import{d4 as w,da as Y,dF as he,d9 as we,a$ as ve,d as ge,r as p,D as Fe,w as xe,q as De,i as Ce,s as W,c as ye,b as a,f as F,l as r,F as He,e as x,j as _e,v as be,g as Te,aK as Ae,o as j}from"./main-BA6IByp5.js";import{u as Se}from"./pageTitle-B21vlPMS.js";import{D as M}from"./button-KLE7N1ea.js";import{D as Re,f as ke,h as Ee,i as Pe,a as Ie}from"./chart-lOXFzThi.js";import{D as E}from"./check-box-DwmWm1zQ.js";import{s as ze,D as c,j as Ve,k as Le,l as Ue}from"./data-grid-C6vrNf0X.js";import{D as q}from"./date-box-BjlbzhYK.js";import{D as Be}from"./load-panel-C2Bzo4IZ.js";import{D as Me,a as Z,b as Oe,c as Ge,d as Ne,e as Ke,f as $e}from"./pivot-grid-BItAcQVR.js";import{a as Ye}from"./popup-DG4RL5cU.js";import{D as We}from"./select-box-WXMYeD5A.js";import{y as J}from"./overlay-DuLKvmQo.js";import"./m_select_box-BfgkrVhL.js";import"./m_row_dragging-D5bGi6cA.js";import{E as X,M as je}from"./export_merged_ranges_manager-CWcrsa4W.js";import{e as qe}from"./exceljs.min-Dm3_meIG.js";import{s as Ze}from"./FileSaver-CQu8bA20.js";import{f as Q}from"./date-C9GFWz3S.js";import{V as Je,a as Qe}from"./VCard-bvvLevnF.js";import{V as Xe}from"./VSwitch-IJfHCZ3l.js";import"./editor-BBQp0CcU.js";import"./m_base_widget-0F2NQ4j5.js";import"./themes-C2TbJqJs.js";import"./language_codes-C3ZVNYdT.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./dayjs.min-WZT4ZYRx.js";import"./tr-gc5XBwcp.js";import"./createSimpleFunctional-nAcGup33.js";import"./VAvatar-D2N_ZOil.js";import"./VImg-BfSY32t_.js";import"./index-C_9jYE9r.js";import"./VCardText-DJ3k762g.js";import"./VInput-C1USnspv.js";import"./focus-CQP_fAha.js";import"./form-DO4DnGMc.js";import"./VSelectionControl-VIR3YQGH.js";class et{constructor(e,o,s,d){this.component=e,this.dataProvider=o,this.worksheet=s,this.mergedRangesManager=new je(o,s),this.topLeftCell=d.topLeftCell,this.customizeCell=d.customizeCell,this.mergeColumnFieldValues=d.mergeColumnFieldValues,this.mergeRowFieldValues=d.mergeRowFieldValues,this.exportFilterFieldHeaders=d.exportFilterFieldHeaders,this.exportDataFieldHeaders=d.exportDataFieldHeaders,this.exportColumnFieldHeaders=d.exportColumnFieldHeaders,this.exportRowFieldHeaders=d.exportRowFieldHeaders,this.rtlEnabled=e.option("rtlEnabled"),this.rowHeaderLayout=e.option("rowHeaderLayout"),this.wrapText=!!e.option("wordWrapEnabled"),this.filterFieldHeaders=this._tryGetFieldHeaders("filter"),this.dataFieldHeaders=this._tryGetFieldHeaders("data"),this.columnFieldHeaders=this._tryGetFieldHeaders("column"),this.rowFieldHeaders=this._tryGetFieldHeaders("row")}_getFirstColumnIndex(){return this.topLeftCell.column}_getWorksheetFrozenState(e){const{x:o,y:s}=this.dataProvider.getFrozenArea();return{state:"frozen",xSplit:e.from.column+o-1,ySplit:e.from.row+s+this._getFieldHeaderRowsCount()-1}}_getFieldHeaderRowsCount(){return 0+this._allowExportFilterFieldHeaders()+(this._allowExportDataFieldHeaders()||this._allowExportColumnFieldHeaders())}_isFrozenZone(){return!0}_isHeaderCell(e,o){return e<this.dataProvider.getColumnAreaRowCount()||o<this.dataProvider.getRowAreaColCount()}_getDefaultFieldHeaderCellsData(e){return{text:e,value:e}}_isInfoCell(e,o){return e<this.dataProvider.getColumnAreaRowCount()&&o<this.dataProvider.getRowAreaColCount()}_allowToMergeRange(e,o,s,d){return!(this.dataProvider.isColumnAreaCell(e,o)&&!this.mergeColumnFieldValues&&d||this.dataProvider.isRowAreaCell(e,o)&&!this.mergeRowFieldValues&&s)}_trySetAutoFilter(){}_trySetFont(e,o){w(o)&&(e.font=e.font||{},e.font.bold=o)}_getFieldHeaderStyles(){const e={style:"thin",color:{argb:"FF7E7E7E"}};return{alignment:J(this.rtlEnabled),bold:!0,border:{bottom:e,left:e,right:e,top:e}}}_trySetOutlineLevel(){}_getAllFieldHeaders(){return this.dataProvider._exportController.getDataSource()._descriptions}_tryGetFieldHeaders(e){if(!this[`export${he(e,!0)}FieldHeaders`])return[];const o=this._getAllFieldHeaders()[e==="data"?"values":`${e}s`].filter((s=>s.area===e));return J(this.rtlEnabled)==="right"&&o.sort(((s,d)=>d.areaIndex-s.areaIndex)),o.map((s=>s.caption))}_customizeCell(e,o,s){we(this.customizeCell)&&!s&&this.customizeCell({excelCell:e,pivotCell:o})}_isRowFieldHeadersRow(e){const o=this._isInfoCell(e,0)&&this.dataProvider.getCellData(e+1,0,!0).cellSourceData.area==="row";return this._allowExportRowFieldHeaders()&&o}_exportAllFieldHeaders(e,o){const s=e.length,d=this.dataProvider.getRowAreaColCount();let f=this.topLeftCell.row;this._allowExportFilterFieldHeaders()&&(this._exportFieldHeaders("filter",f,0,s,o),f+=1),this._allowExportDataFieldHeaders()&&(this._exportFieldHeaders("data",f,0,d,o),this._allowExportColumnFieldHeaders()||this._exportFieldHeaders("column",f,d,s-d,o)),this._allowExportColumnFieldHeaders()&&(this._allowExportDataFieldHeaders()||this._exportFieldHeaders("data",f,0,d,o),this._exportFieldHeaders("column",f,d,s-d,o))}_exportFieldHeaders(e,o,s,d,f){const _=this[`${e}FieldHeaders`],C=this.worksheet.getRow(o),y=e!=="row"||e==="row"&&this.rowHeaderLayout==="tree";y&&this.mergedRangesManager.addMergedRange(C.getCell(this.topLeftCell.column+s),0,d-1);for(let v=0;v<d;v+=1){const b=C.getCell(this.topLeftCell.column+s+v),T=_;let A=[];const D=T.length>d||y?T.join(", "):T[v];A=ve({},this._getDefaultFieldHeaderCellsData(D),{headerType:e}),b.value=D,this._applyHeaderStyles(b,f),this._customizeCell(b,A)}}_applyHeaderStyles(e,o){const{bold:s,alignment:d,border:f}=this._getFieldHeaderStyles();this._trySetFont(e,s),o(e,this.wrapText,d),e.border=f}_allowExportRowFieldHeaders(){return this.rowFieldHeaders.length>0}_allowExportFilterFieldHeaders(){return this.filterFieldHeaders.length>0}_allowExportDataFieldHeaders(){return this.dataFieldHeaders.length>0}_allowExportColumnFieldHeaders(){return this.columnFieldHeaders.length>0}}function tt(n){return X.export(at(n),et,lt,rt)}function at(n){if(!(w(n)&&Y(n)))throw Error('The "exportPivotGrid" method requires a configuration object.');if(!(w(n.component)&&Y(n.component)&&n.component.NAME==="dxPivotGrid"))throw Error('The "component" field must contain a PivotGrid instance.');return w(n.mergeRowFieldValues)||(n.mergeRowFieldValues=!0),w(n.mergeColumnFieldValues)||(n.mergeColumnFieldValues=!0),w(n.exportDataFieldHeaders)||(n.exportDataFieldHeaders=!1),w(n.exportRowFieldHeaders)||(n.exportRowFieldHeaders=!1),w(n.exportColumnFieldHeaders)||(n.exportColumnFieldHeaders=!1),w(n.exportFilterFieldHeaders)||(n.exportFilterFieldHeaders=!1),X.getFullOptions(n)}function lt(n){return n._dataArea.groupElement()}function rt(n){return n.$element()}const it={class:"demo-space-x"},ot={class:"pa-2"},st={class:"export-options"},dt={class:"options"},Yt=ge({__name:"ciro-ozettablo",setup(n){const e=p();p(null);const o=Se(),s=p(),d=p([]),f=p(),_=p(!1),C=p(!1),y=p(!1),v=p(!1),b=p(null),T=p(""),A=p(!1),D=p(!1),P=p(!1),I=p(""),ee=p(["Açık","Kapalı"]),H=new Date,z=new Date(H);z.setDate(H.getDate()-H.getDay()+1);const V=new Date(H);V.setDate(H.getDate()-H.getDay()+7);const L=p([z,V]),S=p(z),R=p(V);document.title="OFT - Cirolar Özet Tablo";function te(i){}const O=async()=>{var i,t,l;await pe(),(l=(t=(i=s.value)==null?void 0:i.instance)==null?void 0:t.getDataSource())==null||l.reload()};function ae(){var i,t;(t=(i=f.value)==null?void 0:i.instance)==null||t.updateDimensions()}const le=Fe(()=>({fields:[{caption:"CARİ ADI",width:120,dataField:"CARI_ADI",area:"filter",filterType:"include"},{caption:"FATURA NO",width:70,dataField:"fatura_no",area:"filter",filterType:"include"},{caption:"FATURA TARİHİ",width:400,dataField:"fatura_tarih",area:"filter",filterType:"include"},{caption:"FATURA TARİHİ (YIL)",area:"row",dataField:"fatura_tarih",groupInterval:"year",dataType:"date",filterType:"include",expanded:!0},{caption:"FATURA TARİHİ (AY)",area:"row",dataField:"fatura_tarih",groupInterval:"month",dataType:"date",filterType:"include",expanded:!0},{caption:"KANAL TİPİ",area:"column",dataField:"KANAL_TIPI",filterType:"include"},{caption:"E-FATURA DURUMU",area:"filter",dataField:"E_FATURA_DURUMU",filterType:"include"},{caption:"FATURA TARİHİ (HAFTA)",area:"filter",dataField:"hafta",groupInterval:"week",dataType:"date",filterType:"include"},{caption:"MİKTAR",area:"data",dataField:"miktar",dataType:"number",filterType:"include",format:{type:"fixedPoint",precision:0,useGrouping:!0}},{caption:"USD NET TUTAR",dataField:"USD_NET_TUTAR",dataType:"number",summaryType:"sum",area:"data",format:{type:"fixedPoint",precision:0,useGrouping:!0}},{caption:"SATIŞ PERSONELİ",dataField:"SATIŞ PERSONEL KODU",area:"filter"}],store:d.value})),re=()=>{var i,t,l;(l=(t=(i=s.value)==null?void 0:i.instance)==null?void 0:t.getDataSource())==null||l.state({})};function ie(i){const t=i.component.getDataSource(),l=i.field;if(l&&(i.items.push({text:"Düzeni Sıfırla",onItemClick(){t.state({})}}),(!l.groupName||l.groupIndex===0)&&i.items.push({text:"Alanı Gizle",onItemClick(){let u;l.groupName?u=t.getAreaFields(l.area,!0)[l.areaIndex].index:u=l.index,t.field(u,{area:null}),t.load()}}),l.dataType==="number")){const u=function(m){t.field(l.index,{summaryType:m.itemData.value}),t.load()},h=[];i.items.push({text:"Hesaplama Türü",items:h}),["Sum","Count","Avg","Min","Max"].forEach(m=>{const g=m.toLowerCase();h.push({text:m,value:m.toLowerCase(),onItemClick:u,selected:i.field.summaryType===g})})}}function oe({value:i}){_.value=i}function se({value:i}){C.value=i}function de({value:i}){y.value=i}function ne({value:i}){v.value=i}function ue(i){const t=new qe.Workbook,l=t.addWorksheet("Cirolar");l.columns=[{width:35}],tt({component:i.component,worksheet:l,topLeftCell:{row:4,column:1},keepColumnWidths:!1,exportDataFieldHeaders:_.value,exportRowFieldHeaders:C.value,exportColumnFieldHeaders:y.value,exportFilterFieldHeaders:v.value}).then(u=>{var N,K;const h=l.getRow(2),m=l.views[0];h.height=30;const g=m.xSplit+1,k=g+3;l.mergeCells(2,g,2,k);const U=h.getCell(g);U.value="Cirolar",U.font={name:"Segoe UI Light",size:22,bold:!0},U.alignment={horizontal:"left",vertical:"middle",wrapText:!0};const fe=(((N=u==null?void 0:u.to)==null?void 0:N.row)??0)+2,B=l.getRow(fe).getCell(((K=u==null?void 0:u.to)==null?void 0:K.column)??0);B.value="www.oftyazilim.com",B.font={color:{argb:"BFBFBF"},italic:!0},B.alignment={horizontal:"right"}}).then(()=>{t.xlsx.writeBuffer().then(u=>{Ze(new Blob([u],{type:"application/octet-stream"}),"Cirolar.xlsx")})})}xe(d,()=>{var i,t,l,u,h,m;(l=(t=(i=s.value)==null?void 0:i.instance)==null?void 0:t.getDataSource())==null||l.reload(),(m=(u=s.value)==null?void 0:u.instance)==null||m.bindChart((h=e.value)==null?void 0:h.instance,{dataFieldsDisplayMode:"splitPanes",alternateDataFields:!0})});const pe=async()=>{L.value=[S.value,R.value],S.value=Q(L.value[0]),R.value=Q(L.value[1]);try{const i=await W.get("/api/ciro-ozettablo",{params:{filterValue:S.value,filterValue1:R.value,acik_kapali:I.value,userId:G.value.id}});d.value=i.data.ciro}catch(i){console.error("Veri çekilirken hata oluştu:",i)}D.value=!1},G=De("userData");Ce(async()=>{o.setTitle("Cirolar Özet Tablo"),W.post("/api/log-kayit",{userId:G.value.id,sayfa:"Cirolar (özet tablo)",eylem:"Yükleme"})});const me=({seriesName:i,originalValue:t})=>{const l=i.indexOf("Total")!==-1?new Intl.NumberFormat("en-TR").format(t):t;return{html:`${i}<div class='currency'>${l}</div>`}},ce=i=>{Ae(()=>{i.component._$element.find(".dx-pivotgrid-cell").each((u,h)=>{const m=$(h),g=parseFloat(m.text());if(!isNaN(g)){m.empty();const k=document.createElement("div");m.append(k),new DxProgressBar({elementAttr:{class:"progress-bar"},value:g,showStatus:!0}).$mount(k)}})})};return(i,t)=>(j(),ye(He,null,[a(Je,{class:"mt-0 pa-0 pt-2"},{default:F(()=>[x("div",null,[a(Qe,null,{default:F(()=>[x("div",it,[a(r(q),{label:"Başlangıç Tarihi",width:"150","label-mode":"floating",value:S.value,"onUpdate:value":t[0]||(t[0]=l=>S.value=l),type:"date"},null,8,["value"]),a(r(q),{label:"Bitiş Tarihi",width:"150","label-mode":"floating",value:R.value,"onUpdate:value":t[1]||(t[1]=l=>R.value=l),type:"date"},null,8,["value"]),a(r(We),{items:ee.value,value:I.value,"onUpdate:value":t[2]||(t[2]=l=>I.value=l),"show-clear-button":!0,label:"Açık-Kapalı","label-mode":"floating",width:"140"},null,8,["items","value"]),a(r(M),{class:"mt-1",icon:"refresh",text:"Yenile",onClick:O}),a(r(M),{class:"mt-1",icon:"undo",text:"Düzen Sıfırla",onClick:t[3]||(t[3]=l=>re())}),a(Xe,{modelValue:P.value,"onUpdate:modelValue":t[4]||(t[4]=l=>P.value=l),label:"Grafik Göster",value:"chartGoster"},null,8,["modelValue"])])]),_:1}),_e(x("div",ot,[t[8]||(t[8]=x("div",{class:"long-title"},[x("h3",null,"Ciro Tablosu")],-1)),a(r(Re),{ref_key:"chart",ref:e},{default:F(()=>[a(r(ke),{enabled:!0,"customize-tooltip":me}),a(r(Ee),{width:450}),a(r(Pe),{height:320}),a(r(Ie),{type:"bar"})]),_:1},512)],512),[[be,P.value]]),a(r(Me),{class:"mt-0 pt-0",id:"pivotgrid",ref_key:"grid",ref:s,"data-source":le.value,"allow-sorting-by-summary":!0,"allow-filtering":!0,"show-borders":!0,"show-column-grand-totals":!0,"show-row-grand-totals":!0,"show-row-totals":!0,"show-column-totals":!0,onExporting:ue,onContentReady:ce,"on-context-menu-preparing":ie,onCellClick:te},{fieldChooserButton:F(()=>[a(r(M),{icon:"plus",text:"Özel Buton",onClick:t[6]||(t[6]=l=>O())})]),default:F(()=>[a(r(Z),{"show-relevant-values":!1,width:300,height:400},{default:F(()=>[a(r(Oe),{enabled:!0})]),_:1}),(j(),Te(r(Be),{key:D.value,visible:D.value,"onUpdate:visible":t[5]||(t[5]=l=>D.value=l),"show-indicator":!0,"show-pane":!0,shading:!0},null,8,["visible"])),a(r(Ge),{"allow-search":!0}),a(r(Ne),{"show-data-fields":!0,"show-row-fields":!0,"show-column-fields":!0,"show-filter-fields":!0,"allow-field-dragging":!0,visible:!0}),a(r(Ke),{enabled:!0}),a(r($e),{enabled:!0,type:"localStorage","storage-key":"dx-widget-gallery-pivotgrid-ciro-storing"})]),_:1},8,["data-source"])]),x("div",st,[t[9]||(t[9]=x("div",{class:"caption"},"Dışa Aktarma Seçenekleri",-1)),x("div",dt,[a(r(E),{id:"export-data-field-headers",value:_.value,"on-value-changed":oe,text:"Alan Başlıklarını Aktar"},null,8,["value"]),a(r(E),{id:"export-row-field-headers",value:C.value,"on-value-changed":se,text:"Satır Alan Başlıklarını Dışa Aktar"},null,8,["value"]),a(r(E),{id:"export-column-field-headers",value:y.value,"on-value-changed":de,text:"Sütun Alan Başlıklarını Dışa Aktar"},null,8,["value"]),a(r(E),{id:"export-filter-field-headers",value:v.value,"on-value-changed":ne,text:"Filtre Alan Başlıklarını Dışa Aktar"},null,8,["value"])])])]),_:1}),a(r(Ye),{width:1500,height:900,title:T.value,visible:A.value,"onUpdate:visible":t[7]||(t[7]=l=>A.value=l),onShown:ae,"show-close-button":!0},{default:F(()=>[a(r(ze),{id:"grid",ref:f.value,"data-source":b.value,"key-expr":"satir_id","show-borders":!0,"row-alternation-enabled":!1,"min-width":200,"allow-column-reordering":!0,"column-auto-width":!1,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:i.onCellPrepared},{default:F(()=>[a(r(c),{"data-field":"id",caption:"ID",visible:!1,"min-width":90}),a(r(c),{"data-field":"haftax",caption:"HFT","data-type":"string",visible:!1,width:20}),a(r(c),{"data-field":"OPERASYON",caption:"OPERASYON",visible:i.operasyon,width:120},null,8,["visible"]),a(r(c),{"data-field":"siparis_belge_no",caption:"SİPARİŞ NO",width:90,visible:!0,"allow-sorting":!1}),a(r(c),{"data-field":"cari_ad",caption:"MÜŞTERİ",visible:!0,"min-width":140,"allow-sorting":!1}),a(r(c),{"data-field":"stok_kodu",caption:"STOK KODU",visible:!0,width:120,"allow-sorting":!1}),a(r(c),{"data-field":"stok_adi",caption:"STOK ADI","min-width":200,"allow-sorting":!1}),a(r(c),{"data-field":"isemri_no",caption:"İŞ EMRİ NO",width:120,"allow-sorting":!1}),a(r(c),{"data-field":"teslim_tarihi",caption:"TESLİM TARİHİ","data-type":"date",width:140,visible:i.operasyon,format:{formatter:l=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(l)).replace(/\//g,".")},"allow-sorting":!1},null,8,["visible","format"]),a(r(c),{"data-field":"kalan_miktar",caption:"KALAN MİKTAR","data-type":"number",width:100,visible:!0,"allow-sorting":!1,format:{type:"fixedPoint",precision:1,thousandsSeparator:","}}),a(r(c),{"data-field":"isemri_miktari",caption:"İŞ EMRİ MİKTARI","data-type":"number",width:90,visible:!0,format:{type:"fixedPoint",precision:1,thousandsSeparator:","}}),a(r(c),{"data-field":"operasyon_hazirlik_suresi",caption:"HAZIRLIK SÜRESİ","data-type":"number",width:90,visible:!0,format:{type:"fixedPoint",precision:1,thousandsSeparator:","}}),a(r(c),{"data-field":"operasyon_suresi",caption:"OPERASYON SÜRESİ","data-type":"number",width:90,visible:!0,format:{type:"fixedPoint",precision:1,thousandsSeparator:","},"allow-sorting":!1}),a(r(c),{"data-field":"satir_id",caption:"SATIR ID",visible:!1,"min-width":90,"allow-sorting":!1}),a(r(Z),{visible:!0}),a(r(Ve),{visible:!0}),a(r(Le),{visible:!0,width:240}),a(r(Ue),{mode:"multiple"})]),_:1},8,["data-source","onCellPrepared"])]),_:1},8,["title","visible"])],64))}});export{Yt as default};
