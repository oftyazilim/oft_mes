import{_ as A}from"./AppSelect.vue_vue_type_script_setup_true_lang-lgv_3q_y.js";import{_ as B}from"./AppTextField.vue_vue_type_script_setup_true_lang-BHOOf77t.js";import{d as K,D as N,r as n,aL as z,w as C,g as S,o as k,f as t,b as s,m as P,aF as V,p as D,l,T as y,y as E,aM as O,aE as j}from"./main-BsBPzaN6.js";import{r as w,e as q}from"./validators-BwBNGiur.js";import{$ as c}from"./api-BQNiQ3o8.js";import{V as I,a as L}from"./VToolbar-CgVmy0uY.js";import{V as Y}from"./VSpacer-fylUpn_x.js";import{V as G}from"./VDivider-7uupSCsu.js";import{V as H}from"./VAlert-DEFyGUqd.js";import{V as J}from"./VCard-Bn92qnwe.js";import{V as Q}from"./VCardText-E037F6rH.js";import{V as W}from"./VForm-CgjybpOp.js";import{V as X}from"./VRow-CwsVaWJo.js";import{V as d}from"./VCol-nFHEoKtU.js";import{V as Z}from"./VNavigationDrawer-Cjd1aiMJ.js";const Ve=K({__name:"UserFormDrawer",props:{modelValue:{type:Boolean},editUser:{}},emits:["update:modelValue","saved"],setup(F,{emit:M}){const _=F,b=M,u=N({get:()=>_.modelValue,set:o=>b("update:modelValue",o)}),g=n(),e=z({id:void 0,name:"",email:"",password:"",roles:[],permissions:[]}),U=n([]),x=n([]),T=n(!1),f=n(!1),p=n(null);C(()=>_.editUser,o=>{o?(e.id=o.id,e.name=o.name,e.email=o.email,e.password="",e.roles=(o.roles||[]).map(a=>a.name),e.permissions=(o.permissions||[]).map(a=>a.name)):(e.id=void 0,e.name="",e.email="",e.password="",e.roles=[],e.permissions=[])},{immediate:!0});const R=async()=>{T.value=!0;try{const[o,a]=await Promise.all([c("/roles/available"),c("/permissions")]);U.value=(o.roles||[]).map(i=>({title:i.name,value:i.name})),x.value=(a||[]).map(i=>({title:i.name,value:i.name}))}catch(o){p.value=(o==null?void 0:o.message)||"Meta veriler alınamadı."}finally{T.value=!1}};C(u,o=>{o&&R()});const v=()=>{u.value=!1},$=async()=>{var a,i;p.value=null;const o=await((a=g.value)==null?void 0:a.validate());if(o!=null&&o.valid)try{f.value=!0;const r={name:e.name,email:e.email,roles:e.roles,permissions:e.permissions};e.password&&(r.password=e.password),e.id?await c(`/users/${e.id}`,{method:"PUT",body:r}):await c("/users",{method:"POST",body:{...r,password:e.password||void 0}}),b("saved"),v()}catch(r){p.value=((i=r==null?void 0:r.data)==null?void 0:i.message)||(r==null?void 0:r.message)||"Kayıt başarısız."}finally{f.value=!1}};return(o,a)=>{const i=B,r=A;return k(),S(Z,{modelValue:l(u),"onUpdate:modelValue":a[5]||(a[5]=m=>j(u)?u.value=m:null),location:"end",temporary:"",width:"480"},{default:t(()=>[s(I,{density:"comfortable",flat:""},{default:t(()=>[s(L,null,{default:t(()=>[V(D(l(e).id?"Kullanıcıyı Düzenle":"Yeni Kullanıcı"),1)]),_:1}),s(Y),s(y,{icon:"",variant:"text",onClick:v},{default:t(()=>[s(E,{icon:"tabler-x"})]),_:1})]),_:1}),s(G),l(p)?(k(),S(H,{key:0,type:"error",variant:"tonal",class:"ma-4"},{default:t(()=>[V(D(l(p)),1)]),_:1})):P("",!0),s(J,{flat:""},{default:t(()=>[s(Q,null,{default:t(()=>[s(l(W),{ref_key:"refVForm",ref:g,onSubmit:O($,["prevent"])},{default:t(()=>[s(X,null,{default:t(()=>[s(d,{cols:"12"},{default:t(()=>[s(i,{modelValue:l(e).name,"onUpdate:modelValue":a[0]||(a[0]=m=>l(e).name=m),label:"Ad Soyad",rules:[l(w)]},null,8,["modelValue","rules"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(i,{modelValue:l(e).email,"onUpdate:modelValue":a[1]||(a[1]=m=>l(e).email=m),label:"E-posta",rules:[l(w),l(q)]},null,8,["modelValue","rules"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(i,{modelValue:l(e).password,"onUpdate:modelValue":a[2]||(a[2]=m=>l(e).password=m),label:l(e).id?"Şifre (opsiyonel)":"Şifre",type:"password",rules:l(e).id?[]:[l(w)]},null,8,["modelValue","label","rules"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(r,{modelValue:l(e).roles,"onUpdate:modelValue":a[3]||(a[3]=m=>l(e).roles=m),items:l(U),label:"Roller",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(r,{modelValue:l(e).permissions,"onUpdate:modelValue":a[4]||(a[4]=m=>l(e).permissions=m),items:l(x),label:"İzinler",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),s(d,{cols:"12",class:"d-flex justify-end gap-3"},{default:t(()=>[s(y,{variant:"tonal",color:"secondary",onClick:v},{default:t(()=>a[6]||(a[6]=[V("İptal")])),_:1,__:[6]}),s(y,{type:"submit",loading:l(f),disabled:l(f)},{default:t(()=>a[7]||(a[7]=[V("Kaydet")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{Ve as _};
