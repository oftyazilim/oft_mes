import{m as rt,g as V,c as Me,a as he,D as it,d as lt,b as at,s as ut,r as Be,e as dt,f as ct,h as pt,i as Re,G as gt,j as ht,k as mt,l as ne,n as ft,o as _t,p as Ct,q as yt,t as xt,u as wt,v as W,w as vt,x as It,y as St,z as bt,A as Et,B as kt,E as Gt,F as Ot,H as At,I as Tt,J as Dt,K as Mt,L as Bt,M as Rt,N as D,O as Pt,P as Y,Q as me,R as Lt,S as Ft,T as Vt,U as Ht,V as Nt,W as $t,X as Kt,Y as Wt,Z as L,_ as zt}from"./m_row_dragging-DnmdIjTe.js";import{a$ as v,d1 as x,dc as H,d_ as Ut,dD as k,df as w,d3 as b,dL as fe,dZ as y,d4 as _,d9 as N,dK as B,d6 as jt,db as Pe,dk as qt,dG as Qt,e3 as Xt,da as _e,e6 as Jt,d$ as Ce,dO as Yt}from"./main-BsBPzaN6.js";import{N as $,ao as Zt,s as C,q as se,n as eo,I as to,ai as re,e as ye,C as xe,aH as oo,U as no,aG as so}from"./dom_component-BOMsNA7g.js";import{a as ro}from"./themes-s_hOyPlB.js";import{o as R,e as ie,q as le,s as ae,k as io,w as Le,a as z,m as lo,b as ao}from"./m_resize_observer-D2tcFhH5.js";import{y as uo,c as co,B as po,A as Fe,d as we,a9 as ve,P as go,E as ho}from"./m_select_box-B4A-KNOi.js";import{W as Z}from"./overlay-CBORn4Ri.js";const g=v({},rt,V,{modules:[]});Me.views.columnHeadersView;g.registerModule("columnHeaders",Me);g.registerModule("columns",{defaultOptions:()=>x(!0,{},he.defaultOptions(),{commonColumnSettings:{allowExporting:!0}}),controllers:he.controllers});let U=it;const K={extend(l){U=l(U)},create:l=>new U(l)};class mo extends at{_getDataSourceAdapter(){return K}_getSpecificDataSourceOption(){const e=this.option("dataSource");return e&&!Array.isArray(e)&&this.option("keyExpr")&&$.log("W1011"),super._getSpecificDataSourceOption()}}g.registerModule("data",{defaultOptions:lt.defaultOptions,controllers:{data:mo}});g.registerModule("sorting",ut);Be.views.rowsView;g.registerModule("rows",Be);g.registerModule("contextMenu",dt);g.registerModule("errorHandling",ct);g.registerModule("gridView",pt);Re.views.headerPanel;g.registerModule("headerPanel",Re);const fo="Specifying grid templates with the jQuery selector name is now deprecated. Use the DOM Node or the jQuery object that references this selector instead.";g.registerModulesOrder(["stateStoring","columns","selection","editorFactory","columnChooser","grouping","editing","editingRowBased","editingFormBased","editingCellBased","masterDetail","validating","adaptivity","data","virtualScrolling","columnHeaders","filterRow","headerPanel","headerFilter","sorting","search","rows","pager","columnsResizingReordering","contextMenu","keyboardNavigation","headersKeyboardNavigation","groupPanelKeyboardNavigation","errorHandling","summary","columnFixing","export","gridView"]);class _o extends gt{_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:{platform:"ios"},options:{showRowLines:!0}},{device:()=>ro(),options:{showRowLines:!0,showColumnLines:!1,headerFilter:{height:315},editing:{useIcons:!0},selection:{showCheckBoxesMode:"always"}}},{device:()=>Zt.webkit,options:{loadingTimeout:30,loadPanel:{animation:{show:{easing:"cubic-bezier(1, 0, 1, 0)",duration:500,from:{opacity:0},to:{opacity:1}}}}}},{device:e=>e.deviceType!=="desktop",options:{grouping:{expandMode:"rowClick"}}}])}_init(){super._init(),V.logHeaderFilterDeprecatedWarningIfNeed(this),g.processModules(this,g),g.callModuleItemsMethod(this,"init")}_initMarkup(){super._initMarkup.apply(this,arguments),this.getView("gridView").render(this.$element())}_setDeprecatedOptions(){super._setDeprecatedOptions(),x(this._deprecatedOptions,{useKeyboard:{since:"19.2",alias:"keyboardNavigation.enabled"},rowTemplate:{since:"21.2",message:'Use the "dataRowTemplate" option instead'}})}static registerModule(e,t){g.registerModule(e,t)}getGridCoreHelper(){return g}_getTemplate(e){let t=e;return H(t)&&t.startsWith("#")&&(t=C(e),Ut.warn(fo)),super._getTemplate(t)}focus(e){this.getController("keyboardNavigation").focus(e)}}se("dxDataGrid",_o);g.registerModule("stateStoring",ht);g.registerModule("selection",mt);ne.controllers.columnChooser;ne.views.columnChooserView;g.registerModule("columnChooser",ne);const I={groupPanel:"dx-datagrid-group-panel",groupPanelMessage:"dx-group-panel-message",groupPanelItem:"dx-group-panel-item",groupPanelLabel:"dx-toolbar-label",groupPanelContainer:"dx-toolbar-item"},Co="groupbycolumn",ue="ungroupcolumn",de="ungroupallcolumns";function T(l,e){const t=R(e.group),o=[];for(let n=0;n<l.length;n++)o.push([t[n].selector,"=",l[n]]);return e.filter&&o.push(e.filter),V.combineFilters(o)}function Ve(l,e,t){const o=R(e.group);let n=[];for(let s=t?l.length-1:0;s<l.length;s++){const r=[];for(let i=0;i<=s;i++){const{selector:u}=o[i];if(s===i&&(l[i]===null||l[i]===!1||l[i]===!0))l[i]===!1?r.push([u,"=",o[i].desc?!0:null]):(l[i]?!o[i].desc:o[i].desc)?r.push([u,"<>",l[i]]):(r.push([u,"<>",null]),r.push([u,"=",null]));else{const a=[u,s===i?o[i].desc?">":"<":"=",l[i]];a[1]==="<"?r.push([a,"or",[u,"=",null]]):r.push(a)}}n.push(g.combineFilters(r))}return n=g.combineFilters(n,"or"),g.combineFilters([n,e.filter])}const Ie=function(l,e){const{hash:t}=l;return t&&t[JSON.stringify(e)]},yo=function(l,e){let t=0,o=l.length-1;if(!l.length)return 0;do{const s=o+t>>1;l[s].offset>e?o=s:t=s}while(o-t>1);let n;for(n=t;n<=o&&!(l[n].offset>e);n++);return n},He=function(l,e,t){for(let o=0;o<l.length;o++)e+1>=t?l[o].children=[]:He(l[o].children,e+1,t)},Ne=function(l,e,t){let o=0;if(e)if(!t)o=e.length;else for(let n=0;n<e.length;n++)l.isGroupItemCountable(e[n])&&o++,o+=Ne(l,e[n].items,t-1);return o};let $e=class{constructor(e){this._dataSource=e,this.reset()}reset(){this._groupsInfo=[],this._totalCountCorrection=0}totalCountCorrection(){return this._totalCountCorrection}updateTotalItemsCount(e){this._totalCountCorrection=e||0}isGroupItemCountable(e){return!this._isVirtualPaging()||!e.isContinuation}_isVirtualPaging(){const e=this._dataSource.option("scrolling.mode");return e==="virtual"||e==="infinite"}itemsCount(){const t=this._dataSource._dataSource,o=g.normalizeSortingInfo(t.group()||[]).length;return Ne(this,t.items(),o)}foreachGroups(e,t,o,n,s){const r=this;return(function i(u,a,d,c){const p=[];function h(f,E,G,S){const O=E&&f(E,G);return O&&S.push(O),O}for(let f=0;f<u.length;f++){if(c.push(u[f].data),!d&&h(a,u[f].data,c,p)===!1)return!1;if(!u[f].data||u[f].data.isExpanded||o){const{children:E}=u[f],G=E.length&&i(E,a,d,c);if(G&&p.push(G),G===!1)return!1}if(d&&h(a,u[f].data,c,p)===!1)return!1;(!u[f].data||u[f].data.offset!==u[f].offset)&&(n=!0),c.pop()}const m=s&&c.slice(0);return n&&k.apply(C,p).always((()=>{r._updateGroupInfoOffsets(u,m)}))})(r._groupsInfo,e,t,[])}_updateGroupInfoOffsets(e,t){t=t||[];for(let o=0;o<e.length;o++){const n=e[o];if(n.data&&n.data.offset!==n.offset){n.offset=n.data.offset;for(let s=0;s<t.length;s++)t[s].offset=n.offset}}e.sort(((o,n)=>o.offset-n.offset))}findGroupInfo(e){let t,o=this._groupsInfo;for(let n=0;o&&n<e.length;n++)t=Ie(o,e[n]),o=t&&t.children;return t&&t.data}addGroupInfo(e){const t=this;let o;const{path:n}=e;let s=t._groupsInfo;for(let r=0;r<n.length;r++){if(o=Ie(s,n[r]),!o){o={key:n[r],offset:e.offset,data:{offset:e.offset,isExpanded:!0,path:n.slice(0,r+1)},children:[]};const i=yo(s,e.offset);s.splice(i,0,o),s.hash=s.hash||{},s.hash[JSON.stringify(o.key)]=o}r===n.length-1&&(o.data=e,o.offset!==e.offset&&t._updateGroupInfoOffsets(s)),s=o.children}}allowCollapseAll(){return!0}refresh(e){const t=this,{storeLoadOptions:o}=e,n=R(o.group||[]),s="_group"in t?R(t._group||[]):n;let r=Math.min(s.length,n.length);t._group=o.group;for(let i=0;i<r;i++)if(!V.isEqualSelectors(s[i].selector,n[i].selector)){r=i;break}r?He(t._groupsInfo,0,r):t.reset()}handleDataLoading(){}handleDataLoaded(e,t){t(e)}handleDataLoadedCore(e,t){t(e)}};function ee(l,e,t,o){if(o=o||0,e>1&&t>0){let n=l-Math.floor(l/e)*e||e;return n+=t-o-2,n<0&&(n+=e),Math.floor(n/(e-o-1))}return 0}const M=function(l,e,t){return l.foreachGroups(((o,n)=>{if(o.isExpanded)return e(o,n)}),!0,!1,t,t)},ce=function(l,e,t,o,n,s,r){let i;if(o.items=o.items||[],o.paths=o.paths||[],o.count=o.count||0,o.lastCount=o.lastCount||0,!!t)for(let u=0;u<e.length;u++){const a=e[u];if(a.items!==void 0){if(n.push(a.key),s)i=!0;else{const d=l.findGroupInfo(n);i=d&&d.isExpanded}i?a.items?ce(l,a.items,t-1,o,n,s,r):t===1&&a.count&&(!s||r)&&(o.items.push(a),o.paths.push(n.slice(0)),o.count+=o.lastCount,o.lastCount=a.count):(a.collapsedItems=a.items,a.items=null),n.pop()}}},xo=function(l,e,t,o,n){const s=l.findGroupInfo(o);let r;s?(t?s.count=e.count>0?e.count:e.items&&e.items.length||0:e.count=s.count||e.count,s.offset=n):(t&&(r=e.count>0?e.count:e.items.length),l.addGroupInfo({isExpanded:l._isGroupExpanded(o.length-1),path:o.slice(0),offset:n,count:r||0}))},pe=function(l,e,t,o,n,s,r){const u=(e.group?e.group.length:0)===o,a=e.remoteOperations.paging;let d=0,c=0,p;if(n=n||0,s=s||[],a&&!r&&(d=n===0?e.skip||0:e.skips[n-1]||0),n>=o)return t.length;for(let h=0;h<t.length;h++){const m=t[h];if(m){if(s.push(m.key),!m.count&&!m.items||m.items===void 0||(xo(l,m,u,s,d+h),p=m.items?pe(l,e,m.items,o,n+1,s,h):m.count||-1,p<0))return-1;c+=p,s.pop()}}return c},j=function(l,e){return l&&l.length&&l[e]&&!!l[e].isExpanded},Se=function(l,e,t){let o,n=t;for(let s=0;s<l.length;s++)o=l[s].offset+1,s>0&&(o+=l[s-1].childrenTotalCount,e&&(o+=ee(n,e,o,s-1)*s)),n+=o;return n};function Ke(l,e,t,o){const n=e.items[o],s=l.skips&&l.skips[t],r=l.takes&&l.takes[t],i=o===e.items.length-1,u=o===0,a=u&&s||0,d=n.count>r+a;u&&s!==void 0&&(n.isContinuation=!0),i&&r!==void 0&&d&&(n.isContinuationOnNextPage=!0)}function wo(l,e,t){const o=t-1,n=l.group?l.group.length:0;e.skip=l.skips&&l.skips[o],l.takes&&l.takes[o]!==void 0&&(n===t?e.take=e.count?e.count-(e.skip||0):0:e.take=0,e.take+=l.takes[o])}function We(l){return!Array.isArray(l)}function be(l){We(l.data)||(l.data=new w)}function ze(l,e,t,o,n,s){e.isCustomLoading||(o={},ce(l,s,t,o,[]),wo(e,o,t));const r=e.group?e.group.length:0;o.paths.length&&r-t>0?(be(e),vo(l,e,o,t,n,s)):o.paths.length&&e.storeLoadOptions.group?(be(e),Io(l,e,o,s)):We(e.data)&&e.data.resolve(s)}function vo(l,e,t,o,n,s){const r=e.group||[],i=r[n+1],u=[];b(t.paths,(a=>{var d;const c={requireTotalCount:!1,requireGroupCount:!0,group:[i],groupSummary:e.storeLoadOptions.groupSummary,filter:T(t.paths[a],{filter:e.storeLoadOptions.filter,group:r}),select:e.storeLoadOptions.select,langParams:(d=e.storeLoadOptions)===null||d===void 0?void 0:d.langParams};a===0&&(c.skip=t.skip||0),a===t.paths.length-1&&(c.take=t.take);const p=c.take===0?[]:l._dataSource.loadFromStore(c);k(p).done((h=>{const m=t.items[a];Ke(e,t,n,a),m.items=h})),u.push(p)})),k.apply(null,u).done((()=>{pe(l,e,s,o+1),ze(l,e,o+1,t,n+1,s)}))}function Io(l,e,t,o){const n=[],s=e.group||[];b(t.paths,((a,d)=>{n.push(T(d,{group:e.isCustomLoading?e.storeLoadOptions.group:s}))}));let{filter:r}=e.storeLoadOptions;e.storeLoadOptions.isLoadingAll||(r=g.combineFilters([r,g.combineFilters(n,"or")]));const i=x({},e.storeLoadOptions,{requireTotalCount:!1,requireGroupCount:!1,group:null,sort:s.concat(g.normalizeSortingInfo(e.storeLoadOptions.sort||[])),filter:r}),u=l._dataSource.isLastLevelGroupItemsPagingLocal();u||(i.skip=t.skip,i.take=t.take),k(t.take===0?[]:l._dataSource.loadFromStore(i)).done((a=>{u&&(a=l._dataSource.sortLastLevelGroupItems(a,s,t.paths),a=t.skip?a.slice(t.skip):a,a=t.take?a.slice(0,t.take):a),b(t.items,((d,c)=>{const p=c.count-(d===0&&t.skip||0),h=a.splice(0,p);Ke(e,t,s.length-1,d),c.items=h})),e.data.resolve(o)})).fail(e.data.reject)}const q=function(l,e){const t=new w,o=!!(e.group&&e.group.length),n=x({skip:0,take:1,requireGroupCount:o,requireTotalCount:!o},e,{group:o?e.group:null});return l.load(n).done(((s,r)=>{const i=r&&(o?r.groupCount:r.totalCount);if(!isFinite(i)){t.reject(ie.Error(o?"E4022":"E4021"));return}t.resolve(i)})).fail(t.reject.bind(t)),t};let Ee=class extends $e{updateTotalItemsCount(e){let t=0;const o=e.extra&&e.extra.totalCount||0,n=e.extra&&e.extra.groupCount||0,s=this._dataSource.pageSize(),r=this._isVirtualPaging();M(this,(i=>{i.childrenTotalCount=0})),M(this,((i,u)=>{const a=Se(u,r?0:s,t);let d=i.count+i.childrenTotalCount;r||(d+=ee(a,s,d,u.length-1)),u[u.length-2]?u[u.length-2].childrenTotalCount+=d:t+=d})),super.updateTotalItemsCount(t-o+n)}_isGroupExpanded(e){const t=this._dataSource.group();return j(t,e)}_updatePagingOptions(e,t){const o=this,n=o._isVirtualPaging(),s=o._dataSource.pageSize(),r=[],i=[];let u=0,a=0;e.take&&(M(this,(d=>{d.childrenTotalCount=0,d.skipChildrenTotalCount=0})),M(o,((d,c)=>{let p,h=0,m=0;const f=Se(c,n?0:s,a);let E=0,G=0,S=d.count+d.childrenTotalCount,O=S;t&&t(d,f);const A=e.skip-f;f<=e.skip+e.take&&S&&(p=e.take,n||(E=ee(f,s,S,c.length-1),S+=E*c.length,O+=E,s&&A>=0&&(h=c.length,m=c.length-1,G=Math.floor(A/s))),A>=0?(f+S>e.skip&&r.unshift(A-G*h-d.skipChildrenTotalCount),f+S>=e.skip+p&&i.unshift(p-h-d.childrenTotalCount+d.skipChildrenTotalCount)):f+S>=e.skip+p&&i.unshift(p+A-d.childrenTotalCount)),f<=e.skip&&(c[c.length-2]?c[c.length-2].skipChildrenTotalCount+=Math.min(O,A+1-G*m):u+=Math.min(O,A+1)),f<=e.skip+p&&(S=Math.min(O,A+p-(G+1)*m),c[c.length-2]?c[c.length-2].childrenTotalCount+=S:a+=S)})),e.skip-=u,e.take-=a-u),e.skips=r,e.takes=i}changeRowExpand(e){const t=this.findGroupInfo(e),o=this._dataSource,n=o.remoteOperations().groupPaging,s=g.normalizeSortingInfo(o.group());return t?(t.isExpanded=!t.isExpanded,n&&t.isExpanded&&e.length<s.length?q(o,{filter:T(e,{filter:o.lastLoadOptions().filter,group:o.group()}),group:[s[e.length]],select:o.select()}).done((r=>{t.count=r})):new w().resolve()):new w().reject()}handleDataLoading(e){const t=this,{storeLoadOptions:o}=e,n=g.normalizeSortingInfo(o.group||e.loadOptions.group);if(!(e.isCustomLoading||!n.length)){if(e.remoteOperations.grouping){const s=t._dataSource.remoteOperations().paging;o.group=g.normalizeSortingInfo(o.group),o.group.forEach(((r,i)=>{const u=i===o.group.length-1;r.isExpanded=!s||!u}))}e.group=e.group||n,e.remoteOperations.paging?(e.skip=o.skip,e.take=o.take,o.requireGroupCount=!0,o.group=n.slice(0,1),t._updatePagingOptions(e),o.skip=e.skip,o.take=e.take):(e.skip=e.loadOptions.skip,e.take=e.loadOptions.take,t._updatePagingOptions(e))}}handleDataLoadedCore(e,t){const o=this,n=g.normalizeSortingInfo(e.storeLoadOptions.group||e.loadOptions.group).length,s=e.group?e.group.length:0;let r;const i={};if(e.isCustomLoading)t(e),ce(o,e.data,n,i,[],e.isCustomLoading,e.storeLoadOptions.isLoadingAll);else{if(e.remoteOperations.paging||o.foreachGroups((u=>{u.count=0})),r=pe(o,e,e.data,n),r<0){e.data=new w().reject($.Error("E1037"));return}if(e.remoteOperations.paging||n&&e.extra&&e.loadOptions.requireTotalCount&&(e.extra.totalCount=r,e.extra.groupCount=e.data.length),s&&e.storeLoadOptions.requireGroupCount&&!isFinite(e.extra.groupCount)){e.data=new w().reject(ie.Error("E4022"));return}o.updateTotalItemsCount(e),e.remoteOperations.paging||(o._updatePagingOptions(e),e.lastLoadOptions.skips=e.skips,e.lastLoadOptions.takes=e.takes),t(e),e.remoteOperations.paging||o._processPaging(e,n)}ze(o,e,n,i,0,e.data)}_processSkips(e,t,o){if(!o)return;const n=e[0],s=t[0],r=n&&n.items;s!==void 0&&(n.isContinuation=!0,r&&(n.items=r.slice(s),this._processSkips(n.items,t.slice(1),o-1)))}_processTakes(e,t,o,n,s){if(!n||!e)return;s=s||[];const r=e[e.length-1];let i=r&&r.items;const u=o[0],a=t[0];if(r){const d=r.count-(r.isContinuation&&a||0)||i.length;u!==void 0&&d>u&&(r.isContinuationOnNextPage=!0,s.forEach((c=>{c.isContinuationOnNextPage=!0})),i&&(i=i.slice(0,u),r.items=i)),s.push(r),this._processTakes(i,t.slice(1),o.slice(1),n-1,s)}}_processPaging(e,t){this._processSkips(e.data,e.skips,t),this._processTakes(e.data,e.skips,e.takes,t)}isLastLevelGroupItemsPagingLocal(){return!1}sortLastLevelGroupItems(e){return e}refresh(e,t){const o=this,n=o._dataSource,{storeLoadOptions:s}=e,r=e.group||e.storeLoadOptions.group,i=g.normalizeSortingInfo(o._group);let u,a;function d(c,p){p.length===a+1&&(c.isExpanded=u)}for(a=0;a<i.length;a++)u=j(r,a),j(o._group,a)!==u&&o.foreachGroups(d);if(super.refresh.apply(this,arguments),r&&e.remoteOperations.paging&&t.reload)return M(o,(c=>{const p=q(n,{filter:T(c.path,{filter:s.filter,group:r}),group:r.slice(c.path.length),select:s.select}),h=q(n,{filter:Ve(c.path,{filter:s.filter,group:r},!0),group:r.slice(c.path.length-1,c.path.length),select:s.select});return k(h,p).done(((m,f)=>{m=parseInt(m.length?m[0]:m),f=parseInt(f.length?f[0]:f),c.offset=m,c.count!==f&&(c.count=f,o.updateTotalItemsCount(e))}))}),!0)}};const Q=function(l,e){const t=new w,o=x({skip:0,take:1,requireTotalCount:!0},e);return l.load(o).done(((n,s)=>{t.resolve(s&&s.totalCount)})).fail(t.reject.bind(t)),t},F=function(l,e,t){return l.foreachGroups((o=>{if(!o.isExpanded)return e(o)}),!1,!1,t,!0)},ke=function(l,e){let t=0,o=e||0;return e&&(F(l,(n=>{if(n.offset-t>=e)return!1;t+=n.count-1})),o+=t),o},Ue=function(l,e,t,o,n,s){let r=0,i=!1;for(let u=0;u<e.length;u++){const a=e[u];if(a.items!==void 0){t.push(a.key);const d=l.findGroupInfo(t);if(d&&!d.isExpanded)a.collapsedItems=a.items,a.items=null,o+=d.count,s--,s<0&&r++,n&&(i=!0);else if(a.items){const c=Ue(l,a.items,t,o,n,s);n&&(c.offset-o>1?a.isContinuation=!0:i=!0),o=c.offset,s=c.take,s<0&&(a.items.length?a.isContinuationOnNextPage=!0:r++)}t.pop()}else n&&(i=!0),o++,s--,s<0&&r++;n=!1}return i&&e.splice(0,1),r&&e.splice(-r,r),{offset:o,take:s}},So=function(l,e){if(l.length!==e.length)return!1;for(let t=0;t<l.length;t++)if(!io(null,l[t],e[t]))return!1;return!0},te=function(l,e,t,o,n){if(e){for(let s=0;s<e.length;s++){const r=e[s];if("key"in r&&r.items!==void 0){t.push(r.key),n&&So(n.path,t)&&!r.isContinuation&&(n.offset=o);const i=l.findGroupInfo(t);i&&!r.isContinuation&&(i.offset=o),i&&!i.isExpanded?o+=i.count:o=te(l,r.items,t,o,n),t.pop()}else o++}return o}},bo=function(l,e){if(e.group){const t=g.normalizeSortingInfo(e.group),o=g.normalizeSortingInfo(l.sort);l.sort=ae.arrangeSortingInfo(t,o),delete e.group}},Eo=function(l,e,t){const o=g.normalizeSortingInfo(t||e.group);let n=[];for(let s=0;s<l.length;s++){const r=[];for(let i=0;i<=s;i++)r.push([o[i].selector,s===i?"<>":"=",l[i]]);n.push(g.combineFilters(r))}return n=g.combineFilters(n,"or"),g.combineFilters([n,e.filter])},je=function(l,e){let t=l.count||l.items.length;if(!l.count&&e>1){t=0;for(let o=0;o<l.items.length;o++)t+=je(l.items[o],e-1)}return t};class Ge extends $e{handleDataLoading(e){const{storeLoadOptions:t}=e,o=[];let n=0,s=!1,r;const{group:i}=e.loadOptions;let u=0;if(bo(t,e.loadOptions),e.group=e.group||i,e.isCustomLoading)return;const a=x({},t);a.skip=ke(this,t.skip),a.skip&&a.take&&i&&(a.skip--,a.take++,s=!0),a.take&&i&&(r=a.take,a.take++),F(this,(d=>{if(d.offset>=a.skip+a.take+u)return!1;d.offset>=a.skip+u&&d.count&&(u+=d.count-1,o.push(d),n+=d.count)})),b(o,(function(){a.filter=Eo(this.path,a,i)})),e.storeLoadOptions=a,e.collapsedGroups=o,e.collapsedItemsCount=n,e.skip=a.skip||0,e.skipFirstItem=s,e.take=r}handleDataLoaded(e,t){const o=this,{collapsedGroups:n}=e,s=g.normalizeSortingInfo(e.group),r=s.length;function i(u,a,d,c,p){if(!u||!a.length||!d.length)return;let h,m;const f=fe(a[0],!0);for(m=0;m<u.length&&(h=fe(u[m].key,!0),!(p>=c.offset||f===h));m++)p+=je(u[m],d.length);(!u.length||f!==h)&&u.splice(m,0,{key:a[0],items:[],count:a.length===1?c.count:void 0}),i(u[m].items,a.slice(1),d.slice(1),c,p)}if(e.collapsedItemsCount&&e.extra&&e.extra.totalCount>=0&&(e.extra._totalCountWasIncreasedByCollapsedItems||(e.extra.totalCount+=e.collapsedItemsCount,e.extra._totalCountWasIncreasedByCollapsedItems=!0)),t(e),r){let{data:u}=e;const a=le(u);if(ae.multiLevelGroup(a,s).enumerate().done((d=>{u=d})),n)for(let d=0;d<n.length;d++)i(u,n[d].path,s,n[d],e.skip);e.isCustomLoading||Ue(o,u,[],e.skip,e.skipFirstItem,e.take),e.data=u}}isGroupItemCountable(e){return e.items===null}updateTotalItemsCount(){let e=0;F(this,(t=>{t.count&&(e-=t.count-1)})),super.updateTotalItemsCount(e)}changeRowExpand(e){const t=this,o=t._dataSource,n=o.beginPageIndex?o.beginPageIndex():o.pageIndex(),s=o.items(),r=ke(t,n*o.pageSize());let i=t.findGroupInfo(e),u;return i&&!i.isExpanded?u=new w().resolve(i.count):u=Q(o,{filter:T(e,{filter:o.filter(),group:o.group()})}),k(u).done((a=>{a=parseInt(a.length?a[0]:a),i?(te(t,s,[],r),i.isExpanded=!i.isExpanded,i.count=a):(i={offset:-1,count:a,path:e,isExpanded:!1},te(t,s,[],r,i),i.offset>=0&&t.addGroupInfo(i)),t.updateTotalItemsCount()})).fail((function(){o._eventsStrategy.fireEvent("loadError",arguments)}))}allowCollapseAll(){return!1}refresh(e,t){const o=this,{storeLoadOptions:n}=e,s=o._dataSource;if(super.refresh.apply(this,arguments),t.reload)return F(o,(r=>{const i=Q(s,{filter:T(r.path,n)}),u=Q(s,{filter:Ve(r.path,n)});return k(u,i).done(((a,d)=>{a=parseInt(a.length?a[0]:a),d=parseInt(d.length?d[0]:d),r.offset=a,r.count!==d&&(r.count=d,o.updateTotalItemsCount())}))}),!0)}}const ko=l=>class extends l{init(){super.init.apply(this,arguments),this._initGroupingHelper()}_initGroupingHelper(e){const t=this._grouping,o=this.option("grouping.autoExpandAll"),n=this.option("focusedRowEnabled"),s=e?e.remoteOperations:this.remoteOperations();s.filtering&&s.sorting&&s.paging&&!s.grouping&&(o||!n)?(!t||t instanceof Ee)&&(this._grouping=new Ge(this)):(!t||t instanceof Ge)&&(this._grouping=new Ee(this))}totalItemsCount(){const e=super.totalItemsCount();return e>0&&this._dataSource.group()&&this._dataSource.requireTotalCount()?e+this._grouping.totalCountCorrection():e}itemsCount(){return this._dataSource.group()?this._grouping.itemsCount()||0:super.itemsCount.apply(this,arguments)}allowCollapseAll(){return this._grouping.allowCollapseAll()}isGroupItemCountable(e){return this._grouping.isGroupItemCountable(e)}isRowExpanded(e){const t=this._grouping.findGroupInfo(e);return t?t.isExpanded:!this._grouping.allowCollapseAll()}collapseAll(e){return this._collapseExpandAll(e,!1)}expandAll(e){return this._collapseExpandAll(e,!0)}_collapseExpandAll(e,t){const o=this,n=o._dataSource,s=n.group(),r=g.normalizeSortingInfo(s||[]);if(r.length){for(let i=0;i<r.length;i++)e===void 0||e===i?r[i].isExpanded=t:s!=null&&s[i]&&(r[i].isExpanded=s[i].isExpanded);n.group(r),o._grouping.foreachGroups(((i,u)=>{(e===void 0||e===u.length-1)&&(i.isExpanded=t)}),!1,!0),o.resetPagesCache()}return!0}refresh(){return super.refresh.apply(this,arguments),this._grouping.refresh.apply(this._grouping,arguments)}changeRowExpand(e){const t=this,o=t._dataSource;if(o.group())return o.beginLoading(),t._lastLoadOptions&&(t._lastLoadOptions.groupExpand=!0),t._changeRowExpandCore(e).always((()=>{o.endLoading()}))}_changeRowExpandCore(e){return this._grouping.changeRowExpand(e)}_hasGroupLevelsExpandState(e,t){if(e&&Array.isArray(e)){for(let o=0;o<e.length;o++)if(e[o].isExpanded===t)return!0}}_customizeRemoteOperations(e,t){const{remoteOperations:o}=e;e.storeLoadOptions.group?(o.grouping&&!e.isCustomLoading&&(!o.groupPaging||this._hasGroupLevelsExpandState(e.storeLoadOptions.group,!0))&&(o.paging=!1),!o.grouping&&(!o.sorting||!o.filtering||e.isCustomLoading||this._hasGroupLevelsExpandState(e.storeLoadOptions.group,!1))&&(o.paging=!1)):!e.isCustomLoading&&o.paging&&t.grouping&&this.resetCache(),super._customizeRemoteOperations.apply(this,arguments)}_handleDataLoading(e){return super._handleDataLoading(e),this._initGroupingHelper(e),this._grouping.handleDataLoading(e)}_handleDataLoaded(e){return this._grouping.handleDataLoaded(e,super._handleDataLoaded.bind(this))}_handleDataLoadedCore(e){return this._grouping.handleDataLoadedCore(e,super._handleDataLoadedCore.bind(this))}};K.extend(ko);const Go=l=>class extends l{init(){super.init(),this.createAction("onRowExpanding"),this.createAction("onRowExpanded"),this.createAction("onRowCollapsing"),this.createAction("onRowCollapsed")}_beforeProcessItems(e){const t=this._columnsController.getGroupColumns();return e=super._beforeProcessItems(e),e.length&&t.length&&(e=this._processGroupItems(e,t.length)),e}_processItem(e,t){return _(e.groupIndex)&&H(e.rowType)&&e.rowType.indexOf("group")===0?(e=this._processGroupItem(e,t),t.dataIndex=0):e=super._processItem.apply(this,arguments),e}_processGroupItem(e,t){return e}_processGroupItems(e,t,o){const n=this,s=n._columnsController.getGroupColumns(),r=s[s.length-t];if(!o){const u=n.option("scrolling.mode");o={collectContinuationItems:u!=="virtual"&&u!=="infinite",resultItems:[],path:[],values:[]}}const{resultItems:i}=o;if(o.data&&(o.collectContinuationItems||!o.data.isContinuation)&&i.push({rowType:"group",data:o.data,groupIndex:o.path.length-1,isExpanded:!!o.data.items,key:o.path.slice(0),values:o.values.slice(0)}),e)if(t===0)i.push.apply(i,e);else for(let u=0;u<e.length;u++){const a=e[u];a&&"items"in a?(o.data=a,o.path.push(a.key),o.values.push(r&&r.deserializeValue&&!r.calculateDisplayValue?r.deserializeValue(a.key):a.key),n._processGroupItems(a.items,t-1,o),o.data=void 0,o.path.pop(),o.values.pop()):i.push(a)}return i}publicMethods(){return super.publicMethods().concat(["collapseAll","expandAll","isRowExpanded","expandRow","collapseRow"])}collapseAll(e){const t=this._dataSource;t&&t.collapseAll(e)&&(t.pageIndex(0),t.reload())}expandAll(e){const t=this._dataSource;t&&t.expandAll(e)&&(t.pageIndex(0),t.reload())}changeRowExpand(e){const t=this,o=t.isRowExpanded(e),n={key:e,expanded:o};return t.executeAction(o?"onRowCollapsing":"onRowExpanding",n),n.cancel?new w().resolve():k(t._changeRowExpandCore(e)).done((()=>{n.expanded=!o,t.executeAction(o?"onRowCollapsed":"onRowExpanded",n)}))}_changeRowExpandCore(e){const t=this,o=this._dataSource,n=new w;return o?k(o.changeRowExpand(e)).done((()=>{t.load().done(n.resolve).fail(n.reject)})).fail(n.reject):n.resolve(),n}isRowExpanded(e){const t=this._dataSource;return t&&t.isRowExpanded(e)}expandRow(e){return this.isRowExpanded(e)?new w().resolve():this.changeRowExpand(e)}collapseRow(e){return this.isRowExpanded(e)?this.changeRowExpand(e):new w().resolve()}optionChanged(e){e.name==="grouping"&&(e.name="dataSource"),super.optionChanged(e)}},qe=function(l,e,t){var o,n;const s=(o=this.getKeyboardNavigationController)===null||o===void 0?void 0:o.call(this);switch(t.itemData.value){case"group":var r;this.isNeedToFocusColumn=!0,s==null||(r=s.groupColumn)===null||r===void 0||r.call(s,l,e);break;case"ungroup":this.isNeedToFocusColumn=!0,s==null||(n=s.ungroupColumn)===null||n===void 0||n.call(s,l,e);break;case"ungroupAll":this.isNeedToFocusColumn=!0,s==null||s.ungroupAllColumns()}},Qe=l=>{const e=l==null?void 0:l.visible;return e==="auto"?to.current().deviceType==="desktop":!!e},Xe=(l,e)=>{const t=Qe(l),o=(l==null?void 0:l.allowColumnDragging)&&(e==null?void 0:e.allowGrouping);return t&&!!o},Oo=l=>class extends ft(l){_getToolbarItems(){const e=super._getToolbarItems();return this._appendGroupingItem(e)}_appendGroupingItem(e){if(this._isGroupPanelVisible()){let t=!1;const o={template:()=>{const n=C("<div>").addClass(I.groupPanel);return this._updateGroupPanelContent(n),yt("groupPanel",this,n,void 0,this._handleActionKeyDown.bind(this)),n},name:"groupPanel",onItemRendered:()=>{t&&this.renderCompleted.fire(),t=!0},location:"before",locateInMenu:"never",sortIndex:1};e.push(o),this.updateToolbarDimensions()}return e}_handleActionKeyDown(e){const{event:t}=e,o=C(t.target),n=o.closest(`.${I.groupPanelItem}`).index(),s=this._columnsController.getGroupColumns()[n],r=s&&s.index;o.is(".dx-header-filter")?this._headerFilterController.showHeaderFilterMenu(r,!0):this._processGroupItemAction(r),t.preventDefault()}_isGroupPanelVisible(){return Qe(this.option("groupPanel"))}_renderGroupPanelItems(e,t){const o=this;e.empty(),b(t,((n,s)=>{o._createGroupPanelItem(e,s)})),_t(this)}_createGroupPanelItem(e,t){const o=C("<div>").addClass(t.cssClass).addClass(I.groupPanelItem).data("columnData",t).appendTo(e).text(t.caption);return Ct(this,o),o}getGroupAndUngroupItems(e){const{column:t}=e;if(this.option("grouping.contextMenuEnabled")&&t&&(_(t.allowGrouping)?t.allowGrouping:!0)){const s=_(t.groupIndex)&&t.groupIndex>-1,r=this.option("grouping.texts"),i=qe.bind(this,t,0);return[{text:r.ungroup,value:"ungroup",disabled:!s,onItemClick:i,icon:ue},{text:r.ungroupAll,value:"ungroupAll",onItemClick:i,icon:de}]}return[]}_columnOptionChanged(e){if(!this._requireReady&&!g.checkChanges(e.optionNames,["width","visibleWidth"])){const t=this.element(),o=t==null?void 0:t.find(`.${I.groupPanel}`);o&&o.length&&(this._updateGroupPanelContent(o),this.updateToolbarDimensions(),this.renderCompleted.fire())}super._columnOptionChanged()}_updateGroupPanelContent(e){const t=this.getColumns(),o=this.option("groupPanel");this._renderGroupPanelItems(e,t),o.allowColumnDragging&&!t.length&&(C("<div>").addClass(I.groupPanelMessage).text(o.emptyPanelText).appendTo(e),e.closest(`.${I.groupPanelContainer}`).addClass(I.groupPanelLabel),e.closest(`.${I.groupPanelLabel}`).css("maxWidth","none"))}allowDragging(e){const t=this.option("groupPanel");return Xe(t,e)}getColumnElements(){const e=this.element();return e==null?void 0:e.find(`.${I.groupPanelItem}`)}getColumns(){return this._columnsController.getGroupColumns()}getBoundingRect(){const e=this.element();if(e!=null&&e.find(`.${I.groupPanel}`).length){const t=e.offset();return{top:t.top,bottom:t.top+eo(e)}}return null}getName(){return"group"}hasGroupedColumns(){return this._isGroupPanelVisible()&&!!this.getColumns().length}optionChanged(e){e.name==="groupPanel"?(this._invalidate(),e.handled=!0):super.optionChanged(e)}getKeyboardNavigationController(){return this.getController("groupPanelKeyboardNavigation")}isColumnReorderingEnabled(e){return this.allowDragging(e)}getContextMenuItems(e){let t=super.getContextMenuItems(e);const o=C(e.targetElement).closest(`.${I.groupPanelItem}`);if(!o.length)return;e.column=this._columnsController.columnOption(`groupIndex:${o.index()}`);const n=this.getGroupAndUngroupItems(e);n!=null&&n.length&&(t=t??[],t.push(...n));const s=this.getMoveColumnContextMenuItems(e);return s!=null&&s.length&&(t=t??[],t.push(...s)),t}},Ao=l=>class extends l{getContextMenuItems(e){const t=this,o=t.option("grouping.contextMenuEnabled");let n;if(o&&e.row&&e.row.rowType==="group"){const s=t._columnsController,r=s.columnOption(`groupIndex:${e.row.groupIndex}`);if(r&&r.allowGrouping){const i=t.option("grouping.texts"),u=a=>{var d,c;((d=a.itemData)===null||d===void 0?void 0:d.value)==="ungroup"?s.columnOption(r.dataField,"groupIndex",-1):((c=a.itemData)===null||c===void 0?void 0:c.value)==="ungroupAll"&&s.clearGrouping()};n=[],n.push({text:i.ungroup,value:"ungroup",onItemClick:u,icon:ue},{text:i.ungroupAll,value:"ungroupAll",onItemClick:u,icon:de})}}return n}_rowClick(e){const t=this,o=t.option("grouping.expandMode"),s=t.option("scrolling.mode")!=="infinite"&&o==="rowClick"&&C(e.event.target).closest(".dx-group-row").length,r=C(e.event.target).closest(".dx-datagrid-expand").length;(s||r)&&t._changeGroupRowState(e),super._rowClick(e)}_changeGroupRowState(e){const t=this._dataController.items()[e.rowIndex],o=this._columnsController.columnOption(`groupIndex:${t.groupIndex}`,"allowCollapsing");(t.rowType==="data"||t.rowType==="group"&&o!==!1)&&(this._dataController.changeRowExpand(t.key,!0),e.event.preventDefault(),e.handled=!0)}},To=l=>class extends l{getContextMenuItems(e){const t=this,o=[],n=t.option("grouping.contextMenuEnabled");let s=super.getContextMenuItems(e);if(n&&e.row&&(e.row.rowType==="header"||e.row.rowType==="detailAdaptive")){const{column:r,rowIndex:i}=e;if(!r.command&&(!_(r.allowGrouping)||r.allowGrouping)){const u=t.option("grouping.texts"),a=_(r.groupIndex)&&r.groupIndex>-1,d=qe.bind(t,r,i);o.push({text:u.groupByThisColumn,value:"group",beginGroup:!0,disabled:a,onItemClick:d,icon:Co}),r.showWhenGrouped&&o.push({text:u.ungroup,value:"ungroup",disabled:!a,onItemClick:d,icon:ue}),o.push({text:u.ungroupAll,value:"ungroupAll",onItemClick:d,icon:de})}}if(o.length){s=s??[];const r=s.findIndex((i=>i.name==="clearSorting"))+1;s.splice(r,0,...o)}return s}allowDragging(e){const t=this.option("groupPanel");return Xe(t,e)||super.allowDragging(e)}};g.registerModule("grouping",{defaultOptions:()=>({grouping:{autoExpandAll:!0,allowCollapsing:!0,contextMenuEnabled:!0,expandMode:"buttonClick",texts:{groupContinuesMessage:y.format("dxDataGrid-groupContinuesMessage"),groupContinuedMessage:y.format("dxDataGrid-groupContinuedMessage"),groupByThisColumn:y.format("dxDataGrid-groupHeaderText"),ungroup:y.format("dxDataGrid-ungroupHeaderText"),ungroupAll:y.format("dxDataGrid-ungroupAllText")}},groupPanel:{visible:!1,emptyPanelText:y.format("dxDataGrid-groupPanelEmptyText"),allowColumnDragging:!0}}),extenders:{controllers:{data:Go,columns:l=>class extends l{_getExpandColumnOptions(){const e=super._getExpandColumnOptions.apply(this,arguments);return e.cellTemplate=g.getExpandCellTemplate(),e}},editing:l=>class extends l{_isProcessedItem(e){return _(e.groupIndex)&&H(e.rowType)&&e.rowType.indexOf("group")===0}}},views:{headerPanel:Oo,rowsView:Ao,columnHeadersView:To}}});g.registerModule("masterDetail",xt);g.registerModule("editorFactory",wt);const Do=l=>class extends vt(l){_changeRowExpandCore(e){const t=this._editingController;return Array.isArray(e)&&t&&t.refresh(),super._changeRowExpandCore.apply(this,arguments)}};g.registerModule("editing",v({},W,{extenders:v({},W.extenders,{controllers:v({},W.extenders.controllers,{data:Do})})}));g.registerModule("editingRowBased",It);g.registerModule("editingFormBased",St);g.registerModule("editingCellBased",bt);g.registerModule("validating",Et);g.registerModule("virtualScrolling",kt);K.extend(Gt);g.registerModule("filterRow",Ot);g.registerModule("headerFilter",At);g.registerModule("filterSync",Tt);g.registerModule("filterBuilder",Dt);g.registerModule("filterPanel",Mt);g.registerModule("search",Bt);g.registerModule("pager",Rt);D.views.draggingHeaderView;D.controllers.draggingHeader;D.views.columnsSeparatorView;D.controllers.tablePosition;D.controllers.columnsResizer;D.views.trackerView;g.registerModule("columnsResizingReordering",D);g.registerModule("keyboardNavigation",Pt);const Je=l=>class extends l{ungroupColumnByPressingKey(e){var t;const o=this.getColumnFromEvent(e),n=this.getRowIndexFromEvent(e);this.ungroupColumn(o,n),(t=e.originalEvent)===null||t===void 0||t.preventDefault()}getFocusedCellPositionByColumn(e){if(!e)return;const t=this._columnsController.getRowIndex(e.index,!0);return{rowIndex:t,columnIndex:this.getVisibleIndex(e,t)}}getRowIndexFromEvent(e){return 0}getColumnFromEvent(e){}getNewFocusedColumnBeforeUngrouping(e,t){return e}keyDownHandler(e){let t=super.keyDownHandler(e);return t?!0:(this.canUngroupColumnByPressingKey(e)?(this.ungroupColumnByPressingKey(e),t=!0):this.canUngroupAllColumnByPressingKey(e)&&(this.ungroupAllColumns(),t=!0),t)}changeGroupColumnIndex(e,t,o){this._columnsController.beginUpdate(),this._columnsController.columnOption(t.dataField,"groupIndex",e);const n=this.getFocusedCellPositionByColumn(o);this.updateViewFocusPosition(n),this._columnsController.endUpdate()}canUngroupColumnByPressingKey(e){return e.which===Y.G&&e.shift&&re(e.originalEvent)}canUngroupAllColumnByPressingKey(e){return e.which===Y.G&&e.shift&&e.alt}ungroupColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(_(e==null?void 0:e.groupIndex)){const o=this.getNewFocusedColumnBeforeUngrouping(e,t);this.changeGroupColumnIndex(-1,e,o)}}ungroupAllColumns(){this._columnsController.clearGrouping()}},Mo=l=>class extends Je(l){getNewFocusedColumnBeforeGrouping(e,t){if(e.showWhenGrouped)return e;const o=this.getFocusableColumns(t,e.ownerBand);if(o.length===1&&_(e.ownerBand))return this._columnsController.getParentColumn(e,!0);if(o.length===1)return;const n=o.findIndex((s=>s.index===e.index));return n===o.length-1?o[n-1]:o[n+1]}groupColumnByPressingKey(e){var t;const o=C(e.originalEvent.target).closest("td"),n=this._getRowIndex(o.parent()),s=this._getColumnByCellElement(o,n);this.groupColumn(s,n),(t=e.originalEvent)===null||t===void 0||t.preventDefault()}canGroupColumnByPressingKey(e){return e.which===Y.G&&re(e.originalEvent)}getRowIndexFromEvent(e){const t=C(e.originalEvent.target).closest("td");return this._getRowIndex(t.parent())}getColumnFromEvent(e){const t=C(e.originalEvent.target).closest("td"),o=this._getRowIndex(t.parent());return this._getColumnByCellElement(t,o)}keyDownHandler(e){let t=super.keyDownHandler(e);return t?!0:(this.canGroupColumnByPressingKey(e)&&(this.groupColumnByPressingKey(e),t=!0),t)}groupColumn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!_(e.groupIndex)&&e!==null&&e!==void 0&&e.allowGrouping){var o;const n=((o=this._columnsController.getGroupColumns())===null||o===void 0?void 0:o.length)??0,s=this.getNewFocusedColumnBeforeGrouping(e,t);this.changeGroupColumnIndex(n,e,s)}}ungroupAllColumns(){const e=this._getFocusedCell(),t=this._getColumnByCellElement(e);this._columnsController.beginUpdate(),super.ungroupAllColumns();const o=this._columnsController.getRowIndex(t.index,!0),n=this.getVisibleIndex(t);this.updateFocusPosition({rowIndex:o,columnIndex:n}),this._columnsController.endUpdate()}};g.registerModule("headersKeyboardNavigation",v({},me,{extenders:{controllers:{headersKeyboardNavigation:Mo},views:v({},me.extenders.views)}}));class Bo extends Je(Lt){constructor(){super(...arguments),this.isNeedToHiddenFocusAfterClick=!1}groupItemClickHandler(e){var t;const o=C(e.originalEvent.target),n=this._columnsController.columnOption(`groupIndex:${o.index()}`);this.isNeedToHiddenFocusAfterClick=(t=this._columnsController)===null||t===void 0?void 0:t.allowColumnSorting(n)}unsubscribeFromGroupItemClick(){const e=this.getFocusedViewElement();e&&ye.off(e,xe,this.groupItemClickHandlerContext)}subscribeToGroupItemClick(){const e=this.getFocusedViewElement();e&&ye.on(e,xe,`.${I.groupPanelItem}`,this.groupItemClickHandlerContext)}leftRightKeysHandler(e){const{originalEvent:t}=e;if(re(t)){const o=C(t.target),n=this._columnsController.columnOption(`groupIndex:${o.index()}`),s=this.getDirectionByKeyName(e.keyName);this.canReorderColumn(n,s)&&this.moveColumn(n,s),t==null||t.preventDefault()}}getVisibleIndex(e){return e.groupIndex}getColumnFromEvent(e){const t=C(e.originalEvent.target);return this._columnsController.columnOption(`groupIndex:${t.index()}`)}getNewFocusedColumnBeforeUngrouping(e){const t=e.groupIndex,o=this._columnsController.getGroupColumns();return t===o.length-1?o[t-1]:o[t+1]}_getCell(e){var t;const o=(t=this.headerPanel)===null||t===void 0?void 0:t.getColumnElements();return o==null?void 0:o.eq(e.columnIndex)}getFocusedView(){return this.getView("headerPanel")}getFocusedViewElement(){var e;return(e=this.headerPanel)===null||e===void 0||(e=e.element())===null||e===void 0?void 0:e.find(`.${I.groupPanel}`)}getFocusinSelector(){return`.${I.groupPanelItem}`}focusinHandler(e){this.setFocusedCellPosition(0,C(e.target).index())}keyDownHandler(e){let t=super.keyDownHandler(e);return t?!0:((e.keyName==="leftArrow"||e.keyName==="rightArrow")&&(this.leftRightKeysHandler(e),t=!0),t)}renderCompleted(e){const{needToRestoreFocus:t}=this;if(super.renderCompleted(e),this.unsubscribeFromGroupItemClick(),this.subscribeToGroupItemClick(),!t&&this.isNeedToHiddenFocusAfterClick){const o=this._getFocusedCell();o!=null&&o.length&&Ft(o.get(0)),this.isNeedToHiddenFocusAfterClick=!1}}canUngroupColumnByPressingKey(e){return super.canUngroupColumnByPressingKey(e)||e.keyName==="backspace"||e.keyName==="del"}getFirstFocusableVisibleIndex(){var e;const t=(e=this.headerPanel)===null||e===void 0?void 0:e.getColumns();return t!=null&&t.length?0:-1}init(){this.headerPanel=this.getView("headerPanel"),this.groupItemClickHandlerContext=this.groupItemClickHandlerContext??this.groupItemClickHandler.bind(this),super.init()}canReorderColumn(e,t){if(!this.headerPanel.allowDragging(e))return!1;const n=this._columnsController.getGroupColumns();return t===Vt.Next?e.groupIndex!==n.length-1:e.groupIndex!==0}ungroupAllColumns(){this.updateViewFocusPosition(),super.ungroupAllColumns()}}g.registerModule("groupPanelKeyboardNavigation",{controllers:{groupPanelKeyboardNavigation:Bo}});function oe(l,e,t,o){let n=0;if(l<e)for(;n<t.items.length;n++)oe(l+1,e,t.items[n],o);l===e&&o(t)}function P(l,e){let t;if("map"in l)return l.map(e);const o=new Array(l.length);for(t in l)o[t]=e(l[t],t);return o}function Ro(l){return l!==l||l===""||l===null||l===void 0}function Po(l){return l===Le.count}function Oe(l){const e=B(l.selector),t="skipEmptyValues"in l?l.skipEmptyValues:!0;let{aggregator:o}=l;if(typeof o=="string"&&(o=Le[o],!o))throw ie.Error("E4001",l.aggregator);return{selector:e,aggregator:o,skipEmptyValues:t}}class Lo{constructor(e){this._data=e.data,this._groupLevel=e.groupLevel||0,this._totalAggregates=P(e.totalAggregates||[],Oe),this._groupAggregates=P(e.groupAggregates||[],Oe),this._totals=[]}calculate(){this._totalAggregates.length&&this._calculateTotals(0,{items:this._data}),this._groupAggregates.length&&this._groupLevel>0&&this._calculateGroups({items:this._data})}totalAggregates(){return this._totals}_aggregate(e,t,o){const n=t.items?t.items.length:0;for(let s=0;s<e.length;s++){if(Po(e[s].aggregator)){o[s]=(o[s]||0)+n;continue}for(let r=0;r<n;r++)this._accumulate(s,e[s],o,t.items[r])}}_calculateTotals(e,t){if(e===0&&(this._totals=this._seed(this._totalAggregates)),e===this._groupLevel)this._aggregate(this._totalAggregates,t,this._totals);else for(let o=0;o<t.items.length;o++)this._calculateTotals(e+1,t.items[o]);e===0&&(this._totals=this._finalize(this._totalAggregates,this._totals))}_calculateGroups(e){const t=this._groupLevel;let o=t+1;const n=this._seed.bind(this,this._groupAggregates),s=this._aggregate.bind(this,this._groupAggregates),r=this._finalize.bind(this,this._groupAggregates);function i(u){u.aggregates=n(o-1),o===t?s(u,u.aggregates):oe(o,t,u,(a=>{s(a,u.aggregates)})),u.aggregates=r(u.aggregates)}for(;--o>0;)oe(0,o,e,i)}_seed(e,t){return P(e,(o=>{const{aggregator:n}=o;return"seed"in n?N(n.seed)?n.seed(t):n.seed:NaN}))}_accumulate(e,t,o,n){const s=t.selector(n),{aggregator:r}=t,{skipEmptyValues:i}=t;i&&Ro(s)||(o[e]!==o[e]?o[e]=s:o[e]=r.step(o[e],s))}_finalize(e,t){return P(e,((o,n)=>{const s=o.aggregator.finalize;return s?s(t[n]):t[n]}))}}const Fo="dx-cell-focus-disabled",Ye=function(l,e){const t=C(l),{column:o}=e,{summaryItems:n}=e,s=[];if(!o.command&&n){for(let r=0;r<n.length;r++){const i=n[r],u=g.getSummaryText(i,e.summaryTexts);s.push(C("<div>").css("textAlign",i.alignment||o.alignment).addClass("dx-datagrid-summary-item").addClass("dx-datagrid-text-content").addClass(i.cssClass).toggleClass("dx-datagrid-group-text-content",e.rowType==="group").text(u).attr("aria-label",`${o.caption} ${u}`))}t.append(s)}},Ze=function(l,e){const t=l.option("summary.texts")||{};return{totalItem:e.row,summaryItems:e.row.summaryCells[e.columnIndex],summaryTexts:t}},X=function(l){return l.summary||l.aggregates||[]},ge=function(l){return l.option("summary.recalculateWhileEditing")},et=function(l,e,t,o){o=o||[];for(let n=0;n<l.length;n++)o.push(l[n].key),e===1?t(o,l[n].items):et(l[n].items,e-1,t,o),o.pop()},tt=function(l,e,t){return t?tt(l,e.map((o=>({items:[o]})),t-1)):l.concat(e)},ot=function(l,e,t){return t?l.map((o=>{const n={},s=ot(o.items||[],e,t-1);return Object.defineProperty(n,"aggregates",{get:()=>o.aggregates,set:r=>{o.aggregates=r}}),x(n,o,{items:s})})):l.filter((o=>e.indexOf(o)<0))},nt=function(l,e,t){if(!l||!e.length)return l;const o=e[0],n=t[0];let s;return o&&n&&n.length&&(s=le(l),b(n,(function(r){r===0?s=s.sortBy(this.selector,this.desc):s=s.thenBy(this.selector,this.desc)})),s.enumerate().done((r=>{l=r}))),e=e.slice(1),t=t.slice(1),e.length&&t.length&&b(l,(function(){this.items=nt(this.items,e,t)})),l},Ae=function(l,e,t){const o=t&&t.sortByGroups&&t.sortByGroups();return o&&o.length?nt(l,e,o):l},Te=function(l,e,t,o){let n;if(ge(l)){const s=l._editingController;if(s){const r=s.getInsertedData();r.length&&(t=tt(t,r,o));const i=s.getRemovedData();i.length&&(t=ot(t,i,o))}}return e&&(n=new Lo({totalAggregates:e.totalAggregates,groupAggregates:e.groupAggregates,data:t,groupLevel:o}),n.calculate()),n?n.totalAggregates():[]};class Vo extends Ht{_getRows(){return this._dataController.footerItems()}_getCellOptions(e){return x(super._getCellOptions(e),Ze(this,e))}_renderCellContent(e,t){Ye(e,t),super._renderCellContent.apply(this,arguments)}_renderCore(e){let t=!1;const o=this._dataController.footerItems()[0];return(!e||!e.columnIndices)&&(this.element().empty().addClass("dx-datagrid-total-footer").toggleClass("dx-datagrid-nowrap",!this.option("wordWrapEnabled")),t=!0),o&&o.summaryCells&&o.summaryCells.length&&(this._updateContent(this._renderTable({change:e}),e),t&&this._updateScrollLeftPosition()),super._renderCore(e)}_updateContent(e,t){return t&&t.changeType==="update"&&t.columnIndices?this.waitAsyncTemplates().done((()=>{const o=this.getTableElement().find(".dx-row"),n=e.find(".dx-row");this._updateCells(o,n,t.columnIndices[0])})):super._updateContent.apply(this,arguments)}_rowClick(e){const t=this._dataController.footerItems()[e.rowIndex]||{};this.executeAction("onRowClick",x({},e,t))}_columnOptionChanged(e){const{optionNames:t}=e;e.changeTypes.grouping||(t.width||t.visibleWidth)&&super._columnOptionChanged(e)}_handleDataChanged(e){const{changeType:t}=e;e.changeType==="update"&&e.repaintChangesOnly?e.totalColumnIndices?e.totalColumnIndices.length&&this.render(null,{changeType:"update",columnIndices:[e.totalColumnIndices]}):this.render():(t==="refresh"||t==="append"||t==="prepend")&&this.render()}_createRow(e){const t=super._createRow.apply(this,arguments);return e.rowType==="totalFooter"&&(t.addClass("dx-footer-row"),t.addClass(Fo),t.attr("tabindex",0)),t}getHeight(){return this.getElementHeight()}isVisible(){return!!this._dataController.footerItems().length}}const Ho=l=>class extends l{init(){super.init.apply(this,arguments),this._editingController=this.getController("editing"),this._totalAggregates=[],this._summaryGetter=jt}summaryGetter(e){if(!arguments.length)return this._summaryGetter;N(e)&&(this._summaryGetter=e)}summary(e){if(!arguments.length)return this._summaryGetter();this._summaryGetter=function(){return e}}totalAggregates(){return this._totalAggregates}isLastLevelGroupItemsPagingLocal(){const e=this.summary(),t=e==null?void 0:e.sortByGroups();return t==null?void 0:t.length}sortLastLevelGroupItems(e,t,o){const n=ae.multiLevelGroup(le(e),t).toArray();let s=[];return o.forEach((r=>{et(n,t.length,((i,u)=>{r.toString()===i.toString()&&(s=s.concat(u))}))})),s}_customizeRemoteOperations(e){const t=this.summary();t&&(e.remoteOperations.summary?(!e.isCustomLoading||e.storeLoadOptions.isLoadingAll)&&(e.storeLoadOptions.group&&(e.remoteOperations.grouping?e.storeLoadOptions.groupSummary=t.groupAggregates:t.groupAggregates.length&&(e.remoteOperations.paging=!1)),e.storeLoadOptions.totalSummary=t.totalAggregates):(t.totalAggregates.length||t.groupAggregates.length&&e.storeLoadOptions.group)&&(e.remoteOperations.paging=!1)),super._customizeRemoteOperations.apply(this,arguments);const o=e.cachedData.extra;o!=null&&o.summary&&!e.isCustomLoading&&(e.storeLoadOptions.totalSummary=void 0)}_handleDataLoadedCore(e){const t=R(e.storeLoadOptions.group||e.loadOptions.group||[]),o=e.remoteOperations||{},n=this.summaryGetter()(o);if(!e.isCustomLoading||e.storeLoadOptions.isLoadingAll){if(o.summary)!o.paging&&t.length&&n&&(o.grouping||Te(this,{groupAggregates:n.groupAggregates},e.data,t.length),e.data=Ae(e.data,t,n));else if(!o.paging&&n){var s;const r=e.operationTypes||{};if(!Object.keys(r).some((u=>r[u]))||!((s=e.cachedData)!==null&&s!==void 0&&(s=s.extra)!==null&&s!==void 0&&s.summary)||t.length&&n.groupAggregates.length){const u=Te(this,n,e.data,t.length);e.extra=Pe(e.extra)?e.extra:{},e.extra.summary=u,e.cachedData&&(e.cachedData.extra=e.extra)}e.data=Ae(e.data,t,n)}}e.isCustomLoading||(this._totalAggregates=e.extra&&e.extra.summary||this._totalAggregates),super._handleDataLoadedCore(e)}};K.extend(Ho);const No=l=>class extends l{_isDataColumn(e){return e&&(!_(e.groupIndex)||e.showWhenGrouped)}_isGroupFooterVisible(){const e=this.option("summary.groupItems")||[];for(let t=0;t<e.length;t++){const o=e[t],n=this._columnsController.columnOption(o.showInColumn||o.column);if(o.showInGroupFooter&&this._isDataColumn(n))return!0}return!1}_processGroupItems(e,t,o){const n=o&&o.data,s=super._processGroupItems.apply(this,arguments);return o&&(o.isGroupFooterVisible===void 0&&(o.isGroupFooterVisible=this._isGroupFooterVisible()),n&&n.items&&o.isGroupFooterVisible&&(o.collectContinuationItems||!n.isContinuationOnNextPage)&&s.push({rowType:"groupFooter",key:o.path.slice(),data:n,groupIndex:o.path.length-1,values:[]})),s}_processGroupItem(e,t){const o=this;if(t.summaryGroupItems||(t.summaryGroupItems=o.option("summary.groupItems")||[]),e.rowType==="group"){let n=-1,s=-1;b(t.visibleColumns,(function(r){const i=t.visibleColumns[r-1];e.groupIndex===this.groupIndex&&(n=this.index),r>0&&i.command==="expand"&&this.command!=="expand"&&(s=this.index)})),e.summaryCells=this._calculateSummaryCells(t.summaryGroupItems,X(e.data),t.visibleColumns,((r,i)=>r.showInGroupFooter?-1:r.alignByColumn&&i&&!_(i.groupIndex)&&i.index!==s?i.index:n),!0)}return e.rowType==="groupFooter"&&(e.summaryCells=this._calculateSummaryCells(t.summaryGroupItems,X(e.data),t.visibleColumns,((n,s)=>n.showInGroupFooter&&o._isDataColumn(s)?s.index:-1))),e}_calculateSummaryCells(e,t,o,n,s){const r=this,i=[],u={};return b(e,((a,d)=>{const c=r._columnsController.columnOption(d.column),p=d.showInColumn&&r._columnsController.columnOption(d.showInColumn)||c,h=n(d,p);if(h>=0){u[h]||(u[h]=[]);const m=t[a];if(m===m){let f;_(d.valueFormat)?f=d.valueFormat:d.summaryType!=="count"&&(f=g.getFormatByDataType(c&&c.dataType)),u[h].push(x({},d,{value:H(m)&&c&&c.deserializeValue?c.deserializeValue(m):m,valueFormat:f,columnCaption:c&&c.index!==h?c.caption:void 0}))}}})),qt(u)||o.forEach(((a,d)=>{const c=o[d-1],p=s&&((c==null?void 0:c.command)==="expand"||a.command==="expand")?c==null?void 0:c.index:a.index;i.push(u[p]||[])})),i}_getSummaryCells(e,t){const o=this,n=o._columnsController;return o._calculateSummaryCells(e,t,n.getVisibleColumns(),((s,r)=>o._isDataColumn(r)?r.index:-1))}_updateItemsCore(e){const t=this;let o;const n=t._dataSource,s=t._footerItems,r=s&&s[0]&&s[0].summaryCells,i=t.option("summary.totalItems");if(t._footerItems=[],n&&i&&i.length){const u=n.totalAggregates();o=t._getSummaryCells(i,u),e&&e.repaintChangesOnly&&r&&(e.totalColumnIndices=o.map(((a,d)=>JSON.stringify(a)!==JSON.stringify(r[d])?d:-1)).filter((a=>a>=0))),o.length&&t._footerItems.push({rowType:"totalFooter",summaryCells:o})}super._updateItemsCore(e)}_prepareUnsavedDataSelector(e){if(ge(this)){const t=this._editingController;if(t)return function(o){return o=t.getUpdatedData(o),e(o)}}return e}_prepareAggregateSelector(e,t){return e=this._prepareUnsavedDataSelector(e),t==="avg"||t==="sum"?function(o){const n=e(o);return _(n)?Number(n):n}:e}_getAggregates(e,t){const o=this;let n=o.option("summary.calculateCustomSummary");const s=o.option("summary.skipEmptyValues");return Qt(e||[],(r=>{const i=this._columnsController.columnOption(r.column),u=i&&i.calculateCellValue?i.calculateCellValue.bind(i):B(i?i.dataField:r.column);let a=r.summaryType||"count";const d=_(r.skipEmptyValues)?r.skipEmptyValues:s;if(t)return{selector:r.column,summaryType:a};const c=o._prepareAggregateSelector(u,a);if(a==="custom"){n||($.log("E1026"),n=function(){});const p={component:o.component,name:r.name};n(p),p.summaryProcess="calculate",a={seed(h){return p.summaryProcess="start",p.totalValue=void 0,p.groupIndex=h,delete p.value,n(p),p.totalValue},step(h,m){return p.summaryProcess="calculate",p.totalValue=h,p.value=m,n(p),p.totalValue},finalize(h){return p.summaryProcess="finalize",p.totalValue=h,delete p.value,n(p),p.totalValue}}}return{selector:c,aggregator:a,skipEmptyValues:d}}))}_addSortInfo(e,t,o,n){if(t){const{groupIndex:s}=t;n=n||t.sortOrder,_(s)&&(e[s]=e[s]||[],e[s].push({selector:o,desc:n==="desc"}))}}_findSummaryItem(e,t){let o=-1;return _(t)&&b(e||[],(function(n){if(this.name===t||n===t||this.summaryType===t||this.column===t||(function(s){const{summaryType:r}=s,{column:i}=s;return r&&i&&`${r}_${i}`})(this)===t)return o=n,!1})),o}_getSummarySortByGroups(e,t){const o=this,n=o._columnsController,s=n.getGroupColumns(),r=[];if(!(!t||!t.length))return b(e||[],(function(){const{sortOrder:i}=this;let{groupColumn:u}=this;const a=o._findSummaryItem(t,this.summaryItem);if(a<0)return;const d=function(c){return X(c)[a]};_(u)?(u=n.columnOption(u),o._addSortInfo(r,u,d,i)):b(s,((c,p)=>{o._addSortInfo(r,p,d,i)}))})),r}_createDataSourceAdapterCore(e,t){const o=this,n=super._createDataSourceAdapterCore(e,t);return n.summaryGetter((s=>o._getSummaryOptions(s||t))),n}_getSummaryOptions(e){const t=this,o=t.option("summary.groupItems"),n=t.option("summary.totalItems"),s=t.option("sortByGroupSummaryInfo"),r=t._getAggregates(o,e&&e.grouping&&e.summary),i=t._getAggregates(n,e&&e.summary),u=function(){return t._getSummarySortByGroups(s,o)};if(r.length||i.length)return{groupAggregates:r,totalAggregates:i,sortByGroups:u}}publicMethods(){const e=super.publicMethods();return e.push("getTotalSummaryValue"),e}getTotalSummaryValue(e){const t=this._findSummaryItem(this.option("summary.totalItems"),e),o=this._dataSource.totalAggregates();if(o.length&&t>-1)return o[t]}optionChanged(e){(e.name==="summary"||e.name==="sortByGroupSummaryInfo")&&(e.name="dataSource"),super.optionChanged(e)}init(){this._footerItems=[],super.init()}footerItems(){return this._footerItems}},$o=l=>class extends l{_refreshSummary(){ge(this)&&!this.isSaving()&&this._dataController.refresh({load:!0,changesOnly:!0})}_addChange(e){const t=super._addChange.apply(this,arguments);return e.type&&this._refreshSummary(),t}_removeChange(){const e=super._removeChange.apply(this,arguments);return this._refreshSummary(),e}cancelEditData(){const e=super.cancelEditData.apply(this,arguments);return this._refreshSummary(),e}},Ko=l=>class extends l{_createRow(e){const t=super._createRow.apply(this,arguments);return e&&t.addClass(e.rowType==="groupFooter"?"dx-datagrid-group-footer":""),t}_renderCells(e,t){super._renderCells.apply(this,arguments),t.row.rowType==="group"&&t.row.summaryCells&&t.row.summaryCells.length&&this._renderGroupSummaryCells(e,t)}_hasAlignByColumnSummaryItems(e,t){return!_(t.columns[e].groupIndex)&&t.row.summaryCells[e].length}_getAlignByColumnCellCount(e,t){let o=0;for(let n=1;n<e;n++){const s=t.row.summaryCells.length-n;o=this._hasAlignByColumnSummaryItems(s,t)?n:o}return o}_renderGroupSummaryCells(e,t){const o=e.children().last(),n=Number(o.attr("colSpan"))||1,s=this._getAlignByColumnCellCount(n,t);this._renderGroupSummaryCellsCore(o,t,n,s)}_renderGroupSummaryCellsCore(e,t,o,n){if(n>0){e.attr("colSpan",o-n);for(let s=0;s<n;s++){const r=t.columns.length-n+s;this._renderCell(e.parent(),x({column:t.columns[r],columnIndex:this._getSummaryCellIndex(r,t.columns)},t))}}}_getSummaryCellIndex(e,t){return e}_getCellTemplate(e){return!e.column.command&&!_(e.column.groupIndex)&&e.summaryItems&&e.summaryItems.length?Ye:super._getCellTemplate(e)}_getCellOptions(e){const t=this,o=super._getCellOptions(e);return e.row.summaryCells?x(o,Ze(t,e)):o}};g.registerModule("summary",{defaultOptions:()=>({summary:{groupItems:void 0,totalItems:void 0,calculateCustomSummary:void 0,skipEmptyValues:!0,recalculateWhileEditing:!1,texts:{sum:y.format("dxDataGrid-summarySum"),sumOtherColumn:y.format("dxDataGrid-summarySumOtherColumn"),min:y.format("dxDataGrid-summaryMin"),minOtherColumn:y.format("dxDataGrid-summaryMinOtherColumn"),max:y.format("dxDataGrid-summaryMax"),maxOtherColumn:y.format("dxDataGrid-summaryMaxOtherColumn"),avg:y.format("dxDataGrid-summaryAvg"),avgOtherColumn:y.format("dxDataGrid-summaryAvgOtherColumn"),count:y.format("dxDataGrid-summaryCount")}},sortByGroupSummaryInfo:void 0}),views:{footerView:Vo},extenders:{controllers:{data:No,editing:$o},views:{rowsView:Ko}}});g.registerModule("stickyColumns",Nt);g.registerModule("columnFixing",$t);g.registerModule("adaptivity",Kt);g.registerModule("virtualColumns",Wt);class Wo{constructor(e,t){let{key:o}=t;this._isSharedDataSource=!1,this._keyExpr=o,this.updateDataSource(e)}_updateDataSource(e){if(e)if(e instanceof z)this._isSharedDataSource=!0,this._dataSource=e;else{const t=lo(e);this._dataSource=new z(x(!0,{},{},t))}}_updateDataSourceByItems(e){this._dataSource=new z({store:new ao({key:this.key(),data:e}),pageSize:0})}_disposeDataSource(){this._dataSource&&(this._isSharedDataSource?this._isSharedDataSource=!1:this._dataSource.dispose(),delete this._dataSource)}load(){return this._dataSource.load()}loadSingle(e,t){if(!this._dataSource)return new w().reject();let o=e,n=t;return arguments.length<2&&(n=e,o=this.key()),this._dataSource.loadSingle(o,n)}loadFromStore(e){return this.store().load(e)}loadNextPage(){return this.pageIndex(1+this.pageIndex()),this.load()}loadOptions(){return this._dataSource.loadOptions()}userData(){return this._dataSource._userData}cancel(e){this._dataSource.cancel(e)}cancelAll(){this._dataSource.cancelAll()}filter(e){return this._dataSource.filter(e)}addSearchFilter(e){this._dataSource._addSearchFilter(e)}group(e){return this._dataSource.group(e)}paginate(){return this._dataSource.paginate()}pageSize(){return this._dataSource._pageSize}pageIndex(e){return e===void 0?this._dataSource.pageIndex(void 0):this._dataSource.pageIndex(e)}resetDataSource(){this._disposeDataSource()}resetDataSourcePageIndex(){this.pageIndex()&&(this.pageIndex(0),this.load())}updateDataSource(e,t){const o=e??this.items();t&&(this._keyExpr=t),this._disposeDataSource(),Array.isArray(o)?this._updateDataSourceByItems(o):this._updateDataSource(o)}totalCount(){return this._dataSource.totalCount()}isLastPage(){return this._dataSource.isLastPage()||!this._dataSource._pageSize}isLoading(){return this._dataSource.isLoading()}isLoaded(){return this._dataSource.isLoaded()}searchValue(e){return this._dataSource.searchValue(e)}searchOperation(e){return this._dataSource.searchOperation(e)}searchExpr(e){return this._dataSource.searchExpr(e)}select(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return this._dataSource.select(t)}key(){var e;const t=(e=this._dataSource)===null||e===void 0?void 0:e.key();return _(t)&&this._keyExpr==="this"?t:this._keyExpr}keyOf(e){return this.store().keyOf(e)}store(){return this._dataSource.store()}items(){var e;return(e=this._dataSource)===null||e===void 0?void 0:e.items()}applyMapFunction(e){return this._dataSource._applyMapFunction(e)}getDataSource(){return this._dataSource??null}reload(){return this._dataSource.reload()}on(e,t){this._dataSource.on(e,t)}off(e,t){this._dataSource.off(e,t)}}const De="dx-buttongroup-item-has-width",J={contained:"dx-buttongroup-mode-contained",outlined:"dx-buttongroup-mode-outlined",text:"dx-buttongroup-mode-text"};class zo extends uo{_initTemplates(){super._initTemplates(),this._templateManager.addDefaultTemplates({item:new co(((e,t,o)=>{this._prepareItemStyles(e);const{buttonTemplate:n}=this.option();this._createComponent(e,po,x({},o,t,this._getBasicButtonOptions(),{_templateData:this._hasCustomTemplate(n)?o:{},template:o.template||n}))}),["text","type","icon","disabled","visible","hint"],this.option("integrationOptions.watchMethod"))})}_getBasicButtonOptions(){const{hoverStateEnabled:e,activeStateEnabled:t,stylingMode:o}=this.option();return{focusStateEnabled:!1,onClick:null,hoverStateEnabled:e,activeStateEnabled:t,stylingMode:o}}_getDefaultOptions(){return v({},super._getDefaultOptions(),{itemTemplateProperty:null})}_hasCustomTemplate(e){return N(e)||this.option("integrationOptions.templates")[e]}_selectedItemClass(){return"dx-item-selected dx-state-selected"}_prepareItemStyles(e){const t=e.data("dxItemIndex");t===0&&e.addClass("dx-buttongroup-first-item");const{items:o}=this.option();o&&t===o.length-1&&e.addClass("dx-buttongroup-last-item"),e.addClass("dx-shape-standard")}_renderItemContent(e){return e.container=C(e.container).parent(),super._renderItemContent(e)}_setAriaSelectionAttribute(e,t){this.setAria("pressed",t,e)}_renderItemContentByNode(e,t){return e.container=C(e.container).children().first(),super._renderItemContentByNode(e,t)}_focusTarget(){return this.$element().parent()}_keyboardEventBindingTarget(){return this._focusTarget()}_enterKeyHandler(e){e.preventDefault(),super._enterKeyHandler(e)}_refreshContent(){this._prepareContent(),this._renderContent()}_itemClass(){return"dx-buttongroup-item"}_itemSelectHandler(e){const{selectionMode:t}=this.option();t==="single"&&this.isItemSelected(e.currentTarget)||super._itemSelectHandler(e)}}class st extends Z{_getDefaultOptions(){return v({},super._getDefaultOptions(),{hoverStateEnabled:!0,focusStateEnabled:!0,selectionMode:"single",selectedItems:[],selectedItemKeys:[],stylingMode:"contained",keyExpr:"text",items:[],buttonTemplate:"content",onSelectionChanged:null,onItemClick:null})}_init(){super._init(),this._createItemClickAction()}_createItemClickAction(){this._itemClickAction=this._createActionByOption("onItemClick")}_initMarkup(){this.setAria("role","group"),this.$element().addClass("dx-buttongroup"),this._renderStylingMode(),this._renderButtons(),this._syncSelectionOptions(),super._initMarkup()}_renderStylingMode(){const{stylingMode:e}=this.option();for(const t in J)this.$element().removeClass(J[t]);this.$element().addClass(J[e??"contained"])}_fireSelectionChangeEvent(e,t){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})({addedItems:e,removedItems:t})}_renderButtons(){const e=C("<div>").addClass("dx-buttongroup-wrapper").appendTo(this.$element()),{selectedItems:t,selectionMode:o,items:n,keyExpr:s,buttonTemplate:r,selectedItemKeys:i,focusStateEnabled:u,hoverStateEnabled:a,activeStateEnabled:d,stylingMode:c,accessKey:p,tabIndex:h}=this.option(),m={selectionMode:o,items:n,keyExpr:s,buttonTemplate:r,selectedItemKeys:i,focusStateEnabled:u,hoverStateEnabled:a,activeStateEnabled:d,stylingMode:c,accessKey:p,tabIndex:h,noDataText:"",selectionRequired:!1,onItemRendered:f=>{const{width:E}=this.option();_(E)&&C(f.itemElement).addClass(De)},onSelectionChanged:f=>{this._syncSelectionOptions(),this._fireSelectionChangeEvent(f.addedItems,f.removedItems)},onItemClick:f=>{this._itemClickAction(f)}};_(t)&&t.length&&(m.selectedItems=t),this._buttonsCollection=this._createComponent(e,zo,m)}_syncSelectionOptions(){this._setOptionWithoutOptionChange("selectedItems",this._buttonsCollection.option("selectedItems")),this._setOptionWithoutOptionChange("selectedItemKeys",this._buttonsCollection.option("selectedItemKeys"))}_optionChanged(e){const{name:t,value:o}=e;switch(t){case"stylingMode":case"selectionMode":case"keyExpr":case"buttonTemplate":case"items":case"activeStateEnabled":case"focusStateEnabled":case"hoverStateEnabled":case"tabIndex":this._invalidate();break;case"selectedItemKeys":case"selectedItems":this._buttonsCollection.option(t,o);break;case"onItemClick":this._createItemClickAction();break;case"onSelectionChanged":break;case"width":super._optionChanged(e),this._buttonsCollection.itemElements().toggleClass(De,!!o);break;default:super._optionChanged(e)}}}se("dxButtonGroup",st);const Uo="dx-dropdownbutton-content";class jo extends Z{_getDefaultOptions(){return v({},super._getDefaultOptions(),{itemTemplate:"item",keyExpr:"this",selectedItem:null,selectedItemKey:null,stylingMode:"outlined",deferRendering:!0,noDataText:y.format("dxCollectionWidget-noDataText"),useSelectMode:!1,splitButton:!1,showArrowIcon:!0,template:null,text:"",type:"normal",onButtonClick:null,onSelectionChanged:null,onItemClick:null,opened:!1,items:null,dataSource:null,focusStateEnabled:!0,hoverStateEnabled:!0,dropDownOptions:{},dropDownContentTemplate:"content",wrapItemText:!1,useItemTextAsTitle:!0,grouped:!1,groupTemplate:"group",buttonGroupOptions:{}})}_setOptionsByReference(){super._setOptionsByReference(),x(this._optionsByReference,{selectedItem:!0})}_init(){super._init(),this._createItemClickAction(),this._createActionClickAction(),this._createSelectionChangedAction(),this._initDataController(),this._compileKeyGetter(),this._compileDisplayGetter(),this._options.cache("buttonGroupOptions",this.option("buttonGroupOptions")),this._options.cache("dropDownOptions",this.option("dropDownOptions"))}_initDataController(){const e=this.option("dataSource");this._dataController=new Wo(e??this.option("items"),{key:this.option("keyExpr")})}_initTemplates(){this._templateManager.addDefaultTemplates({content:new oo((e=>{const t=C(e.container),o=C("<div>").appendTo(t);this._list=this._createComponent(o,Fe,this._listOptions()),this._list.registerKeyHandler("escape",this._escHandler.bind(this)),this._list.registerKeyHandler("tab",this._escHandler.bind(this)),this._list.registerKeyHandler("leftArrow",this._escHandler.bind(this)),this._list.registerKeyHandler("rightArrow",this._escHandler.bind(this))}))}),super._initTemplates()}_compileKeyGetter(){this._keyGetter=B(this._dataController.key())}_compileDisplayGetter(){const{displayExpr:e}=this.option();this._displayGetter=B(e)}_initMarkup(){super._initMarkup(),this.$element().addClass("dx-dropdownbutton"),this._renderButtonGroup(),this._updateArrowClass(),_(this.option("selectedItemKey"))&&this._loadSelectedItem().done(this._updateActionButton.bind(this))}_renderFocusTarget(){}_render(){(!this.option("deferRendering")||this.option("opened"))&&this._renderPopup(),super._render()}_renderContentImpl(){return this._popup&&this._renderPopupContent(),super._renderContentImpl()}_loadSelectedItem(){var e;(e=this._loadSingleDeferred)===null||e===void 0||e.reject();const t=w();if(this._list&&this._lastSelectedItemData!==void 0){const n=this.option("useSelectMode")?this._list.option("selectedItem"):this._lastSelectedItemData;return t.resolve(n)}this._lastSelectedItemData=void 0;const o=this.option("selectedItemKey");return this._dataController.loadSingle(o).done(t.resolve).fail((()=>{t.reject(null)})),this._loadSingleDeferred=t,t.promise()}_createActionClickAction(){this._actionClickAction=this._createActionByOption("onButtonClick")}_createSelectionChangedAction(){this._selectionChangedAction=this._createActionByOption("onSelectionChanged")}_createItemClickAction(){this._itemClickAction=this._createActionByOption("onItemClick")}_fireSelectionChangedAction(e){let{previousValue:t,value:o}=e;this._selectionChangedAction({item:o,previousItem:t})}_fireItemClickAction(e){let{event:t,itemElement:o,itemData:n}=e;return this._itemClickAction({event:t,itemElement:o,itemData:this._actionItem||n})}_getButtonTemplate(){const{template:e,splitButton:t,showArrowIcon:o}=this.option();return e||(t||!o?"content":(n,s)=>{let{text:r,icon:i}=n;const u=we(i),a=r?C("<span>").text(r).addClass("dx-button-text"):void 0,d=we("spindown").addClass("dx-icon-right");C(s).append(u,a,d)})}_getActionButtonConfig(){const{icon:e,text:t,type:o,splitButton:n}=this.option(),s={text:t,icon:e,type:o,template:this._getButtonTemplate(),elementAttr:{class:"dx-dropdownbutton-action"}};return n&&(s.elementAttr.role="menuitem"),s}_getSpinButtonConfig(){const{type:e}=this.option();return{type:e,icon:"spindown",elementAttr:{class:"dx-dropdownbutton-toggle",role:"menuitem"}}}_getButtonGroupItems(){const{splitButton:e}=this.option(),t=[this._getActionButtonConfig()];return e&&t.push(this._getSpinButtonConfig()),t}_buttonGroupItemClick(e){let{event:t,itemData:o}=e;const n=o.elementAttr.class==="dx-dropdownbutton-action";o.elementAttr.class==="dx-dropdownbutton-toggle"?this.toggle():n&&(this._actionClickAction({event:t,selectedItem:this.option("selectedItem")}),this.option("splitButton")||this.toggle())}_getButtonGroupOptions(){const{accessKey:e,focusStateEnabled:t,hoverStateEnabled:o,splitButton:n,stylingMode:s,tabIndex:r}=this.option();return v({items:this._getButtonGroupItems(),width:"100%",height:"100%",selectionMode:"none",focusStateEnabled:t,hoverStateEnabled:o,stylingMode:s,accessKey:e,tabIndex:r,elementAttr:{role:n?"menu":"group"},onItemClick:this._buttonGroupItemClick.bind(this),onKeyboardHandled:u=>this._keyboardHandler(u)},this._options.cache("buttonGroupOptions"))}_renderPopupContent(){const e=this._popup.$content(),t=this._getTemplateByOption("dropDownContentTemplate");return e.empty(),this._popupContentId=`dx-${new Xt}`,this.setAria("id",this._popupContentId,e),t.render({container:no(e),model:this.option("items")||this._dataController.getDataSource()})}_popupOptions(){const e=this.option("rtlEnabled")?"right":"left";return x({dragEnabled:!1,focusStateEnabled:!1,deferRendering:this.option("deferRendering"),hideOnOutsideClick:t=>{const o=this.$element();return!C(t.target).closest(".dx-dropdownbutton").is(o)},showTitle:!1,animation:{show:{type:"fade",duration:0,from:0,to:1},hide:{type:"fade",duration:400,from:1,to:0}},_ignoreFunctionValueDeprecation:!0,width:()=>ve(this.$element()),height:"auto",shading:!1,position:{of:this.$element(),collision:"flipfit",my:`${e} top`,at:`${e} bottom`},_wrapperClassExternal:"dx-dropdowneditor-overlay",contentTemplate:null},this._options.cache("dropDownOptions"),{visible:this.option("opened")})}_listOptions(){const{wrapItemText:e,focusStateEnabled:t,hoverStateEnabled:o,useItemTextAsTitle:n,grouped:s,groupTemplate:r,noDataText:i,displayExpr:u,itemTemplate:a,items:d,selectedItemKey:c,useSelectMode:p}=this.option();return{selectionMode:p?"single":"none",wrapItemText:e,focusStateEnabled:t,hoverStateEnabled:o,useItemTextAsTitle:n,onContentReady:()=>this._fireContentReadyAction(),selectedItemKeys:_(c)&&p?[c]:[],grouped:s,groupTemplate:r,keyExpr:this._dataController.key(),noDataText:i,displayExpr:u,itemTemplate:a,items:d,dataSource:this._dataController.getDataSource(),onItemClick:h=>{this.option("useSelectMode")||(this._lastSelectedItemData=h.itemData),this.option("selectedItemKey",this._keyGetter(h.itemData)),this._fireItemClickAction(h)!==!1&&(this.toggle(!1),this._buttonGroup.focus())}}}_upDownKeyHandler(){var e;return(e=this._popup)!==null&&e!==void 0&&e.option("visible")&&this._list?this._list.focus():this.open(),!0}_escHandler(){return this.close(),this._buttonGroup.focus(),!0}_tabHandler(){return this.close(),!0}_renderPopup(){const e=C("<div>");this.$element().append(e),this._popup=this._createComponent(e,go,this._popupOptions()),this._popup.$content().addClass(Uo),this._popup.$wrapper().addClass("dx-dropdownbutton-popup-wrapper"),this._popup.$overlayContent().attr("aria-label","Dropdown"),this._popup.on("hiding",this._popupHidingHandler.bind(this)),this._popup.on("showing",this._popupShowingHandler.bind(this)),this._bindInnerWidgetOptions(this._popup,"dropDownOptions")}_popupHidingHandler(){this.option("opened",!1),this._updateAriaAttributes(!1)}_popupOptionChanged(e){const t=Z.getOptionsFromContainer(e);this._setPopupOption(t);const o=Object.keys(t);(o.includes("width")||o.includes("height"))&&this._dimensionChanged()}_dimensionChanged(){ho(this.option("dropDownOptions.width"))===void 0&&this._setPopupOption("width",(()=>ve(this.$element())))}_setPopupOption(e,t){this._setWidgetOption("_popup",arguments)}_popupShowingHandler(){this.option("opened",!0),this._updateAriaAttributes(!0)}_setElementAria(e){const t={owns:e?this._popupContentId:void 0};this.setAria(t,this.$element())}_setButtonsAria(e){const t={expanded:e,haspopup:"listbox"},o={};this.option("text")||(o.label="dropdownbutton"),this._getButtons().each(((n,s)=>{n===0?this.setAria(v({},o,t),C(s)):this.setAria(t,C(s))}))}_updateAriaAttributes(e){this._setElementAria(e),this._setButtonsAria(e)}_getButtons(){return this._buttonGroup.$element().find(".dx-button")}_renderButtonGroup(){var e;const t=((e=this._buttonGroup)===null||e===void 0?void 0:e.$element())||C("<div>");this._buttonGroup||this.$element().append(t),this._buttonGroup=this._createComponent(t,st,this._getButtonGroupOptions()),this._buttonGroup.registerKeyHandler("downArrow",this._upDownKeyHandler.bind(this)),this._buttonGroup.registerKeyHandler("tab",this._tabHandler.bind(this)),this._buttonGroup.registerKeyHandler("upArrow",this._upDownKeyHandler.bind(this)),this._buttonGroup.registerKeyHandler("escape",this._escHandler.bind(this)),this._bindInnerWidgetOptions(this._buttonGroup,"buttonGroupOptions"),this._updateAriaAttributes(this.option("opened"))}_updateArrowClass(){const e=this.option("splitButton")||this.option("showArrowIcon");this.$element().toggleClass("dx-dropdownbutton-has-arrow",e)}toggle(e){var t;return this._popup||(this._renderPopup(),this._renderContent()),(t=this._popup)===null||t===void 0?void 0:t.toggle(e)}open(){return this.toggle(!0)}close(){return this.toggle(!1)}_setListOption(e,t){var o;(o=this._list)===null||o===void 0||o.option(e,t)}_getDisplayValue(e){const o=!_e(e)?e:this._displayGetter(e);return _e(o)?"":String(Jt(o,""))}_updateActionButton(e){this.option("useSelectMode")&&this.option({text:this._getDisplayValue(e),icon:Pe(e)?e.icon:void 0}),this._setOptionWithoutOptionChange("selectedItem",e),this._setOptionWithoutOptionChange("selectedItemKey",this._keyGetter(e))}_clean(){var e,t;(e=this._list)===null||e===void 0||e.$element().remove(),(t=this._popup)===null||t===void 0||t.$element().remove()}_selectedItemKeyChanged(e){this._setListOption("selectedItemKeys",this.option("useSelectMode")&&_(e)?[e]:[]);const t=this.option("selectedItem");this._loadSelectedItem().always((o=>{this._updateActionButton(o),this._displayGetter(t)!==this._displayGetter(o)&&this._fireSelectionChangedAction({previousValue:t,value:o})}))}_updateButtonGroup(e,t){this._buttonGroup.option(e,t),this._updateAriaAttributes(this.option("opened"))}_actionButtonOptionChanged(e){let{name:t,value:o}=e;const n={};n[t]=o,this._updateButtonGroup("items[0]",x({},this._getActionButtonConfig(),n)),this._popup&&this._popup.repaint()}_selectModeChanged(e){if(e){this._setListOption("selectionMode","single");const t=this.option("selectedItemKey");this._setListOption("selectedItemKeys",_(t)?[t]:[]),this._selectedItemKeyChanged(this.option("selectedItemKey"))}else this._setListOption("selectionMode","none"),this.option({selectedItemKey:void 0,selectedItem:void 0}),this._actionButtonOptionChanged({text:this.option("text")})}_updateItemCollection(e){const t=this.option("selectedItemKey");this._setListOption("selectedItem",null),this._setWidgetOption("_list",[e]),_(t)&&this._loadSelectedItem().done((o=>{this._setListOption("selectedItemKeys",[t]),this._setListOption("selectedItem",o)})).fail((o=>{this._setListOption("selectedItemKeys",[])})).always(this._updateActionButton.bind(this))}_updateDataController(e){this._dataController.updateDataSource(e,this.option("keyExpr")),this._updateKeyExpr()}_updateKeyExpr(){this._compileKeyGetter(),this._setListOption("keyExpr",this._dataController.key())}focus(){this._buttonGroup.focus()}_optionChanged(e){var t;const{name:o,value:n}=e;switch(o){case"useSelectMode":this._selectModeChanged(n);break;case"splitButton":this._updateArrowClass(),this._renderButtonGroup();break;case"displayExpr":this._compileDisplayGetter(),this._setListOption(o,n),this._updateActionButton(this.option("selectedItem"));break;case"keyExpr":this._updateDataController();break;case"buttonGroupOptions":this._innerWidgetOptionChanged(this._buttonGroup,e);break;case"dropDownOptions":if(e.fullName==="dropDownOptions.visible")break;e.value.visible!==void 0&&delete e.value.visible,this._popupOptionChanged(e),this._innerWidgetOptionChanged(this._popup,e);break;case"opened":this.toggle(n);break;case"focusStateEnabled":case"hoverStateEnabled":this._setListOption(o,n),this._updateButtonGroup(o,n),super._optionChanged(e);break;case"items":this._updateDataController(this.option("items")),this._updateItemCollection(o);break;case"dataSource":this._dataController.updateDataSource(n),this._updateKeyExpr(),this._updateItemCollection(o);break;case"icon":case"text":this._actionButtonOptionChanged(e);break;case"showArrowIcon":this._updateArrowClass(),this._renderButtonGroup(),this._popup&&this._popup.repaint();break;case"width":case"height":super._optionChanged(e),(t=this._popup)===null||t===void 0||t.repaint();break;case"stylingMode":case"tabIndex":this._updateButtonGroup(o,n);break;case"type":this._updateButtonGroup("items",this._getButtonGroupItems());break;case"itemTemplate":case"grouped":case"noDataText":case"groupTemplate":case"wrapItemText":case"useItemTextAsTitle":this._setListOption(o,n);break;case"dropDownContentTemplate":this._renderContent();break;case"selectedItemKey":this._selectedItemKeyChanged(n);break;case"selectedItem":break;case"onItemClick":this._createItemClickAction();break;case"onButtonClick":this._createActionClickAction();break;case"onSelectionChanged":this._createSelectionChangedAction();break;case"deferRendering":{const{opened:s}=this.option();this.toggle(s);break}case"template":this._renderButtonGroup();break;default:super._optionChanged(e)}}getDataSource(){return this._dataController.getDataSource()}}se("dxDropDownButton",jo);function qo(l,e){const t=a=>a||1,o=[],n=(l[0]||[]).reduce(((a,d)=>a+t(d.colspan)),0),s=(a=>{let d=0,c=0;return()=>{const p=a[d]||[],h=p[c++];return c>=p.length&&(d++,c=0),h&&(h.colspan=t(h.colspan),h.rowspan=t(h.rowspan)),h}})(l),r=(a,d,c)=>{const p=o[a]=o[a]||[];if(p[d]=c,c.colspan>1||c.rowspan>1){const h=(m=>x({},m,e))(c);for(let m=1;m<c.colspan;m++)r(a,d+m,h);for(let m=1;m<c.rowspan;m++)for(let f=0;f<c.colspan;f++)r(a+m,d+f,h)}};let i=s(),u=0;for(;i;){for(let a=0;a<n&&i;a++)o[u]&&o[u][a]||(r(u,a,i),a+=i.colspan-1,i=s());u++}return o}class Qo{constructor(e,t,o){this._exportController=e,this._initialColumnWidthsByColumnIndex=t,this._selectedRowsOnly=o}_getGroupValue(e){const{key:t,data:o,rowType:n,groupIndex:s,summaryCells:r}=e,i=this._options.groupColumns[s],u=g.getDisplayValue(i,i.deserializeValue?i.deserializeValue(t[s]):t[s],o,n);let a=`${i.caption}: ${g.formatValue(u,i)}`;return r&&r[0]&&r[0].length&&(a+=` ${g.getGroupRowSummaryText(r[0],this._options.summaryTexts)}`),a}_correctCellIndex(e){return e}_initOptions(){const e=this._exportController,t=e._columnsController.getGroupColumns();this._options={columns:e._getColumns(this._initialColumnWidthsByColumnIndex),groupColumns:t,items:this._selectedRowsOnly||e._selectionOnly?e._getSelectedItems():e._getAllItems(),isHeadersVisible:e.option("showColumnHeaders"),summaryTexts:e.option("summary.texts"),rtlEnabled:e.option("rtlEnabled")}}getHeaderStyles(){return[{bold:!0,alignment:"center"},{bold:!0,alignment:"left"},{bold:!0,alignment:"right"}]}getGroupRowStyle(){return{bold:!0,alignment:so(this._options.rtlEnabled)}}getColumnStyles(){const e=[];return this.getColumns().forEach((t=>{e.push({alignment:t.alignment||"left",format:t.format,dataType:t.dataType})})),e}getStyles(){return[...this.getHeaderStyles(),...this.getColumnStyles(),this.getGroupRowStyle()]}_getTotalCellStyleId(e){var t;const o=((t=this.getColumns()[e])===null||t===void 0?void 0:t.alignment)||"right";return this.getHeaderStyles().map((n=>n.alignment)).indexOf(o)}getStyleId(e,t){return e<this.getHeaderRowCount()?0:this.isTotalCell(e-this.getHeaderRowCount(),t)?this._getTotalCellStyleId(t):this.isGroupRow(e-this.getHeaderRowCount())?this.getHeaderStyles().length+this.getColumns().length:t+this.getHeaderStyles().length}getColumns(e){const{columns:t}=this._options;return e?t:t[t.length-1]}getColumnsWidths(){const e=this.getColumns();return _(e)?e.map((t=>t.width)):void 0}getRowsCount(){return this._options.items.length+this.getHeaderRowCount()}getHeaderRowCount(){return this.isHeadersVisible()?this._options.columns.length-1:0}isGroupRow(e){return e<this._options.items.length&&this._options.items[e].rowType==="group"}getGroupLevel(e){const t=this._options.items[e-this.getHeaderRowCount()],o=t&&t.groupIndex;return t&&t.rowType==="totalFooter"?0:_(o)?o:this._options.groupColumns.length}getCellType(e,t){const o=this.getColumns();if(e<this.getHeaderRowCount())return"string";if(e-=this.getHeaderRowCount(),t<o.length){const n=this._options.items.length&&this._options.items[e],s=o[t];return n&&n.rowType==="data"&&isFinite(n.values[this._correctCellIndex(t)])&&!_(s.customizeText)?_(s.lookup)?s.lookup.dataType:s.dataType:"string"}}ready(){this._initOptions();const e=this._options;return k(e.items).done((t=>{e.items=t})).fail((()=>{e.items=[]}))}_convertFromGridGroupSummaryItems(e){if(_(e)&&e.length>0)return e.map((t=>({value:t.value,name:t.name})))}getCellData(e,t,o){let n,s;const r={cellSourceData:{},value:n},i=this.getColumns(),u=this._correctCellIndex(t);if(e<this.getHeaderRowCount())s=this.getColumns(!0)[e][t],r.cellSourceData.rowType="header",r.cellSourceData.column=s&&s.gridColumn,r.value=s&&s.caption;else{e-=this.getHeaderRowCount();const a=this._options.items.length&&this._options.items[e];if(a){const d=a.values;switch(r.cellSourceData.rowType=a.rowType,r.cellSourceData.column=i[t]&&i[t].gridColumn,a.rowType){case"groupFooter":case"totalFooter":u<d.length&&(n=d[u],_(n)?(r.cellSourceData.value=n.value,r.cellSourceData.totalSummaryItemName=n.name,r.value=g.getSummaryText(n,this._options.summaryTexts)):r.cellSourceData.value=void 0);break;case"group":if(r.cellSourceData.groupIndex=a.groupIndex,t<1)r.cellSourceData.column=this._options.groupColumns[a.groupIndex],r.cellSourceData.value=a.key[a.groupIndex],r.cellSourceData.groupSummaryItems=this._convertFromGridGroupSummaryItems(a.summaryCells[0]),r.value=this._getGroupValue(a);else{const c=a.values[u];if(Array.isArray(c)){r.cellSourceData.groupSummaryItems=this._convertFromGridGroupSummaryItems(c),n="";for(let p=0;p<c.length;p++)n+=(p>0?o?`
`:` 
 `:"")+g.getSummaryText(c[p],this._options.summaryTexts);r.value=n}else r.cellSourceData.value=void 0}break;default:if(s=i[t],s){const c=d[u],p=g.getDisplayValue(s,c,a.data,a.rowType);!isFinite(p)||_(s.customizeText)?o&&_(s.customizeText)&&s.customizeText===this._exportController._columnsController.getCustomizeTextByDataType("boolean")?r.value=p:r.value=g.formatValue(p,s):r.value=p,r.cellSourceData.value=c}r.cellSourceData.data=a.data}}}return r}isHeadersVisible(){return this._options.isHeadersVisible}isTotalCell(e,t){const{items:o}=this._options,n=o[e],s=this._correctCellIndex(t),r=n.summaryCells&&n.summaryCells[s]&&n.summaryCells[s].length>0&&n.summaryCells[s][0].alignByColumn;return n&&n.rowType==="groupFooter"||n.rowType==="totalFooter"||r}getCellMerging(e,t){const{columns:o}=this._options,n=o[e]&&o[e][t];return n?{colspan:(n.exportColspan||1)-1,rowspan:(n.rowspan||1)-1}:{colspan:0,rowspan:0}}getFrozenArea(){return{x:0,y:this.getHeaderRowCount()}}}class Xo extends g.ViewController{init(){this.throwWarningIfNoOnExportingEvent(),this._columnsController=this.getController("columns"),this._dataController=this.getController("data"),this._selectionController=this.getController("selection"),this._rowsView=this.getView("rowsView"),this._headersView=this.getView("columnHeadersView"),this.createAction("onExporting",{excludeValidators:["disabled","readOnly"]})}_getEmptyCell(){return{caption:"",colspan:1,rowspan:1}}_updateColumnWidth(e,t){e.width=t}_getColumns(e){let t=[],o,n;const s=this._columnsController,r=s.getRowCount();for(o=0;o<=r;o++){const i=[];n=s.getVisibleColumns(o,!0);let u;if(o===r)if(this._updateLockCount)u=e;else{const a=this._getColumnWidths(this._headersView,this._rowsView);if(a&&a.length){u={};for(let d=0;d<n.length;d++)u[n[d].index]=a[d]}}for(let a=0;a<n.length;a++){const d=x({},n[a],{dataType:n[a].dataType==="datetime"?"date":n[a].dataType,gridColumn:n[a]});if(this._needColumnExporting(d)){const c=this._calculateExportColspan(d);_(c)&&(d.exportColspan=c),u&&this._updateColumnWidth(d,u[d.index]),i.push(d)}}t.push(i)}return n=t[r],t=qo(t.slice(0,-1),this._getEmptyCell()),t.push(n),t}_calculateExportColspan(e){if(!e.isBand)return;const t=this._columnsController.getChildrenByBandColumn(e.index,!0);if(_(t))return t.reduce(((o,n)=>this._needColumnExporting(n)?o+(this._calculateExportColspan(n)||1):o),0)}_needColumnExporting(e){return!e.command&&(e.allowExporting||e.allowExporting===void 0)}_getFooterSummaryItems(e,t){const o=[];let n=1,s=0;do{const r=[];for(let i=0;i<e.length;i++){const u=e[i],a=u.length;n<a&&(n=a),r.push(u[s])}o.push({values:r,rowType:t?"totalFooter":"groupFooter"})}while(s++<n-1);return o}_hasSummaryGroupFooters(){const e=this.option("summary.groupItems");if(_(e)){for(let t=0;t<e.length;t++)if(e[t].showInGroupFooter)return!0}return!1}_getItemsWithSummaryGroupFooters(e){let t=[],o=[],n=[];for(let s=0;s<e.length;s++){const r=e[s];r.rowType==="groupFooter"?(n=this._getFooterSummaryItems(r.summaryCells),t=t.concat(o,n),o=[]):o.push(r)}return t.length?t:o}_updateGroupValuesWithSummaryByColumn(e){let t=[];for(let o=0;o<e.length;o++){const n=e[o],{summaryCells:s}=n;if(n.rowType==="group"&&s&&s.length>1){const r=n.values.length;for(let i=1;i<s.length;i++)for(let u=0;u<s[i].length;u++){const a=s[i][u];a&&a.alignByColumn&&(Array.isArray(t[i-r])||(t[i-r]=[]),t[i-r].push(a))}t.length>0&&(n.values.push(...t),t=[])}}}_processUnExportedItems(e){const t=this._columnsController.getVisibleColumns(null,!0),o=this._columnsController.getGroupColumns();let n,s;for(let r=0;r<e.length;r++){const i=e[r];let u=!1;n=[],s=[];for(let a=0;a<t.length;a++){const d=t[a];if(u||(u=["detailExpand","buttons"].includes(d.type)),this._needColumnExporting(d)&&(i.values&&(i.rowType==="group"&&!n.length?n.push(i.key[i.groupIndex]):n.push(i.values[a])),i.summaryCells))if(i.rowType==="group"&&!s.length){const c=a-o.length+i.groupIndex;s.push(i.summaryCells[u?c:c+1])}else s.push(i.summaryCells[a])}n.length&&(i.values=n),s.length&&(i.summaryCells=s)}}_getAllItems(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const o=this,n=new w,s=this._dataController.footerItems(),r=s.length&&s[0],i=o.option("summary.totalItems");let u;return k(e).done((a=>{this._dataController.loadAll(a,t).done(((d,c)=>{o._updateGroupValuesWithSummaryByColumn(d),o._hasSummaryGroupFooters()&&(d=o._getItemsWithSummaryGroupFooters(d)),u=r&&r.summaryCells,_(c)&&i&&(u=o._getSummaryCells(i,c));const p=r&&o._getFooterSummaryItems(u,!0);p&&(d=d.concat(p)),o._processUnExportedItems(d),n.resolve(d)})).fail(n.reject)})).fail(n.reject),n}_getSummaryCells(e,t){return this._dataController._calculateSummaryCells(e,t,this._columnsController.getVisibleColumns(null,!0),((o,n)=>this._dataController._isDataColumn(n)?n.index:-1))}_getSelectedItems(){return this.needLoadItemsOnExportingSelectedItems()?this._getAllItems(this._selectionController.loadSelectedItemsWithFilter(),!0):this._getAllItems(this._selectionController.getSelectedRowsData())}_getColumnWidths(e,t){return e&&e.isVisible()?e.getColumnWidths():t.getColumnWidths()}throwWarningIfNoOnExportingEvent(){var e,t;const o=(e=(t=this.component).hasActionSubscription)===null||e===void 0?void 0:e.call(t,"onExporting");this.option("export.enabled")&&!o&&$.log("W1024")}callbackNames(){return["selectionOnlyChanged"]}getDataProvider(e){const t=this._getColumnWidths(this._headersView,this._rowsView);let o;if(t&&t.length){o={};const n=this._columnsController.getVisibleColumns(this._columnsController.getRowCount(),!0);for(let s=0;s<n.length;s++)o[n[s].index]=t[s]}return new Qo(this,o,e)}exportTo(e,t){this._selectionOnly=e;const o=this.getAction("onExporting"),n={rtlEnabled:this.option("rtlEnabled"),selectedRowsOnly:!!e,format:t,fileName:"DataGrid",cancel:!1};N(o)&&o(n)}publicMethods(){return["getDataProvider"]}selectionOnly(e){if(_(e))this._isSelectedRows=e,this.selectionOnlyChanged.fire();else return this._isSelectedRows}optionChanged(e){super.optionChanged(e),e.name==="export"&&this.throwWarningIfNoOnExportingEvent()}needLoadItemsOnExportingSelectedItems(){return this.option("loadItemsOnExportingSelectedItems")??this._dataController._dataSource.remoteOperations().filtering}}const Jo=l=>class extends l{callbackNames(){const e=super.callbackNames();return _(e)?e.push("editingButtonsUpdated"):["editingButtonsUpdated"]}_updateEditButtons(){super._updateEditButtons(),this.editingButtonsUpdated.fire()}},Yo=l=>class extends l{_getToolbarItems(){const e=super._getToolbarItems(),t=this._getExportToolbarButton();return t&&(e.push(t),this._correctItemsPosition(e)),e}_getExportToolbarButton(){const e=this._getExportToolbarItems();if(e.length===0)return null;const t=this._needDisableExportButton(),o={name:"exportButton",location:"after",locateInMenu:"auto",sortIndex:30,options:{items:e},disabled:t};if(e.length===1){const n=v({},e[0],{hint:e[0].text,elementAttr:{class:"dx-datagrid-export-button"}});o.widget="dxButton",o.showText="inMenu",o.options=n}else{const n={icon:"export",displayExpr:"text",items:e,hint:this.option("export.texts.exportTo"),elementAttr:{class:"dx-datagrid-export-button"},dropDownOptions:{width:"auto",_wrapperClassExternal:"dx-datagrid-export-menu"}};o.options=n,o.widget="dxDropDownButton",o.menuItemTemplate=(s,r,i)=>{this._createComponent(C(i),Fe,{items:e})}}return o}_getExportToolbarItems(){const e=this.option("export"),t=this.option("export.texts"),o=this.option("export.formats")??[];if(!e.enabled)return[];const n=[];return o.forEach((s=>{let r=s.toUpperCase(),i="export";s==="xlsx"&&(r="Excel",i="xlsxfile"),s==="pdf"&&(i="pdffile"),n.push({text:Ce(t.exportAll,r),icon:i,onClick:()=>{this._exportController.exportTo(!1,s)}}),e.allowExportSelectedData&&n.push({text:Ce(t.exportSelectedRows,r),icon:"exportselected",onClick:()=>{this._exportController.exportTo(!0,s)}})})),n}_correctItemsPosition(e){e.sort(((t,o)=>t.sortIndex-o.sortIndex))}_isExportButtonVisible(){return this.option("export.enabled")}optionChanged(e){super.optionChanged(e),e.name==="export"&&(e.handled=!0,this._invalidate())}_needDisableExportButton(){const e=!this._columnsController.hasVisibleDataColumns(),t=this._editingController.hasChanges();return e||t}_columnOptionChanged(e){if(super._columnOptionChanged(e),g.checkChanges(e.optionNames,["groupIndex","visible","all"])){const o=this._needDisableExportButton();this.setToolbarItemDisabled("exportButton",o)}}init(){super.init(),this._exportController=this.getController("export"),this._editingController.editingButtonsUpdated.add((()=>{const e=this._needDisableExportButton();this.setToolbarItemDisabled("exportButton",e)}))}};g.registerModule("export",{defaultOptions:()=>({export:{enabled:!1,fileName:"DataGrid",formats:["xlsx"],allowExportSelectedData:!1,texts:{exportTo:y.format("dxDataGrid-exportTo"),exportAll:y.format("dxDataGrid-exportAll"),exportSelectedRows:y.format("dxDataGrid-exportSelectedRows")}}}),controllers:{export:Xo},extenders:{controllers:{editing:Jo},views:{headerPanel:Yo}}});const Zo=Number.MAX_SAFE_INTEGER||9007199254740991,en=l=>class extends L.extenders.controllers.data(l){changeRowExpand(e,t){return this.option("focusedRowEnabled")&&Array.isArray(e)&&this.isRowExpanded(e)&&(!t||!this._keyboardNavigationController.isKeyboardEnabled())&&this._isFocusedRowInsideGroup(e)&&this.option("focusedRowKey",e),super.changeRowExpand(e,t)}_isFocusedRowInsideGroup(e){const t=this.option("focusedRowKey"),o=this.getRowIndexByKey(t),n=o>=0&&this.getVisibleRows()[o],s=this._columnsController.getGroupDataSourceParameters(!0);if(n){for(let r=0;r<e.length;++r)if(B(s[r]&&s[r].selector)(n.data)!==e[r])return!1}return!0}_getGroupPath(e,t){const o=[];let n=e[0];for(;n&&o.length<t;){var s;o.push(n.key),n=(s=n.items)===null||s===void 0?void 0:s[0]}return o}_expandGroupByPath(e,t,o){const n=new w;return o++,e.expandRow(t.slice(0,o)).done((()=>{o===t.length?n.resolve():e._expandGroupByPath(e,t,o).done(n.resolve).fail(n.reject)})).fail(n.reject),n.promise()}_calculateGlobalRowIndexByGroupedData(e){const t=this,o=t._dataSource,n=t._generateFilterByKey(e),s=new w,r=Array.isArray(e),i=o.group();return r?s.resolve(-1).promise():o._grouping._updatePagingOptions?(o.load({filter:t._concatWithCombinedFilter(n),group:i}).done((u=>{if(!(_(u)&&u.length>0))return s.resolve(-1).promise();const d=t._getGroupPath(u,i.length);t._expandGroupByPath(t,d,0).done((()=>{t._calculateExpandedRowGlobalIndex(s,e,d,i)})).fail(s.reject)})).fail(s.reject),s.promise()):(t._calculateGlobalRowIndexByFlatData(e,null,!0).done(s.resolve).fail(s.reject),s)}_calculateExpandedRowGlobalIndex(e,t,o,n){const s=T(o,{group:n}),r=this._dataSource,i=this.option("scrolling.mode"),u=i==="virtual"||i==="infinite",a=r.pageSize();let d;r._grouping._updatePagingOptions({skip:0,take:Zo},((c,p)=>{Yt(c.path,o)&&(d=p)})),this._calculateGlobalRowIndexByFlatData(t,s).done((c=>{let p,h;if(c<0){e.resolve(-1);return}p=(d%a||a)+c-o.length,u?h=0:h=Math.floor(p/(a-o.length))*o.length,p=d+c+h,e.resolve(p)})).fail(e.reject)}};g.registerModule("focus",v({},L,{extenders:v({},L.extenders,{controllers:v({},L.extenders.controllers,{data:en})})}));g.registerModule("rowDragging",zt);export{_o as D,qo as p};
