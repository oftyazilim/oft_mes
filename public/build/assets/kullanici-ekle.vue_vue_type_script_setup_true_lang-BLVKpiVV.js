import{r as N,e as X}from"./validators-BwBNGiur.js";import{d as ee,r as d,a_ as ae,w as _,G as le,a$ as b,g as se,f as u,o as re,b as i,e as ie,v as E,b0 as te,m as V,t as M,ae as w,aZ as U}from"./main-Cq-m7Uwl.js";import{_ as ne}from"./AppSelect.vue_vue_type_script_setup_true_lang-DlxTGcxf.js";import{_ as oe}from"./AppTextField.vue_vue_type_script_setup_true_lang-BLnbbAgJ.js";import{V as ue}from"./VDialog-pXooi2lL.js";import{V as K,c as de,a as me}from"./VCard-CSNjTHN_.js";import{V as pe}from"./VDivider-asXPKL07.js";import{V as ce}from"./VCardText-DBWrmU7G.js";import{V as ve}from"./VForm-CNHRE5-v.js";import{V as fe}from"./VRow-Dk54hNXi.js";import{V as f}from"./VCol-B2ZQFejJ.js";const ye={class:"text-h4 mb-2"},Ee=ee({__name:"kullanici-ekle",props:{isDrawerOpen:{type:Boolean},userData:{default:()=>({id:0,name:"",email:"",roles:"",proses:"",tip:"",unvan:"",ismerkezi:"",istasyon:""})}},emits:["update:isDrawerOpen","submit"],setup(C,{emit:q}){const z=q,T=d([]);d(!1);const A=d(),I=d(""),L=d(null),B=d(null),F=d([]),g=d([]),P=d(null),J=d(null),y=d([]),p=d(null),c=d([]),O=d([]),k=d([]);d(""),d("false");const v=C,Y=d([{name:"AR-GE"},{name:"BAKIM"},{name:"BOYAHANE"},{name:"CAM YAPIŞTIRMA"},{name:"DEPO"},{name:"DUVAR TİPİ MONTAJ"},{name:"DİKİLİ TİP MONTAJ"},{name:"FAN-PDU MONTAJ"},{name:"FİNANS"},{name:"FO-CU MEKANİK MONTAJ"},{name:"GENEL"},{name:"IP PDU MONTAJ"},{name:"İNSAN KAYNAKLARI"},{name:"KALİTE"},{name:"MEKANİK"},{name:"MONTAJ"},{name:"MUHASEBE"},{name:"OUTDOOR ÜRÜN MONTAJ"},{name:"OUTDOOR ÖZEL ÜRÜN MONTAJ"},{name:"PAKETLEME"},{name:"PASİF AKSESUAR MONTAJ"},{name:"PLANLAMA"},{name:"SERİGRAFİ"},{name:"SEVKİYAT"},{name:"SATINALMA"},{name:"SATIŞ"}]),S=async()=>{var e,a;if(p.value===null||p.value===""){k.value=[{istasyon_id:"",ist_adi:"Seçim yok"}];return}try{const{data:s}=await b.get("/api/istasyonal",{params:{ismerkezi:String(p.value??"")}}),l=s,t=(l==null?void 0:l.istasyonlar)??((e=l==null?void 0:l.data)==null?void 0:e.istasyonlar)??l,h=Array.isArray(t)?t:[];if(k.value=h.map(o=>{const r=(o==null?void 0:o.istasyon_id)??(o==null?void 0:o.id)??o,m=typeof r=="number"?r:Number(r);return{istasyon_id:Number.isFinite(m)?m:typeof r=="string"?r:0,ist_adi:(o==null?void 0:o.ist_adi)??(o==null?void 0:o.name)??String(r??"")}}).filter(o=>o.istasyon_id!==0||typeof o.istasyon_id=="string"&&o.istasyon_id!==""),k.value.unshift({istasyon_id:"",ist_adi:"Seçim yok"}),(a=v.userData)!=null&&a.id&&v.userData.istasyon){const o=v.userData.istasyon.split(",").map(m=>Number(m.trim())),r=k.value.map(m=>m.istasyon_id);c.value=o.filter(m=>r.includes(m))}}catch(s){console.error("İstasyonlar alınırken hata oluştu:",s)}},j=async()=>{var e,a;try{const{data:s}=await b.get("/api/merkezal"),l=s,t=(l==null?void 0:l.merkezler)??((e=l==null?void 0:l.data)==null?void 0:e.merkezler)??l,o=(Array.isArray(t)?t:[]).map(r=>{const m=(r==null?void 0:r.is_merkezi_id)??(r==null?void 0:r.id)??r,R=typeof m=="number"?m:Number(m);return{is_merkezi_id:Number.isFinite(R)?R:typeof m=="string"?m:0,mrk_adi:(r==null?void 0:r.mrk_adi)??(r==null?void 0:r.name)??String(m??"")}}).filter(r=>r.is_merkezi_id!==0||typeof r.is_merkezi_id=="string"&&r.is_merkezi_id!=="");if(O.value=[{is_merkezi_id:"",mrk_adi:"Seçim yok"},...o],(a=v.userData)!=null&&a.id){const r=(v.userData.ismerkezi||"").split(",").map(m=>m.trim()).filter(Boolean)[0];p.value=r?isNaN(Number(r))?r:Number(r):null,S()}}catch(s){console.error("Veri çekilirken hata oluştu: ",s)}},n=ae({...v.userData});_(()=>v.userData,e=>{Object.assign(n,e)}),_(()=>v.userData,e=>{if(e&&e.id>0){I.value=e.name||"",L.value=e.email||"",y.value=e.roles!=""?e.roles.split(",").map(a=>a.trim()):[],P.value=e.proses||"",J.value=e.tip||"",B.value=e.unvan||"",F.value=e.ismerkezi||"",g.value=e.istasyon||"";{const a=(e.ismerkezi||"").split(",").map(s=>s.trim()).filter(Boolean)[0];p.value=a?isNaN(Number(a))?a:Number(a):null}c.value=e.istasyon!=""?e.istasyon.split(",").map(a=>Number(a.trim())):[]}else y.value=[],p.value=null,c.value=[],Object.assign(n,{id:0,name:"",email:"",roles:null,proses:"",tip:"",unvan:"",ismerkezi:null,istasyon:null})},{immediate:!0}),le(()=>{G(),j()}),_(p,e=>{e!==null&&e!==""?(c.value=[],g.value=null,S()):(k.value=[{istasyon_id:"",ist_adi:"Seçim yok"}],c.value=[],g.value=null)}),_(c,e=>{Array.isArray(e)&&e.includes("")&&(c.value=[""])});const G=async()=>{try{const{data:e}=await b.get("/api/roles/available"),a=Array.isArray(e==null?void 0:e.roles)?e.roles:Array.isArray(e)?e:[];T.value=a.map(s=>typeof s=="string"?{name:s}:{name:String((s==null?void 0:s.name)??"")}).filter(s=>s.name)}catch(e){console.error("Roller alınırken hata oluştu:",e)}},H=()=>{z("update:isDrawerOpen",!1),U(()=>{var e,a;(e=A.value)==null||e.reset(),(a=A.value)==null||a.resetValidation()})},$=()=>{var e;(e=A.value)==null||e.validate().then(({valid:a})=>{var s;a&&((s=v.userData)!=null&&s.id?x():Z(),z("update:isDrawerOpen",!1),U(()=>{var l,t;(l=A.value)==null||l.reset(),(t=A.value)==null||t.resetValidation()}))})},Z=async()=>{var e,a,s;try{const l=await b.post("/api/users",{name:n.name,email:n.email,password:"pass1234",roles:y.value,proses:n.proses,tip:n.tip,unvan:n.unvan,ismerkezi:String(p.value??""),istasyon:D(c.value)});try{const t=((e=l==null?void 0:l.data)==null?void 0:e.id)??0;window.dispatchEvent(new CustomEvent("user-updated",{detail:{id:t,roles:y.value}}))}catch{}}catch(l){(s=(a=l==null?void 0:l.response)==null?void 0:a.data)!=null&&s.errors?console.error("Doğrulama hataları:",l.response.data.errors):console.error("Beklenmeyen hata:",l)}z("update:isDrawerOpen",!1)},x=async()=>{var e;try{const a=await b.put(`/api/users/${n.id}`,{name:n.name,email:n.email,roles:y.value,proses:n.proses,tip:n.tip,unvan:n.unvan,ismerkezi:String(p.value??""),istasyon:D(c.value)});try{window.dispatchEvent(new CustomEvent("user-updated",{detail:{id:n.id,roles:y.value}}))}catch{}}catch(a){console.error("Kullanıcı güncellenirken hata oluştu:",((e=a==null?void 0:a.response)==null?void 0:e.data)??a)}};_(O,e=>{var a;if((a=v.userData)!=null&&a.id&&(p.value===null||p.value==="")){const s=(v.userData.ismerkezi||"").split(",").map(l=>l.trim()).filter(Boolean)[0];p.value=s?isNaN(Number(s))?s:Number(s):null}});const Q=e=>{z("update:isDrawerOpen",e)},W=e=>{p.value=e,c.value=[],g.value=null,S()},D=e=>Array.isArray(e)?e.filter(a=>a!==null&&a!=="").join(","):e==null?"":e instanceof Set?Array.from(e).join(","):typeof e=="object"&&Array.isArray(e.value)?e.value.join(","):String(e);return(e,a)=>{const s=oe,l=ne;return re(),se(ue,{temporary:"",width:800,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":Q},{default:u(()=>[i(K,{class:"pa-2 pa-sm-10"},{default:u(()=>[i(de,{class:"text-center"},{default:u(()=>[i(me,null,{default:u(()=>[ie("h4",ye,E(v.userData.id>0?"Kullanıcı Düzenle":"Yeni Kullanıcı Ekle"),1)]),_:1})]),_:1}),i(pe),i(K,{flat:""},{default:u(()=>[i(ce,null,{default:u(()=>[i(ve,{ref_key:"refForm",ref:A,"lazy-validation":"",onSubmit:te($,["prevent"])},{default:u(()=>[i(fe,null,{default:u(()=>[i(f,{cols:"6"},{default:u(()=>[i(s,{modelValue:n.name,"onUpdate:modelValue":a[0]||(a[0]=t=>n.name=t),rules:["requiredValidator"in e?e.requiredValidator:V(N)],label:"Adı Soyadı",placeholder:"Ali VELİ"},null,8,["modelValue","rules"])]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(s,{modelValue:n.email,"onUpdate:modelValue":a[1]||(a[1]=t=>n.email=t),rules:["requiredValidator"in e?e.requiredValidator:V(N),"emailValidator"in e?e.emailValidator:V(X)],label:"Email",placeholder:"aliveli@email.com"},null,8,["modelValue","rules"])]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(s,{modelValue:n.unvan,"onUpdate:modelValue":a[2]||(a[2]=t=>n.unvan=t),rules:["requiredValidator"in e?e.requiredValidator:V(N)],label:"Ünvan",placeholder:"Yönetici"},null,8,["modelValue","rules"])]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(l,{modelValue:n.proses,"onUpdate:modelValue":a[3]||(a[3]=t=>n.proses=t),rules:["requiredValidator"in e?e.requiredValidator:V(N)],label:"Görev Yeri (Proses)",items:Y.value,"item-title":"name"},null,8,["modelValue","rules","items"])]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(l,{modelValue:n.tip,"onUpdate:modelValue":a[4]||(a[4]=t=>n.tip=t),rules:["requiredValidator"in e?e.requiredValidator:V(N)],label:"Kademe",items:["YÖNETİM","ÜRETİM"]},null,8,["modelValue","rules"])]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(l,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=t=>y.value=t),rules:["requiredValidator"in e?e.requiredValidator:V(N)],items:T.value,"item-title":"name","item-value":"name","return-object":!1,"menu-props":{maxHeight:"400"},label:"Roller",multiple:"","persistent-hint":"",placeholder:"Rol seçiniz...",chips:"","closable-chips":""},null,8,["modelValue","rules","items"])]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(l,{modelValue:p.value,"onUpdate:modelValue":[a[6]||(a[6]=t=>p.value=t),W],items:O.value,"item-title":"mrk_adi","menu-props":{maxHeight:"400"},label:"İş Merkezleri","persistent-hint":"","item-value":"is_merkezi_id",placeholder:"Rol seçiniz..."},null,8,["modelValue","items"]),M(E(p.value),1)]),_:1}),i(f,{cols:"6"},{default:u(()=>[i(l,{modelValue:c.value,"onUpdate:modelValue":a[7]||(a[7]=t=>c.value=t),items:k.value,"item-title":"ist_adi","menu-props":{maxHeight:"400"},label:"İş İstasyonları","persistent-hint":"","item-value":"istasyon_id",placeholder:"Rol seçiniz..."},null,8,["modelValue","items"]),M(E(c.value),1)]),_:1}),i(f,{cols:"12",class:"text-center mt-2"},{default:u(()=>[i(w,{type:"submit",class:"me-3"},{default:u(()=>a[8]||(a[8]=[M(" Kaydet ")])),_:1,__:[8]}),i(w,{type:"reset",variant:"tonal",color:"error",onClick:H},{default:u(()=>a[9]||(a[9]=[M(" Vazgeç ")])),_:1,__:[9]})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{Ee as _};
