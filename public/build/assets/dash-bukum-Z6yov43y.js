import{d as xe,r as d,X as q,G as ue,bh as Q,c as n,l as c,e as t,v as r,x as F,F as f,i as y,I as v,a$ as Ee,o,aI as Ae,t as ee}from"./main-LxvBfCYO.js";import{_ as $e}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Le={class:"dash-container"},Re={key:0,class:"loading-overlay"},Be={class:"dash-header"},Oe={class:"header-left"},qe={class:"summary-card stretch"},Fe={class:"summary-kpis"},Ie={class:"kpi"},Pe={class:"kpi"},Ve={class:"kpi"},Ke={class:"dash-actions mt-3"},We=["disabled"],Ge={key:0},He={key:1},Ue={key:0,class:"last-updated"},Ye={key:1,class:"warn",title:"API geçici boş yanıt verdi; önceki veriler gösteriliyor"},Xe={key:2,class:"warn"},je={key:3,class:"hint"},Ze={class:"header-right"},Je={class:"weekly-card"},Qe={class:"weekly-vertical mt-2"},et={class:"wv-bars"},tt={class:"wv-stack"},st=["title"],at={key:0,class:"wv-val"},lt={key:0,class:"wv-val"},it={class:"wv-day"},nt={class:"weekly-count-card"},ot={class:"weekly-vertical mt-2"},rt={class:"wvc-bars"},dt={class:"wvc-stack"},ut=["title"],ct={key:0,class:"wvc-label"},vt={class:"wvc-day"},kt={class:"cards-grid"},mt={class:"card-top"},ft={class:"names"},yt={class:"machine-name",style:{"font-size":"20px"}},pt={class:"machine-name"},ht={class:"mb-1"},_t={key:0,class:"operator-name"},bt={class:"duration pe-3"},wt={key:0,class:"meta-row"},gt={class:"meta-left"},St={key:0,class:"pill code"},Mt={key:1,class:"meta-name"},Tt={key:0,class:"meta-right"},Ct={class:"kpi-row"},zt={class:"kpi-item"},Dt={class:"kpi-item"},Nt={class:"kpi-item"},xt={class:"mini-bars"},Et={key:0,class:"multi-bar"},At=["title"],$t={key:1,class:"multi-bar",title:"Çalışma/Duruş oranı"},Lt={key:2,class:"status-extra"},Rt={class:"extra-right"},Bt=["title"],Ot={class:"charts-grid"},qt={class:"chart-card"},Ft={key:0,class:"alert error mt-2"},It={class:"msg"},Pt={key:1,class:"alert empty mt-2"},Vt={key:2,class:"reason-bars mt-2"},Kt={class:"bar"},Wt={key:3,class:"reason-bars mt-2"},Gt={class:"row-label"},Ht={class:"bar mt-2"},Ut={class:"value"},Yt={class:"chart-card ticker-card","aria-label":"Bilgilendirme akışı"},Xt={key:0,class:"ticker-hint"},jt={class:"ticker-controls"},Zt=["onClick","title"],C=1e4,Jt=xe({__name:"dash-bukum",setup(Qt){const te=d(["Üretimde süreklilik için proaktif bakım planı devrede","Operatör güvenliği: Koruyucu ekipman kontrolü yapılmalı","Enerji verimliliği izleniyor – gereksiz duruşları azaltın","Kalite ilk seferde doğru üretimle başlar","Anlık OEE analizi ile darboğazları tespit edin"]),ce=q(()=>[...te.value,...te.value]),w=d(0),z=d(!1);let D=null;const se=[60,100,140,200],I=d(2),ve=q(()=>se[I.value]||140),ae=d(null),P=d(0),p=d(0);let N=0;const ke=q(()=>({transform:`translateX(${w.value}px)`,inlineSize:P.value+"px"}));function V(){const a=ae.value;if(!a)return;const s=a.querySelectorAll(".ticker-item");if(!s.length)return;const e=Math.floor(s.length/2);let l=0;for(let u=0;u<e;u++){const i=s[u];l+=i.offsetWidth,u<e-1&&(l+=42)}p.value=l,P.value=l*2,w.value<-p.value&&(w.value=(w.value%p.value+p.value)%p.value*-1)}function le(a){N||(N=a);const s=(a-N)/1e3;N=a,!z.value&&P.value&&(w.value-=ve.value*s,p.value&&w.value<=-p.value&&(w.value+=p.value)),D=requestAnimationFrame(le)}ue(()=>{requestAnimationFrame(()=>{V(),D=requestAnimationFrame(le)}),window.addEventListener("resize",V)}),Q(()=>{D&&cancelAnimationFrame(D)}),Q(()=>{window.removeEventListener("resize",V)});const x=d([]),g=d({availability:0,performance:0,quality:1,oee:0}),K=d([]),E=d([]),W=d([]),k=d(!0),G=d(!1),A=d(!1),$=d(null),L=d(!1),H=d(!1),U=d(0),M=d(C),me=d(null),fe=q(()=>k.value&&!$.value),h=a=>isFinite(a)?`${Math.round(a*100)}%`:"-",ie=a=>{const s=a*100;return s<50?"oee-red":s<70?"oee-yellow":s<85?"oee-orange":"oee-green"},ye=a=>`${Math.min(100,a)}%`,pe=()=>Math.max(1,...E.value.map(a=>a.work+a.stop)),ne=a=>`${Math.round(a/pe()*100)}%`,he=()=>Math.max(1,...W.value.map(a=>a.count)),_e=a=>`${Math.round(a/he()*100)}%`;function R(a){const s=Math.max(0,Math.min(100,Number(a.workRatio)||0)),e=Math.max(0,Math.min(100,Number(a.stopRatio)||0)),l=s+e;if(l>100){const i=100/l,O=Math.round(s*i*100)/100,J=Math.round(e*i*100)/100;return{work:O,stop:J,remain:0}}const u=Math.max(0,100-l);return{work:Math.round(s*100)/100,stop:Math.round(e*100)/100,remain:Math.round(u*100)/100}}const be={calisma:"#189c49",running:"#189c49",work:"#189c49",durus:"#efb803",stopped:"#efb803",stop:"#efb803",ayar:"#a59ef7",mola:"#f4b73f",kalan:"lightgray",offline:"#9e9e9e"};function Y(a){const s={running:"calisma",work:"calisma",stopped:"durus",stop:"durus",setup:"ayar",break:"mola",idle:"kalan"},e=(a||"").toLowerCase();return s[e]||e}function we(a){return a.reduce((s,e)=>s+(Number(e.duration)||0),0)||0}function ge(a,s=20){return a.length>s?a.slice(0,s)+"…":a}function Se(a,s){const e=Math.max(1,we(s)),l=Math.max(0,(Number(a.duration)||0)/e*100),u=be[Y(String(a.type))]||"#888";return{inlineSize:`${l}%`,backgroundColor:u,borderRadius:"999px"}}function Me(a,s){const e=Y(String(a.type));return e==="calisma"?s.itemName||s.itemCode||"Çalışıyor":e==="durus"?a.reason||a.sebep||a.code||"Duruyor":{calisma:"Çalışma",durus:"Duruş",ayar:"Ayar",mola:"Mola",kalan:"Kalan",offline:"Kapalı"}[e]||String(a.type)}let S=null;const _=d(null);async function Te(a){var s;try{x.value.length===0?k.value=!0:A.value=!0,S&&(clearTimeout(S),S=null),S=window.setTimeout(()=>{G.value=!0},2500),_.value=null;const{data:l}=await Ee.get("/api/dash-bukum/overview",{signal:a,timeout:1e4}),u=((l==null?void 0:l.machines)||[]).map(i=>({id:Number(i.id),name:String(i.name??""),operator:i.operator||void 0,breakDescription:i.break_description??i.breakDescription??i.break_desc??void 0,statuTime:i.statu_time??i.statuTime??void 0,itemCode:i.itemCode??i.item_code??void 0,itemName:i.itemName??i.item_name??void 0,counter:i.counter!==void 0&&i.counter!==null?Number(i.counter):void 0,status:i.status??"offline",availability:Number(i.availability)||0,performance:Number(i.performance)||0,quality:Number(i.quality)||1,oee:Number(i.oee)||0,workRatio:Number(i.workRatio)||0,stopRatio:Number(i.stopRatio)||0,code:i.code||"",segments:Array.isArray(i.segments)?i.segments:Array.isArray(i.barData)?i.barData:Array.isArray(i.timeline)?i.timeline:void 0}));me.value=(l==null?void 0:l.meta)||null,u.length===0?x.value.length===0?L.value=!0:H.value=!0:(x.value=u,L.value=!1,H.value=!1),g.value=(l==null?void 0:l.daySummary)||g.value,K.value=(l==null?void 0:l.reasons)||K.value,E.value=(l==null?void 0:l.weekly)||E.value,W.value=((l==null?void 0:l.weeklyCounts)||(l==null?void 0:l.weekly_counts)||[]).map(i=>({date:String(i.date),label:String(i.label??""),count:Number(i.count??0)})),$.value=new Date,U.value=0,M.value=C}catch(e){U.value+=1,M.value=Math.min(C*Math.pow(2,U.value),6e4);const l=(s=e==null?void 0:e.response)==null?void 0:s.status;l===401?_.value="Yetki hatası (401).":l===404?_.value="Endpoint bulunamadı (404).":l===500?_.value="Sunucu hatası (500).":(e==null?void 0:e.code)==="ECONNABORTED"?_.value="Zaman aşımı.":(e==null?void 0:e.name)==="CanceledError"||(e==null?void 0:e.message)==="canceled"||(_.value="Beklenmeyen hata.")}finally{k.value=!1,A.value=!1,S&&(clearTimeout(S),S=null),G.value&&setTimeout(()=>{G.value=!1},400)}}const Ce=C;let m=null,B=!1,b=null;function T(a=M.value){m&&clearTimeout(m),m=window.setTimeout(oe,a)}async function oe(){if(document.hidden){T(Math.max(3e4,M.value));return}if(B){T(500);return}B=!0,b&&b.abort(),b=new AbortController;try{await Te(b.signal)}finally{B=!1,T(Ce)}}function re(){document.hidden?(b&&b.abort(),m&&(clearTimeout(m),m=null)):T(0)}function X(){B||(m&&(clearTimeout(m),m=null),T(0))}function ze(a){return a?a.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}const de=d(Date.now());let j=null;function De(a){if(a==null)return null;if(typeof a=="number")return a>1e12||a>1e10?a:Math.round(a*1e3);const e=(a instanceof Date?a:new Date(String(a))).getTime();return Number.isFinite(e)?e:null}function Ne(a){const s=De(a);if(!s)return"-";let e=Math.max(0,Math.floor((de.value-s)/1e3));const l=Math.floor(e/3600);e%=3600;const u=Math.floor(e/60),i=e%60,O=J=>String(J).padStart(2,"0");return l>0?`${l}h ${O(u)}m`:u>0?`${u}m ${O(i)}s`:`${i}s`}function Z(a){var e;if(a.breakDescription)return String(a.breakDescription);const s=Array.isArray(a.segments)?a.segments:[];for(let l=s.length-1;l>=0;l--)if(Y(String((e=s[l])==null?void 0:e.type))==="durus"){const i=s[l].reason||s[l].sebep||s[l].code;if(i)return String(i)}}return ue(async()=>{document.addEventListener("visibilitychange",re),await oe(),j=window.setInterval(()=>{de.value=Date.now()},1e3)}),Q(()=>{document.removeEventListener("visibilitychange",re),b&&b.abort(),m&&clearTimeout(m),j&&clearInterval(j)}),(a,s)=>(o(),n("div",Le,[fe.value?(o(),n("div",Re,s[2]||(s[2]=[t("div",{class:"loader-box"},[t("div",{class:"spinner","aria-hidden":"true"}),t("h2",null,"Veriler yükleniyor"),t("p",null,"Makine durumları, OEE ve haftalık istatistikler getiriliyor. Lütfen bekleyin…")],-1)]))):c("",!0),t("header",Be,[t("div",Oe,[s[8]||(s[8]=t("div",{class:"title-block ms-4"},[t("h1",null,"Büküm Dashboard")],-1)),t("div",qe,[s[7]||(s[7]=t("div",{class:"summary-title"},"Günlük Genel Değerlendirme",-1)),t("div",Fe,[t("div",Ie,[s[3]||(s[3]=t("span",null,"Uyg.",-1)),t("strong",null,r(h(g.value.availability)),1)]),t("div",Pe,[s[4]||(s[4]=t("span",null,"Perf.",-1)),t("strong",null,r(h(g.value.performance)),1)]),t("div",Ve,[s[5]||(s[5]=t("span",null,"Kalite",-1)),t("strong",null,r(h(g.value.quality)),1)]),t("div",{class:F(["kpi oee",ie(g.value.oee)])},[s[6]||(s[6]=t("span",null,"OEE",-1)),t("strong",null,r(h(g.value.oee)),1)],2)]),t("div",Ke,[t("button",{class:"refresh-btn",onClick:X,disabled:A.value||k.value},[A.value?(o(),n("span",Ge,"⟳ Yenileniyor...")):(o(),n("span",He,"⟳ Yenile"))],8,We),$.value?(o(),n("small",Ue,"Güncellendi: "+r(ze($.value)),1)):c("",!0),H.value?(o(),n("small",Ye,"Geçici boş yanıt")):L.value&&!k.value?(o(),n("small",Xe,"Veri yok")):c("",!0),M.value>C&&!k.value?(o(),n("small",je,"Bekleme: "+r(Math.round(M.value/1e3))+"sn",1)):c("",!0)])])]),t("div",Ze,[t("div",Je,[s[10]||(s[10]=t("h4",null,"Haftalık Çalışma / Duruş (dk)",-1)),t("div",Qe,[t("div",et,[k.value?(o(),n(f,{key:0},y(7,e=>t("div",{key:"wv-skel-"+e,class:"wv-col"},[t("div",tt,[t("div",{class:"wv-fill sk-fill",style:v({blockSize:20+e*6+"%"})},null,4)]),s[9]||(s[9]=t("div",{class:"wv-day"}," ",-1))])),64)):(o(!0),n(f,{key:1},y(E.value,e=>(o(),n("div",{key:e.date,class:"wv-col"},[t("div",{class:"wv-stack",title:e.work+" dk çalışma / "+e.stop+" dk duruş"},[t("div",{class:"wv-seg work",style:v({blockSize:ne(e.work)}),title:"Çalışma"},[e.work>0?(o(),n("span",at,r(e.work),1)):c("",!0)],4),t("div",{class:"wv-seg stop",style:v({blockSize:ne(e.stop)}),title:"Duruş"},[e.stop>0?(o(),n("span",lt,r(e.stop),1)):c("",!0)],4)],8,st),t("div",it,r(e.label),1)]))),128))])])]),t("div",nt,[s[12]||(s[12]=t("h4",null,"Haftalık Sayaç (adet)",-1)),t("div",ot,[t("div",rt,[k.value?(o(),n(f,{key:0},y(7,e=>t("div",{key:"wvc-skel-"+e,class:"wvc-col"},[t("div",dt,[t("div",{class:"wvc-fill sk-fill",style:v({blockSize:20+e*4+"%"})},null,4)]),s[11]||(s[11]=t("div",{class:"wvc-day"}," ",-1))])),64)):(o(!0),n(f,{key:1},y(W.value,e=>(o(),n("div",{key:e.date,class:"wvc-col"},[t("div",{class:"wvc-stack",title:e.count+" adet"},[t("div",{class:"wvc-bar",style:v({blockSize:_e(e.count)}),title:"Adet"},[e.count>0?(o(),n("span",ct,r(e.count),1)):c("",!0)],4)],8,ut),t("div",vt,r(e.label),1)]))),128))])])])])]),t("section",kt,[k.value?(o(),n(f,{key:0},y(6,e=>t("article",{key:"skeleton-"+e,class:"machine-card skeleton"},s[13]||(s[13]=[Ae('<div class="card-top" data-v-d18f1a3d><div class="names" data-v-d18f1a3d><div class="sk-line w-60" data-v-d18f1a3d></div><div class="sk-line w-40 mt-1" data-v-d18f1a3d></div></div><div class="status" data-v-d18f1a3d><span class="dot" data-v-d18f1a3d></span><span class="sk-line w-20" data-v-d18f1a3d></span></div></div><div class="kpi-row" data-v-d18f1a3d><div class="kpi-item" data-v-d18f1a3d><div class="sk-line w-60" data-v-d18f1a3d></div><div class="sk-line w-40 mt-1" data-v-d18f1a3d></div></div><div class="kpi-item" data-v-d18f1a3d><div class="sk-line w-60" data-v-d18f1a3d></div><div class="sk-line w-40 mt-1" data-v-d18f1a3d></div></div><div class="kpi-item" data-v-d18f1a3d><div class="sk-line w-60" data-v-d18f1a3d></div><div class="sk-line w-40 mt-1" data-v-d18f1a3d></div></div><div class="kpi-item" data-v-d18f1a3d><div class="sk-line w-60" data-v-d18f1a3d></div><div class="sk-line w-40 mt-1" data-v-d18f1a3d></div></div></div><div class="mini-bars" data-v-d18f1a3d><div class="multi-bar" data-v-d18f1a3d><div class="multi-seg sk-fill" style="inline-size:65%;" data-v-d18f1a3d></div><div class="multi-seg sk-fill" style="inline-size:20%;" data-v-d18f1a3d></div><div class="multi-seg sk-fill" style="inline-size:15%;" data-v-d18f1a3d></div></div></div>',3)]))),64)):(o(!0),n(f,{key:1},y(x.value,e=>(o(),n("article",{key:e.id,class:"machine-card"},[t("div",mt,[t("div",ft,[t("h3",yt,[ee(r(e.code)+" - ",1),t("span",pt,r(ge(e.name,35)),1)]),t("p",ht,[s[14]||(s[14]=ee("Operatör: ")),e.operator?(o(),n("span",_t,r(e.operator),1)):c("",!0)])]),t("div",{class:F(["status",e.status])},[t("span",bt,r(Ne(e.statuTime)),1),s[15]||(s[15]=t("span",{class:"dot"},null,-1))],2)]),e.itemCode||e.itemName||e.counter!==void 0?(o(),n("div",wt,[t("div",gt,[e.itemCode?(o(),n("span",St,r(e.itemCode),1)):c("",!0),e.itemName?(o(),n("span",Mt,r(e.itemName),1)):c("",!0)]),e.counter!==void 0?(o(),n("div",Tt,[s[16]||(s[16]=ee("Sayaç: ")),t("strong",null,r(e.counter),1)])):c("",!0)])):c("",!0),t("div",Ct,[t("div",zt,[s[17]||(s[17]=t("span",null,"Uygulanabilirlik",-1)),t("strong",null,r(h(e.availability)),1)]),t("div",Dt,[s[18]||(s[18]=t("span",null,"Performans",-1)),t("strong",null,r(h(e.performance)),1)]),t("div",Nt,[s[19]||(s[19]=t("span",null,"Kalite",-1)),t("strong",null,r(h(e.quality)),1)]),t("div",{class:F(["kpi-item oee",ie(e.oee)])},[s[20]||(s[20]=t("span",null,"OEE",-1)),t("strong",null,r(h(e.oee)),1)],2)]),t("div",xt,[e.segments&&e.segments.length?(o(),n("div",Et,[(o(!0),n(f,null,y(e.segments,(l,u)=>(o(),n("div",{key:e.id+"-seg-"+u,class:"multi-seg",style:v(Se(l,e.segments)),title:Me(l,e)},null,12,At))),128))])):(o(),n("div",$t,[t("div",{class:"multi-seg work",style:v({inlineSize:R(e).work+"%"}),title:"Çalışma"},null,4),t("div",{class:"multi-seg stop",style:v({inlineSize:R(e).stop+"%"}),title:"Duruş"},null,4),R(e).remain>0?(o(),n("div",{key:0,class:"multi-seg remain",style:v({inlineSize:R(e).remain+"%"}),title:"Kalan"},null,4)):c("",!0)])),e.status==="stopped"&&Z(e)?(o(),n("div",Lt,[t("div",Rt,[s[21]||(s[21]=t("span",null,"Sebep: ",-1)),t("span",{class:"value reason",title:Z(e)},r(Z(e)),9,Bt)])])):c("",!0)])]))),128))]),t("section",Ot,[t("div",qt,[s[26]||(s[26]=t("h4",null,"Duruş Sebepleri (Süre)",-1)),_.value?(o(),n("div",Ft,[s[22]||(s[22]=t("strong",null,"Veri alınamadı:",-1)),t("span",It,r(_.value),1),t("button",{class:"retry-btn",onClick:X},"Tekrar Dene")])):L.value&&!k.value?(o(),n("div",Pt,[s[23]||(s[23]=t("span",null,"Henüz veri yok.",-1)),t("button",{class:"retry-btn subtle",onClick:X},"Yenile")])):c("",!0),k.value?(o(),n("div",Vt,[(o(),n(f,null,y(5,e=>t("div",{key:"rs-"+e,class:"reason-row"},[s[24]||(s[24]=t("div",{class:"row-label"},[t("div",{class:"sk-line w-40"})],-1)),t("div",Kt,[t("div",{class:"fill sk-fill",style:v({width:100-e*12+"%"})},null,4)]),s[25]||(s[25]=t("div",{class:"value"},[t("div",{class:"sk-line w-20 ml-auto"})],-1))])),64))])):(o(),n("div",Wt,[(o(!0),n(f,null,y(K.value,e=>(o(),n("div",{key:e.name,class:"reason-row"},[t("div",Gt,r(e.name),1),t("div",Ht,[t("div",{class:"fill reason",style:v({width:ye(e.minutes)})},null,4)]),t("div",Ut,r(e.minutes)+" dk",1)]))),128))]))]),t("div",Yt,[s[27]||(s[27]=t("h4",null,"Canlı Akış",-1)),t("div",{class:"ticker-shell",onMouseenter:s[0]||(s[0]=e=>z.value=!0),onMouseleave:s[1]||(s[1]=e=>z.value=!1)},[t("div",{class:"ticker-track",style:v(ke.value),ref_key:"tickerTrackEl",ref:ae},[(o(!0),n(f,null,y(ce.value,(e,l)=>(o(),n("span",{key:"tk-"+l,class:"ticker-item"},r(e),1))),128))],4)],32),z.value?c("",!0):(o(),n("small",Xt,"Üzerine gelince durur")),t("div",jt,[(o(),n(f,null,y(se,(e,l)=>t("button",{key:"sp-"+e,class:F(["speed-btn",{active:I.value===l}]),onClick:u=>I.value=l,title:e+" px/sn"},r(e),11,Zt)),64))])])])]))}}),ss=$e(Jt,[["__scopeId","data-v-d18f1a3d"]]);export{ss as default};
