import{d1 as X,d4 as se,dD as _e,d9 as xe,df as te,d6 as Ee,d3 as lt,dc as dt,dK as Oe,dW as li,dV as _t,e6 as Ie,e3 as Le,dN as dn,dk as di,dO as ci,da as cn,dZ as U,d2 as hi,dz as Et,a$ as Ge,dt as it,d$ as Ye,dn as hn,d as ye,db as un,r as Ne,i as pn,s as mn,c as _n,g as fn,b as $e,f as Ct,l as ke,o as Ut,x as gn}from"./main-BsBPzaN6.js";import{p as ui,a as Se}from"./index-DCLb7BvJ.js";import{z as In,j as ct,N as yn,s as w,e as de,o as be,g as ve,I as We,ai as Nt,a5 as wt,P as pi,ax as Cn,aw as mi,w as Re,au as we,b1 as _i,aE as fi,aq as Ue,C as rt,as as Lt,av as gi,U as St,az as Vt,q as ft,am as vn,ay as Kt,l as Wt,d as Ht,be as bn,bf as xn,aW as wn}from"./dom_component-BOMsNA7g.js";import{W as Ce,O as Sn}from"./overlay-CBORn4Ri.js";import{n as Dn}from"./notify-0JiCxtId.js";import{e as En,A as st,C as Mn}from"./m_resize_observer-D2tcFhH5.js";import{f as jt}from"./file_saver-D4H08IA6.js";import{c as pt,g as Fn}from"./_commonjsHelpers-D6-XlEtG.js";import{c as mt}from"./_commonjs-dynamic-modules-TDtrdbi3.js";import{C as Pn,aq as An,ar as kn,a0 as Tn,as as On,ag as Bn}from"./m_row_dragging-DnmdIjTe.js";import{B as He,d as gt,y as Ii,c as yi,N as Mt,l as zn,h as $n,n as Rn,P as Ci,T as Un}from"./m_select_box-B4A-KNOi.js";import{D as Nn}from"./row_dragging-BzqQhtt7.js";import{i as vi,e as Zt,d as bi,c as Gt}from"./themes-s_hOyPlB.js";import{P as xi}from"./m_progress_bar-D4doRZaV.js";import{E as Ln}from"./editor-658b01uO.js";import{S as Vn}from"./splitter_control-DHyKuva-.js";import{a as Kn}from"./popup-DqRFkKZM.js";import"./format_helper-BxObqpko.js";const Dt=function(N,e,t){e=e||Ee,t=t||Ee,Array.isArray(N)||(N=[N]);const i=N.map(((n,s)=>_e(n).then((o=>(xe(e)&&e({item:n,index:s,result:o}),o)),(o=>(o||(o={}),o.index=s,xe(t)&&t(o),new te().resolve().promise())))));return _e.apply(null,i)},wi=function(N){const e=["B","KB","MB","GB","TB"];let t=0,i=N;for(;i>=1024&&t<=e.length-1;)i/=1024,t++;return i=Math.round(10*i)/10,`${i} ${e[t]}`},je=function(N,e,t){return t.forEach((i=>{X(!0,N,se(e[i])?{[i]:e[i]}:{})})),N},Wn=(N,e)=>{const t={};e.forEach((n=>{t[n]=null})),N.forEach((n=>{const s=n.fileItem.key;Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=n)}));const i=[];return e.forEach((n=>{const s=t[n];s&&i.push(s)})),i},qt=function(N){const e=Object.keys(N),t=[];return e.forEach((i=>t.push(N[i]))),{keys:e,values:t}},Hn="/",Si=N=>{const e=N.lastIndexOf(".");return e!==-1?N.substr(e):""},Yt=N=>{const e=N.lastIndexOf("/");return e!==-1?N.substr(e+1):N},Di=(N,e)=>{if(!N||N==="/")return[];const t=[];let i="";for(let n=0;n<N.length;n++){let s=N.charAt(n);if(s==="/"){const o=N.charAt(n+1);o!=="/"&&(i&&(t.push(i),i=""),s=o),n++}i+=s}if(i&&t.push(i),e)for(let n=0;n<t.length;n++)t[n]=Be(n===0?"":t[n-1],Ft(t[n]));return t},Ft=function(N){return N.replace(/\/{1,1}/g,"//")},Be=function(){let N="";return lt(arguments,((e,t)=>{t&&(N&&(N+="/"),N+=t)})),N};class Xe{constructor(){(dt(arguments[0])?this._publicCtor:this._internalCtor).apply(this,arguments)}_internalCtor(e,t,i,n){this.name=t||"",this.pathInfo=e&&[...e]||[],this.parentPath=this._getPathByPathInfo(this.pathInfo),this.relativeName=Be(this.parentPath,t),this.key=n||this._getPathByPathInfo(this.getFullPathInfo(),!0),this.path=Be(this.parentPath,t),this.pathKeys=this.pathInfo.map((s=>{let{key:o}=s;return o})),this.isRoot()||this.pathKeys.push(this.key),this._initialize(i)}_publicCtor(e,t,i){this.path=e||"",this.pathKeys=i||[];const n=[],s=Di(e,!0);for(let o=0;o<s.length-1;o++){const r=s[o],d={key:this.pathKeys[o]||r,name:Yt(r)};n.push(d)}this.pathInfo=n,this.relativeName=e,this.name=Yt(e),this.key=this.pathKeys.length?this.pathKeys[this.pathKeys.length-1]:e,this.parentPath=s.length>1?s[s.length-2]:"",this._initialize(t)}_initialize(e){this.isDirectory=!!e,this.size=0,this.dateModified=new Date,this.thumbnail="",this.tooltipText=""}getFullPathInfo(){const e=[...this.pathInfo];return this.isRoot()||e.push({key:this.key,name:this.name}),e}isRoot(){return this.path===""}getFileExtension(){return this.isDirectory?"":Si(this.name)}equals(e){return e&&this.key===e.key}createClone(){const e=new Xe(this.pathInfo,this.name,this.isDirectory,this.key);return e.key=this.key,e.size=this.size,e.dateModified=this.dateModified,e.thumbnail=this.thumbnail,e.tooltipText=this.tooltipText,e.hasSubDirectories=this.hasSubDirectories,e.dataItem=this.dataItem,e}_getPathByPathInfo(e,t){return e.map((i=>t?Ft(i.name):i.name)).join(Hn)}}class It{constructor(e){e=Ie(e,{}),this._keyGetter=Oe(this._getKeyExpr(e)),this._nameGetter=Oe(this._getNameExpr(e)),this._isDirGetter=Oe(this._getIsDirExpr(e)),this._sizeGetter=Oe(this._getSizeExpr(e)),this._dateModifiedGetter=Oe(this._getDateModifiedExpr(e)),this._thumbnailGetter=Oe(e.thumbnailExpr||"thumbnail")}getItems(e){return[]}renameItem(e,t){}createDirectory(e,t){}deleteItems(e){}moveItems(e,t){}copyItems(e,t){}uploadFileChunk(e,t,i){}abortFileUpload(e,t,i){}downloadItems(e){}getItemsContent(e){}getFileUploadChunkSize(){return 2e5}_convertDataObjectsToFileItems(e,t){const i=[];return lt(e,((n,s)=>{const o=this._createFileItem(s,t);i.push(o)})),i}_createFileItem(e,t){const i=this._keyGetter(e),n=new Xe(t,this._nameGetter(e),!!this._isDirGetter(e),i);return n.size=this._sizeGetter(e),n.size===void 0&&(n.size=0),n.dateModified=In.deserializeDate(this._dateModifiedGetter(e)),n.dateModified===void 0&&(n.dateModified=new Date),n.isDirectory&&(n.hasSubDirectories=this._hasSubDirs(e)),i||(n.key=n.relativeName),n.thumbnail=this._thumbnailGetter(e)||"",n.dataItem=e,n}_hasSubDirs(e){return!0}_getKeyExpr(e){return e.keyExpr||this._defaultKeyExpr}_defaultKeyExpr(e){if(arguments.length===2){e.__KEY__=arguments[1];return}return Object.prototype.hasOwnProperty.call(e,"__KEY__")?e.__KEY__:null}_getNameExpr(e){return e.nameExpr||"name"}_getIsDirExpr(e){return e.isDirectoryExpr||"isDirectory"}_getSizeExpr(e){return e.sizeExpr||"size"}_getDateModifiedExpr(e){return e.dateModifiedExpr||"dateModified"}_executeActionAsDeferred(e,t){const i=new te;try{const n=e();li(n)?_t(n).done((s=>i.resolve(t&&s||void 0))).fail((s=>i.reject(s))):i.resolve(t&&n||void 0)}catch(n){return i.reject(n)}return i.promise()}}var vt={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var Xt;function jn(){return Xt||(Xt=1,(function(N,e){(function(t){N.exports=t()})(function(){return(function t(i,n,s){function o(g,v){if(!n[g]){if(!i[g]){var y=typeof mt=="function"&&mt;if(!v&&y)return y(g,!0);if(r)return r(g,!0);var C=new Error("Cannot find module '"+g+"'");throw C.code="MODULE_NOT_FOUND",C}var h=n[g]={exports:{}};i[g][0].call(h.exports,function(_){var c=i[g][1][_];return o(c||_)},h,h.exports,t,i,n,s)}return n[g].exports}for(var r=typeof mt=="function"&&mt,d=0;d<s.length;d++)o(s[d]);return o})({1:[function(t,i,n){var s=t("./utils"),o=t("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(d){for(var g,v,y,C,h,_,c,p=[],u=0,I=d.length,x=I,D=s.getTypeOf(d)!=="string";u<d.length;)x=I-u,y=D?(g=d[u++],v=u<I?d[u++]:0,u<I?d[u++]:0):(g=d.charCodeAt(u++),v=u<I?d.charCodeAt(u++):0,u<I?d.charCodeAt(u++):0),C=g>>2,h=(3&g)<<4|v>>4,_=1<x?(15&v)<<2|y>>6:64,c=2<x?63&y:64,p.push(r.charAt(C)+r.charAt(h)+r.charAt(_)+r.charAt(c));return p.join("")},n.decode=function(d){var g,v,y,C,h,_,c=0,p=0,u="data:";if(d.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var I,x=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===r.charAt(64)&&x--,d.charAt(d.length-2)===r.charAt(64)&&x--,x%1!=0)throw new Error("Invalid base64 input, bad content length.");for(I=o.uint8array?new Uint8Array(0|x):new Array(0|x);c<d.length;)g=r.indexOf(d.charAt(c++))<<2|(C=r.indexOf(d.charAt(c++)))>>4,v=(15&C)<<4|(h=r.indexOf(d.charAt(c++)))>>2,y=(3&h)<<6|(_=r.indexOf(d.charAt(c++))),I[p++]=g,h!==64&&(I[p++]=v),_!==64&&(I[p++]=y);return I}},{"./support":30,"./utils":32}],2:[function(t,i,n){var s=t("./external"),o=t("./stream/DataWorker"),r=t("./stream/Crc32Probe"),d=t("./stream/DataLengthProbe");function g(v,y,C,h,_){this.compressedSize=v,this.uncompressedSize=y,this.crc32=C,this.compression=h,this.compressedContent=_}g.prototype={getContentWorker:function(){var v=new o(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),y=this;return v.on("end",function(){if(this.streamInfo.data_length!==y.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new o(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},g.createWorkerFrom=function(v,y,C){return v.pipe(new r).pipe(new d("uncompressedSize")).pipe(y.compressWorker(C)).pipe(new d("compressedSize")).withStreamInfo("compression",y)},i.exports=g},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var s=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var s=t("./utils"),o=(function(){for(var r,d=[],g=0;g<256;g++){r=g;for(var v=0;v<8;v++)r=1&r?3988292384^r>>>1:r>>>1;d[g]=r}return d})();i.exports=function(r,d){return r!==void 0&&r.length?s.getTypeOf(r)!=="string"?(function(g,v,y,C){var h=o,_=C+y;g^=-1;for(var c=C;c<_;c++)g=g>>>8^h[255&(g^v[c])];return-1^g})(0|d,r,r.length,0):(function(g,v,y,C){var h=o,_=C+y;g^=-1;for(var c=C;c<_;c++)g=g>>>8^h[255&(g^v.charCodeAt(c))];return-1^g})(0|d,r,r.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var s=null;s=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:s}},{lie:37}],7:[function(t,i,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),r=t("./utils"),d=t("./stream/GenericWorker"),g=s?"uint8array":"array";function v(y,C){d.call(this,"FlateWorker/"+y),this._pako=null,this._pakoAction=y,this._pakoOptions=C,this.meta={}}n.magic="\b\0",r.inherits(v,d),v.prototype.processChunk=function(y){this.meta=y.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(g,y.data),!1)},v.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var y=this;this._pako.onData=function(C){y.push({data:C,meta:y.meta})}},n.compressWorker=function(y){return new v("Deflate",y)},n.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function s(h,_){var c,p="";for(c=0;c<_;c++)p+=String.fromCharCode(255&h),h>>>=8;return p}function o(h,_,c,p,u,I){var x,D,E=h.file,z=h.compression,T=I!==g.utf8encode,V=r.transformTo("string",I(E.name)),k=r.transformTo("string",g.utf8encode(E.name)),j=E.comment,ee=r.transformTo("string",I(j)),b=r.transformTo("string",g.utf8encode(j)),O=k.length!==E.name.length,l=b.length!==j.length,$="",ne="",K="",oe=E.dir,W=E.date,ie={crc32:0,compressedSize:0,uncompressedSize:0};_&&!c||(ie.crc32=h.crc32,ie.compressedSize=h.compressedSize,ie.uncompressedSize=h.uncompressedSize);var P=0;_&&(P|=8),T||!O&&!l||(P|=2048);var F=0,Q=0;oe&&(F|=16),u==="UNIX"?(Q=798,F|=(function(G,he){var fe=G;return G||(fe=he?16893:33204),(65535&fe)<<16})(E.unixPermissions,oe)):(Q=20,F|=(function(G){return 63&(G||0)})(E.dosPermissions)),x=W.getUTCHours(),x<<=6,x|=W.getUTCMinutes(),x<<=5,x|=W.getUTCSeconds()/2,D=W.getUTCFullYear()-1980,D<<=4,D|=W.getUTCMonth()+1,D<<=5,D|=W.getUTCDate(),O&&(ne=s(1,1)+s(v(V),4)+k,$+="up"+s(ne.length,2)+ne),l&&(K=s(1,1)+s(v(ee),4)+b,$+="uc"+s(K.length,2)+K);var q="";return q+=`
\0`,q+=s(P,2),q+=z.magic,q+=s(x,2),q+=s(D,2),q+=s(ie.crc32,4),q+=s(ie.compressedSize,4),q+=s(ie.uncompressedSize,4),q+=s(V.length,2),q+=s($.length,2),{fileRecord:y.LOCAL_FILE_HEADER+q+V+$,dirRecord:y.CENTRAL_FILE_HEADER+s(Q,2)+q+s(ee.length,2)+"\0\0\0\0"+s(F,4)+s(p,4)+V+$+ee}}var r=t("../utils"),d=t("../stream/GenericWorker"),g=t("../utf8"),v=t("../crc32"),y=t("../signature");function C(h,_,c,p){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=_,this.zipPlatform=c,this.encodeFileName=p,this.streamFiles=h,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(C,d),C.prototype.push=function(h){var _=h.meta.percent||0,c=this.entriesCount,p=this._sources.length;this.accumulate?this.contentBuffer.push(h):(this.bytesWritten+=h.data.length,d.prototype.push.call(this,{data:h.data,meta:{currentFile:this.currentFile,percent:c?(_+100*(c-p-1))/c:100}}))},C.prototype.openedSource=function(h){this.currentSourceOffset=this.bytesWritten,this.currentFile=h.file.name;var _=this.streamFiles&&!h.file.dir;if(_){var c=o(h,_,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:c.fileRecord,meta:{percent:0}})}else this.accumulate=!0},C.prototype.closedSource=function(h){this.accumulate=!1;var _=this.streamFiles&&!h.file.dir,c=o(h,_,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(c.dirRecord),_)this.push({data:(function(p){return y.DATA_DESCRIPTOR+s(p.crc32,4)+s(p.compressedSize,4)+s(p.uncompressedSize,4)})(h),meta:{percent:100}});else for(this.push({data:c.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},C.prototype.flush=function(){for(var h=this.bytesWritten,_=0;_<this.dirRecords.length;_++)this.push({data:this.dirRecords[_],meta:{percent:100}});var c=this.bytesWritten-h,p=(function(u,I,x,D,E){var z=r.transformTo("string",E(D));return y.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(u,2)+s(u,2)+s(I,4)+s(x,4)+s(z.length,2)+z})(this.dirRecords.length,c,h,this.zipComment,this.encodeFileName);this.push({data:p,meta:{percent:100}})},C.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},C.prototype.registerPrevious=function(h){this._sources.push(h);var _=this;return h.on("data",function(c){_.processChunk(c)}),h.on("end",function(){_.closedSource(_.previous.streamInfo),_._sources.length?_.prepareNextSource():_.end()}),h.on("error",function(c){_.error(c)}),this},C.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},C.prototype.error=function(h){var _=this._sources;if(!d.prototype.error.call(this,h))return!1;for(var c=0;c<_.length;c++)try{_[c].error(h)}catch{}return!0},C.prototype.lock=function(){d.prototype.lock.call(this);for(var h=this._sources,_=0;_<h.length;_++)h[_].lock()},i.exports=C},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var s=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(r,d,g){var v=new o(d.streamFiles,g,d.platform,d.encodeFileName),y=0;try{r.forEach(function(C,h){y++;var _=(function(I,x){var D=I||x,E=s[D];if(!E)throw new Error(D+" is not a valid compression method !");return E})(h.options.compression,d.compression),c=h.options.compressionOptions||d.compressionOptions||{},p=h.dir,u=h.date;h._compressWorker(_,c).withStreamInfo("file",{name:C,dir:p,date:u,comment:h.comment||"",unixPermissions:h.unixPermissions,dosPermissions:h.dosPermissions}).pipe(v)}),v.entriesCount=y}catch(C){v.error(C)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new s;for(var r in this)typeof this[r]!="function"&&(o[r]=this[r]);return o}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(o,r){return new s().loadAsync(o,r)},s.external=t("./external"),i.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var s=t("./utils"),o=t("./external"),r=t("./utf8"),d=t("./zipEntries"),g=t("./stream/Crc32Probe"),v=t("./nodejsUtils");function y(C){return new o.Promise(function(h,_){var c=C.decompressed.getContentWorker().pipe(new g);c.on("error",function(p){_(p)}).on("end",function(){c.streamInfo.crc32!==C.decompressed.crc32?_(new Error("Corrupted zip : CRC32 mismatch")):h()}).resume()})}i.exports=function(C,h){var _=this;return h=s.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),v.isNode&&v.isStream(C)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",C,!0,h.optimizedBinaryString,h.base64).then(function(c){var p=new d(h);return p.load(c),p}).then(function(c){var p=[o.Promise.resolve(c)],u=c.files;if(h.checkCRC32)for(var I=0;I<u.length;I++)p.push(y(u[I]));return o.Promise.all(p)}).then(function(c){for(var p=c.shift(),u=p.files,I=0;I<u.length;I++){var x=u[I],D=x.fileNameStr,E=s.resolve(x.fileNameStr);_.file(E,x.decompressed,{binary:!0,optimizedBinaryString:!0,date:x.date,dir:x.dir,comment:x.fileCommentStr.length?x.fileCommentStr:null,unixPermissions:x.unixPermissions,dosPermissions:x.dosPermissions,createFolders:h.createFolders}),x.dir||(_.file(E).unsafeOriginalName=D)}return p.zipComment.length&&(_.comment=p.zipComment),_})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var s=t("../utils"),o=t("../stream/GenericWorker");function r(d,g){o.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(g)}s.inherits(r,o),r.prototype._bindStream=function(d){var g=this;(this._stream=d).pause(),d.on("data",function(v){g.push({data:v,meta:{percent:0}})}).on("error",function(v){g.isPaused?this.generatedError=v:g.error(v)}).on("end",function(){g.isPaused?g._upstreamEnded=!0:g.end()})},r.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var s=t("readable-stream").Readable;function o(r,d,g){s.call(this,d),this._helper=r;var v=this;r.on("data",function(y,C){v.push(y)||v._helper.pause(),g&&g(C)}).on("error",function(y){v.emit("error",y)}).on("end",function(){v.push(null)})}t("../utils").inherits(o,s),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(s,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(s,o);if(typeof s=="number")throw new Error('The "data" argument must not be a number');return new Buffer(s,o)},allocBuffer:function(s){if(Buffer.alloc)return Buffer.alloc(s);var o=new Buffer(s);return o.fill(0),o},isBuffer:function(s){return Buffer.isBuffer(s)},isStream:function(s){return s&&typeof s.on=="function"&&typeof s.pause=="function"&&typeof s.resume=="function"}}},{}],15:[function(t,i,n){function s(E,z,T){var V,k=r.getTypeOf(z),j=r.extend(T||{},v);j.date=j.date||new Date,j.compression!==null&&(j.compression=j.compression.toUpperCase()),typeof j.unixPermissions=="string"&&(j.unixPermissions=parseInt(j.unixPermissions,8)),j.unixPermissions&&16384&j.unixPermissions&&(j.dir=!0),j.dosPermissions&&16&j.dosPermissions&&(j.dir=!0),j.dir&&(E=u(E)),j.createFolders&&(V=p(E))&&I.call(this,V,!0);var ee=k==="string"&&j.binary===!1&&j.base64===!1;T&&T.binary!==void 0||(j.binary=!ee),(z instanceof y&&z.uncompressedSize===0||j.dir||!z||z.length===0)&&(j.base64=!1,j.binary=!0,z="",j.compression="STORE",k="string");var b=null;b=z instanceof y||z instanceof d?z:_.isNode&&_.isStream(z)?new c(E,z):r.prepareContent(E,z,j.binary,j.optimizedBinaryString,j.base64);var O=new C(E,b,j);this.files[E]=O}var o=t("./utf8"),r=t("./utils"),d=t("./stream/GenericWorker"),g=t("./stream/StreamHelper"),v=t("./defaults"),y=t("./compressedObject"),C=t("./zipObject"),h=t("./generate"),_=t("./nodejsUtils"),c=t("./nodejs/NodejsStreamInputAdapter"),p=function(E){E.slice(-1)==="/"&&(E=E.substring(0,E.length-1));var z=E.lastIndexOf("/");return 0<z?E.substring(0,z):""},u=function(E){return E.slice(-1)!=="/"&&(E+="/"),E},I=function(E,z){return z=z!==void 0?z:v.createFolders,E=u(E),this.files[E]||s.call(this,E,null,{dir:!0,createFolders:z}),this.files[E]};function x(E){return Object.prototype.toString.call(E)==="[object RegExp]"}var D={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(E){var z,T,V;for(z in this.files)V=this.files[z],(T=z.slice(this.root.length,z.length))&&z.slice(0,this.root.length)===this.root&&E(T,V)},filter:function(E){var z=[];return this.forEach(function(T,V){E(T,V)&&z.push(V)}),z},file:function(E,z,T){if(arguments.length!==1)return E=this.root+E,s.call(this,E,z,T),this;if(x(E)){var V=E;return this.filter(function(j,ee){return!ee.dir&&V.test(j)})}var k=this.files[this.root+E];return k&&!k.dir?k:null},folder:function(E){if(!E)return this;if(x(E))return this.filter(function(k,j){return j.dir&&E.test(k)});var z=this.root+E,T=I.call(this,z),V=this.clone();return V.root=T.name,V},remove:function(E){E=this.root+E;var z=this.files[E];if(z||(E.slice(-1)!=="/"&&(E+="/"),z=this.files[E]),z&&!z.dir)delete this.files[E];else for(var T=this.filter(function(k,j){return j.name.slice(0,E.length)===E}),V=0;V<T.length;V++)delete this.files[T[V].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(E){var z,T={};try{if((T=r.extend(E||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=T.type.toLowerCase(),T.compression=T.compression.toUpperCase(),T.type==="binarystring"&&(T.type="string"),!T.type)throw new Error("No output type specified.");r.checkSupport(T.type),T.platform!=="darwin"&&T.platform!=="freebsd"&&T.platform!=="linux"&&T.platform!=="sunos"||(T.platform="UNIX"),T.platform==="win32"&&(T.platform="DOS");var V=T.comment||this.comment||"";z=h.generateWorker(this,T,V)}catch(k){(z=new d("error")).error(k)}return new g(z,T.type||"string",T.mimeType)},generateAsync:function(E,z){return this.generateInternalStream(E).accumulate(z)},generateNodeStream:function(E,z){return(E=E||{}).type||(E.type="nodebuffer"),this.generateInternalStream(E).toNodejsStream(z)}};i.exports=D},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var s=t("./DataReader");function o(r){s.call(this,r);for(var d=0;d<this.data.length;d++)r[d]=255&r[d]}t("../utils").inherits(o,s),o.prototype.byteAt=function(r){return this.data[this.zero+r]},o.prototype.lastIndexOfSignature=function(r){for(var d=r.charCodeAt(0),g=r.charCodeAt(1),v=r.charCodeAt(2),y=r.charCodeAt(3),C=this.length-4;0<=C;--C)if(this.data[C]===d&&this.data[C+1]===g&&this.data[C+2]===v&&this.data[C+3]===y)return C-this.zero;return-1},o.prototype.readAndCheckSignature=function(r){var d=r.charCodeAt(0),g=r.charCodeAt(1),v=r.charCodeAt(2),y=r.charCodeAt(3),C=this.readData(4);return d===C[0]&&g===C[1]&&v===C[2]&&y===C[3]},o.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var s=t("../utils");function o(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var d,g=0;for(this.checkOffset(r),d=this.index+r-1;d>=this.index;d--)g=(g<<8)+this.byteAt(d);return this.index+=r,g},readString:function(r){return s.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},i.exports=o},{"../utils":32}],19:[function(t,i,n){var s=t("./Uint8ArrayReader");function o(r){s.call(this,r)}t("../utils").inherits(o,s),o.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var s=t("./DataReader");function o(r){s.call(this,r)}t("../utils").inherits(o,s),o.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},o.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},o.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},o.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var s=t("./ArrayReader");function o(r){s.call(this,r)}t("../utils").inherits(o,s),o.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var s=t("../utils"),o=t("../support"),r=t("./ArrayReader"),d=t("./StringReader"),g=t("./NodeBufferReader"),v=t("./Uint8ArrayReader");i.exports=function(y){var C=s.getTypeOf(y);return s.checkSupport(C),C!=="string"||o.uint8array?C==="nodebuffer"?new g(y):o.uint8array?new v(s.transformTo("uint8array",y)):new r(s.transformTo("array",y)):new d(y)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var s=t("./GenericWorker"),o=t("../utils");function r(d){s.call(this,"ConvertWorker to "+d),this.destType=d}o.inherits(r,s),r.prototype.processChunk=function(d){this.push({data:o.transformTo(this.destType,d.data),meta:d.meta})},i.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var s=t("./GenericWorker"),o=t("../crc32");function r(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(r,s),r.prototype.processChunk=function(d){this.streamInfo.crc32=o(d.data,this.streamInfo.crc32||0),this.push(d)},i.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var s=t("../utils"),o=t("./GenericWorker");function r(d){o.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}s.inherits(r,o),r.prototype.processChunk=function(d){if(d){var g=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=g+d.data.length}o.prototype.processChunk.call(this,d)},i.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var s=t("../utils"),o=t("./GenericWorker");function r(d){o.call(this,"DataWorker");var g=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(v){g.dataIsReady=!0,g.data=v,g.max=v&&v.length||0,g.type=s.getTypeOf(v),g.isPaused||g._tickAndRepeat()},function(v){g.error(v)})}s.inherits(r,o),r.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,g=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,g);break;case"uint8array":d=this.data.subarray(this.index,g);break;case"array":case"nodebuffer":d=this.data.slice(this.index,g)}return this.index=g,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function s(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,r){return this._listeners[o].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,r){if(this._listeners[o])for(var d=0;d<this._listeners[o].length;d++)this._listeners[o][d].call(this,r)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var r=this;return o.on("data",function(d){r.processChunk(d)}),o.on("end",function(){r.end()}),o.on("error",function(d){r.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,r){return this.extraStreamInfo[o]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=s},{}],29:[function(t,i,n){var s=t("../utils"),o=t("./ConvertWorker"),r=t("./GenericWorker"),d=t("../base64"),g=t("../support"),v=t("../external"),y=null;if(g.nodestream)try{y=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function C(_,c){return new v.Promise(function(p,u){var I=[],x=_._internalType,D=_._outputType,E=_._mimeType;_.on("data",function(z,T){I.push(z),c&&c(T)}).on("error",function(z){I=[],u(z)}).on("end",function(){try{var z=(function(T,V,k){switch(T){case"blob":return s.newBlob(s.transformTo("arraybuffer",V),k);case"base64":return d.encode(V);default:return s.transformTo(T,V)}})(D,(function(T,V){var k,j=0,ee=null,b=0;for(k=0;k<V.length;k++)b+=V[k].length;switch(T){case"string":return V.join("");case"array":return Array.prototype.concat.apply([],V);case"uint8array":for(ee=new Uint8Array(b),k=0;k<V.length;k++)ee.set(V[k],j),j+=V[k].length;return ee;case"nodebuffer":return Buffer.concat(V);default:throw new Error("concat : unsupported type '"+T+"'")}})(x,I),E);p(z)}catch(T){u(T)}I=[]}).resume()})}function h(_,c,p){var u=c;switch(c){case"blob":case"arraybuffer":u="uint8array";break;case"base64":u="string"}try{this._internalType=u,this._outputType=c,this._mimeType=p,s.checkSupport(u),this._worker=_.pipe(new o(u)),_.lock()}catch(I){this._worker=new r("error"),this._worker.error(I)}}h.prototype={accumulate:function(_){return C(this,_)},on:function(_,c){var p=this;return _==="data"?this._worker.on(_,function(u){c.call(p,u.data,u.meta)}):this._worker.on(_,function(){s.delay(c,arguments,p)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(_){if(s.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new y(this,{objectMode:this._outputType!=="nodebuffer"},_)}},i.exports=h},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var s=new ArrayBuffer(0);try{n.blob=new Blob([s],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(s),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var s=t("./utils"),o=t("./support"),r=t("./nodejsUtils"),d=t("./stream/GenericWorker"),g=new Array(256),v=0;v<256;v++)g[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;g[254]=g[254]=1;function y(){d.call(this,"utf-8 decode"),this.leftOver=null}function C(){d.call(this,"utf-8 encode")}n.utf8encode=function(h){return o.nodebuffer?r.newBufferFrom(h,"utf-8"):(function(_){var c,p,u,I,x,D=_.length,E=0;for(I=0;I<D;I++)(64512&(p=_.charCodeAt(I)))==55296&&I+1<D&&(64512&(u=_.charCodeAt(I+1)))==56320&&(p=65536+(p-55296<<10)+(u-56320),I++),E+=p<128?1:p<2048?2:p<65536?3:4;for(c=o.uint8array?new Uint8Array(E):new Array(E),I=x=0;x<E;I++)(64512&(p=_.charCodeAt(I)))==55296&&I+1<D&&(64512&(u=_.charCodeAt(I+1)))==56320&&(p=65536+(p-55296<<10)+(u-56320),I++),p<128?c[x++]=p:(p<2048?c[x++]=192|p>>>6:(p<65536?c[x++]=224|p>>>12:(c[x++]=240|p>>>18,c[x++]=128|p>>>12&63),c[x++]=128|p>>>6&63),c[x++]=128|63&p);return c})(h)},n.utf8decode=function(h){return o.nodebuffer?s.transformTo("nodebuffer",h).toString("utf-8"):(function(_){var c,p,u,I,x=_.length,D=new Array(2*x);for(c=p=0;c<x;)if((u=_[c++])<128)D[p++]=u;else if(4<(I=g[u]))D[p++]=65533,c+=I-1;else{for(u&=I===2?31:I===3?15:7;1<I&&c<x;)u=u<<6|63&_[c++],I--;1<I?D[p++]=65533:u<65536?D[p++]=u:(u-=65536,D[p++]=55296|u>>10&1023,D[p++]=56320|1023&u)}return D.length!==p&&(D.subarray?D=D.subarray(0,p):D.length=p),s.applyFromCharCode(D)})(h=s.transformTo(o.uint8array?"uint8array":"array",h))},s.inherits(y,d),y.prototype.processChunk=function(h){var _=s.transformTo(o.uint8array?"uint8array":"array",h.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var c=_;(_=new Uint8Array(c.length+this.leftOver.length)).set(this.leftOver,0),_.set(c,this.leftOver.length)}else _=this.leftOver.concat(_);this.leftOver=null}var p=(function(I,x){var D;for((x=x||I.length)>I.length&&(x=I.length),D=x-1;0<=D&&(192&I[D])==128;)D--;return D<0||D===0?x:D+g[I[D]]>x?D:x})(_),u=_;p!==_.length&&(o.uint8array?(u=_.subarray(0,p),this.leftOver=_.subarray(p,_.length)):(u=_.slice(0,p),this.leftOver=_.slice(p,_.length))),this.push({data:n.utf8decode(u),meta:h.meta})},y.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=y,s.inherits(C,d),C.prototype.processChunk=function(h){this.push({data:n.utf8encode(h.data),meta:h.meta})},n.Utf8EncodeWorker=C},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var s=t("./support"),o=t("./base64"),r=t("./nodejsUtils"),d=t("./external");function g(c){return c}function v(c,p){for(var u=0;u<c.length;++u)p[u]=255&c.charCodeAt(u);return p}t("setimmediate"),n.newBlob=function(c,p){n.checkSupport("blob");try{return new Blob([c],{type:p})}catch{try{var u=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return u.append(c),u.getBlob(p)}catch{throw new Error("Bug : can't construct the Blob.")}}};var y={stringifyByChunk:function(c,p,u){var I=[],x=0,D=c.length;if(D<=u)return String.fromCharCode.apply(null,c);for(;x<D;)p==="array"||p==="nodebuffer"?I.push(String.fromCharCode.apply(null,c.slice(x,Math.min(x+u,D)))):I.push(String.fromCharCode.apply(null,c.subarray(x,Math.min(x+u,D)))),x+=u;return I.join("")},stringifyByChar:function(c){for(var p="",u=0;u<c.length;u++)p+=String.fromCharCode(c[u]);return p},applyCanBeUsed:{uint8array:(function(){try{return s.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return s.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function C(c){var p=65536,u=n.getTypeOf(c),I=!0;if(u==="uint8array"?I=y.applyCanBeUsed.uint8array:u==="nodebuffer"&&(I=y.applyCanBeUsed.nodebuffer),I)for(;1<p;)try{return y.stringifyByChunk(c,u,p)}catch{p=Math.floor(p/2)}return y.stringifyByChar(c)}function h(c,p){for(var u=0;u<c.length;u++)p[u]=c[u];return p}n.applyFromCharCode=C;var _={};_.string={string:g,array:function(c){return v(c,new Array(c.length))},arraybuffer:function(c){return _.string.uint8array(c).buffer},uint8array:function(c){return v(c,new Uint8Array(c.length))},nodebuffer:function(c){return v(c,r.allocBuffer(c.length))}},_.array={string:C,array:g,arraybuffer:function(c){return new Uint8Array(c).buffer},uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return r.newBufferFrom(c)}},_.arraybuffer={string:function(c){return C(new Uint8Array(c))},array:function(c){return h(new Uint8Array(c),new Array(c.byteLength))},arraybuffer:g,uint8array:function(c){return new Uint8Array(c)},nodebuffer:function(c){return r.newBufferFrom(new Uint8Array(c))}},_.uint8array={string:C,array:function(c){return h(c,new Array(c.length))},arraybuffer:function(c){return c.buffer},uint8array:g,nodebuffer:function(c){return r.newBufferFrom(c)}},_.nodebuffer={string:C,array:function(c){return h(c,new Array(c.length))},arraybuffer:function(c){return _.nodebuffer.uint8array(c).buffer},uint8array:function(c){return h(c,new Uint8Array(c.length))},nodebuffer:g},n.transformTo=function(c,p){if(p=p||"",!c)return p;n.checkSupport(c);var u=n.getTypeOf(p);return _[u][c](p)},n.resolve=function(c){for(var p=c.split("/"),u=[],I=0;I<p.length;I++){var x=p[I];x==="."||x===""&&I!==0&&I!==p.length-1||(x===".."?u.pop():u.push(x))}return u.join("/")},n.getTypeOf=function(c){return typeof c=="string"?"string":Object.prototype.toString.call(c)==="[object Array]"?"array":s.nodebuffer&&r.isBuffer(c)?"nodebuffer":s.uint8array&&c instanceof Uint8Array?"uint8array":s.arraybuffer&&c instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(c){if(!s[c.toLowerCase()])throw new Error(c+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(c){var p,u,I="";for(u=0;u<(c||"").length;u++)I+="\\x"+((p=c.charCodeAt(u))<16?"0":"")+p.toString(16).toUpperCase();return I},n.delay=function(c,p,u){setImmediate(function(){c.apply(u||null,p||[])})},n.inherits=function(c,p){function u(){}u.prototype=p.prototype,c.prototype=new u},n.extend=function(){var c,p,u={};for(c=0;c<arguments.length;c++)for(p in arguments[c])Object.prototype.hasOwnProperty.call(arguments[c],p)&&u[p]===void 0&&(u[p]=arguments[c][p]);return u},n.prepareContent=function(c,p,u,I,x){return d.Promise.resolve(p).then(function(D){return s.blob&&(D instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(D))!==-1)&&typeof FileReader<"u"?new d.Promise(function(E,z){var T=new FileReader;T.onload=function(V){E(V.target.result)},T.onerror=function(V){z(V.target.error)},T.readAsArrayBuffer(D)}):D}).then(function(D){var E=n.getTypeOf(D);return E?(E==="arraybuffer"?D=n.transformTo("uint8array",D):E==="string"&&(x?D=o.decode(D):u&&I!==!0&&(D=(function(z){return v(z,s.uint8array?new Uint8Array(z.length):new Array(z.length))})(D))),D):d.Promise.reject(new Error("Can't read the data of '"+c+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var s=t("./reader/readerFor"),o=t("./utils"),r=t("./signature"),d=t("./zipEntry"),g=t("./support");function v(y){this.files=[],this.loadOptions=y}v.prototype={checkSignature:function(y){if(!this.reader.readAndCheckSignature(y)){this.reader.index-=4;var C=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(C)+", expected "+o.pretty(y)+")")}},isSignature:function(y,C){var h=this.reader.index;this.reader.setIndex(y);var _=this.reader.readString(4)===C;return this.reader.setIndex(h),_},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var y=this.reader.readData(this.zipCommentLength),C=g.uint8array?"uint8array":"array",h=o.transformTo(C,y);this.zipComment=this.loadOptions.decodeFileName(h)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var y,C,h,_=this.zip64EndOfCentralSize-44;0<_;)y=this.reader.readInt(2),C=this.reader.readInt(4),h=this.reader.readData(C),this.zip64ExtensibleData[y]={id:y,length:C,value:h}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var y,C;for(y=0;y<this.files.length;y++)C=this.files[y],this.reader.setIndex(C.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),C.readLocalPart(this.reader),C.handleUTF8(),C.processAttributes()},readCentralDir:function(){var y;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(y=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(y);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var y=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(y<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(y);var C=y;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(y=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(y),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var h=this.centralDirOffset+this.centralDirSize;this.zip64&&(h+=20,h+=12+this.zip64EndOfCentralSize);var _=C-h;if(0<_)this.isSignature(C,r.CENTRAL_FILE_HEADER)||(this.reader.zero=_);else if(_<0)throw new Error("Corrupted zip: missing "+Math.abs(_)+" bytes.")},prepareReader:function(y){this.reader=s(y)},load:function(y){this.prepareReader(y),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var s=t("./reader/readerFor"),o=t("./utils"),r=t("./compressedObject"),d=t("./crc32"),g=t("./utf8"),v=t("./compressions"),y=t("./support");function C(h,_){this.options=h,this.loadOptions=_}C.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(h){var _,c;if(h.skip(22),this.fileNameLength=h.readInt(2),c=h.readInt(2),this.fileName=h.readData(this.fileNameLength),h.skip(c),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((_=(function(p){for(var u in v)if(Object.prototype.hasOwnProperty.call(v,u)&&v[u].magic===p)return v[u];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,_,h.readData(this.compressedSize))},readCentralPart:function(h){this.versionMadeBy=h.readInt(2),h.skip(2),this.bitFlag=h.readInt(2),this.compressionMethod=h.readString(2),this.date=h.readDate(),this.crc32=h.readInt(4),this.compressedSize=h.readInt(4),this.uncompressedSize=h.readInt(4);var _=h.readInt(2);if(this.extraFieldsLength=h.readInt(2),this.fileCommentLength=h.readInt(2),this.diskNumberStart=h.readInt(2),this.internalFileAttributes=h.readInt(2),this.externalFileAttributes=h.readInt(4),this.localHeaderOffset=h.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");h.skip(_),this.readExtraFields(h),this.parseZIP64ExtraField(h),this.fileComment=h.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var h=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),h==0&&(this.dosPermissions=63&this.externalFileAttributes),h==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var h=s(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=h.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=h.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=h.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=h.readInt(4))}},readExtraFields:function(h){var _,c,p,u=h.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});h.index+4<u;)_=h.readInt(2),c=h.readInt(2),p=h.readData(c),this.extraFields[_]={id:_,length:c,value:p};h.setIndex(u)},handleUTF8:function(){var h=y.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=g.utf8decode(this.fileName),this.fileCommentStr=g.utf8decode(this.fileComment);else{var _=this.findExtraFieldUnicodePath();if(_!==null)this.fileNameStr=_;else{var c=o.transformTo(h,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}var p=this.findExtraFieldUnicodeComment();if(p!==null)this.fileCommentStr=p;else{var u=o.transformTo(h,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(u)}}},findExtraFieldUnicodePath:function(){var h=this.extraFields[28789];if(h){var _=s(h.value);return _.readInt(1)!==1||d(this.fileName)!==_.readInt(4)?null:g.utf8decode(_.readData(h.length-5))}return null},findExtraFieldUnicodeComment:function(){var h=this.extraFields[25461];if(h){var _=s(h.value);return _.readInt(1)!==1||d(this.fileComment)!==_.readInt(4)?null:g.utf8decode(_.readData(h.length-5))}return null}},i.exports=C},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function s(_,c,p){this.name=_,this.dir=p.dir,this.date=p.date,this.comment=p.comment,this.unixPermissions=p.unixPermissions,this.dosPermissions=p.dosPermissions,this._data=c,this._dataBinary=p.binary,this.options={compression:p.compression,compressionOptions:p.compressionOptions}}var o=t("./stream/StreamHelper"),r=t("./stream/DataWorker"),d=t("./utf8"),g=t("./compressedObject"),v=t("./stream/GenericWorker");s.prototype={internalStream:function(_){var c=null,p="string";try{if(!_)throw new Error("No output type specified.");var u=(p=_.toLowerCase())==="string"||p==="text";p!=="binarystring"&&p!=="text"||(p="string"),c=this._decompressWorker();var I=!this._dataBinary;I&&!u&&(c=c.pipe(new d.Utf8EncodeWorker)),!I&&u&&(c=c.pipe(new d.Utf8DecodeWorker))}catch(x){(c=new v("error")).error(x)}return new o(c,p,"")},async:function(_,c){return this.internalStream(_).accumulate(c)},nodeStream:function(_,c){return this.internalStream(_||"nodebuffer").toNodejsStream(c)},_compressWorker:function(_,c){if(this._data instanceof g&&this._data.compression.magic===_.magic)return this._data.getCompressedWorker();var p=this._decompressWorker();return this._dataBinary||(p=p.pipe(new d.Utf8EncodeWorker)),g.createWorkerFrom(p,_,c)},_decompressWorker:function(){return this._data instanceof g?this._data.getContentWorker():this._data instanceof v?this._data:new r(this._data)}};for(var y=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],C=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<y.length;h++)s.prototype[y[h]]=C;i.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(s){var o,r,d=s.MutationObserver||s.WebKitMutationObserver;if(d){var g=0,v=new d(_),y=s.document.createTextNode("");v.observe(y,{characterData:!0}),o=function(){y.data=g=++g%2}}else if(s.setImmediate||s.MessageChannel===void 0)o="document"in s&&"onreadystatechange"in s.document.createElement("script")?function(){var c=s.document.createElement("script");c.onreadystatechange=function(){_(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},s.document.documentElement.appendChild(c)}:function(){setTimeout(_,0)};else{var C=new s.MessageChannel;C.port1.onmessage=_,o=function(){C.port2.postMessage(0)}}var h=[];function _(){var c,p;r=!0;for(var u=h.length;u;){for(p=h,h=[],c=-1;++c<u;)p[c]();u=h.length}r=!1}i.exports=function(c){h.push(c)!==1||r||o()}}).call(this,typeof pt<"u"?pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var s=t("immediate");function o(){}var r={},d=["REJECTED"],g=["FULFILLED"],v=["PENDING"];function y(u){if(typeof u!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,u!==o&&c(this,u)}function C(u,I,x){this.promise=u,typeof I=="function"&&(this.onFulfilled=I,this.callFulfilled=this.otherCallFulfilled),typeof x=="function"&&(this.onRejected=x,this.callRejected=this.otherCallRejected)}function h(u,I,x){s(function(){var D;try{D=I(x)}catch(E){return r.reject(u,E)}D===u?r.reject(u,new TypeError("Cannot resolve promise with itself")):r.resolve(u,D)})}function _(u){var I=u&&u.then;if(u&&(typeof u=="object"||typeof u=="function")&&typeof I=="function")return function(){I.apply(u,arguments)}}function c(u,I){var x=!1;function D(T){x||(x=!0,r.reject(u,T))}function E(T){x||(x=!0,r.resolve(u,T))}var z=p(function(){I(E,D)});z.status==="error"&&D(z.value)}function p(u,I){var x={};try{x.value=u(I),x.status="success"}catch(D){x.status="error",x.value=D}return x}(i.exports=y).prototype.finally=function(u){if(typeof u!="function")return this;var I=this.constructor;return this.then(function(x){return I.resolve(u()).then(function(){return x})},function(x){return I.resolve(u()).then(function(){throw x})})},y.prototype.catch=function(u){return this.then(null,u)},y.prototype.then=function(u,I){if(typeof u!="function"&&this.state===g||typeof I!="function"&&this.state===d)return this;var x=new this.constructor(o);return this.state!==v?h(x,this.state===g?u:I,this.outcome):this.queue.push(new C(x,u,I)),x},C.prototype.callFulfilled=function(u){r.resolve(this.promise,u)},C.prototype.otherCallFulfilled=function(u){h(this.promise,this.onFulfilled,u)},C.prototype.callRejected=function(u){r.reject(this.promise,u)},C.prototype.otherCallRejected=function(u){h(this.promise,this.onRejected,u)},r.resolve=function(u,I){var x=p(_,I);if(x.status==="error")return r.reject(u,x.value);var D=x.value;if(D)c(u,D);else{u.state=g,u.outcome=I;for(var E=-1,z=u.queue.length;++E<z;)u.queue[E].callFulfilled(I)}return u},r.reject=function(u,I){u.state=d,u.outcome=I;for(var x=-1,D=u.queue.length;++x<D;)u.queue[x].callRejected(I);return u},y.resolve=function(u){return u instanceof this?u:r.resolve(new this(o),u)},y.reject=function(u){var I=new this(o);return r.reject(I,u)},y.all=function(u){var I=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=u.length,D=!1;if(!x)return this.resolve([]);for(var E=new Array(x),z=0,T=-1,V=new this(o);++T<x;)k(u[T],T);return V;function k(j,ee){I.resolve(j).then(function(b){E[ee]=b,++z!==x||D||(D=!0,r.resolve(V,E))},function(b){D||(D=!0,r.reject(V,b))})}},y.race=function(u){var I=this;if(Object.prototype.toString.call(u)!=="[object Array]")return this.reject(new TypeError("must be an array"));var x=u.length,D=!1;if(!x)return this.resolve([]);for(var E=-1,z=new this(o);++E<x;)T=u[E],I.resolve(T).then(function(V){D||(D=!0,r.resolve(z,V))},function(V){D||(D=!0,r.reject(z,V))});var T;return z}},{immediate:36}],38:[function(t,i,n){var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var s=t("./zlib/deflate"),o=t("./utils/common"),r=t("./utils/strings"),d=t("./zlib/messages"),g=t("./zlib/zstream"),v=Object.prototype.toString,y=0,C=-1,h=0,_=8;function c(u){if(!(this instanceof c))return new c(u);this.options=o.assign({level:C,method:_,chunkSize:16384,windowBits:15,memLevel:8,strategy:h,to:""},u||{});var I=this.options;I.raw&&0<I.windowBits?I.windowBits=-I.windowBits:I.gzip&&0<I.windowBits&&I.windowBits<16&&(I.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new g,this.strm.avail_out=0;var x=s.deflateInit2(this.strm,I.level,I.method,I.windowBits,I.memLevel,I.strategy);if(x!==y)throw new Error(d[x]);if(I.header&&s.deflateSetHeader(this.strm,I.header),I.dictionary){var D;if(D=typeof I.dictionary=="string"?r.string2buf(I.dictionary):v.call(I.dictionary)==="[object ArrayBuffer]"?new Uint8Array(I.dictionary):I.dictionary,(x=s.deflateSetDictionary(this.strm,D))!==y)throw new Error(d[x]);this._dict_set=!0}}function p(u,I){var x=new c(I);if(x.push(u,!0),x.err)throw x.msg||d[x.err];return x.result}c.prototype.push=function(u,I){var x,D,E=this.strm,z=this.options.chunkSize;if(this.ended)return!1;D=I===~~I?I:I===!0?4:0,typeof u=="string"?E.input=r.string2buf(u):v.call(u)==="[object ArrayBuffer]"?E.input=new Uint8Array(u):E.input=u,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(z),E.next_out=0,E.avail_out=z),(x=s.deflate(E,D))!==1&&x!==y)return this.onEnd(x),!(this.ended=!0);E.avail_out!==0&&(E.avail_in!==0||D!==4&&D!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(o.shrinkBuf(E.output,E.next_out))):this.onData(o.shrinkBuf(E.output,E.next_out)))}while((0<E.avail_in||E.avail_out===0)&&x!==1);return D===4?(x=s.deflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===y):D!==2||(this.onEnd(y),!(E.avail_out=0))},c.prototype.onData=function(u){this.chunks.push(u)},c.prototype.onEnd=function(u){u===y&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=u,this.msg=this.strm.msg},n.Deflate=c,n.deflate=p,n.deflateRaw=function(u,I){return(I=I||{}).raw=!0,p(u,I)},n.gzip=function(u,I){return(I=I||{}).gzip=!0,p(u,I)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var s=t("./zlib/inflate"),o=t("./utils/common"),r=t("./utils/strings"),d=t("./zlib/constants"),g=t("./zlib/messages"),v=t("./zlib/zstream"),y=t("./zlib/gzheader"),C=Object.prototype.toString;function h(c){if(!(this instanceof h))return new h(c);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},c||{});var p=this.options;p.raw&&0<=p.windowBits&&p.windowBits<16&&(p.windowBits=-p.windowBits,p.windowBits===0&&(p.windowBits=-15)),!(0<=p.windowBits&&p.windowBits<16)||c&&c.windowBits||(p.windowBits+=32),15<p.windowBits&&p.windowBits<48&&(15&p.windowBits)==0&&(p.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var u=s.inflateInit2(this.strm,p.windowBits);if(u!==d.Z_OK)throw new Error(g[u]);this.header=new y,s.inflateGetHeader(this.strm,this.header)}function _(c,p){var u=new h(p);if(u.push(c,!0),u.err)throw u.msg||g[u.err];return u.result}h.prototype.push=function(c,p){var u,I,x,D,E,z,T=this.strm,V=this.options.chunkSize,k=this.options.dictionary,j=!1;if(this.ended)return!1;I=p===~~p?p:p===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof c=="string"?T.input=r.binstring2buf(c):C.call(c)==="[object ArrayBuffer]"?T.input=new Uint8Array(c):T.input=c,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new o.Buf8(V),T.next_out=0,T.avail_out=V),(u=s.inflate(T,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&k&&(z=typeof k=="string"?r.string2buf(k):C.call(k)==="[object ArrayBuffer]"?new Uint8Array(k):k,u=s.inflateSetDictionary(this.strm,z)),u===d.Z_BUF_ERROR&&j===!0&&(u=d.Z_OK,j=!1),u!==d.Z_STREAM_END&&u!==d.Z_OK)return this.onEnd(u),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&u!==d.Z_STREAM_END&&(T.avail_in!==0||I!==d.Z_FINISH&&I!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(x=r.utf8border(T.output,T.next_out),D=T.next_out-x,E=r.buf2string(T.output,x),T.next_out=D,T.avail_out=V-D,D&&o.arraySet(T.output,T.output,x,D,0),this.onData(E)):this.onData(o.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(j=!0)}while((0<T.avail_in||T.avail_out===0)&&u!==d.Z_STREAM_END);return u===d.Z_STREAM_END&&(I=d.Z_FINISH),I===d.Z_FINISH?(u=s.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,u===d.Z_OK):I!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(T.avail_out=0))},h.prototype.onData=function(c){this.chunks.push(c)},h.prototype.onEnd=function(c){c===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},n.Inflate=h,n.inflate=_,n.inflateRaw=function(c,p){return(p=p||{}).raw=!0,_(c,p)},n.ungzip=_},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var s=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(d){for(var g=Array.prototype.slice.call(arguments,1);g.length;){var v=g.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var y in v)v.hasOwnProperty(y)&&(d[y]=v[y])}}return d},n.shrinkBuf=function(d,g){return d.length===g?d:d.subarray?d.subarray(0,g):(d.length=g,d)};var o={arraySet:function(d,g,v,y,C){if(g.subarray&&d.subarray)d.set(g.subarray(v,v+y),C);else for(var h=0;h<y;h++)d[C+h]=g[v+h]},flattenChunks:function(d){var g,v,y,C,h,_;for(g=y=0,v=d.length;g<v;g++)y+=d[g].length;for(_=new Uint8Array(y),g=C=0,v=d.length;g<v;g++)h=d[g],_.set(h,C),C+=h.length;return _}},r={arraySet:function(d,g,v,y,C){for(var h=0;h<y;h++)d[C+h]=g[v+h]},flattenChunks:function(d){return[].concat.apply([],d)}};n.setTyped=function(d){d?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,r))},n.setTyped(s)},{}],42:[function(t,i,n){var s=t("./common"),o=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var d=new s.Buf8(256),g=0;g<256;g++)d[g]=252<=g?6:248<=g?5:240<=g?4:224<=g?3:192<=g?2:1;function v(y,C){if(C<65537&&(y.subarray&&r||!y.subarray&&o))return String.fromCharCode.apply(null,s.shrinkBuf(y,C));for(var h="",_=0;_<C;_++)h+=String.fromCharCode(y[_]);return h}d[254]=d[254]=1,n.string2buf=function(y){var C,h,_,c,p,u=y.length,I=0;for(c=0;c<u;c++)(64512&(h=y.charCodeAt(c)))==55296&&c+1<u&&(64512&(_=y.charCodeAt(c+1)))==56320&&(h=65536+(h-55296<<10)+(_-56320),c++),I+=h<128?1:h<2048?2:h<65536?3:4;for(C=new s.Buf8(I),c=p=0;p<I;c++)(64512&(h=y.charCodeAt(c)))==55296&&c+1<u&&(64512&(_=y.charCodeAt(c+1)))==56320&&(h=65536+(h-55296<<10)+(_-56320),c++),h<128?C[p++]=h:(h<2048?C[p++]=192|h>>>6:(h<65536?C[p++]=224|h>>>12:(C[p++]=240|h>>>18,C[p++]=128|h>>>12&63),C[p++]=128|h>>>6&63),C[p++]=128|63&h);return C},n.buf2binstring=function(y){return v(y,y.length)},n.binstring2buf=function(y){for(var C=new s.Buf8(y.length),h=0,_=C.length;h<_;h++)C[h]=y.charCodeAt(h);return C},n.buf2string=function(y,C){var h,_,c,p,u=C||y.length,I=new Array(2*u);for(h=_=0;h<u;)if((c=y[h++])<128)I[_++]=c;else if(4<(p=d[c]))I[_++]=65533,h+=p-1;else{for(c&=p===2?31:p===3?15:7;1<p&&h<u;)c=c<<6|63&y[h++],p--;1<p?I[_++]=65533:c<65536?I[_++]=c:(c-=65536,I[_++]=55296|c>>10&1023,I[_++]=56320|1023&c)}return v(I,_)},n.utf8border=function(y,C){var h;for((C=C||y.length)>y.length&&(C=y.length),h=C-1;0<=h&&(192&y[h])==128;)h--;return h<0||h===0?C:h+d[y[h]]>C?h:C}},{"./common":41}],43:[function(t,i,n){i.exports=function(s,o,r,d){for(var g=65535&s|0,v=s>>>16&65535|0,y=0;r!==0;){for(r-=y=2e3<r?2e3:r;v=v+(g=g+o[d++]|0)|0,--y;);g%=65521,v%=65521}return g|v<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var s=(function(){for(var o,r=[],d=0;d<256;d++){o=d;for(var g=0;g<8;g++)o=1&o?3988292384^o>>>1:o>>>1;r[d]=o}return r})();i.exports=function(o,r,d,g){var v=s,y=g+d;o^=-1;for(var C=g;C<y;C++)o=o>>>8^v[255&(o^r[C])];return-1^o}},{}],46:[function(t,i,n){var s,o=t("../utils/common"),r=t("./trees"),d=t("./adler32"),g=t("./crc32"),v=t("./messages"),y=0,C=4,h=0,_=-2,c=-1,p=4,u=2,I=8,x=9,D=286,E=30,z=19,T=2*D+1,V=15,k=3,j=258,ee=j+k+1,b=42,O=113,l=1,$=2,ne=3,K=4;function oe(a,B){return a.msg=v[B],B}function W(a){return(a<<1)-(4<a?9:0)}function ie(a){for(var B=a.length;0<=--B;)a[B]=0}function P(a){var B=a.state,A=B.pending;A>a.avail_out&&(A=a.avail_out),A!==0&&(o.arraySet(a.output,B.pending_buf,B.pending_out,A,a.next_out),a.next_out+=A,B.pending_out+=A,a.total_out+=A,a.avail_out-=A,B.pending-=A,B.pending===0&&(B.pending_out=0))}function F(a,B){r._tr_flush_block(a,0<=a.block_start?a.block_start:-1,a.strstart-a.block_start,B),a.block_start=a.strstart,P(a.strm)}function Q(a,B){a.pending_buf[a.pending++]=B}function q(a,B){a.pending_buf[a.pending++]=B>>>8&255,a.pending_buf[a.pending++]=255&B}function G(a,B){var A,f,m=a.max_chain_length,S=a.strstart,R=a.prev_length,L=a.nice_match,M=a.strstart>a.w_size-ee?a.strstart-(a.w_size-ee):0,H=a.window,Y=a.w_mask,Z=a.prev,J=a.strstart+j,ce=H[S+R-1],ae=H[S+R];a.prev_length>=a.good_match&&(m>>=2),L>a.lookahead&&(L=a.lookahead);do if(H[(A=B)+R]===ae&&H[A+R-1]===ce&&H[A]===H[S]&&H[++A]===H[S+1]){S+=2,A++;do;while(H[++S]===H[++A]&&H[++S]===H[++A]&&H[++S]===H[++A]&&H[++S]===H[++A]&&H[++S]===H[++A]&&H[++S]===H[++A]&&H[++S]===H[++A]&&H[++S]===H[++A]&&S<J);if(f=j-(J-S),S=J-j,R<f){if(a.match_start=B,L<=(R=f))break;ce=H[S+R-1],ae=H[S+R]}}while((B=Z[B&Y])>M&&--m!=0);return R<=a.lookahead?R:a.lookahead}function he(a){var B,A,f,m,S,R,L,M,H,Y,Z=a.w_size;do{if(m=a.window_size-a.lookahead-a.strstart,a.strstart>=Z+(Z-ee)){for(o.arraySet(a.window,a.window,Z,Z,0),a.match_start-=Z,a.strstart-=Z,a.block_start-=Z,B=A=a.hash_size;f=a.head[--B],a.head[B]=Z<=f?f-Z:0,--A;);for(B=A=Z;f=a.prev[--B],a.prev[B]=Z<=f?f-Z:0,--A;);m+=Z}if(a.strm.avail_in===0)break;if(R=a.strm,L=a.window,M=a.strstart+a.lookahead,H=m,Y=void 0,Y=R.avail_in,H<Y&&(Y=H),A=Y===0?0:(R.avail_in-=Y,o.arraySet(L,R.input,R.next_in,Y,M),R.state.wrap===1?R.adler=d(R.adler,L,Y,M):R.state.wrap===2&&(R.adler=g(R.adler,L,Y,M)),R.next_in+=Y,R.total_in+=Y,Y),a.lookahead+=A,a.lookahead+a.insert>=k)for(S=a.strstart-a.insert,a.ins_h=a.window[S],a.ins_h=(a.ins_h<<a.hash_shift^a.window[S+1])&a.hash_mask;a.insert&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[S+k-1])&a.hash_mask,a.prev[S&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=S,S++,a.insert--,!(a.lookahead+a.insert<k)););}while(a.lookahead<ee&&a.strm.avail_in!==0)}function fe(a,B){for(var A,f;;){if(a.lookahead<ee){if(he(a),a.lookahead<ee&&B===y)return l;if(a.lookahead===0)break}if(A=0,a.lookahead>=k&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+k-1])&a.hash_mask,A=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),A!==0&&a.strstart-A<=a.w_size-ee&&(a.match_length=G(a,A)),a.match_length>=k)if(f=r._tr_tally(a,a.strstart-a.match_start,a.match_length-k),a.lookahead-=a.match_length,a.match_length<=a.max_lazy_match&&a.lookahead>=k){for(a.match_length--;a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+k-1])&a.hash_mask,A=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart,--a.match_length!=0;);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask;else f=r._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(f&&(F(a,!1),a.strm.avail_out===0))return l}return a.insert=a.strstart<k-1?a.strstart:k-1,B===C?(F(a,!0),a.strm.avail_out===0?ne:K):a.last_lit&&(F(a,!1),a.strm.avail_out===0)?l:$}function re(a,B){for(var A,f,m;;){if(a.lookahead<ee){if(he(a),a.lookahead<ee&&B===y)return l;if(a.lookahead===0)break}if(A=0,a.lookahead>=k&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+k-1])&a.hash_mask,A=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),a.prev_length=a.match_length,a.prev_match=a.match_start,a.match_length=k-1,A!==0&&a.prev_length<a.max_lazy_match&&a.strstart-A<=a.w_size-ee&&(a.match_length=G(a,A),a.match_length<=5&&(a.strategy===1||a.match_length===k&&4096<a.strstart-a.match_start)&&(a.match_length=k-1)),a.prev_length>=k&&a.match_length<=a.prev_length){for(m=a.strstart+a.lookahead-k,f=r._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-k),a.lookahead-=a.prev_length-1,a.prev_length-=2;++a.strstart<=m&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+k-1])&a.hash_mask,A=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart),--a.prev_length!=0;);if(a.match_available=0,a.match_length=k-1,a.strstart++,f&&(F(a,!1),a.strm.avail_out===0))return l}else if(a.match_available){if((f=r._tr_tally(a,0,a.window[a.strstart-1]))&&F(a,!1),a.strstart++,a.lookahead--,a.strm.avail_out===0)return l}else a.match_available=1,a.strstart++,a.lookahead--}return a.match_available&&(f=r._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0),a.insert=a.strstart<k-1?a.strstart:k-1,B===C?(F(a,!0),a.strm.avail_out===0?ne:K):a.last_lit&&(F(a,!1),a.strm.avail_out===0)?l:$}function le(a,B,A,f,m){this.good_length=a,this.max_lazy=B,this.nice_length=A,this.max_chain=f,this.func=m}function me(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*T),this.dyn_dtree=new o.Buf16(2*(2*E+1)),this.bl_tree=new o.Buf16(2*(2*z+1)),ie(this.dyn_ltree),ie(this.dyn_dtree),ie(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(V+1),this.heap=new o.Buf16(2*D+1),ie(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*D+1),ie(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ue(a){var B;return a&&a.state?(a.total_in=a.total_out=0,a.data_type=u,(B=a.state).pending=0,B.pending_out=0,B.wrap<0&&(B.wrap=-B.wrap),B.status=B.wrap?b:O,a.adler=B.wrap===2?0:1,B.last_flush=y,r._tr_init(B),h):oe(a,_)}function Pe(a){var B=ue(a);return B===h&&(function(A){A.window_size=2*A.w_size,ie(A.head),A.max_lazy_match=s[A.level].max_lazy,A.good_match=s[A.level].good_length,A.nice_match=s[A.level].nice_length,A.max_chain_length=s[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=k-1,A.match_available=0,A.ins_h=0})(a.state),B}function Fe(a,B,A,f,m,S){if(!a)return _;var R=1;if(B===c&&(B=6),f<0?(R=0,f=-f):15<f&&(R=2,f-=16),m<1||x<m||A!==I||f<8||15<f||B<0||9<B||S<0||p<S)return oe(a,_);f===8&&(f=9);var L=new me;return(a.state=L).strm=a,L.wrap=R,L.gzhead=null,L.w_bits=f,L.w_size=1<<L.w_bits,L.w_mask=L.w_size-1,L.hash_bits=m+7,L.hash_size=1<<L.hash_bits,L.hash_mask=L.hash_size-1,L.hash_shift=~~((L.hash_bits+k-1)/k),L.window=new o.Buf8(2*L.w_size),L.head=new o.Buf16(L.hash_size),L.prev=new o.Buf16(L.w_size),L.lit_bufsize=1<<m+6,L.pending_buf_size=4*L.lit_bufsize,L.pending_buf=new o.Buf8(L.pending_buf_size),L.d_buf=1*L.lit_bufsize,L.l_buf=3*L.lit_bufsize,L.level=B,L.strategy=S,L.method=A,Pe(a)}s=[new le(0,0,0,0,function(a,B){var A=65535;for(A>a.pending_buf_size-5&&(A=a.pending_buf_size-5);;){if(a.lookahead<=1){if(he(a),a.lookahead===0&&B===y)return l;if(a.lookahead===0)break}a.strstart+=a.lookahead,a.lookahead=0;var f=a.block_start+A;if((a.strstart===0||a.strstart>=f)&&(a.lookahead=a.strstart-f,a.strstart=f,F(a,!1),a.strm.avail_out===0)||a.strstart-a.block_start>=a.w_size-ee&&(F(a,!1),a.strm.avail_out===0))return l}return a.insert=0,B===C?(F(a,!0),a.strm.avail_out===0?ne:K):(a.strstart>a.block_start&&(F(a,!1),a.strm.avail_out),l)}),new le(4,4,8,4,fe),new le(4,5,16,8,fe),new le(4,6,32,32,fe),new le(4,4,16,16,re),new le(8,16,32,32,re),new le(8,16,128,128,re),new le(8,32,128,256,re),new le(32,128,258,1024,re),new le(32,258,258,4096,re)],n.deflateInit=function(a,B){return Fe(a,B,I,15,8,0)},n.deflateInit2=Fe,n.deflateReset=Pe,n.deflateResetKeep=ue,n.deflateSetHeader=function(a,B){return a&&a.state?a.state.wrap!==2?_:(a.state.gzhead=B,h):_},n.deflate=function(a,B){var A,f,m,S;if(!a||!a.state||5<B||B<0)return a?oe(a,_):_;if(f=a.state,!a.output||!a.input&&a.avail_in!==0||f.status===666&&B!==C)return oe(a,a.avail_out===0?-5:_);if(f.strm=a,A=f.last_flush,f.last_flush=B,f.status===b)if(f.wrap===2)a.adler=0,Q(f,31),Q(f,139),Q(f,8),f.gzhead?(Q(f,(f.gzhead.text?1:0)+(f.gzhead.hcrc?2:0)+(f.gzhead.extra?4:0)+(f.gzhead.name?8:0)+(f.gzhead.comment?16:0)),Q(f,255&f.gzhead.time),Q(f,f.gzhead.time>>8&255),Q(f,f.gzhead.time>>16&255),Q(f,f.gzhead.time>>24&255),Q(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),Q(f,255&f.gzhead.os),f.gzhead.extra&&f.gzhead.extra.length&&(Q(f,255&f.gzhead.extra.length),Q(f,f.gzhead.extra.length>>8&255)),f.gzhead.hcrc&&(a.adler=g(a.adler,f.pending_buf,f.pending,0)),f.gzindex=0,f.status=69):(Q(f,0),Q(f,0),Q(f,0),Q(f,0),Q(f,0),Q(f,f.level===9?2:2<=f.strategy||f.level<2?4:0),Q(f,3),f.status=O);else{var R=I+(f.w_bits-8<<4)<<8;R|=(2<=f.strategy||f.level<2?0:f.level<6?1:f.level===6?2:3)<<6,f.strstart!==0&&(R|=32),R+=31-R%31,f.status=O,q(f,R),f.strstart!==0&&(q(f,a.adler>>>16),q(f,65535&a.adler)),a.adler=1}if(f.status===69)if(f.gzhead.extra){for(m=f.pending;f.gzindex<(65535&f.gzhead.extra.length)&&(f.pending!==f.pending_buf_size||(f.gzhead.hcrc&&f.pending>m&&(a.adler=g(a.adler,f.pending_buf,f.pending-m,m)),P(a),m=f.pending,f.pending!==f.pending_buf_size));)Q(f,255&f.gzhead.extra[f.gzindex]),f.gzindex++;f.gzhead.hcrc&&f.pending>m&&(a.adler=g(a.adler,f.pending_buf,f.pending-m,m)),f.gzindex===f.gzhead.extra.length&&(f.gzindex=0,f.status=73)}else f.status=73;if(f.status===73)if(f.gzhead.name){m=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>m&&(a.adler=g(a.adler,f.pending_buf,f.pending-m,m)),P(a),m=f.pending,f.pending===f.pending_buf_size)){S=1;break}S=f.gzindex<f.gzhead.name.length?255&f.gzhead.name.charCodeAt(f.gzindex++):0,Q(f,S)}while(S!==0);f.gzhead.hcrc&&f.pending>m&&(a.adler=g(a.adler,f.pending_buf,f.pending-m,m)),S===0&&(f.gzindex=0,f.status=91)}else f.status=91;if(f.status===91)if(f.gzhead.comment){m=f.pending;do{if(f.pending===f.pending_buf_size&&(f.gzhead.hcrc&&f.pending>m&&(a.adler=g(a.adler,f.pending_buf,f.pending-m,m)),P(a),m=f.pending,f.pending===f.pending_buf_size)){S=1;break}S=f.gzindex<f.gzhead.comment.length?255&f.gzhead.comment.charCodeAt(f.gzindex++):0,Q(f,S)}while(S!==0);f.gzhead.hcrc&&f.pending>m&&(a.adler=g(a.adler,f.pending_buf,f.pending-m,m)),S===0&&(f.status=103)}else f.status=103;if(f.status===103&&(f.gzhead.hcrc?(f.pending+2>f.pending_buf_size&&P(a),f.pending+2<=f.pending_buf_size&&(Q(f,255&a.adler),Q(f,a.adler>>8&255),a.adler=0,f.status=O)):f.status=O),f.pending!==0){if(P(a),a.avail_out===0)return f.last_flush=-1,h}else if(a.avail_in===0&&W(B)<=W(A)&&B!==C)return oe(a,-5);if(f.status===666&&a.avail_in!==0)return oe(a,-5);if(a.avail_in!==0||f.lookahead!==0||B!==y&&f.status!==666){var L=f.strategy===2?(function(M,H){for(var Y;;){if(M.lookahead===0&&(he(M),M.lookahead===0)){if(H===y)return l;break}if(M.match_length=0,Y=r._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,Y&&(F(M,!1),M.strm.avail_out===0))return l}return M.insert=0,H===C?(F(M,!0),M.strm.avail_out===0?ne:K):M.last_lit&&(F(M,!1),M.strm.avail_out===0)?l:$})(f,B):f.strategy===3?(function(M,H){for(var Y,Z,J,ce,ae=M.window;;){if(M.lookahead<=j){if(he(M),M.lookahead<=j&&H===y)return l;if(M.lookahead===0)break}if(M.match_length=0,M.lookahead>=k&&0<M.strstart&&(Z=ae[J=M.strstart-1])===ae[++J]&&Z===ae[++J]&&Z===ae[++J]){ce=M.strstart+j;do;while(Z===ae[++J]&&Z===ae[++J]&&Z===ae[++J]&&Z===ae[++J]&&Z===ae[++J]&&Z===ae[++J]&&Z===ae[++J]&&Z===ae[++J]&&J<ce);M.match_length=j-(ce-J),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=k?(Y=r._tr_tally(M,1,M.match_length-k),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):(Y=r._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),Y&&(F(M,!1),M.strm.avail_out===0))return l}return M.insert=0,H===C?(F(M,!0),M.strm.avail_out===0?ne:K):M.last_lit&&(F(M,!1),M.strm.avail_out===0)?l:$})(f,B):s[f.level].func(f,B);if(L!==ne&&L!==K||(f.status=666),L===l||L===ne)return a.avail_out===0&&(f.last_flush=-1),h;if(L===$&&(B===1?r._tr_align(f):B!==5&&(r._tr_stored_block(f,0,0,!1),B===3&&(ie(f.head),f.lookahead===0&&(f.strstart=0,f.block_start=0,f.insert=0))),P(a),a.avail_out===0))return f.last_flush=-1,h}return B!==C?h:f.wrap<=0?1:(f.wrap===2?(Q(f,255&a.adler),Q(f,a.adler>>8&255),Q(f,a.adler>>16&255),Q(f,a.adler>>24&255),Q(f,255&a.total_in),Q(f,a.total_in>>8&255),Q(f,a.total_in>>16&255),Q(f,a.total_in>>24&255)):(q(f,a.adler>>>16),q(f,65535&a.adler)),P(a),0<f.wrap&&(f.wrap=-f.wrap),f.pending!==0?h:1)},n.deflateEnd=function(a){var B;return a&&a.state?(B=a.state.status)!==b&&B!==69&&B!==73&&B!==91&&B!==103&&B!==O&&B!==666?oe(a,_):(a.state=null,B===O?oe(a,-3):h):_},n.deflateSetDictionary=function(a,B){var A,f,m,S,R,L,M,H,Y=B.length;if(!a||!a.state||(S=(A=a.state).wrap)===2||S===1&&A.status!==b||A.lookahead)return _;for(S===1&&(a.adler=d(a.adler,B,Y,0)),A.wrap=0,Y>=A.w_size&&(S===0&&(ie(A.head),A.strstart=0,A.block_start=0,A.insert=0),H=new o.Buf8(A.w_size),o.arraySet(H,B,Y-A.w_size,A.w_size,0),B=H,Y=A.w_size),R=a.avail_in,L=a.next_in,M=a.input,a.avail_in=Y,a.next_in=0,a.input=B,he(A);A.lookahead>=k;){for(f=A.strstart,m=A.lookahead-(k-1);A.ins_h=(A.ins_h<<A.hash_shift^A.window[f+k-1])&A.hash_mask,A.prev[f&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=f,f++,--m;);A.strstart=f,A.lookahead=k-1,he(A)}return A.strstart+=A.lookahead,A.block_start=A.strstart,A.insert=A.lookahead,A.lookahead=0,A.match_length=A.prev_length=k-1,A.match_available=0,a.next_in=L,a.input=M,a.avail_in=R,A.wrap=S,h},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(s,o){var r,d,g,v,y,C,h,_,c,p,u,I,x,D,E,z,T,V,k,j,ee,b,O,l,$;r=s.state,d=s.next_in,l=s.input,g=d+(s.avail_in-5),v=s.next_out,$=s.output,y=v-(o-s.avail_out),C=v+(s.avail_out-257),h=r.dmax,_=r.wsize,c=r.whave,p=r.wnext,u=r.window,I=r.hold,x=r.bits,D=r.lencode,E=r.distcode,z=(1<<r.lenbits)-1,T=(1<<r.distbits)-1;e:do{x<15&&(I+=l[d++]<<x,x+=8,I+=l[d++]<<x,x+=8),V=D[I&z];t:for(;;){if(I>>>=k=V>>>24,x-=k,(k=V>>>16&255)===0)$[v++]=65535&V;else{if(!(16&k)){if((64&k)==0){V=D[(65535&V)+(I&(1<<k)-1)];continue t}if(32&k){r.mode=12;break e}s.msg="invalid literal/length code",r.mode=30;break e}j=65535&V,(k&=15)&&(x<k&&(I+=l[d++]<<x,x+=8),j+=I&(1<<k)-1,I>>>=k,x-=k),x<15&&(I+=l[d++]<<x,x+=8,I+=l[d++]<<x,x+=8),V=E[I&T];i:for(;;){if(I>>>=k=V>>>24,x-=k,!(16&(k=V>>>16&255))){if((64&k)==0){V=E[(65535&V)+(I&(1<<k)-1)];continue i}s.msg="invalid distance code",r.mode=30;break e}if(ee=65535&V,x<(k&=15)&&(I+=l[d++]<<x,(x+=8)<k&&(I+=l[d++]<<x,x+=8)),h<(ee+=I&(1<<k)-1)){s.msg="invalid distance too far back",r.mode=30;break e}if(I>>>=k,x-=k,(k=v-y)<ee){if(c<(k=ee-k)&&r.sane){s.msg="invalid distance too far back",r.mode=30;break e}if(O=u,(b=0)===p){if(b+=_-k,k<j){for(j-=k;$[v++]=u[b++],--k;);b=v-ee,O=$}}else if(p<k){if(b+=_+p-k,(k-=p)<j){for(j-=k;$[v++]=u[b++],--k;);if(b=0,p<j){for(j-=k=p;$[v++]=u[b++],--k;);b=v-ee,O=$}}}else if(b+=p-k,k<j){for(j-=k;$[v++]=u[b++],--k;);b=v-ee,O=$}for(;2<j;)$[v++]=O[b++],$[v++]=O[b++],$[v++]=O[b++],j-=3;j&&($[v++]=O[b++],1<j&&($[v++]=O[b++]))}else{for(b=v-ee;$[v++]=$[b++],$[v++]=$[b++],$[v++]=$[b++],2<(j-=3););j&&($[v++]=$[b++],1<j&&($[v++]=$[b++]))}break}}break}}while(d<g&&v<C);d-=j=x>>3,I&=(1<<(x-=j<<3))-1,s.next_in=d,s.next_out=v,s.avail_in=d<g?g-d+5:5-(d-g),s.avail_out=v<C?C-v+257:257-(v-C),r.hold=I,r.bits=x}},{}],49:[function(t,i,n){var s=t("../utils/common"),o=t("./adler32"),r=t("./crc32"),d=t("./inffast"),g=t("./inftrees"),v=1,y=2,C=0,h=-2,_=1,c=852,p=592;function u(b){return(b>>>24&255)+(b>>>8&65280)+((65280&b)<<8)+((255&b)<<24)}function I(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function x(b){var O;return b&&b.state?(O=b.state,b.total_in=b.total_out=O.total=0,b.msg="",O.wrap&&(b.adler=1&O.wrap),O.mode=_,O.last=0,O.havedict=0,O.dmax=32768,O.head=null,O.hold=0,O.bits=0,O.lencode=O.lendyn=new s.Buf32(c),O.distcode=O.distdyn=new s.Buf32(p),O.sane=1,O.back=-1,C):h}function D(b){var O;return b&&b.state?((O=b.state).wsize=0,O.whave=0,O.wnext=0,x(b)):h}function E(b,O){var l,$;return b&&b.state?($=b.state,O<0?(l=0,O=-O):(l=1+(O>>4),O<48&&(O&=15)),O&&(O<8||15<O)?h:($.window!==null&&$.wbits!==O&&($.window=null),$.wrap=l,$.wbits=O,D(b))):h}function z(b,O){var l,$;return b?($=new I,(b.state=$).window=null,(l=E(b,O))!==C&&(b.state=null),l):h}var T,V,k=!0;function j(b){if(k){var O;for(T=new s.Buf32(512),V=new s.Buf32(32),O=0;O<144;)b.lens[O++]=8;for(;O<256;)b.lens[O++]=9;for(;O<280;)b.lens[O++]=7;for(;O<288;)b.lens[O++]=8;for(g(v,b.lens,0,288,T,0,b.work,{bits:9}),O=0;O<32;)b.lens[O++]=5;g(y,b.lens,0,32,V,0,b.work,{bits:5}),k=!1}b.lencode=T,b.lenbits=9,b.distcode=V,b.distbits=5}function ee(b,O,l,$){var ne,K=b.state;return K.window===null&&(K.wsize=1<<K.wbits,K.wnext=0,K.whave=0,K.window=new s.Buf8(K.wsize)),$>=K.wsize?(s.arraySet(K.window,O,l-K.wsize,K.wsize,0),K.wnext=0,K.whave=K.wsize):($<(ne=K.wsize-K.wnext)&&(ne=$),s.arraySet(K.window,O,l-$,ne,K.wnext),($-=ne)?(s.arraySet(K.window,O,l-$,$,0),K.wnext=$,K.whave=K.wsize):(K.wnext+=ne,K.wnext===K.wsize&&(K.wnext=0),K.whave<K.wsize&&(K.whave+=ne))),0}n.inflateReset=D,n.inflateReset2=E,n.inflateResetKeep=x,n.inflateInit=function(b){return z(b,15)},n.inflateInit2=z,n.inflate=function(b,O){var l,$,ne,K,oe,W,ie,P,F,Q,q,G,he,fe,re,le,me,ue,Pe,Fe,a,B,A,f,m=0,S=new s.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!b||!b.state||!b.output||!b.input&&b.avail_in!==0)return h;(l=b.state).mode===12&&(l.mode=13),oe=b.next_out,ne=b.output,ie=b.avail_out,K=b.next_in,$=b.input,W=b.avail_in,P=l.hold,F=l.bits,Q=W,q=ie,B=C;e:for(;;)switch(l.mode){case _:if(l.wrap===0){l.mode=13;break}for(;F<16;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(2&l.wrap&&P===35615){S[l.check=0]=255&P,S[1]=P>>>8&255,l.check=r(l.check,S,2,0),F=P=0,l.mode=2;break}if(l.flags=0,l.head&&(l.head.done=!1),!(1&l.wrap)||(((255&P)<<8)+(P>>8))%31){b.msg="incorrect header check",l.mode=30;break}if((15&P)!=8){b.msg="unknown compression method",l.mode=30;break}if(F-=4,a=8+(15&(P>>>=4)),l.wbits===0)l.wbits=a;else if(a>l.wbits){b.msg="invalid window size",l.mode=30;break}l.dmax=1<<a,b.adler=l.check=1,l.mode=512&P?10:12,F=P=0;break;case 2:for(;F<16;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(l.flags=P,(255&l.flags)!=8){b.msg="unknown compression method",l.mode=30;break}if(57344&l.flags){b.msg="unknown header flags set",l.mode=30;break}l.head&&(l.head.text=P>>8&1),512&l.flags&&(S[0]=255&P,S[1]=P>>>8&255,l.check=r(l.check,S,2,0)),F=P=0,l.mode=3;case 3:for(;F<32;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}l.head&&(l.head.time=P),512&l.flags&&(S[0]=255&P,S[1]=P>>>8&255,S[2]=P>>>16&255,S[3]=P>>>24&255,l.check=r(l.check,S,4,0)),F=P=0,l.mode=4;case 4:for(;F<16;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}l.head&&(l.head.xflags=255&P,l.head.os=P>>8),512&l.flags&&(S[0]=255&P,S[1]=P>>>8&255,l.check=r(l.check,S,2,0)),F=P=0,l.mode=5;case 5:if(1024&l.flags){for(;F<16;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}l.length=P,l.head&&(l.head.extra_len=P),512&l.flags&&(S[0]=255&P,S[1]=P>>>8&255,l.check=r(l.check,S,2,0)),F=P=0}else l.head&&(l.head.extra=null);l.mode=6;case 6:if(1024&l.flags&&(W<(G=l.length)&&(G=W),G&&(l.head&&(a=l.head.extra_len-l.length,l.head.extra||(l.head.extra=new Array(l.head.extra_len)),s.arraySet(l.head.extra,$,K,G,a)),512&l.flags&&(l.check=r(l.check,$,G,K)),W-=G,K+=G,l.length-=G),l.length))break e;l.length=0,l.mode=7;case 7:if(2048&l.flags){if(W===0)break e;for(G=0;a=$[K+G++],l.head&&a&&l.length<65536&&(l.head.name+=String.fromCharCode(a)),a&&G<W;);if(512&l.flags&&(l.check=r(l.check,$,G,K)),W-=G,K+=G,a)break e}else l.head&&(l.head.name=null);l.length=0,l.mode=8;case 8:if(4096&l.flags){if(W===0)break e;for(G=0;a=$[K+G++],l.head&&a&&l.length<65536&&(l.head.comment+=String.fromCharCode(a)),a&&G<W;);if(512&l.flags&&(l.check=r(l.check,$,G,K)),W-=G,K+=G,a)break e}else l.head&&(l.head.comment=null);l.mode=9;case 9:if(512&l.flags){for(;F<16;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(P!==(65535&l.check)){b.msg="header crc mismatch",l.mode=30;break}F=P=0}l.head&&(l.head.hcrc=l.flags>>9&1,l.head.done=!0),b.adler=l.check=0,l.mode=12;break;case 10:for(;F<32;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}b.adler=l.check=u(P),F=P=0,l.mode=11;case 11:if(l.havedict===0)return b.next_out=oe,b.avail_out=ie,b.next_in=K,b.avail_in=W,l.hold=P,l.bits=F,2;b.adler=l.check=1,l.mode=12;case 12:if(O===5||O===6)break e;case 13:if(l.last){P>>>=7&F,F-=7&F,l.mode=27;break}for(;F<3;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}switch(l.last=1&P,F-=1,3&(P>>>=1)){case 0:l.mode=14;break;case 1:if(j(l),l.mode=20,O!==6)break;P>>>=2,F-=2;break e;case 2:l.mode=17;break;case 3:b.msg="invalid block type",l.mode=30}P>>>=2,F-=2;break;case 14:for(P>>>=7&F,F-=7&F;F<32;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if((65535&P)!=(P>>>16^65535)){b.msg="invalid stored block lengths",l.mode=30;break}if(l.length=65535&P,F=P=0,l.mode=15,O===6)break e;case 15:l.mode=16;case 16:if(G=l.length){if(W<G&&(G=W),ie<G&&(G=ie),G===0)break e;s.arraySet(ne,$,K,G,oe),W-=G,K+=G,ie-=G,oe+=G,l.length-=G;break}l.mode=12;break;case 17:for(;F<14;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(l.nlen=257+(31&P),P>>>=5,F-=5,l.ndist=1+(31&P),P>>>=5,F-=5,l.ncode=4+(15&P),P>>>=4,F-=4,286<l.nlen||30<l.ndist){b.msg="too many length or distance symbols",l.mode=30;break}l.have=0,l.mode=18;case 18:for(;l.have<l.ncode;){for(;F<3;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}l.lens[R[l.have++]]=7&P,P>>>=3,F-=3}for(;l.have<19;)l.lens[R[l.have++]]=0;if(l.lencode=l.lendyn,l.lenbits=7,A={bits:l.lenbits},B=g(0,l.lens,0,19,l.lencode,0,l.work,A),l.lenbits=A.bits,B){b.msg="invalid code lengths set",l.mode=30;break}l.have=0,l.mode=19;case 19:for(;l.have<l.nlen+l.ndist;){for(;le=(m=l.lencode[P&(1<<l.lenbits)-1])>>>16&255,me=65535&m,!((re=m>>>24)<=F);){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(me<16)P>>>=re,F-=re,l.lens[l.have++]=me;else{if(me===16){for(f=re+2;F<f;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(P>>>=re,F-=re,l.have===0){b.msg="invalid bit length repeat",l.mode=30;break}a=l.lens[l.have-1],G=3+(3&P),P>>>=2,F-=2}else if(me===17){for(f=re+3;F<f;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}F-=re,a=0,G=3+(7&(P>>>=re)),P>>>=3,F-=3}else{for(f=re+7;F<f;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}F-=re,a=0,G=11+(127&(P>>>=re)),P>>>=7,F-=7}if(l.have+G>l.nlen+l.ndist){b.msg="invalid bit length repeat",l.mode=30;break}for(;G--;)l.lens[l.have++]=a}}if(l.mode===30)break;if(l.lens[256]===0){b.msg="invalid code -- missing end-of-block",l.mode=30;break}if(l.lenbits=9,A={bits:l.lenbits},B=g(v,l.lens,0,l.nlen,l.lencode,0,l.work,A),l.lenbits=A.bits,B){b.msg="invalid literal/lengths set",l.mode=30;break}if(l.distbits=6,l.distcode=l.distdyn,A={bits:l.distbits},B=g(y,l.lens,l.nlen,l.ndist,l.distcode,0,l.work,A),l.distbits=A.bits,B){b.msg="invalid distances set",l.mode=30;break}if(l.mode=20,O===6)break e;case 20:l.mode=21;case 21:if(6<=W&&258<=ie){b.next_out=oe,b.avail_out=ie,b.next_in=K,b.avail_in=W,l.hold=P,l.bits=F,d(b,q),oe=b.next_out,ne=b.output,ie=b.avail_out,K=b.next_in,$=b.input,W=b.avail_in,P=l.hold,F=l.bits,l.mode===12&&(l.back=-1);break}for(l.back=0;le=(m=l.lencode[P&(1<<l.lenbits)-1])>>>16&255,me=65535&m,!((re=m>>>24)<=F);){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(le&&(240&le)==0){for(ue=re,Pe=le,Fe=me;le=(m=l.lencode[Fe+((P&(1<<ue+Pe)-1)>>ue)])>>>16&255,me=65535&m,!(ue+(re=m>>>24)<=F);){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}P>>>=ue,F-=ue,l.back+=ue}if(P>>>=re,F-=re,l.back+=re,l.length=me,le===0){l.mode=26;break}if(32&le){l.back=-1,l.mode=12;break}if(64&le){b.msg="invalid literal/length code",l.mode=30;break}l.extra=15&le,l.mode=22;case 22:if(l.extra){for(f=l.extra;F<f;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}l.length+=P&(1<<l.extra)-1,P>>>=l.extra,F-=l.extra,l.back+=l.extra}l.was=l.length,l.mode=23;case 23:for(;le=(m=l.distcode[P&(1<<l.distbits)-1])>>>16&255,me=65535&m,!((re=m>>>24)<=F);){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if((240&le)==0){for(ue=re,Pe=le,Fe=me;le=(m=l.distcode[Fe+((P&(1<<ue+Pe)-1)>>ue)])>>>16&255,me=65535&m,!(ue+(re=m>>>24)<=F);){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}P>>>=ue,F-=ue,l.back+=ue}if(P>>>=re,F-=re,l.back+=re,64&le){b.msg="invalid distance code",l.mode=30;break}l.offset=me,l.extra=15&le,l.mode=24;case 24:if(l.extra){for(f=l.extra;F<f;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}l.offset+=P&(1<<l.extra)-1,P>>>=l.extra,F-=l.extra,l.back+=l.extra}if(l.offset>l.dmax){b.msg="invalid distance too far back",l.mode=30;break}l.mode=25;case 25:if(ie===0)break e;if(G=q-ie,l.offset>G){if((G=l.offset-G)>l.whave&&l.sane){b.msg="invalid distance too far back",l.mode=30;break}he=G>l.wnext?(G-=l.wnext,l.wsize-G):l.wnext-G,G>l.length&&(G=l.length),fe=l.window}else fe=ne,he=oe-l.offset,G=l.length;for(ie<G&&(G=ie),ie-=G,l.length-=G;ne[oe++]=fe[he++],--G;);l.length===0&&(l.mode=21);break;case 26:if(ie===0)break e;ne[oe++]=l.length,ie--,l.mode=21;break;case 27:if(l.wrap){for(;F<32;){if(W===0)break e;W--,P|=$[K++]<<F,F+=8}if(q-=ie,b.total_out+=q,l.total+=q,q&&(b.adler=l.check=l.flags?r(l.check,ne,q,oe-q):o(l.check,ne,q,oe-q)),q=ie,(l.flags?P:u(P))!==l.check){b.msg="incorrect data check",l.mode=30;break}F=P=0}l.mode=28;case 28:if(l.wrap&&l.flags){for(;F<32;){if(W===0)break e;W--,P+=$[K++]<<F,F+=8}if(P!==(4294967295&l.total)){b.msg="incorrect length check",l.mode=30;break}F=P=0}l.mode=29;case 29:B=1;break e;case 30:B=-3;break e;case 31:return-4;case 32:default:return h}return b.next_out=oe,b.avail_out=ie,b.next_in=K,b.avail_in=W,l.hold=P,l.bits=F,(l.wsize||q!==b.avail_out&&l.mode<30&&(l.mode<27||O!==4))&&ee(b,b.output,b.next_out,q-b.avail_out)?(l.mode=31,-4):(Q-=b.avail_in,q-=b.avail_out,b.total_in+=Q,b.total_out+=q,l.total+=q,l.wrap&&q&&(b.adler=l.check=l.flags?r(l.check,ne,q,b.next_out-q):o(l.check,ne,q,b.next_out-q)),b.data_type=l.bits+(l.last?64:0)+(l.mode===12?128:0)+(l.mode===20||l.mode===15?256:0),(Q==0&&q===0||O===4)&&B===C&&(B=-5),B)},n.inflateEnd=function(b){if(!b||!b.state)return h;var O=b.state;return O.window&&(O.window=null),b.state=null,C},n.inflateGetHeader=function(b,O){var l;return b&&b.state?(2&(l=b.state).wrap)==0?h:((l.head=O).done=!1,C):h},n.inflateSetDictionary=function(b,O){var l,$=O.length;return b&&b.state?(l=b.state).wrap!==0&&l.mode!==11?h:l.mode===11&&o(1,O,$,0)!==l.check?-3:ee(b,O,$,$)?(l.mode=31,-4):(l.havedict=1,C):h},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var s=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],g=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(v,y,C,h,_,c,p,u){var I,x,D,E,z,T,V,k,j,ee=u.bits,b=0,O=0,l=0,$=0,ne=0,K=0,oe=0,W=0,ie=0,P=0,F=null,Q=0,q=new s.Buf16(16),G=new s.Buf16(16),he=null,fe=0;for(b=0;b<=15;b++)q[b]=0;for(O=0;O<h;O++)q[y[C+O]]++;for(ne=ee,$=15;1<=$&&q[$]===0;$--);if($<ne&&(ne=$),$===0)return _[c++]=20971520,_[c++]=20971520,u.bits=1,0;for(l=1;l<$&&q[l]===0;l++);for(ne<l&&(ne=l),b=W=1;b<=15;b++)if(W<<=1,(W-=q[b])<0)return-1;if(0<W&&(v===0||$!==1))return-1;for(G[1]=0,b=1;b<15;b++)G[b+1]=G[b]+q[b];for(O=0;O<h;O++)y[C+O]!==0&&(p[G[y[C+O]]++]=O);if(T=v===0?(F=he=p,19):v===1?(F=o,Q-=257,he=r,fe-=257,256):(F=d,he=g,-1),b=l,z=c,oe=O=P=0,D=-1,E=(ie=1<<(K=ne))-1,v===1&&852<ie||v===2&&592<ie)return 1;for(;;){for(V=b-oe,j=p[O]<T?(k=0,p[O]):p[O]>T?(k=he[fe+p[O]],F[Q+p[O]]):(k=96,0),I=1<<b-oe,l=x=1<<K;_[z+(P>>oe)+(x-=I)]=V<<24|k<<16|j|0,x!==0;);for(I=1<<b-1;P&I;)I>>=1;if(I!==0?(P&=I-1,P+=I):P=0,O++,--q[b]==0){if(b===$)break;b=y[C+p[O]]}if(ne<b&&(P&E)!==D){for(oe===0&&(oe=ne),z+=l,W=1<<(K=b-oe);K+oe<$&&!((W-=q[K+oe])<=0);)K++,W<<=1;if(ie+=1<<K,v===1&&852<ie||v===2&&592<ie)return 1;_[D=P&E]=ne<<24|K<<16|z-c|0}}return P!==0&&(_[z+P]=b-oe<<24|64<<16|0),u.bits=ne,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var s=t("../utils/common"),o=0,r=1;function d(m){for(var S=m.length;0<=--S;)m[S]=0}var g=0,v=29,y=256,C=y+1+v,h=30,_=19,c=2*C+1,p=15,u=16,I=7,x=256,D=16,E=17,z=18,T=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],V=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ee=new Array(2*(C+2));d(ee);var b=new Array(2*h);d(b);var O=new Array(512);d(O);var l=new Array(256);d(l);var $=new Array(v);d($);var ne,K,oe,W=new Array(h);function ie(m,S,R,L,M){this.static_tree=m,this.extra_bits=S,this.extra_base=R,this.elems=L,this.max_length=M,this.has_stree=m&&m.length}function P(m,S){this.dyn_tree=m,this.max_code=0,this.stat_desc=S}function F(m){return m<256?O[m]:O[256+(m>>>7)]}function Q(m,S){m.pending_buf[m.pending++]=255&S,m.pending_buf[m.pending++]=S>>>8&255}function q(m,S,R){m.bi_valid>u-R?(m.bi_buf|=S<<m.bi_valid&65535,Q(m,m.bi_buf),m.bi_buf=S>>u-m.bi_valid,m.bi_valid+=R-u):(m.bi_buf|=S<<m.bi_valid&65535,m.bi_valid+=R)}function G(m,S,R){q(m,R[2*S],R[2*S+1])}function he(m,S){for(var R=0;R|=1&m,m>>>=1,R<<=1,0<--S;);return R>>>1}function fe(m,S,R){var L,M,H=new Array(p+1),Y=0;for(L=1;L<=p;L++)H[L]=Y=Y+R[L-1]<<1;for(M=0;M<=S;M++){var Z=m[2*M+1];Z!==0&&(m[2*M]=he(H[Z]++,Z))}}function re(m){var S;for(S=0;S<C;S++)m.dyn_ltree[2*S]=0;for(S=0;S<h;S++)m.dyn_dtree[2*S]=0;for(S=0;S<_;S++)m.bl_tree[2*S]=0;m.dyn_ltree[2*x]=1,m.opt_len=m.static_len=0,m.last_lit=m.matches=0}function le(m){8<m.bi_valid?Q(m,m.bi_buf):0<m.bi_valid&&(m.pending_buf[m.pending++]=m.bi_buf),m.bi_buf=0,m.bi_valid=0}function me(m,S,R,L){var M=2*S,H=2*R;return m[M]<m[H]||m[M]===m[H]&&L[S]<=L[R]}function ue(m,S,R){for(var L=m.heap[R],M=R<<1;M<=m.heap_len&&(M<m.heap_len&&me(S,m.heap[M+1],m.heap[M],m.depth)&&M++,!me(S,L,m.heap[M],m.depth));)m.heap[R]=m.heap[M],R=M,M<<=1;m.heap[R]=L}function Pe(m,S,R){var L,M,H,Y,Z=0;if(m.last_lit!==0)for(;L=m.pending_buf[m.d_buf+2*Z]<<8|m.pending_buf[m.d_buf+2*Z+1],M=m.pending_buf[m.l_buf+Z],Z++,L===0?G(m,M,S):(G(m,(H=l[M])+y+1,S),(Y=T[H])!==0&&q(m,M-=$[H],Y),G(m,H=F(--L),R),(Y=V[H])!==0&&q(m,L-=W[H],Y)),Z<m.last_lit;);G(m,x,S)}function Fe(m,S){var R,L,M,H=S.dyn_tree,Y=S.stat_desc.static_tree,Z=S.stat_desc.has_stree,J=S.stat_desc.elems,ce=-1;for(m.heap_len=0,m.heap_max=c,R=0;R<J;R++)H[2*R]!==0?(m.heap[++m.heap_len]=ce=R,m.depth[R]=0):H[2*R+1]=0;for(;m.heap_len<2;)H[2*(M=m.heap[++m.heap_len]=ce<2?++ce:0)]=1,m.depth[M]=0,m.opt_len--,Z&&(m.static_len-=Y[2*M+1]);for(S.max_code=ce,R=m.heap_len>>1;1<=R;R--)ue(m,H,R);for(M=J;R=m.heap[1],m.heap[1]=m.heap[m.heap_len--],ue(m,H,1),L=m.heap[1],m.heap[--m.heap_max]=R,m.heap[--m.heap_max]=L,H[2*M]=H[2*R]+H[2*L],m.depth[M]=(m.depth[R]>=m.depth[L]?m.depth[R]:m.depth[L])+1,H[2*R+1]=H[2*L+1]=M,m.heap[1]=M++,ue(m,H,1),2<=m.heap_len;);m.heap[--m.heap_max]=m.heap[1],(function(ae,De){var Qe,Ae,et,pe,ht,yt,ze=De.dyn_tree,$t=De.max_code,rn=De.stat_desc.static_tree,an=De.stat_desc.has_stree,ln=De.stat_desc.extra_bits,Rt=De.stat_desc.extra_base,tt=De.stat_desc.max_length,ut=0;for(pe=0;pe<=p;pe++)ae.bl_count[pe]=0;for(ze[2*ae.heap[ae.heap_max]+1]=0,Qe=ae.heap_max+1;Qe<c;Qe++)tt<(pe=ze[2*ze[2*(Ae=ae.heap[Qe])+1]+1]+1)&&(pe=tt,ut++),ze[2*Ae+1]=pe,$t<Ae||(ae.bl_count[pe]++,ht=0,Rt<=Ae&&(ht=ln[Ae-Rt]),yt=ze[2*Ae],ae.opt_len+=yt*(pe+ht),an&&(ae.static_len+=yt*(rn[2*Ae+1]+ht)));if(ut!==0){do{for(pe=tt-1;ae.bl_count[pe]===0;)pe--;ae.bl_count[pe]--,ae.bl_count[pe+1]+=2,ae.bl_count[tt]--,ut-=2}while(0<ut);for(pe=tt;pe!==0;pe--)for(Ae=ae.bl_count[pe];Ae!==0;)$t<(et=ae.heap[--Qe])||(ze[2*et+1]!==pe&&(ae.opt_len+=(pe-ze[2*et+1])*ze[2*et],ze[2*et+1]=pe),Ae--)}})(m,S),fe(H,ce,m.bl_count)}function a(m,S,R){var L,M,H=-1,Y=S[1],Z=0,J=7,ce=4;for(Y===0&&(J=138,ce=3),S[2*(R+1)+1]=65535,L=0;L<=R;L++)M=Y,Y=S[2*(L+1)+1],++Z<J&&M===Y||(Z<ce?m.bl_tree[2*M]+=Z:M!==0?(M!==H&&m.bl_tree[2*M]++,m.bl_tree[2*D]++):Z<=10?m.bl_tree[2*E]++:m.bl_tree[2*z]++,H=M,ce=(Z=0)===Y?(J=138,3):M===Y?(J=6,3):(J=7,4))}function B(m,S,R){var L,M,H=-1,Y=S[1],Z=0,J=7,ce=4;for(Y===0&&(J=138,ce=3),L=0;L<=R;L++)if(M=Y,Y=S[2*(L+1)+1],!(++Z<J&&M===Y)){if(Z<ce)for(;G(m,M,m.bl_tree),--Z!=0;);else M!==0?(M!==H&&(G(m,M,m.bl_tree),Z--),G(m,D,m.bl_tree),q(m,Z-3,2)):Z<=10?(G(m,E,m.bl_tree),q(m,Z-3,3)):(G(m,z,m.bl_tree),q(m,Z-11,7));H=M,ce=(Z=0)===Y?(J=138,3):M===Y?(J=6,3):(J=7,4)}}d(W);var A=!1;function f(m,S,R,L){q(m,(g<<1)+(L?1:0),3),(function(M,H,Y,Z){le(M),Q(M,Y),Q(M,~Y),s.arraySet(M.pending_buf,M.window,H,Y,M.pending),M.pending+=Y})(m,S,R)}n._tr_init=function(m){A||((function(){var S,R,L,M,H,Y=new Array(p+1);for(M=L=0;M<v-1;M++)for($[M]=L,S=0;S<1<<T[M];S++)l[L++]=M;for(l[L-1]=M,M=H=0;M<16;M++)for(W[M]=H,S=0;S<1<<V[M];S++)O[H++]=M;for(H>>=7;M<h;M++)for(W[M]=H<<7,S=0;S<1<<V[M]-7;S++)O[256+H++]=M;for(R=0;R<=p;R++)Y[R]=0;for(S=0;S<=143;)ee[2*S+1]=8,S++,Y[8]++;for(;S<=255;)ee[2*S+1]=9,S++,Y[9]++;for(;S<=279;)ee[2*S+1]=7,S++,Y[7]++;for(;S<=287;)ee[2*S+1]=8,S++,Y[8]++;for(fe(ee,C+1,Y),S=0;S<h;S++)b[2*S+1]=5,b[2*S]=he(S,5);ne=new ie(ee,T,y+1,C,p),K=new ie(b,V,0,h,p),oe=new ie(new Array(0),k,0,_,I)})(),A=!0),m.l_desc=new P(m.dyn_ltree,ne),m.d_desc=new P(m.dyn_dtree,K),m.bl_desc=new P(m.bl_tree,oe),m.bi_buf=0,m.bi_valid=0,re(m)},n._tr_stored_block=f,n._tr_flush_block=function(m,S,R,L){var M,H,Y=0;0<m.level?(m.strm.data_type===2&&(m.strm.data_type=(function(Z){var J,ce=4093624447;for(J=0;J<=31;J++,ce>>>=1)if(1&ce&&Z.dyn_ltree[2*J]!==0)return o;if(Z.dyn_ltree[18]!==0||Z.dyn_ltree[20]!==0||Z.dyn_ltree[26]!==0)return r;for(J=32;J<y;J++)if(Z.dyn_ltree[2*J]!==0)return r;return o})(m)),Fe(m,m.l_desc),Fe(m,m.d_desc),Y=(function(Z){var J;for(a(Z,Z.dyn_ltree,Z.l_desc.max_code),a(Z,Z.dyn_dtree,Z.d_desc.max_code),Fe(Z,Z.bl_desc),J=_-1;3<=J&&Z.bl_tree[2*j[J]+1]===0;J--);return Z.opt_len+=3*(J+1)+5+5+4,J})(m),M=m.opt_len+3+7>>>3,(H=m.static_len+3+7>>>3)<=M&&(M=H)):M=H=R+5,R+4<=M&&S!==-1?f(m,S,R,L):m.strategy===4||H===M?(q(m,2+(L?1:0),3),Pe(m,ee,b)):(q(m,4+(L?1:0),3),(function(Z,J,ce,ae){var De;for(q(Z,J-257,5),q(Z,ce-1,5),q(Z,ae-4,4),De=0;De<ae;De++)q(Z,Z.bl_tree[2*j[De]+1],3);B(Z,Z.dyn_ltree,J-1),B(Z,Z.dyn_dtree,ce-1)})(m,m.l_desc.max_code+1,m.d_desc.max_code+1,Y+1),Pe(m,m.dyn_ltree,m.dyn_dtree)),re(m),L&&le(m)},n._tr_tally=function(m,S,R){return m.pending_buf[m.d_buf+2*m.last_lit]=S>>>8&255,m.pending_buf[m.d_buf+2*m.last_lit+1]=255&S,m.pending_buf[m.l_buf+m.last_lit]=255&R,m.last_lit++,S===0?m.dyn_ltree[2*R]++:(m.matches++,S--,m.dyn_ltree[2*(l[R]+y+1)]++,m.dyn_dtree[2*F(S)]++),m.last_lit===m.lit_bufsize-1},n._tr_align=function(m){q(m,2,3),G(m,x,ee),(function(S){S.bi_valid===16?(Q(S,S.bi_buf),S.bi_buf=0,S.bi_valid=0):8<=S.bi_valid&&(S.pending_buf[S.pending++]=255&S.bi_buf,S.bi_buf>>=8,S.bi_valid-=8)})(m)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(s){(function(o,r){if(!o.setImmediate){var d,g,v,y,C=1,h={},_=!1,c=o.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(o);p=p&&p.setTimeout?p:o,d={}.toString.call(o.process)==="[object process]"?function(D){process.nextTick(function(){I(D)})}:(function(){if(o.postMessage&&!o.importScripts){var D=!0,E=o.onmessage;return o.onmessage=function(){D=!1},o.postMessage("","*"),o.onmessage=E,D}})()?(y="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",x,!1):o.attachEvent("onmessage",x),function(D){o.postMessage(y+D,"*")}):o.MessageChannel?((v=new MessageChannel).port1.onmessage=function(D){I(D.data)},function(D){v.port2.postMessage(D)}):c&&"onreadystatechange"in c.createElement("script")?(g=c.documentElement,function(D){var E=c.createElement("script");E.onreadystatechange=function(){I(D),E.onreadystatechange=null,g.removeChild(E),E=null},g.appendChild(E)}):function(D){setTimeout(I,0,D)},p.setImmediate=function(D){typeof D!="function"&&(D=new Function(""+D));for(var E=new Array(arguments.length-1),z=0;z<E.length;z++)E[z]=arguments[z+1];var T={callback:D,args:E};return h[C]=T,d(C),C++},p.clearImmediate=u}function u(D){delete h[D]}function I(D){if(_)setTimeout(I,0,D);else{var E=h[D];if(E){_=!0;try{(function(z){var T=z.callback,V=z.args;switch(V.length){case 0:T();break;case 1:T(V[0]);break;case 2:T(V[0],V[1]);break;case 3:T(V[0],V[1],V[2]);break;default:T.apply(r,V)}})(E)}finally{u(D),_=!1}}}}function x(D){D.source===o&&typeof D.data=="string"&&D.data.indexOf(y)===0&&I(+D.data.slice(y.length))}})(typeof self>"u"?s===void 0?this:s:self)}).call(this,typeof pt<"u"?pt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(vt)),vt.exports}var Zn=jn();const Jt=Fn(Zn);class ot{constructor(e,t,i){this.errorCode=e,this.fileSystemItem=t,this.errorText=i}}const ge={NoAccess:0,FileExists:1,FileNotFound:2,DirectoryExists:3,DirectoryNotFound:4,WrongFileExtension:5,MaxFileSizeExceeded:6,InvalidSymbols:7,Other:32767},bt=ct();class Qt extends It{constructor(e){e=Ie(e,{}),super(e);const t=e.data;if(t&&!Array.isArray(t))throw En.Error("E4006");const i=e.itemsExpr||"items";this._subFileItemsGetter=Oe(i),this._subFileItemsSetter=this._getSetter(i);const n=e.contentExpr||"content";this._contentGetter=Oe(n),this._contentSetter=this._getSetter(n);const s=this._getNameExpr(e);this._nameSetter=this._getSetter(s);const o=this._getIsDirExpr(e);this._getIsDirSetter=this._getSetter(o);const r=this._getKeyExpr(e);this._keySetter=this._getSetter(r);const d=this._getSizeExpr(e);this._sizeSetter=this._getSetter(d);const g=this._getDateModifiedExpr(e);this._dateModifiedSetter=this._getSetter(g),this._data=t||[]}getItems(e){return this._executeActionAsDeferred((()=>this._getItems(e)),!0)}renameItem(e,t){return this._executeActionAsDeferred((()=>this._renameItemCore(e,t)))}_renameItemCore(e,t){if(!e)return;const i=this._findDataObject(e);this._nameSetter(i,t),e.name=t,e.key=this._ensureDataObjectKey(i)}createDirectory(e,t){return this._executeActionAsDeferred((()=>{this._validateDirectoryExists(e),this._createDataObject(e,t,!0)}))}deleteItems(e){return e.map((t=>this._executeActionAsDeferred((()=>this._deleteItem(t)))))}moveItems(e,t){const i=this._findDataObject(t),n=this._getDirectoryDataItems(i);return e.map((o=>this._executeActionAsDeferred((()=>{this._checkAbilityToMoveOrCopyItem(o,t);const r=this._findDataObject(o);this._deleteItem(o),n.push(r)}))))}copyItems(e,t){const i=this._findDataObject(t),n=this._getDirectoryDataItems(i);return e.map((o=>this._executeActionAsDeferred((()=>{this._checkAbilityToMoveOrCopyItem(o,t);const r=this._findDataObject(o),d=this._createCopy(r);n.push(d)}))))}uploadFileChunk(e,t,i){if(t.chunkIndex>0)return t.customData.deferred;this._validateDirectoryExists(i);const n=t.customData.deferred=new te,s=this._createFileReader();return s.readAsDataURL(e),s.onload=()=>{const o=s.result.split(",")[1],r=this._createDataObject(i,e.name,!1);this._sizeSetter(r,e.size),this._dateModifiedSetter(r,e.lastModifiedDate),this._contentSetter(r,o),n.resolve()},s.onerror=o=>n.reject(o),n}downloadItems(e){e.length===1?this._downloadSingleFile(e[0]):this._downloadMultipleFiles(e)}_downloadSingleFile(e){const t=this._getFileContent(e),i=bt.atob(t),n=new ArrayBuffer(i.length),s=new Uint8Array(n);for(let r=0;r<i.length;r++)s[r]=i.charCodeAt(r);const o=new bt.Blob([n],{type:"application/octet-stream"});jt.saveAs(e.name,null,o)}_downloadMultipleFiles(e){const t=Gn(),i=new t;e.forEach((o=>i.file(o.name,this._getFileContent(o),{base64:!0})));const n={type:"blob",compression:"DEFLATE",mimeType:"application/zip"},s=new te;i.generateAsync?i.generateAsync(n).then(s.resolve):s.resolve(i.generate(n)),s.done((o=>jt.saveAs("files.zip",null,o)))}_getFileContent(e){const t=this._findDataObject(e);return this._contentGetter(t)||""}_validateDirectoryExists(e){if(!this._isFileItemExists(e)||this._isDirGetter(e.fileItem))throw new ot(ge.DirectoryNotFound,e)}_checkAbilityToMoveOrCopyItem(e,t){const i=this._findDataObject(e),n=this._getKeyFromDataObject(i,e.parentPath),s=t.getFullPathInfo();let o="";s.forEach((r=>{if(o=Be(o,r.name),this._getDataObjectKey(r.key,o)===n)throw new ot(ge.Other,e)}))}_createDataObject(e,t,i){const n={};this._nameSetter(n,t),this._getIsDirSetter(n,i),this._keySetter(n,String(new Le));const s=this._findDataObject(e);return this._getDirectoryDataItems(s).push(n),n}_createCopy(e){const t={};this._nameSetter(t,this._nameGetter(e)),this._getIsDirSetter(t,this._isDirGetter(e));const i=this._subFileItemsGetter(e);if(Array.isArray(i)){const n=[];i.forEach((s=>{const o=this._createCopy(s);n.push(o)})),this._subFileItemsSetter(t,n)}return t}_deleteItem(e){const t=this._findDataObject(e),i=this._findFileItemObj(e.pathInfo),n=this._getDirectoryDataItems(i),s=n.indexOf(t);n.splice(s,1)}_getDirectoryDataItems(e){if(!e)return this._data;let t=this._subFileItemsGetter(e);return Array.isArray(t)||(t=[],this._subFileItemsSetter(e,t)),t}_getItems(e){this._validateDirectoryExists(e);const t=e.getFullPathInfo(),i=t&&t.length>0?t[t.length-1].key:null;let n=this._data;if(i){const s=this._findFileItemObj(t);n=s&&this._subFileItemsGetter(s)||[]}return this._ensureKeysForDuplicateNameItems(n),this._convertDataObjectsToFileItems(n,t)}_ensureKeysForDuplicateNameItems(e){const t={};e.forEach((i=>{const n=this._nameGetter(i);t[n]?this._ensureDataObjectKey(i):t[n]=!0}))}_findDataObject(e){if(e.isRoot())return null;const t=this._findFileItemObj(e.getFullPathInfo());if(!t){const i=e.isDirectory?ge.DirectoryNotFound:ge.FileNotFound;throw new ot(i,e)}return t}_findFileItemObj(e){Array.isArray(e)||(e=[]);let t="",i=null,n=this._data;for(let s=0;s<e.length&&(s===0||i);s++)i=n.find((o=>{const r=this._isDirGetter(o)||s===e.length-1;return this._getKeyFromDataObject(o,t)===e[s].key&&this._nameGetter(o)===e[s].name&&r})),i&&(t=Be(t,this._nameGetter(i)),n=this._subFileItemsGetter(i));return i}_getKeyFromDataObject(e,t){const i=this._keyGetter(e),n=Be(t,this._nameGetter(e));return this._getDataObjectKey(i,n)}_getDataObjectKey(e,t){return e||t}_ensureDataObjectKey(e){let t=this._keyGetter(e);return t||(t=String(new Le),this._keySetter(e,t)),t}_hasSubDirs(e){const t=Ie(this._subFileItemsGetter(e),[]);if(!Array.isArray(t))return!0;for(let i=0;i<t.length;i++)if(this._isDirGetter(t[i])===!0)return!0;return!1}_getSetter(e){return xe(e)?e:dn(e)}_isFileItemExists(e){return e.isDirectory&&e.isRoot()||!!this._findFileItemObj(e.getFullPathInfo())}_createFileReader(){return new bt.FileReader}}function Gn(){if(!Jt)throw yn.Error("E1041","JSZip");return Jt}const qn=ct(),Yn="chunk",Te={GET_DIR_CONTENTS:"GetDirContents",CREATE_DIR:"CreateDir",RENAME:"Rename",MOVE:"Move",COPY:"Copy",REMOVE:"Remove",UPLOAD_CHUNK:"UploadChunk",ABORT_UPLOAD:"AbortUpload",DOWLOAD:"Download"},nt={GET:"GET",POST:"POST"};class Xn extends It{constructor(e){e=Ie(e,{}),super(e),this._endpointUrl=e.endpointUrl,this._beforeAjaxSend=e.beforeAjaxSend,this._beforeSubmit=e.beforeSubmit,this._requestHeaders=e.requestHeaders,this._hasSubDirsGetter=Oe(e.hasSubDirectoriesExpr||"hasSubDirectories")}getItems(e){const t=e.getFullPathInfo();return this._executeRequest(Te.GET_DIR_CONTENTS,{pathInfo:t}).then((i=>this._convertDataObjectsToFileItems(i.result,t)))}renameItem(e,t){return this._executeRequest(Te.RENAME,{pathInfo:e.getFullPathInfo(),isDirectory:e.isDirectory,name:t})}createDirectory(e,t){return this._executeRequest(Te.CREATE_DIR,{pathInfo:e.getFullPathInfo(),name:t})}deleteItems(e){return e.map((t=>this._executeRequest(Te.REMOVE,{pathInfo:t.getFullPathInfo(),isDirectory:t.isDirectory})))}moveItems(e,t){return e.map((i=>this._executeRequest(Te.MOVE,{sourcePathInfo:i.getFullPathInfo(),sourceIsDirectory:i.isDirectory,destinationPathInfo:t.getFullPathInfo()})))}copyItems(e,t){return e.map((i=>this._executeRequest(Te.COPY,{sourcePathInfo:i.getFullPathInfo(),sourceIsDirectory:i.isDirectory,destinationPathInfo:t.getFullPathInfo()})))}uploadFileChunk(e,t,i){t.chunkIndex===0&&(t.customData.uploadId=new Le);const n={destinationPathInfo:i.getFullPathInfo(),chunkMetadata:JSON.stringify({UploadId:t.customData.uploadId,FileName:e.name,Index:t.chunkIndex,TotalCount:t.chunkCount,FileSize:e.size})},s={url:this._endpointUrl,headers:this._requestHeaders||{},method:nt.POST,dataType:"json",data:{[Yn]:t.chunkBlob,arguments:JSON.stringify(n),command:Te.UPLOAD_CHUNK},upload:{onprogress:Ee,onloadstart:Ee,onabort:Ee},xhrFields:{},cache:!1},o=new te;return this._beforeSendInternal(s),st.sendRequest(s).done((r=>{!r.success&&o.reject(r)||o.resolve()})).fail(o.reject),o.promise()}abortFileUpload(e,t,i){return this._executeRequest(Te.ABORT_UPLOAD,{uploadId:t.customData.uploadId})}downloadItems(e){const t=this._getDownloadArgs(e),i=w("<form>").css({display:"none"}).attr({method:nt.POST,action:t.url}),n={command:t.command,arguments:t.arguments};this._beforeSubmitInternal(n),this._appendFormDataInputsToForm(n,i),i.appendTo("body"),de.trigger(i,"submit"),setTimeout((()=>i.remove()))}getItemsContent(e){const t=this._getDownloadArgs(e),i={url:t.url,headers:this._requestHeaders||{},method:nt.POST,responseType:"arraybuffer",data:{command:t.command,arguments:t.arguments},upload:{onprogress:Ee,onloadstart:Ee,onabort:Ee},xhrFields:{},cache:!1};return this._beforeSendInternal(i),st.sendRequest(i)}_getDownloadArgs(e){const i={pathInfoList:e.map((s=>s.getFullPathInfo()))},n=JSON.stringify(i);return{url:this._endpointUrl,arguments:n,command:Te.DOWLOAD}}_getItemsIds(e){return e.map((t=>t.relativeName))}_executeRequest(e,t){const i=e===Te.GET_DIR_CONTENTS?nt.GET:nt.POST,n=new te,s={url:this._getEndpointUrl(e,t),headers:this._requestHeaders||{},method:i,dataType:"json",data:{},xhrFields:{},cache:!1};return this._beforeSendInternal(s),st.sendRequest(s).then((o=>{!o.success&&n.reject(o)||n.resolve(o)}),(o=>n.reject(o))),n.promise()}_beforeSubmitInternal(e){xe(this._beforeSubmit)&&this._beforeSubmit({formData:e})}_beforeSendInternal(e){if(xe(this._beforeAjaxSend)){const t={headers:e.headers,formData:e.data,xhrFields:e.xhrFields};this._beforeAjaxSend(t),e.headers=t.headers,e.data=t.formData,e.xhrFields=t.xhrFields}di(e.data)?delete e.data:(e.responseType||e.upload)&&(e.data=this._createFormData(e.data))}_createFormData(e){const t=new qn.FormData;for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&se(e[i])&&t.append(i,e[i]);return t}_appendFormDataInputsToForm(e,t){for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&se(e[i])&&w("<input>").attr({type:"hidden",name:i,value:e[i]}).appendTo(t)}_getEndpointUrl(e,t){const i=this._getQueryString({command:e,arguments:JSON.stringify(t)}),n=this._endpointUrl&&this._endpointUrl.indexOf("?")>0?"&":"?";return this._endpointUrl+n+i}_getQueryString(e){const t=[],i=Object.keys(e);for(let n=0;n<i.length;n++){const s=i[n];let o=e[s];if(o!==void 0)if(o===null&&(o=""),Array.isArray(o))this._processQueryStringArrayParam(s,o,t);else{const r=this._getQueryStringPair(s,o);t.push(r)}}return t.join("&")}_processQueryStringArrayParam(e,t,i){lt(t,((n,s)=>{const o=this._getQueryStringPair(e,s);i.push(o)}))}_getQueryStringPair(e,t){return encodeURIComponent(e)+"="+encodeURIComponent(t)}_hasSubDirs(e){const t=this._hasSubDirsGetter(e);return typeof t=="boolean"?t:!0}_getKeyExpr(e){return e.keyExpr||"key"}}class Jn extends It{constructor(e){e=Ie(e,{}),super(e),this._hasSubDirsGetter=Oe(e.hasSubDirectoriesExpr||"hasSubDirectories"),this._getItemsFunction=this._ensureFunction(e.getItems,(()=>[])),this._renameItemFunction=this._ensureFunction(e.renameItem),this._createDirectoryFunction=this._ensureFunction(e.createDirectory),this._deleteItemFunction=this._ensureFunction(e.deleteItem),this._moveItemFunction=this._ensureFunction(e.moveItem),this._copyItemFunction=this._ensureFunction(e.copyItem),this._uploadFileChunkFunction=this._ensureFunction(e.uploadFileChunk),this._abortFileUploadFunction=this._ensureFunction(e.abortFileUpload),this._downloadItemsFunction=this._ensureFunction(e.downloadItems),this._getItemsContentFunction=this._ensureFunction(e.getItemsContent)}getItems(e){const t=e.getFullPathInfo();return this._executeActionAsDeferred((()=>this._getItemsFunction(e)),!0).then((i=>this._convertDataObjectsToFileItems(i,t)))}renameItem(e,t){return this._executeActionAsDeferred((()=>this._renameItemFunction(e,t)))}createDirectory(e,t){return this._executeActionAsDeferred((()=>this._createDirectoryFunction(e,t)))}deleteItems(e){return e.map((t=>this._executeActionAsDeferred((()=>this._deleteItemFunction(t)))))}moveItems(e,t){return e.map((i=>this._executeActionAsDeferred((()=>this._moveItemFunction(i,t)))))}copyItems(e,t){return e.map((i=>this._executeActionAsDeferred((()=>this._copyItemFunction(i,t)))))}uploadFileChunk(e,t,i){return this._executeActionAsDeferred((()=>this._uploadFileChunkFunction(e,t,i)))}abortFileUpload(e,t,i){return this._executeActionAsDeferred((()=>this._abortFileUploadFunction(e,t,i)))}downloadItems(e){return this._executeActionAsDeferred((()=>this._downloadItemsFunction(e)))}getItemsContent(e){return this._executeActionAsDeferred((()=>this._getItemsContentFunction(e)))}_hasSubDirs(e){const t=this._hasSubDirsGetter(e);return typeof t=="boolean"?t:!0}_getKeyExpr(e){return e.keyExpr||"key"}_ensureFunction(e,t){return t=t||Ee,xe(e)?e:t}}const Je={NAVIGATION:"navigation",REFRESH:"refresh"};class Qn{constructor(e){e=e||{},this._options=X({},e),this._isInitialized=!1,this._dataLoading=!1,this._dataLoadingDeferred=null,this._rootDirectoryInfo=this._createRootDirectoryInfo(e.rootText),this._currentDirectoryInfo=this._rootDirectoryInfo,this._defaultIconMap=this._createDefaultIconMap(),this.startSingleLoad(),this._setSecurityController(),this._setProvider(e.fileProvider),this._initialize()}_initialize(){const e=this._options.currentPathKeys&&this._options.currentPathKeys.length?this.setCurrentPathByKeys(this._options.currentPathKeys):this.setCurrentPath(this._options.currentPath),t=()=>{this._isInitialized=!0,this._raiseInitialized()};e?_e(e).always(t):t()}_setSecurityController(){this._securityController=new es({allowedFileExtensions:this._options.allowedFileExtensions,maxFileSize:this._options.uploadMaxFileSize}),this._resetState()}setAllowedFileExtensions(e){se(e)&&(this._options.allowedFileExtensions=e),this._setSecurityController(),this.refresh()}setUploadOptions(e){let{maxFileSize:t,chunkSize:i}=e;se(i)&&(this._options.uploadChunkSize=i),se(t)&&(this._options.uploadMaxFileSize=t,this._setSecurityController(),this.refresh())}_setProvider(e){this._fileProvider=this._createFileProvider(e),this._resetState()}updateProvider(e,t){return se(t)?_e(this._getDirectoryByPathParts(this._rootDirectoryInfo,t,!0)).then((i=>{i!==this._rootDirectoryInfo&&this._resetCurrentDirectory(),this._setProvider(e)})).then((()=>this.setCurrentPathByKeys(t))):this._updateProviderOnly(e)}_updateProviderOnly(e){return this._resetCurrentDirectory(),this._setProvider(e),_e(this.refresh())}_createFileProvider(e){if(e||(e=[]),Array.isArray(e))return new Qt({data:e});if(e instanceof It)return e;switch(e.type){case"remote":return new Xn(e);case"custom":return new Jn(e)}return new Qt(e)}setCurrentPath(e){const t=Di(e),i=Be(...t);return this.getCurrentDirectory().fileItem.relativeName===i?new te().resolve().promise():this._setCurrentDirectoryByPathParts(t)}setCurrentPathByKeys(e){return ci(this.getCurrentDirectory().fileItem.pathKeys,e)?new te().resolve().promise():this._setCurrentDirectoryByPathParts(e,!0)}getCurrentPath(){let e="",t=this.getCurrentDirectory();for(;t&&!t.fileItem.isRoot();){const i=Ft(t.fileItem.name);e=Be(i,e),t=t.parentDirectory}return e}getCurrentPathKeys(){return this.getCurrentDirectory().fileItem.pathKeys}getCurrentDirectory(){return this._currentDirectoryInfo}setCurrentDirectory(e,t){if(!e)return;if(t&&(e=this._getActualDirectoryInfo(e)),this._currentDirectoryInfo&&this._currentDirectoryInfo===e){this._raisePathPotentiallyChanged();return}const i=this._currentDirectoryInfo.fileItem.key!==e.fileItem.key;this._currentDirectoryInfo=e,i&&this._isInitialized&&(this._dataLoading||this._raiseDataLoading(Je.NAVIGATION),this._raiseSelectedDirectoryChanged(e))}_resetCurrentDirectory(){this._currentDirectoryInfo=this._rootDirectoryInfo}getCurrentItems(e){return this._dataLoadingDeferred?this._dataLoadingDeferred.then((()=>this._getCurrentItemsInternal(e))):this._getCurrentItemsInternal(e)}_getCurrentItemsInternal(e){const t=this.getCurrentDirectory();return this.getDirectoryContents(t).then((n=>{const s=this._separateItemsByType(n);return t.fileItem.hasSubDirectories=!!s.folders.length,e?s.files:n}))}getDirectories(e,t){return this.getDirectoryContents(e,t).then((i=>i.filter((n=>n.fileItem.isDirectory))))}_separateItemsByType(e){const t=[],i=[];return e.forEach((n=>n.fileItem.isDirectory?t.push(n):i.push(n))),{folders:t,files:i}}getDirectoryContents(e,t){if(!e)return new te().resolve([this._rootDirectoryInfo]).promise();if(e.itemsLoaded)return new te().resolve(e.items).promise();if(this._singleOperationLockId&&e.itemsSingleLoadErrorId===this._singleOperationLockId)return this._changeDirectoryOnError(e,t,!0),new te().reject().promise();const i=e.getInternalKey();let n=this._loadedItems[i];return n||(n=this._getFileItems(e,t).then((s=>(s=s||[],e.items=s.map((o=>o.isDirectory&&this._createDirectoryInfo(o,e)||this._createFileInfo(o,e))),e.itemsLoaded=!0,e.items)),(()=>(this._singleOperationLockId&&e.itemsSingleLoadErrorId!==this._singleOperationLockId&&(e.itemsSingleLoadErrorId=this._singleOperationLockId),[]))),this._loadedItems[i]=n,n.always((()=>{delete this._loadedItems[i]})),n)}_getFileItems(e,t){let i=null;try{i=this._fileProvider.getItems(e.fileItem)}catch(n){return this._handleItemLoadError(e,n,t)}return _e(i).then((n=>this._securityController.getAllowedItems(n)),(n=>this._handleItemLoadError(e,n,t)))}createDirectory(e,t){const i=e.fileItem,n=this._createDirInfoByName(t,e),s=this._createEditActionInfo("create",n,e);return this._processEditAction(s,(o=>{o.parentDirectory=i,o.name=t,this._editingEvents.onDirectoryCreating(o)}),(()=>this._fileProvider.createDirectory(i,t).done((o=>(i.isRoot()||(i.hasSubDirectories=!0),o)))),(()=>{const o={parentDirectory:i,name:t};this._editingEvents.onDirectoryCreated(o)}),(()=>this._resetDirectoryState(e,!0)))}renameItem(e,t){const i=e.fileItem.createClone(),n=this._createEditActionInfo("rename",e,e.parentDirectory,{itemNewName:t});return this._processEditAction(n,((s,o)=>{o.fileItem.isDirectory||this._securityController.validateExtension(t),s.item=i,s.newName=t,this._editingEvents.onItemRenaming(s)}),(s=>this._fileProvider.renameItem(s,t)),(()=>{const s={sourceItem:i,itemName:t};this._editingEvents.onItemRenamed(s)}),(()=>{const s=this._getActualDirectoryInfo(e.parentDirectory);this._resetDirectoryState(s),this.setCurrentDirectory(s)}))}moveItems(e,t){const i=this._createEditActionInfo("move",e,t);return this._processEditAction(i,((n,s)=>{n.item=s.fileItem,n.destinationDirectory=t.fileItem,this._editingEvents.onItemMoving(n)}),(n=>this._fileProvider.moveItems([n],t.fileItem)),(n=>{const s={sourceItem:n.fileItem,parentDirectory:t.fileItem,itemName:n.fileItem.name,itemPath:Be(t.fileItem.path,n.fileItem.name)};this._editingEvents.onItemMoved(s)}),(n=>{e.forEach((s=>this._resetDirectoryState(s.parentDirectory,!0))),n&&(this._resetDirectoryState(t),this.setCurrentPathByKeys(t.fileItem.pathKeys),t.expanded=!0)}))}copyItems(e,t){const i=this._createEditActionInfo("copy",e,t);return this._processEditAction(i,((n,s)=>{n.item=s.fileItem,n.destinationDirectory=t.fileItem,this._editingEvents.onItemCopying(n)}),(n=>this._fileProvider.copyItems([n],t.fileItem)),(n=>{const s={sourceItem:n.fileItem,parentDirectory:t.fileItem,itemName:n.fileItem.name,itemPath:Be(t.fileItem.path,n.fileItem.name)};this._editingEvents.onItemCopied(s)}),(n=>{n&&(t=this._getActualDirectoryInfo(t),this._resetDirectoryState(t),this.setCurrentDirectory(t),t.expanded=!0)}))}deleteItems(e){const t=e.length>0?e[0].parentDirectory:null,i=this._createEditActionInfo("delete",e,t);return this._processEditAction(i,((n,s)=>{n.item=s.fileItem,this._editingEvents.onItemDeleting(n)}),(n=>this._fileProvider.deleteItems([n])),(n=>this._editingEvents.onItemDeleted({item:n.fileItem})),(()=>{e.forEach((n=>{const s=this._getActualDirectoryInfo(n.parentDirectory);this._resetDirectoryState(s),this.setCurrentDirectory(s)}))}))}processUploadSession(e,t){const i=this._getItemInfosForUploaderFiles(e.files,t),n=this._createEditActionInfo("upload",i,t,{sessionInfo:e});return this._processEditAction(n,(()=>{}),((s,o)=>e.deferreds[o]),(()=>{}),(()=>this._resetDirectoryState(t,!0)))}uploadFileChunk(e,t,i){let n=null;t.chunkIndex===0?(this._securityController.validateMaxFileSize(e.size),this._securityController.validateExtension(e.name),n=this._processBeforeItemEditAction((o=>{o.fileData=e,o.destinationDirectory=i,this._editingEvents.onFileUploading(o)}))):n=new te().resolve().promise();let s=n.then((()=>this._fileProvider.uploadFileChunk(e,t,i)));return t.chunkIndex===t.chunkCount-1&&(s=s.done((()=>{const o={fileData:e,parentDirectory:i};this._editingEvents.onFileUploaded(o)}))),s}abortFileUpload(e,t,i){return _e(this._fileProvider.abortFileUpload(e,t,i))}getFileUploadChunkSize(){const e=this._options.uploadChunkSize;return e&&e>0?e:this._fileProvider.getFileUploadChunkSize()}downloadItems(e){const t=e.map((i=>this._processBeforeItemEditAction((n=>{n.item=i.fileItem,this._editingEvents.onItemDownloading(n)}),i)));return _e(...t).then((()=>{const i=e.map((n=>n.fileItem));return _e(this._getItemActionResult(this._fileProvider.downloadItems(i))).then((()=>{}),(n=>{this._raiseDownloadItemsError(e,e[0].parentDirectory,n)}))}),(i=>{this._raiseDownloadItemsError(e,e[0].parentDirectory,i)}))}getItemContent(e){const t=e.map((i=>i.fileItem));return _e(this._fileProvider.getItemsContent(t))}_handleItemLoadError(e,t,i){return e=this._getActualDirectoryInfo(e),this._raiseGetItemsError(e,t),this._changeDirectoryOnError(e,i),new te().reject().promise()}_raiseGetItemsError(e,t){const i=this._createEditActionInfo("getItems",e,e);this._raiseEditActionStarting(i),this._raiseEditActionResultAcquired(i),this._raiseEditActionError(i,{errorCode:t.errorCode,errorText:t.errorText,fileItem:e.fileItem,index:0})}_raiseDownloadItemsError(e,t,i){const n=this._createEditActionInfo("download",e,t),s=e.length;n.singleRequest=s===1,this._raiseEditActionStarting(n),this._raiseEditActionResultAcquired(n);for(let o=0;o<s-1;o++)this._raiseEditActionItemError(n,{errorCode:i.errorCode,errorText:i.errorText,fileItem:e[o].fileItem,index:o});this._raiseEditActionError(n,{errorCode:i.errorCode,errorText:i.errorText,fileItem:e[s-1].fileItem,index:s-1})}_changeDirectoryOnError(e,t,i){i&&(e=this._getActualDirectoryInfo(e)),this._resetDirectoryState(e),e.expanded=!1,t||this.setCurrentDirectory(e.parentDirectory)}_getItemActionResult(e){return Array.isArray(e)?e[0]:e}_processEditAction(e,t,i,n,s){let o=!1;this._raiseEditActionStarting(e);const r=e.itemInfos.map(((d,g)=>this._processBeforeItemEditAction(t,d).then((()=>this._getItemActionResult(i(d.fileItem,g)).done((()=>n(d)))))));return e.singleRequest=r.length===1,this._raiseEditActionResultAcquired(e),Dt(r,(d=>{o=!0,this._raiseCompleteEditActionItem(e,d)}),(d=>this._raiseEditActionItemError(e,d))).then((()=>{s(o),this._raiseCompleteEditAction(e)}))}_createEditActionInfo(e,t,i,n){t=Array.isArray(t)?t:[t],n=n||{};const s=t.map((o=>o.fileItem));return{name:e,itemInfos:t,items:s,directory:i,customData:n,singleRequest:!0}}_processBeforeItemEditAction(e,t){const i=new te,n=this._createBeforeActionArgs();try{e(n,t)}catch(s){return i.reject(s).promise()}if(!n.cancel)i.resolve();else{if(n.cancel===!0)return i.reject({errorText:n.errorText,errorCode:n.errorCode});li(n.cancel)&&_e(n.cancel).then((s=>{s===!0?i.reject():cn(s)&&s.cancel===!0&&i.reject({errorText:s.errorText,errorCode:s.errorCode}),i.resolve()}),i.resolve)}return i.promise()}_createBeforeActionArgs(){return{errorCode:void 0,errorText:"",cancel:!1}}_getItemInfosForUploaderFiles(e,t){const i=this._getPathInfo(t),n=[];for(let s=0;s<e.length;s++){const o=e[s],r=new Xe(i,o.name,!1),d=this._createFileInfo(r,t);n.push(d)}return n}refresh(){return this._lockRefresh?this._refreshDeferred:(this._lockRefresh=!0,this._executeDataLoad((()=>this._refreshDeferred=this._refreshInternal()),Je.REFRESH))}startSingleLoad(){this._singleOperationLockId=new Le().toString()}endSingleLoad(){delete this._singleOperationLockId}_refreshInternal(){const e={items:this._rootDirectoryInfo.items},t=this._getDirectoryPathKeyParts(this.getCurrentDirectory());return this._resetDirectoryState(this._rootDirectoryInfo),this._loadItemsRecursive(this._rootDirectoryInfo,e).then((()=>{const i=this._findDirectoryByPathKeyParts(t);this.setCurrentDirectory(i),delete this._lockRefresh}))}_loadItemsRecursive(e,t){return this.getDirectories(e).then((i=>{const n=[];for(let s=0;s<i.length;s++){const o=t.items.find((r=>i[s].fileItem.key===r.fileItem.key));o&&(i[s].expanded=o.expanded,i[s].expanded&&n.push(this._loadItemsRecursive(i[s],o)))}return Dt(n)}),(()=>null))}_setCurrentDirectoryByPathParts(e,t){return this._executeDataLoad((()=>this._setCurrentDirectoryByPathPartsInternal(e,t)),Je.NAVIGATION)}_setCurrentDirectoryByPathPartsInternal(e,t){return this._getDirectoryByPathParts(this._rootDirectoryInfo,e,t).then((i=>{for(let n=i.parentDirectory;n;n=n.parentDirectory)n.expanded=!0;this.setCurrentDirectory(i)}),(()=>{this._raisePathPotentiallyChanged()}))}_executeDataLoad(e,t){return this._dataLoadingDeferred?this._dataLoadingDeferred.then((()=>this._executeDataLoad(e,t))):(this._dataLoading=!0,this._dataLoadingDeferred=new te,this._isInitialized&&this._raiseDataLoading(t),e().always((()=>{const i=this._dataLoadingDeferred;this._dataLoadingDeferred=null,this._dataLoading=!1,i.resolve()})))}_getDirectoryByPathParts(e,t,i){if(t.length<1)return new te().resolve(e).promise();const n=i?"key":"name";return this.getDirectories(e).then((s=>{const o=s.find((d=>d.fileItem[n]===t[0]));if(!o)return new te().reject().promise();const r=[...t].splice(1);return this._getDirectoryByPathParts(o,r,i)}))}_getDirectoryPathKeyParts(e){const t=[];for(;e&&e.parentDirectory;)t.unshift(e.fileItem.key),e=e.parentDirectory;return t}_findDirectoryByPathKeyParts(e){let t=this._rootDirectoryInfo;if(e.length===0)return t;let i=0,n=t;for(;n&&i<e.length;)n=t.items.find((s=>s.fileItem.key===e[i])),n&&(t=n),i++;return t}_getActualDirectoryInfo(e){const t=this._getDirectoryPathKeyParts(e);return this._findDirectoryByPathKeyParts(t)}_createDirInfoByName(e,t){const i=this._getPathInfo(t),n=new Xe(i,e,!0);return this._createDirectoryInfo(n,t)}_createDirectoryInfo(e,t){return X(this._createFileInfo(e,t),{icon:"folder",expanded:e.isRoot(),items:[]})}_createFileInfo(e,t){return{fileItem:e,parentDirectory:t,icon:this._getFileItemDefaultIcon(e),getInternalKey(){return`FIK_${this.fileItem.key}`},getDisplayName(){return this.displayName||this.fileItem.name}}}_resetDirectoryState(e,t){t&&(e=this._getActualDirectoryInfo(e)),e.itemsLoaded=!1,e.items=[]}_getFileItemDefaultIcon(e){if(e.isDirectory)return"folder";const t=e.getFileExtension();return this._defaultIconMap[t]||"doc"}_createDefaultIconMap(){const e={".txt":"txtfile",".rtf":"rtffile",".doc":"docfile",".docx":"docxfile",".xls":"xlsfile",".xlsx":"xlsxfile",".ppt":"pptfile",".pptx":"pptxfile",".pdf":"pdffile"};return[".png",".gif",".jpg",".jpeg",".ico",".bmp"].forEach((t=>{e[t]="image"})),e}_createRootDirectoryInfo(e){const t=new Xe(null,"",!0),i=this._createDirectoryInfo(t,null);return i.displayName=e||"Files",i}setRootText(e){this._rootDirectoryInfo.displayName=e||"Files"}_raiseInitialized(){this._tryCallAction("onInitialized",{controller:this})}_raiseDataLoading(e){this._tryCallAction("onDataLoading",{operation:e})}_raiseSelectedDirectoryChanged(e){this._tryCallAction("onSelectedDirectoryChanged",{selectedDirectoryInfo:e})}_raiseEditActionStarting(e){this._tryCallAction("onEditActionStarting",e)}_raiseEditActionResultAcquired(e){this._tryCallAction("onEditActionResultAcquired",e)}_raiseEditActionError(e,t){this._tryCallAction("onEditActionError",e,t)}_raiseEditActionItemError(e,t){this._tryCallAction("onEditActionItemError",e,t)}_raiseCompleteEditActionItem(e,t){this._tryCallAction("onCompleteEditActionItem",e,t)}_raiseCompleteEditAction(e){this._tryCallAction("onCompleteEditAction",e)}_raisePathPotentiallyChanged(){this._tryCallAction("onPathPotentiallyChanged")}_tryCallAction(e){const t=Array.prototype.slice.call(arguments,1);this._isInitialized&&this._options[e]&&this._options[e](...t)}_resetState(){this._selectedDirectory=null,this._rootDirectoryInfo.items=[],this._rootDirectoryInfo.itemsLoaded=!1,this._loadedItems={}}_getPathInfo(e){const t=[];for(let i=e;i&&!i.fileItem.isRoot();i=i.parentDirectory)t.unshift({key:i.fileItem.key,name:i.fileItem.name});return t}on(e,t){const i=`on${e}`;this._options[i]=t}get _editingEvents(){return this._options.editingEvents}}class es{constructor(e){this._options=X({allowedFileExtensions:[],maxFileSize:0},e),this._extensionsMap={},this._allowedFileExtensions.forEach((t=>{this._extensionsMap[t.toUpperCase()]=!0}))}getAllowedItems(e){return this._allowedFileExtensions.length===0?e:e.filter((t=>t.isDirectory||this._isValidExtension(t.name)))}validateExtension(e){if(!this._isValidExtension(e))throw new ot(ge.WrongFileExtension,null)}validateMaxFileSize(e){if(this._maxFileSize&&e>this._maxFileSize)throw new ot(ge.MaxFileSizeExceeded,null)}_isValidExtension(e){if(this._allowedFileExtensions.length===0)return!0;const t=Si(e).toUpperCase();return this._extensionsMap[t]}get _allowedFileExtensions(){return this._options.allowedFileExtensions}get _maxFileSize(){return this._options.maxFileSize}}const Ei={create:!1,copy:!1,move:!1,delete:!1,rename:!1,upload:!1,download:!1};class ts{constructor(e){this._actions={},this._permissions=e||{},this._initCommands()}_initCommands(){this._commands=[{name:"create",text:U.format("dxFileManager-commandCreate"),icon:"newfolder",enabled:this._permissions.create,noFileItemRequired:!0},{name:"rename",text:U.format("dxFileManager-commandRename"),icon:"rename",enabled:this._permissions.rename,isSingleFileItemCommand:!0},{name:"move",text:U.format("dxFileManager-commandMove"),icon:"movetofolder",enabled:this._permissions.move},{name:"copy",text:U.format("dxFileManager-commandCopy"),icon:"copy",enabled:this._permissions.copy},{name:"delete",text:U.format("dxFileManager-commandDelete"),icon:"trash",enabled:this._permissions.delete},{name:"download",text:U.format("dxFileManager-commandDownload"),icon:"download",enabled:this._permissions.download},{name:"upload",text:U.format("dxFileManager-commandUpload"),icon:"upload",enabled:this._permissions.upload,noFileItemRequired:!0},{name:"refresh",text:U.format("dxFileManager-commandRefresh"),icon:"dx-filemanager-i dx-filemanager-i-refresh",enabled:!0,noFileItemRequired:!0},{name:"thumbnails",text:U.format("dxFileManager-commandThumbnails"),icon:"mediumiconslayout",enabled:!0,noFileItemRequired:!0},{name:"details",text:U.format("dxFileManager-commandDetails"),icon:"detailslayout",enabled:!0,noFileItemRequired:!0},{name:"clearSelection",text:U.format("dxFileManager-commandClearSelection"),icon:"remove",enabled:!0},{name:"showNavPane",hint:U.format("dxFileManager-commandShowNavPane"),icon:"menu",enabled:!1,noFileItemRequired:!0}],this._commandMap={},this._commands.forEach((e=>{this._commandMap[e.name]=e}))}registerActions(e){this._actions=X(this._actions,e)}executeCommand(e,t){const i=dt(e)?e:e.name,n=this._actions[i];if(n)return n(t)}updatePermissions(e){const t=X({},Ei,e);this._permissions=t,lt(this._permissions,(i=>{this._commandMap[i].enabled=this._permissions[i]}))}setCommandEnabled(e,t){const i=this.getCommandByName(e);i&&(i.enabled=t)}getCommandByName(e){return this._commandMap[e]}isCommandAvailable(e,t){const i=this.getCommandByName(e);if(!i||!i.enabled)return!1;if(i.noFileItemRequired)return!0;const n=t&&t.length||0;return n===0||t.some((s=>s.fileItem.isRoot()||s.fileItem.isParentFolder))?!1:e==="download"?t.every((s=>!s.fileItem.isDirectory)):!i.isSingleFileItemCommand||n===1}}const ei={create:{},upload:{},download:{},rename:{},move:{},copy:{},delete:{},refresh:{beginGroup:!0}},is=["beginGroup","closeMenuOnClick","disabled","icon","selectable","selected","text","visible"];class ns extends Ce{_initMarkup(){this._initActions(),this._isVisible=!1;const e=w("<div>").appendTo(this.$element());this._contextMenu=this._createComponent(e,Pn,{cssClass:"dx-filemanager-context-menu",showEvent:"",onItemClick:t=>this._onContextMenuItemClick(t.itemData.name,t),onShowing:t=>this._onContextMenuShowing(t),onShown:()=>this._onContextMenuShown(),onHidden:()=>this._onContextMenuHidden()}),super._initMarkup()}showAt(e,t,i,n){const{itemData:s,itemElement:o,isActionButton:r=!1}=n;this._isVisible&&this._onContextMenuHidden(),this._menuShowingContext={targetElement:o,itemData:s,fileItems:e,event:i,isActionButton:r};const d={of:t,at:"top left",my:"top left",offset:""};i?d.offset=i.offsetX+" "+i.offsetY:(d.my="left top",d.at="left bottom",d.boundaryOffset="1"),this._contextMenu.option({target:t,position:d}),this._contextMenu.show()}createContextMenuItems(e,t,i){this._targetFileItems=e,this._targetFileItem=se(i)?i:e==null?void 0:e[0];const n=[];return(t||this.option("items")).forEach((o=>{const r=dt(o)?o:o.name,d=this._configureItemByCommandName(r,o,e,this._targetFileItem);this._isContextMenuItemAvailable(d,e)&&n.push(d)})),n}_isContextMenuItemAvailable(e,t){return!this._isDefaultItem(e.name)||!e._autoHide?Ie(e.visible,!0):this._isIsolatedCreationItemCommand(e.name)&&t&&t.length?!1:this._commandManager.isCommandAvailable(e.name,t)}_isIsolatedCreationItemCommand(e){return(e==="create"||e==="upload")&&this.option("isolateCreationItemCommands")}_isDefaultItem(e){return!!ei[e]}_configureItemByCommandName(e,t,i,n){if(!this._isDefaultItem(e)){const r=X(!0,{},t);return r.originalItemData=t,this._addItemClickHandler(e,r),Array.isArray(t.items)&&(r.items=this.createContextMenuItems(i,t.items,n)),r}const s=this._createMenuItemByCommandName(e),o=ei[e];return X(s,o),s.originalItemData=t,je(s,t,is),se(s.visible)||(s._autoHide=!0),e&&!s.name&&X(s,{name:e}),s}_createMenuItemByCommandName(e){const{text:t,icon:i}=this._commandManager.getCommandByName(e),n={name:e,text:t,icon:i};return this._addItemClickHandler(e,n),n}_addItemClickHandler(e,t){t.onItemClick=i=>this._onContextMenuItemClick(e,i)}_onContextMenuItemClick(e,t){var i;const n=X(!0,{},t);if(n.itemData=t.itemData.originalItemData,n.fileSystemItem=(i=this._targetFileItem)===null||i===void 0?void 0:i.fileItem,n.viewArea=this.option("viewArea"),this._actions.onItemClick(n),this._isDefaultItem(e)){const s=this._isIsolatedCreationItemCommand(e)?null:this._targetFileItems;this._commandManager.executeCommand(e,s)}}_initActions(){this._actions={onContextMenuHidden:this._createActionByOption("onContextMenuHidden"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onItemClick:this._createActionByOption("onItemClick")}}_onContextMenuShowing(e){if(this._isVisible&&this._onContextMenuHidden(!0),e=X(e,this._menuShowingContext,{options:this.option(),cancel:!1}),this._actions.onContextMenuShowing(e),!e.cancel){const t=this.createContextMenuItems(this._menuShowingContext.fileItems,null,this._menuShowingContext.fileSystemItem);this._contextMenu.option("dataSource",t)}}tryUpdateVisibleContextMenu(){if(this._isVisible){const e=this.createContextMenuItems(this._targetFileItems);this._contextMenu.option("dataSource",e)}}_onContextMenuShown(){this._isVisible=!0}_onContextMenuHidden(e){this._isVisible=!1,e||(this._menuShowingContext={}),this._contextMenu.option("visible",!1),this._raiseContextMenuHidden()}_raiseContextMenuHidden(){this._actions.onContextMenuHidden()}_getDefaultOptions(){return X(super._getDefaultOptions(),{commandManager:null,onContextMenuHidden:null,onItemClick:null})}_optionChanged(e){const t=e.name;switch(t){case"commandManager":this.repaint();break;case"items":this.tryUpdateVisibleContextMenu();break;case"onItemClick":case"onContextMenuShowing":case"onContextMenuHidden":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}get _commandManager(){return this.option("commandManager")}}const ss="dx-filemanager-file-actions-button",os="dx-filemanager-file-actions-button-activated";class Mi extends Ce{_initMarkup(){this._createClickAction();const e=w("<div>");this.$element().append(e).addClass(ss),this._button=this._createComponent(e,He,{icon:"overflow",stylingMode:"text",onClick:t=>this._raiseClick(t)}),super._initMarkup()}_createClickAction(){this._clickAction=this._createActionByOption("onClick")}_raiseClick(e){this._clickAction(e)}_getDefaultOptions(){return X(super._getDefaultOptions(),{cssClass:"",onClick:null})}_optionChanged(e){switch(e.name){case"cssClass":this.repaint();break;case"onClick":this._createClickAction();break;default:super._optionChanged(e)}}setActive(e){this.$element().toggleClass(os,e),setTimeout((()=>this._button.$element().toggleClass("dx-state-active",e)))}}class Fi extends Ce{_initMarkup(){this._initActions(),this._getCurrentDirectory=this.option("getCurrentDirectory"),this._createFileActionsButton=Ee,this._storeExpandedState=this.option("storeExpandedState")||!1;const e=w("<div>").addClass("dx-filemanager-dirs-tree").appendTo(this.$element()),t={dataStructure:"plain",rootValue:"",createChildren:this._onFilesTreeViewCreateSubDirectories.bind(this),itemTemplate:this._createFilesTreeViewItemTemplate.bind(this),keyExpr:"getInternalKey",parentIdExpr:"parentDirectory.getInternalKey",displayExpr:i=>i.getDisplayName(),hasItemsExpr:"fileItem.hasSubDirectories",onItemClick:i=>this._actions.onDirectoryClick(i),onItemExpanded:i=>this._onFilesTreeViewItemExpanded(i),onItemCollapsed:i=>this._onFilesTreeViewItemCollapsed(i),onItemRendered:i=>this._onFilesTreeViewItemRendered(i),onContentReady:()=>this._actions.onFilesTreeViewContentReady()};this._contextMenu&&(this._contextMenu.option("onContextMenuHidden",(()=>this._onContextMenuHidden())),t.onItemContextMenu=i=>this._onFilesTreeViewItemContextMenu(i),this._createFileActionsButton=(i,n)=>this._createComponent(i,Mi,n)),this._filesTreeView=this._createComponent(e,An,t)}_initActions(){this._actions={onDirectoryClick:this._createActionByOption("onDirectoryClick"),onFilesTreeViewContentReady:this._createActionByOption("onFilesTreeViewContentReady")}}_render(){super._render();const e=this;setTimeout((()=>{e._updateFocusedElement()}))}_onFilesTreeViewCreateSubDirectories(e){const t=this.option("getDirectories"),i=e&&e.itemData||null;return t&&t(i,!0)}_onFilesTreeViewItemRendered(e){let{itemData:t}=e;const i=this._getCurrentDirectory();i&&i.fileItem.equals(t.fileItem)&&(this._updateFocusedElement(),this._restoreScrollTopPosition())}_onFilesTreeViewItemExpanded(e){let{itemData:t}=e;this._storeExpandedState&&(t.expanded=!0)}_onFilesTreeViewItemCollapsed(e){let{itemData:t}=e;this._storeExpandedState&&(t.expanded=!1)}_createFilesTreeViewItemTemplate(e,t,i){const n=w(i);n.closest(this._filesTreeViewItemSelector).data("item",e);const o=gt(e.icon),r=w("<span>").text(e.getDisplayName()).addClass("dx-filemanager-dirs-tree-item-text"),d=w("<div>");n.append(o,r,d),this._createFileActionsButton(d,{onClick:g=>this._onFileItemActionButtonClick(g)})}_onFilesTreeViewItemContextMenu(e){let{itemElement:t,event:i}=e;i.preventDefault(),i.stopPropagation();const n=w(t).data("item");this._contextMenu.showAt([n],t,i,{itemData:n,itemElement:t})}_onFileItemActionButtonClick(e){let{component:t,element:i,event:n}=e;n.stopPropagation();const s=t.$element().closest(this._filesTreeViewItemSelector),o=s.data("item"),r={itemData:o,itemElement:s,isActionButton:!0};this._contextMenu.showAt([o],i,n,r),this._activeFileActionsButton=t,this._activeFileActionsButton.setActive(!0)}_onContextMenuHidden(){this._activeFileActionsButton&&this._activeFileActionsButton.setActive(!1)}toggleNodeDisabledState(e,t){const i=this._getNodeByKey(e);if(!i)return;const s=this._filesTreeView.option("items").map((o=>o.getInternalKey())).indexOf(i.getInternalKey());s!==-1&&this._filesTreeView.option(`items[${s}].disabled`,t)}_saveScrollTopPosition(){be()&&(this._scrollTopPosition=this._filesTreeView.getScrollable().scrollTop())}_restoreScrollTopPosition(){!be()||!hi(this._scrollTopPosition)||setTimeout((()=>this._filesTreeView.getScrollable().scrollTo(this._scrollTopPosition)))}_updateFocusedElement(){const e=this._getCurrentDirectory(),t=this._getItemElementByKey(e==null?void 0:e.getInternalKey());this._$focusedElement&&this._$focusedElement.toggleClass("dx-filemanager-focused-item",!1),this._$focusedElement=t||w(),this._$focusedElement.toggleClass("dx-filemanager-focused-item",!0)}_getNodeByKey(e){var t;return(t=this._filesTreeView)===null||t===void 0?void 0:t._getNode(e)}_getPublicNode(e){var t;const i=[...(t=this._filesTreeView)===null||t===void 0?void 0:t.getNodes()];for(;i.length;){const n=i.shift();if(n.itemData.getInternalKey()===e)return n;n.children.length&&i.push(...n.children)}}_getItemElementByKey(e){const t=this._getNodeByKey(e);if(t){const i=this._filesTreeView._getNodeElement(t);if(i)return i.children(this._filesTreeViewItemSelector)}return null}_getDefaultOptions(){return X(super._getDefaultOptions(),{storeExpandedState:!1,initialFolder:null,contextMenu:null,getItems:null,getCurrentDirectory:null,onDirectoryClick:null})}_optionChanged(e){const t=e.name;switch(t){case"storeExpandedState":this._storeExpandedState=this.option(t);break;case"getItems":case"rootFolderDisplayName":case"initialFolder":case"contextMenu":this.repaint();break;case"getCurrentDirectory":this.getCurrentDirectory=this.option(t);break;case"onDirectoryClick":case"onFilesTreeViewContentReady":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}get _filesTreeViewItemSelector(){return".dx-treeview-item"}get _contextMenu(){return this.option("contextMenu")}toggleDirectoryExpandedState(e,t){const i=new te,n=this._getPublicNode(e==null?void 0:e.getInternalKey());if(!n)return i.reject().promise();if(n.expanded===t||n.itemsLoaded&&!n.itemData.fileItem.hasSubDirectories)return i.resolve().promise();const s=t?"expandItem":"collapseItem";return this._filesTreeView[s](e.getInternalKey())}refresh(){this._$focusedElement=null,this._saveScrollTopPosition(),this._filesTreeView.option("dataSource",[])}updateCurrentDirectory(){this._disposed||(this._updateFocusedElement(),this._storeExpandedState&&this._updateExpandedStateToCurrentDirectory())}_updateExpandedStateToCurrentDirectory(){return this.toggleDirectoryExpandedStateRecursive(this._getCurrentDirectory().parentDirectory,!0)}toggleDirectoryExpandedStateRecursive(e,t){const i=[];for(let n=e;n;n=n.parentDirectory)i.unshift(n);return this.toggleDirectoryLineExpandedState(i,t)}toggleDirectoryLineExpandedState(e,t){return e.length?this.toggleDirectoryExpandedState(e.shift(),t).then((()=>this.toggleDirectoryLineExpandedState(e,t))):new te().resolve().promise()}}class Pi extends Ce{_init(){this._initActions(),this._lockFocusedItemProcessing=!1,this._focusedItemKey=this.option("focusedItemKey"),super._init()}_initMarkup(){this._needResetScrollPosition=!1,this.$element().addClass("dx-filemanager-files-view");const e=ve(kn,"dxFileManager_open");de.on(this.$element(),e,this._getItemSelector(),this._onItemDblClick.bind(this)),super._initMarkup()}_initActions(){this._actions={onError:this._createActionByOption("onError"),onSelectionChanged:this._createActionByOption("onSelectionChanged"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged"),onSelectedItemOpened:this._createActionByOption("onSelectedItemOpened"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onItemListDataLoaded:this._createActionByOption("onItemListDataLoaded")}}_getDefaultOptions(){return X(super._getDefaultOptions(),{selectionMode:"single",selectedItemKeys:[],focusedItemKey:void 0,contextMenu:null,getItems:null,getItemThumbnail:null,onError:null,onSelectionChanged:null,onFocusedItemChanged:null,onSelectedItemOpened:null,onContextMenuShowing:null})}_optionChanged(e){const t=e.name;switch(t){case"selectionMode":case"contextMenu":case"getItems":case"getItemThumbnail":this.repaint();break;case"selectedItemKeys":this._setSelectedItemKeys(e.value);break;case"focusedItemKey":this._lockFocusedItemProcessing||this._setFocusedItemKey(e.value);break;case"onError":case"onSelectedItemOpened":case"onSelectionChanged":case"onFocusedItemChanged":case"onContextMenuShowing":case"onItemListDataLoaded":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}_getItems(){return this._getItemsInternal().done((e=>{this._itemCount=e.length,this._itemCount===0&&this._resetFocus();const t=this._findParentDirectoryItem(e);this._hasParentDirectoryItem=!!t,this._parentDirectoryItemKey=t?t.fileItem.key:null})).always((()=>{this._onDataLoaded()}))}_getItemsInternal(){const e=this.option("getItems"),t=e?e():[];return _e(t)}_raiseOnError(e){this._actions.onError({error:e})}_raiseSelectionChanged(e){this._actions.onSelectionChanged(e)}_raiseFocusedItemChanged(e){this._actions.onFocusedItemChanged(e)}_raiseSelectedItemOpened(e){this._actions.onSelectedItemOpened({fileItemInfo:e})}_raiseContextMenuShowing(e){this._actions.onContextMenuShowing(e)}_raiseItemListDataLoaded(){this._actions.onItemListDataLoaded()}_onDataLoaded(){var e;this._raiseItemListDataLoaded(),(e=this._refreshDeferred)===null||e===void 0||e.resolve()}_onContentReady(){this._needResetScrollPosition&&(this._resetScrollTopPosition(),this._needResetScrollPosition=!1)}_tryRaiseSelectionChanged(e){let{selectedItemInfos:t,selectedItems:i,selectedItemKeys:n,currentSelectedItemKeys:s,currentDeselectedItemKeys:o}=e;const r=this._findParentDirectoryItem(this.getSelectedItems());r&&this._deselectItem(r);let d=!this._hasParentDirectoryItem;d=d||this._hasValidKeys(s)||this._hasValidKeys(o),d&&(t=this._filterOutItemByPredicate(t,(g=>g.fileItem.key===this._parentDirectoryItemKey)),i=this._filterOutParentDirectory(i),n=this._filterOutParentDirectoryKey(n,!0),s=this._filterOutParentDirectoryKey(s,!0),o=this._filterOutParentDirectoryKey(o,!0),this._raiseSelectionChanged({selectedItemInfos:t,selectedItems:i,selectedItemKeys:n,currentSelectedItemKeys:s,currentDeselectedItemKeys:o}))}_onFocusedItemChanged(e){this._focusedItemKey!==e.itemKey&&(this._focusedItemKey=e.itemKey,this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",e.itemKey),this._lockFocusedItemProcessing=!1,this._raiseFocusedItemChanged(e))}_resetFocus(){}_resetScrollTopPosition(){be()&&setTimeout((()=>{var e;return(e=this._getScrollable())===null||e===void 0?void 0:e.scrollTo(0)}))}_getScrollable(){}_getItemThumbnail(e){const t=this.option("getItemThumbnail");return t?t(e):{thumbnail:""}}_getItemThumbnailContainer(e){const{thumbnail:t,cssClass:i}=this._getItemThumbnail(e),n=gt(t).addClass(this._getItemThumbnailCssClass());return i&&n.addClass(i),n}_getItemThumbnailCssClass(){return""}_getItemSelector(){}_onItemDblClick(e){}_isDesktop(){return We.real().deviceType==="desktop"}_showContextMenu(e,t,i,n){this._contextMenu.showAt(e,t,i,n)}get _contextMenu(){return this.option("contextMenu")}_findParentDirectoryItem(e){for(let t=0;t<e.length;t++){const i=e[t];if(this._isParentDirectoryItem(i))return i}return null}_getFileItemsForContextMenu(e){const t=this.getSelectedItems();return this._isParentDirectoryItem(e)&&t.push(e),t}_isParentDirectoryItem(e){return e.fileItem.isParentFolder}_hasValidKeys(e){return e.length>1||e.length===1&&e[0]!==this._parentDirectoryItemKey}_filterOutParentDirectory(e,t){return this._filterOutItemByPredicate(e,(i=>i.key===this._parentDirectoryItemKey),t)}_filterOutParentDirectoryKey(e,t){return this._filterOutItemByPredicate(e,(i=>i===this._parentDirectoryItemKey),t)}_filterOutItemByPredicate(e,t,i){let n=e,s=-1;for(let o=0;o<e.length;o++)if(t(e[o])){s=o;break}return s!==-1&&(i&&(n=[...e]),n.splice(s,1)),n}_isMultipleSelectionMode(){return this.option("selectionMode")==="multiple"}_deselectItem(e){}_setSelectedItemKeys(e){}_setFocusedItemKey(e){}_createDataSource(){return{store:new Mn({key:"fileItem.key",load:this._getItems.bind(this)})}}getSelectedItems(){}clearSelection(){}selectItem(){}refresh(e,t){}}const rs="dx-filemanager-parent-directory-item",ti={thumbnail:{caption:"",calculateSortValue:"isDirectory",width:36,alignment:"center",cssClass:"dx-filemanager-details-item-is-directory"},name:{caption:U.format("dxFileManager-listDetailsColumnCaptionName")},dateModified:{caption:U.format("dxFileManager-listDetailsColumnCaptionDateModified"),width:110,hidingPriority:1},size:{caption:U.format("dxFileManager-listDetailsColumnCaptionFileSize"),width:90,alignment:"right",hidingPriority:0},isParentFolder:{caption:"isParentFolder",visible:!1,sortIndex:0,sortOrder:"asc"}};class as extends Pi{_initMarkup(){this._itemCount=0,this._focusedItem=null,this._hasParentDirectoryItem=!1,this._parentDirectoryItemKey=null,this._selectAllCheckBox=null,this._selectAllCheckBoxUpdating=!1,this.$element().addClass("dx-filemanager-details"),this._createFilesView(),this._contextMenu.option("onContextMenuHidden",(()=>this._onContextMenuHidden())),super._initMarkup()}_createFilesView(){const e=w("<div>").appendTo(this.$element()),t=this._isMultipleSelectionMode()?"multiple":"none";this._filesView=this._createComponent(e,Nn,{dataSource:this._createDataSource(),hoverStateEnabled:!0,selection:{mode:t,showCheckBoxesMode:this._isDesktop()?"onClick":"none"},selectedRowKeys:this.option("selectedItemKeys"),focusedRowKey:this.option("focusedItemKey"),focusedRowEnabled:!0,allowColumnResizing:!0,scrolling:{mode:"virtual"},sorting:{mode:"single",showSortIndexes:!1},loadPanel:{shading:!0},height:"100%",showColumnLines:!1,showRowLines:!1,columnHidingEnabled:!1,columns:this._createColumns(),onEditorPreparing:this._onEditorPreparing.bind(this),onRowPrepared:this._onRowPrepared.bind(this),onContextMenuPreparing:this._onContextMenuPreparing.bind(this),onSelectionChanged:this._onFilesViewSelectionChanged.bind(this),onFocusedRowChanged:this._onFilesViewFocusedRowChanged.bind(this),onOptionChanged:this._onFilesViewOptionChanged.bind(this),onContentReady:this._onContentReady.bind(this)})}_createColumns(){let e=this.option("detailColumns");e=e.slice(0),e=e.map((i=>{let n=i;return dt(i)&&(n={dataField:i}),this._getPreparedColumn(n)}));const t=this.option("customizeDetailColumns");return xe(t)&&(e=t(e)),e.push(this._getPreparedColumn({dataField:"isParentFolder"})),e.forEach((i=>this._updateColumnDataField(i))),e}_getPreparedColumn(e){const t={};let i="";if(this._isDefaultColumn(e.dataField)){const n=X(!0,{},ti[e.dataField]);switch(i=n.cssClass||"",e.dataField){case"thumbnail":n.cellTemplate=this._createThumbnailColumnCell.bind(this),n.calculateSortValue=`fileItem.${n.calculateSortValue}`;break;case"name":n.cellTemplate=this._createNameColumnCell.bind(this),n.caption=U.format("dxFileManager-listDetailsColumnCaptionName");break;case"size":n.calculateCellValue=this._calculateSizeColumnCellValue.bind(this),n.caption=U.format("dxFileManager-listDetailsColumnCaptionFileSize"),n.calculateSortValue=s=>s.fileItem.isDirectory?-1:s.fileItem.size;break;case"dateModified":n.caption=U.format("dxFileManager-listDetailsColumnCaptionDateModified")}X(!0,t,n)}return je(t,e,["alignment","caption","dataField","dataType","hidingPriority","sortIndex","sortOrder","visible","visibleIndex","width"]),e.cssClass&&(i=`${i} ${e.cssClass}`),i&&(t.cssClass=i),t}_updateColumnDataField(e){const t=this._isDefaultColumn(e.dataField)?"":"dataItem.";return e.dataField="fileItem."+t+e.dataField,e}_isDefaultColumn(e){return!!ti[e]}_onFileItemActionButtonClick(e){let{component:t,element:i,event:n}=e;n.stopPropagation();const s=t.$element().closest(this._getItemSelector()),o=s.data("item");this._selectItem(o);const r={itemData:o,itemElement:s,isActionButton:!0},d=this._getFileItemsForContextMenu(o);this._showContextMenu(d,i,n,r),this._activeFileActionsButton=t,this._activeFileActionsButton.setActive(!0)}_onContextMenuHidden(){this._activeFileActionsButton&&this._activeFileActionsButton.setActive(!1)}_getItemThumbnailCssClass(){return"dx-filemanager-details-item-thumbnail"}_getItemSelector(){return".dx-data-row"}_onItemDblClick(e){const i=w(e.currentTarget).data("item");this._raiseSelectedItemOpened(i)}_isAllItemsSelected(){const e=this._hasParentDirectoryItem?this._itemCount-1:this._itemCount,t=this._filesView.option("selectedRowKeys");return t.length?t.length>=e?!0:void 0:!1}_onEditorPreparing(e){let{component:t,command:i,row:n,parentType:s,editorOptions:o}=e;this._filesView||(this._filesView=t),i==="select"&&n?this._isParentDirectoryItem(n.data)&&(o.disabled=!0):s==="headerRow"&&(o.onInitialized=r=>{let{component:d}=r;this._selectAllCheckBox=d},o.value=this._isAllItemsSelected(),o.onValueChanged=r=>this._onSelectAllCheckBoxValueChanged(r))}_onSelectAllCheckBoxValueChanged(e){let{event:t,previousValue:i,value:n}=e;if(!t){i&&!this._selectAllCheckBoxUpdating&&this._selectAllCheckBox&&this._selectAllCheckBox.option("value",i);return}this._isAllItemsSelected()!==n&&(n?this._filesView.selectAll():this._filesView.deselectAll(),t.preventDefault())}_onRowPrepared(e){let{rowType:t,rowElement:i,data:n}=e;if(t==="data"){const s=w(i);s.data("item",n),this._isParentDirectoryItem(n)&&s.addClass(rs)}}_onContextMenuPreparing(e){if(!this._isDesktop())return;let t=null,i={};e.row&&e.row.rowType==="data"&&(i=e.row.data,this._selectItem(i),t=this._getFileItemsForContextMenu(i));const n=X({},{targetElement:e.target==="content"&&se(e.row)?this._filesView.getRowElement(e.rowIndex):void 0,itemData:i,options:this._contextMenu.option(),event:e.event,isActionButton:!1,cancel:!1});this._raiseContextMenuShowing(n),e.items=n.cancel?[]:this._contextMenu.createContextMenuItems(t,null,i)}_onFilesViewSelectionChanged(e){let{component:t,selectedRowsData:i,selectedRowKeys:n,currentSelectedRowKeys:s,currentDeselectedRowKeys:o}=e;this._filesView=this._filesView||t,this._selectAllCheckBox&&(this._selectAllCheckBoxUpdating=!0,this._selectAllCheckBox.option("value",this._isAllItemsSelected()),this._selectAllCheckBoxUpdating=!1);const r=i.map((d=>d.fileItem));this._tryRaiseSelectionChanged({selectedItemInfos:i,selectedItems:r,selectedItemKeys:n,currentSelectedItemKeys:s,currentDeselectedItemKeys:o})}_onFilesViewFocusedRowChanged(e){var t;if(!this._isMultipleSelectionMode()){var i;this._selectItemSingleSelection((i=e.row)===null||i===void 0?void 0:i.data)}const n=((t=e.row)===null||t===void 0?void 0:t.data.fileItem)||null;this._onFocusedItemChanged({item:n,itemKey:n==null?void 0:n.key,itemElement:e.rowElement})}_onFilesViewOptionChanged(e){let{fullName:t}=e;t.indexOf("sortOrder")>-1&&this._filesView.columnOption("isParentFolder",{sortOrder:"asc",sortIndex:0})}_resetFocus(){this._setFocusedItemKey(void 0)}_createThumbnailColumnCell(e,t){this._getItemThumbnailContainer(t.data).appendTo(e)}_createNameColumnCell(e,t){const i=w("<div>"),n=w("<span>").text(t.data.fileItem.name).addClass("dx-filemanager-details-item-name"),s=w("<div>").append(n,i).addClass("dx-filemanager-details-item-name-wrapper");w(e).append(s),this._createComponent(i,Mi,{onClick:o=>this._onFileItemActionButtonClick(o)})}_calculateSizeColumnCellValue(e){return e.fileItem.isDirectory?"":wi(e.fileItem.size)}_selectItem(e){(this._isMultipleSelectionMode()?this._selectItemMultipleSelection:this._selectItemSingleSelection).call(this,e)}_deselectItem(e){this._filesView.deselectRows([e.fileItem.key])}_selectItemSingleSelection(e){if(!this._focusedItem||!e||this._focusedItem.fileItem.key!==e.fileItem.key){const t=this._focusedItem;this._focusedItem=e;const i=[];t&&i.push(t.fileItem.key);const n=[],s=[];e&&!this._isParentDirectoryItem(e)&&(n.push(e.fileItem),s.push(e.fileItem.key)),this._raiseSelectionChanged({selectedItems:n,selectedItemKeys:s,currentSelectedItemKeys:[...s],currentDeselectedItemKeys:i})}}_selectItemMultipleSelection(e){let{fileItem:t}=e;if(!this._filesView.isRowSelected(t.key)){const n=this._filesView.getController("selection").isSelectionWithCheckboxes();this._filesView.selectRows([t.key],n)}}_setSelectedItemKeys(e){this._filesView.option("selectedRowKeys",e)}_setFocusedItemKey(e){var t;(t=this._filesView)===null||t===void 0||t.option("focusedRowKey",e)}clearSelection(){this._isMultipleSelectionMode()?this._filesView.clearSelection():this._filesView.option("focusedRowIndex",-1)}refresh(e,t){const i={dataSource:this._createDataSource()};return e&&Object.prototype.hasOwnProperty.call(e,"focusedItemKey")&&(se(e.focusedItemKey)?i.focusedRowKey=e.focusedItemKey:i.focusedRowIndex=-1),!se(i.focusedRowKey)&&i.focusedRowIndex===-1&&t===Je.NAVIGATION&&(i.paging={pageIndex:0},this._needResetScrollPosition=!0),this._filesView.option(i),this._refreshDeferred=new te,this._refreshDeferred.promise()}_getScrollable(){return this._filesView.getScrollable()}getSelectedItems(){return this._isMultipleSelectionMode()?this._filesView.getSelectedRowsData():this._focusedItem&&!this._isParentDirectoryItem(this._focusedItem)?[this._focusedItem]:[]}}const ii=ve($n.name,"dxFileManagerThumbnailsListBox");class ls extends Ii{_initMarkup(){this._initActions(),this._lockFocusedItemProcessing=!1,this.$element().addClass("dx-filemanager-thumbnails-view-port"),this._renderScrollView(),this._renderItemsContainer(),this._createScrollViewControl(),super._initMarkup(),this.onFocusedItemChanged=this._onFocusedItemChanged.bind(this),this._layoutUtils=new ds(this._scrollView,this.$element(),this._$itemContainer,this.itemElements().first()),this._syncFocusedItemKey()}_initActions(){this._actions={onItemEnterKeyPressed:this._createActionByOption("onItemEnterKeyPressed"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged")}}_initTemplates(){super._initTemplates(),this._itemThumbnailTemplate=this.option("itemThumbnailTemplate"),this._getTooltipText=this.option("getTooltipText"),this._templateManager.addDefaultTemplates({item:new yi((function(e,t,i){const n=this._getDefaultItemTemplate(i,e);e.append(n)}).bind(this),["fileItem"],this.option("integrationOptions.watchMethod"))})}_createScrollViewControl(){this._scrollView||(this._scrollView=this._createComponent(this._$scrollView,Mt,{scrollByContent:!0,scrollByThumb:!0,useKeyboard:!1,showScrollbar:"onHover"}))}_renderScrollView(){this._$scrollView||(this._$scrollView=w("<div>").appendTo(this.$element()))}getScrollable(){return this._scrollView}_renderItemsContainer(){this._$itemContainer||(this._$itemContainer=w("<div>").addClass("dx-filemanager-thumbnails-container").appendTo(this._$scrollView))}_render(){super._render(),this._detachEventHandlers(),this._attachEventHandlers()}_clean(){this._detachEventHandlers(),super._clean()}_supportedKeys(){return X(super._supportedKeys(),{upArrow(e){this._beforeKeyProcessing(e),this._processArrowKeys(-1,!1,e)},downArrow(e){this._beforeKeyProcessing(e),this._processArrowKeys(1,!1,e)},home(e){this._beforeKeyProcessing(e),this._processHomeEndKeys(0,!0,e)},end(e){this._beforeKeyProcessing(e),this._processHomeEndKeys(this._getItemsLength()-1,!0,e)},pageUp(e){this._beforeKeyProcessing(e),this._processPageChange(!0,e)},pageDown(e){this._beforeKeyProcessing(e),this._processPageChange(!1,e)},enter(e){this._beforeKeyProcessing(e),this._actions.onItemEnterKeyPressed(this._getFocusedItem())},A(e){this._beforeKeyProcessing(e),Nt(e)&&this.selectAll()}})}_beforeKeyProcessing(e){e.preventDefault(),this._layoutUtils.reset()}_processArrowKeys(e,t,i){const n=this._getFocusedItem();if(n){if(!t){const o=this._layoutUtils.getLayoutModel();if(!o)return;e*=o.itemPerRowCount}const s=this._getIndexByItem(n)+e;this._focusItemByIndex(s,!0,i)}}_processHomeEndKeys(e,t,i){this._focusItemByIndex(e,t,i)}_processPageChange(e,t){const i=this._getFocusedItem();if(!i)return;const n=this._layoutUtils.getLayoutModel();if(!n)return;const s=this._layoutUtils.createItemLayoutModel(this._getIndexByItem(i)),o=e?n.rowPerPageRate:-n.rowPerPageRate,r=s.itemRowIndex-o;let v=(e?Math.ceil:Math.floor)(r)*n.itemPerRowCount+s.itemColumnIndex;v<0?v=0:v>=this._getItemsLength()&&(v=this._getItemsLength()-1),this._focusItemByIndex(v,!0,t)}_processLongTap(e){const t=this._closestItemElement(w(e.target)),i=this._getIndexByItemElement(t);this._selection.changeItemSelection(i,{control:!0})}_attachEventHandlers(){this.option("selectionMode")==="multiple"&&de.on(this._itemContainer(),ii,`.${this._itemContentClass()}`,(e=>{this._processLongTap(e),e.stopPropagation()})),de.on(this._itemContainer(),"mousedown selectstart",(e=>{e.shiftKey&&e.preventDefault()}))}_detachEventHandlers(){de.off(this._itemContainer(),ii),de.off(this._itemContainer(),"mousedown selectstart")}_itemContainer(){return this._$itemContainer}_itemClass(){return"dx-filemanager-thumbnails-item"}_itemDataKey(){return"dxFileManagerItemData"}_getDefaultItemTemplate(e,t){t.attr("title",this._getTooltipText(e));const i=this._itemThumbnailTemplate(e),n=w("<div>").addClass("dx-filemanager-thumbnails-item-spacer"),s=w("<div>").addClass("dx-filemanager-thumbnails-item-name").text(e.fileItem.name);t.append(i,n,s)}_itemSelectHandler(e){let t={};this.option("selectionMode")==="multiple"&&(this._isPreserveSelectionMode||(this._isPreserveSelectionMode=Nt(e)||e.shiftKey),t={control:this._isPreserveSelectionMode,shift:e.shiftKey});const i=this._getIndexByItemElement(e.currentTarget);this._selection.changeItemSelection(i,t)}_initSelectionModule(){super._initSelectionModule();const e=X(this._selection.options,{selectedKeys:this.option("selectedItemKeys"),onSelectionChanged:t=>{this.option("selectedItems",this._getItemsByKeys(t.selectedItemKeys,t.selectedItems)),this._updateSelectedItems(t)}});this._selection=new zn(e)}_updateSelectedItems(e){const t=e.addedItemKeys,i=e.removedItemKeys;if(this._rendered&&(t.length||i.length)){if(!this._rendering){const n=[];let s;const o=[];this._editStrategy.beginCache();for(let r=0;r<i.length;r++)s=this._getIndexByKey(i[r]),o.push(s),this._removeSelection(s);for(let r=0;r<t.length;r++)s=this._getIndexByKey(t[r]),n.push(s),this._addSelection(s);this._editStrategy.endCache(),this._updateSelection(n,o)}this._fireSelectionChangeEvent(e)}}_fireSelectionChangeEvent(e){this._createActionByOption("onSelectionChanged",{excludeValidators:["disabled","readOnly"]})(e)}_updateSelection(e,t){this.getSelectedItems().length===0&&(this._isPreserveSelectionMode=!1)}_normalizeSelectedItems(){const e=this._getKeysByItems(this.option("selectedItems")),t=this._selection.getSelectedItemKeys();return this._compareKeys(t,e)||this._selection.setSelection(e),new te().resolve().promise()}_focusOutHandler(){}_getItems(){return this.option("items")||[]}_getItemsLength(){return this._getItems().length}_getIndexByItemElement(e){return this._editStrategy.getNormalizedIndex(e)}_getItemByIndex(e){return this._getItems()[e]}_getFocusedItem(){return this.getItemByItemElement(this.option("focusedElement"))}_focusItem(e,t){this.option("focusedElement",this.getItemElementByItem(e)),t&&this._layoutUtils.scrollToItem(this._getIndexByItem(e))}_focusItemByIndex(e,t,i){if(e>=0&&e<this._getItemsLength()){const n=this._getItemByIndex(e);this._focusItem(n,t,i)}}_syncFocusedItemKey(){this._syncFocusedItemKeyDeferred||(this._syncFocusedItemKeyDeferred=new te);const e=this._syncFocusedItemKeyDeferred;if(this._dataSource&&this._dataSource.isLoading())return e.promise();const t=this.option("focusedItemKey");if(se(t)){const n=this.option("items").find((s=>this.keyOf(s)===t));n?(this._focusItem(n,!0),e.resolve()):(this.option("focusedItemKey",void 0),e.reject())}else e.resolve();return this._syncFocusedItemKeyDeferred=null,e.promise()}_onFocusedItemChanged(){const e=this._getFocusedItem(),t=this.keyOf(e),i=this.option("focusedItemKey");t!==i&&(this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",t),this._lockFocusedItemProcessing=!1,this._raiseFocusedItemChanged(e))}_raiseFocusedItemChanged(e){const t={item:e,itemElement:this.option("focusedElement")};this._actions.onFocusedItemChanged(t)}_changeItemSelection(e,t){if(this.isItemSelected(e)===t)return;const i=this.getItemElementByItem(e),n=this._getIndexByItemElement(i);this._selection.changeItemSelection(n,{control:this._isPreserveSelectionMode})}_chooseSelectOption(){return"selectedItemKeys"}getSelectedItems(){return this._selection.getSelectedItems()}getItemElementByItem(e){return this._editStrategy.getItemElement(e)}getItemByItemElement(e){return this._getItemByIndex(this._getIndexByItemElement(e))}selectAll(){this.option("selectionMode")==="multiple"&&(this._selection.selectAll(),this._isPreserveSelectionMode=!0)}selectItem(e){this._changeItemSelection(e,!0)}deselectItem(e){this._changeItemSelection(e,!1)}clearSelection(){this._selection.deselectAll()}_optionChanged(e){switch(e.name){case"items":this._layoutUtils&&this._layoutUtils.updateItems(this.itemElements().first()),super._optionChanged(e);break;case"focusedItemKey":if(this._lockFocusedItemProcessing)break;se(e.value)?this._syncFocusedItemKey().done((()=>{const t=this._getFocusedItem();this._raiseFocusedItemChanged(t)})):(this.option("focusedElement",null),this._raiseFocusedItemChanged(null));break;case"onItemEnterKeyPressed":case"onFocusedItemChanged":this._actions[e.name]=this._createActionByOption(e.name);break;default:super._optionChanged(e)}}}class ds{constructor(e,t,i,n){this._layoutModel=null,this._scrollView=e,this._$viewPort=t,this._$itemContainer=i,this._$item=n}updateItems(e){this._$item=e}reset(){this._layoutModel=null}getLayoutModel(){return this._layoutModel||(this._layoutModel=this._createLayoutModel()),this._layoutModel}_createLayoutModel(){if(!this._$item)return null;const e=wt(this._$item,!0);if(e===0)return null;const t=pi(this._$item,!0),i=Cn(this._$itemContainer),n=mi(this._$viewPort),s=this._scrollView.scrollTop(),o=s+n,r=Math.floor(i/e),d=n/t;return{itemWidth:e,itemHeight:t,viewPortWidth:i,viewPortHeight:n,viewPortScrollTop:s,viewPortScrollBottom:o,itemPerRowCount:r,rowPerPageRate:d}}createItemLayoutModel(e){const t=this.getLayoutModel();if(!t)return null;const i=Math.floor(e/t.itemPerRowCount),n=e%t.itemPerRowCount,s=i*t.itemHeight,o=s+t.itemHeight;return{itemRowIndex:i,itemColumnIndex:n,itemTop:s,itemBottom:o}}scrollToItem(e){const t=this.getLayoutModel();if(!t)return;const n=Math.floor(e/t.itemPerRowCount)*t.itemHeight,s=n+t.itemHeight;let o=t.viewPortScrollTop;n<t.viewPortScrollTop?o=n:s>t.viewPortScrollBottom&&(o=s-t.viewPortHeight),this._scrollView.scrollTo(o)}}class cs extends Pi{_initMarkup(){super._initMarkup(),this.$element().addClass("dx-filemanager-thumbnails");const e=ve(Rn,"dxFileManager_thumbnails");de.on(this.$element(),e,this._onContextMenu.bind(this)),this._createItemList()}_createItemList(){const e=this._isMultipleSelectionMode()?"multiple":"single",t=w("<div>").appendTo(this.$element());this._itemList=this._createComponent(t,ls,{dataSource:this._createDataSource(),selectionMode:e,selectedItemKeys:this.option("selectedItemKeys"),focusedItemKey:this.option("focusedItemKey"),activeStateEnabled:!0,hoverStateEnabled:!0,loopItemFocus:!1,focusStateEnabled:!0,onItemEnterKeyPressed:this._tryOpen.bind(this),itemThumbnailTemplate:this._getItemThumbnailContainer.bind(this),getTooltipText:this._getTooltipText.bind(this),onSelectionChanged:this._onItemListSelectionChanged.bind(this),onFocusedItemChanged:this._onItemListFocusedItemChanged.bind(this),onContentReady:this._onContentReady.bind(this)})}_onContextMenu(e){if(e.preventDefault(),e.stopPropagation(),!this._isDesktop())return;let t=null;const i=w(e.target).closest(this._getItemSelector());let n=null;i.length>0&&(n=this._itemList.getItemByItemElement(i),this._itemList.selectItem(n),t=this._getFileItemsForContextMenu(n));const s={itemData:n,itemElement:i.length?i:void 0};this._showContextMenu(t,e.target,e,s)}_getItemThumbnailCssClass(){return"dx-filemanager-thumbnails-item-thumbnail"}_getItemSelector(){return".dx-filemanager-thumbnails-item"}_getTooltipText(e){const t=e.fileItem;if(t.tooltipText)return t.tooltipText;let i=`${t.name}\r
`;return t.isDirectory||(i+=`${U.format("dxFileManager-listThumbnailsTooltipTextSize")}: ${wi(t.size)}\r
`),i+=`${U.format("dxFileManager-listThumbnailsTooltipTextDateModified")}: ${t.dateModified}`,i}_onItemDblClick(e){const t=w(e.currentTarget),i=this._itemList.getItemByItemElement(t);this._tryOpen(i)}_tryOpen(e){e&&this._raiseSelectedItemOpened(e)}_getItemsInternal(){return super._getItemsInternal().then((e=>{const t=new te;return setTimeout((()=>t.resolve(e))),t.promise()}))}_disableDragging(){return!1}_getDefaultOptions(){return X(super._getDefaultOptions(),{focusStateEnabled:!0})}_onItemListSelectionChanged(e){let{addedItemKeys:t,removedItemKeys:i}=e;const n=this.getSelectedItems(),s=n.map((r=>r.fileItem)),o=s.map((r=>r.key));this._tryRaiseSelectionChanged({selectedItemInfos:n,selectedItems:s,selectedItemKeys:o,currentSelectedItemKeys:t,currentDeselectedItemKeys:i})}_onItemListFocusedItemChanged(e){let{item:t,itemElement:i}=e;this._isMultipleSelectionMode()||this._selectItemSingleSelection(t);const n=(t==null?void 0:t.fileItem)||null;this._onFocusedItemChanged({item:n,itemKey:n==null?void 0:n.key,itemElement:i||void 0})}_getScrollable(){return this._itemList.getScrollable()}_setSelectedItemKeys(e){this._itemList.option("selectedItemKeys",e)}_setFocusedItemKey(e){this._itemList.option("focusedItemKey",e)}refresh(e,t){const i={dataSource:this._createDataSource()};return e&&Object.prototype.hasOwnProperty.call(e,"focusedItemKey")&&(i.focusedItemKey=e.focusedItemKey),e&&Object.prototype.hasOwnProperty.call(e,"selectedItemKeys")&&(i.selectedItemKeys=e.selectedItemKeys),!se(i.focusedItemKey)&&t===Je.NAVIGATION&&(this._needResetScrollPosition=!0),this._itemList.option(i),this._refreshDeferred=new te,this._refreshDeferred.promise()}_deselectItem(e){const t=this._itemList.getItemElementByItem(e);this._itemList.unselectItem(t)}_selectItemSingleSelection(e){e?this._itemList.selectItem(e):this._itemList.clearSelection()}clearSelection(){this._itemList.clearSelection()}getSelectedItems(){return this._itemList.getSelectedItems()}}const ni={showNavPane:{location:"before"},create:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},upload:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},refresh:{location:"after",showText:"inMenu",cssClass:"dx-filemanager-toolbar-has-large-icon",compactMode:{showText:"inMenu",locateInMenu:"auto"}},switchView:{location:"after"},download:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},move:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},copy:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},rename:{location:"before",compactMode:{showText:"inMenu",locateInMenu:"auto"}},delete:{location:"before",compactMode:{showText:"inMenu"}},clearSelection:{location:"after",locateInMenu:"never",compactMode:{showText:"inMenu"}},separator:{location:"before"}},hs=["visible","location","locateInMenu","disabled","showText"],us=["accessKey","elementAttr","height","hint","icon","stylingMode","tabIndex","text","width"],ps=["separator","switchView"],si={default:"dx-filemanager-i dx-filemanager-i-refresh",progress:"dx-filemanager-i dx-filemanager-i-progress",success:"dx-filemanager-i dx-filemanager-i-done",error:"dx-filemanager-i dx-filemanager-i-danger"};class ms extends Ce{_init(){super._init(),this._generalToolbarVisible=!0,this._refreshItemState={message:"",status:"default"}}_initMarkup(){this._createItemClickedAction(),this._$viewSwitcherPopup=w("<div>").addClass("dx-filemanager-view-switcher-popup"),this._generalToolbar=this._createToolbar(this.option("generalItems"),!this._generalToolbarVisible),this._fileToolbar=this._createToolbar(this.option("fileItems"),this._generalToolbarVisible),this._$viewSwitcherPopup.appendTo(this.$element()),this.$element().addClass("dx-filemanager-toolbar dx-filemanager-general-toolbar")}_render(){super._render();const e=this._getVisibleToolbar();this._checkCompactMode(e)}_clean(){delete this._commandManager,delete this._itemClickedAction,delete this._$viewSwitcherPopup,delete this._generalToolbar,delete this._fileToolbar,super._clean()}_dimensionChanged(e){if(!e||e!=="height"){const t=this._getVisibleToolbar();this._checkCompactMode(t)}}_getVisibleToolbar(){return this._generalToolbarVisible?this._generalToolbar:this._fileToolbar}_createToolbar(e,t){const i=this._getPreparedItems(e),n=w("<div>").appendTo(this.$element()),s=this._createComponent(n,Tn,{items:i,visible:!t,onItemClick:o=>this._raiseItemClicked(o)});return s.compactMode=!1,s}_getPreparedItems(e){return e=e.map((t=>{let i=t;dt(t)&&(i={name:t});const n=i.name,s=this._configureItemByCommandName(n,i);return s.originalItemData=t,n!=="separator"&&this._setItemVisibleAvailable(s),s})),this._updateSeparatorsVisibility(e),e}_updateSeparatorsVisibility(e,t){let i=!1;const n=this._getMenuItems(t),s={before:!1,center:!1,after:!1},o={before:this._getItemsInGroup(e,n,"before"),center:this._getItemsInGroup(e,n,"center"),after:this._getItemsInGroup(e,n,"after")};return e.forEach(((r,d)=>{const g=r.location;if(r.name==="separator"){const v=s[g]&&this._groupHasItemsAfter(o[g]);r.visible!==v&&(i=!0,r.visible=v),s[g]=!1}else this._isItemInMenu(n,r)||(s[g]=s[g]||r.visible),o[g].shift()})),t&&i&&t.repaint(),i}_getMenuItems(e){return(e?e._getMenuItems():[]).map((i=>i.originalItemData))}_isItemInMenu(e,t){return!!e.length&&Ie(t.locateInMenu,"never")!=="never"&&e.indexOf(t.originalItemData)!==-1}_getItemsInGroup(e,t,i){return e.filter((n=>n.location===i&&!this._isItemInMenu(t,n)))}_groupHasItemsAfter(e){for(let t=0;t<e.length;t++)if(e[t].name!=="separator"&&e[t].visible)return!0;return!1}_configureItemByCommandName(e,t){var i;let n={};const s=this._commandManager.getCommandByName(e);switch(s&&(n=this._createCommandItem(s)),e){case"separator":n=this._createSeparatorItem();break;case"switchView":n=this._createViewModeItem()}if(this._isDefaultItem(e)){const o=ni[e];X(!0,n,o);let r=n.cssClass||"";je(n,t,hs),se(t.options)&&je(n.options,t.options,us),je(n.options,t,["text","icon"]),t.cssClass&&(r=`${r} ${t.cssClass}`),r&&(n.cssClass=r),se(t.visible)||(n._autoHide=!0),n.widget==="dxButton"&&(n.showText==="inMenu"&&!se(n.options.hint)&&(n.options.hint=n.options.text),n.compactMode&&!se(n.options.hint)&&this._configureHintForCompactMode(n))}else X(!0,n,t),n.widget||(n.widget="dxButton"),n.widget==="dxButton"&&!n.compactMode&&!n.showText&&n.options&&n.options.icon&&n.options.text&&(n.compactMode={showText:"inMenu"});return e&&!n.name&&X(n,{name:e}),n.location=Ie(n.location,"before"),se((i=n.options)===null||i===void 0?void 0:i.stylingMode)||(n.widget==="dxButton"&&X(!0,n,{options:{stylingMode:"text"}}),n.widget==="dxSelectBox"&&X(!0,n,{options:{stylingMode:"filled"}})),n}_isDefaultItem(e){return!!ni[e]}_createCommandItem(e){return{widget:"dxButton",options:{text:e.text,hint:e.hint,commandText:e.text,icon:e.icon,stylingMode:"text",onClick:t=>this._executeCommand(e)}}}_createSeparatorItem(){return{template:(e,t,i)=>{w(i).addClass("dx-filemanager-toolbar-separator-item")}}}_createViewModeItem(){const e=["details","thumbnails"].map((n=>{const{text:s,icon:o}=this._commandManager.getCommandByName(n);return{name:n,text:s,icon:o}})),t=this.option("itemViewMode")==="thumbnails"?1:0,i={container:this._$viewSwitcherPopup};return vi()?i.width=Zt()?28:36:bi()&&(i.width=Zt()?34:40),{cssClass:"dx-filemanager-toolbar-viewmode-item",widget:"dxDropDownButton",options:{items:e,keyExpr:"name",selectedItemKey:this.option("itemViewMode"),displayExpr:" ",hint:e[t].text,stylingMode:"text",showArrowIcon:!1,useSelectMode:!0,dropDownOptions:i,onItemClick:n=>this._executeCommand(n.itemData.name)}}}_configureHintForCompactMode(e){e.options.hint="",e.compactMode.options=e.compactMode.options||{},e.compactMode.options.hint=e.options.text}_checkCompactMode(e){e.compactMode&&this._toggleCompactMode(e,!1);const t=this._toolbarHasItemsOverflow(e);e.compactMode!==t?(e.compactMode||this._toggleCompactMode(e,t),e.compactMode=t):e.compactMode&&this._toggleCompactMode(e,!0)}_toolbarHasItemsOverflow(e){const t=Re(e.$element()),i=e._getItemsWidth();return t<i}_toggleCompactMode(e,t){let i=!1;const n=e.option("items");n.forEach((s=>{if(s.compactMode){let o=null;t?(s.saved=this._getCompactModeOptions(s,s._available),o=s.compactMode):o=s.saved;const r=this._getCompactModeOptions(o,s._available);X(!0,s,r),i=!0}})),i=this._updateSeparatorsVisibility(n)||i,i&&e.repaint(),this._updateSeparatorsVisibility(n,e)}_getCompactModeOptions(e,t){let{showText:i,locateInMenu:n,options:s}=e;return{visible:t,showText:Ie(i,"always"),locateInMenu:Ie(n,"never"),options:{hint:s==null?void 0:s.hint}}}_ensureAvailableCommandsVisible(e){let t=!1;const i=e.option("items");i.forEach((n=>{if(n.name!=="separator"){const s=n._available;this._setItemVisibleAvailable(n),n._available!==s&&(t=!0)}})),t=this._updateSeparatorsVisibility(i)||t,t&&e.repaint(),this._updateSeparatorsVisibility(i,e)}_setItemVisibleAvailable(e){var t;const i=(t=e.originalItemData)===null||t===void 0?void 0:t.visible;e._available=this._isToolbarItemAvailable(e),e.visible=se(i)?i:e._available}_fileToolbarHasEffectiveItems(){return this._fileToolbar.option("items").some((t=>this._isFileToolbarItemAvailable(t)))}_executeCommand(e){this._commandManager.executeCommand(e)}_isToolbarItemAvailable(e){return!this._isDefaultItem(e.name)||!e._autoHide?Ie(e.visible,!0):e.name==="refresh"?this._generalToolbarVisible||!!this._isRefreshVisibleInFileToolbar:ps.indexOf(e.name)>-1?!0:this._isCommandAvailable(e.name)}_isFileToolbarItemAvailable(e){let{name:t,visible:i}=e;return!this._isDefaultItem(t)&&Ie(i,!0)||t!=="clearSelection"&&t!=="refresh"&&this._isCommandAvailable(t)}_isCommandAvailable(e){return this._commandManager.isCommandAvailable(e,this.option("contextItems"))}_updateItemInToolbar(e,t,i){e.beginUpdate();const n=e.option("items");for(let s=0;s<n.length;s++)if(n[s].name===t){e.option(`items[${s}]`,i);break}e.endUpdate()}_raiseItemClicked(e){const t=X(!0,{},e);t.itemData=e.itemData.originalItemData,this._itemClickedAction(t)}_createItemClickedAction(){this._itemClickedAction=this._createActionByOption("onItemClick")}_getDefaultOptions(){return X(super._getDefaultOptions(),{commandManager:null,generalItems:[],fileItems:[],contextItems:[],itemViewMode:"details",onItemClick:null})}_optionChanged(e){const t=e.name;switch(t){case"commandManager":case"itemViewMode":case"generalItems":case"fileItems":this.repaint();break;case"contextItems":this._update();break;case"onItemClick":this._itemClickedAction=this._createActionByOption(t);break;default:super._optionChanged(e)}}updateItemPermissions(){this.repaint(),this._restoreRefreshItemState()}_restoreRefreshItemState(){this.updateRefreshItem(this._refreshItemState.message,this._refreshItemState.status)}updateRefreshItem(e,t){let i=null,n=U.format("dxFileManager-commandRefresh"),s="inMenu";this._isRefreshVisibleInFileToolbar=!1,this._refreshItemState={message:e,status:t},t==="default"?i={options:{icon:si.default}}:(i={options:{icon:si[t]}},this._isRefreshVisibleInFileToolbar=!0,n=e,s="always");const o=X({},i,{visible:this._isRefreshVisibleInFileToolbar});this._applyRefreshItemOptions(i,o),this._refreshItemTextTimeout=this._updateRefreshItemText(t==="progress",n,s)}_updateRefreshItemText(e,t,i){const n={showText:i,options:{text:t}};if(e)return setTimeout((()=>{this._applyRefreshItemOptions(n),this._refreshItemTextTimeout=void 0}),500);this._refreshItemTextTimeout&&clearTimeout(this._refreshItemTextTimeout),this._applyRefreshItemOptions(n)}_applyRefreshItemOptions(e,t){t||(t=X({},e)),this._updateItemInToolbar(this._generalToolbar,"refresh",e),this._updateItemInToolbar(this._fileToolbar,"refresh",t)}_update(){const e=this.option("contextItems").length===0||!this._fileToolbarHasEffectiveItems();this._generalToolbarVisible!==e&&(this._generalToolbar.option("visible",e),this._fileToolbar.option("visible",!e),this._generalToolbarVisible=e,this.$element().toggleClass("dx-filemanager-general-toolbar",e),this.$element().toggleClass("dx-filemanager-file-toolbar",!e));const t=this._getVisibleToolbar();this._ensureAvailableCommandsVisible(t),this._checkCompactMode(t)}get _commandManager(){return this.option("commandManager")}}const qe={getMoveToConfig(N,e){switch(N){case"right":return{transform:`translate(${e}px, 0px)`};case"left":return{left:e};case"top":case"bottom":return{top:e};default:return}},moveTo(N){const{$element:e,position:t,direction:i="left",duration:n,complete:s}=N,o=this.getMoveToConfig(i,t),r=i==="right"?"custom":"slide";we.animate(e.get(0),{type:r,to:o,duration:n,complete:s})},margin(N){const{$element:e,margin:t,direction:i="left",duration:n,complete:s}=N,r={[`margin${Et(i,!0)}`]:t};we.animate(e.get(0),{to:r,duration:n,complete:s})},fade(N,e,t,i){we.animate(N.get(0),{type:"fade",to:e.to,from:e.from,duration:t,complete:i})},size(N){const{$element:e,size:t,direction:i="left",marginTop:n=0,duration:s,complete:o}=N,r={};i==="right"||i==="left"?r.width=t:r.height=t,i==="bottom"&&(r.marginTop=n),we.animate(e.get(0),{to:r,duration:s,complete:o})},complete(N){we.stop(N.get(0),!0)}};class Pt{constructor(e){this._drawer=e}getDrawerInstance(){return this._drawer}renderPanelContent(e){const t=this.getDrawerInstance(),i=t._getTemplate(t.option("template"));i&&i.render({container:t.content(),onRendered:()=>{e==null||e.resolve()}})}renderPosition(e,t){const i=te(),n=te(),s=this.getDrawerInstance();e&&_e.apply(w,[i,n]).done((()=>{s._animationCompleteHandler()})),this._internalRenderPosition(e,i),e||s.resizeViewContent(),this.renderShaderVisibility(e,t,n)}_getPanelOffset(e){const t=this.getDrawerInstance(),i=t.isHorizontalDirection()?t.getRealPanelWidth():t.getRealPanelHeight();return(this._getPanelSize(e)??0)-i}_getPanelSize(e){return e?this.getDrawerInstance().getMaxSize():this.getDrawerInstance().getMinSize()}renderShaderVisibility(e,t,i){const n=this.getDrawerInstance(),{opened:s}=n.option(),o=s?{from:0,to:1}:{from:1,to:0};e?qe.fade(w(n._$shader),o,t,(()=>{this._drawer._toggleShaderVisibility(s),i==null||i.resolve()})):(n._toggleShaderVisibility(s),n._$shader.css("opacity",o.to))}getPanelContent(){return w(this.getDrawerInstance().content())}setPanelSize(e){this.refreshPanelElementSize(e)}refreshPanelElementSize(e){const t=this.getDrawerInstance(),{opened:i}=t.option(),n=this._getPanelSize(i);t.isHorizontalDirection()?_i(w(t.content()),e?t.getRealPanelWidth():n):fi(w(t.content()),e?t.getRealPanelHeight():n)}isViewContentFirst(e,t){return!1}onPanelContentRendered(){}_internalRenderPosition(e,t){}}class _s extends Pt{renderPanelContent(e){delete this._initialPosition;const t=this.getDrawerInstance(),{opened:i,minSize:n,template:s,templatesRenderAsynchronously:o}=t.option();t._overlay=t._createComponent(w(t.content()),Sn,{shading:!1,container:t.content(),visualContainer:t.getOverlayTarget(),position:this._getOverlayPosition(),width:i?"auto":n??0,height:"100%",templatesRenderAsynchronously:o,animation:{show:{duration:0}},onPositioned:(function(r){this._fixOverlayPosition(r.component.$content())}).bind(this),contentTemplate:s,onContentReady:r=>{e==null||e.resolve(),this._processOverlayZIndex(r.component.content())},visible:!0,propagateOutsideClick:!0})}_fixOverlayPosition(e){const t=Ie(this._initialPosition,{left:0,top:0});Ue(e,t),this.getDrawerInstance().calcTargetPosition()==="right"&&e.css("left","auto"),this.getDrawerInstance().calcTargetPosition()==="bottom"&&(e.css("top","auto"),e.css("bottom","0px"))}_getOverlayPosition(){const e=this.getDrawerInstance(),t=e.calcTargetPosition();let i={};switch(t){case"left":i={my:"top left",at:"top left"};break;case"right":i={my:e.option("rtlEnabled")?"top left":"top right",at:"top right"};break;case"top":case"bottom":i={my:t,at:t}}return i.of=e.getOverlayTarget().get(0),i}refreshPanelElementSize(e){const t=this.getDrawerInstance(),i=t.getOverlay(),{opened:n}=t.option();i&&(t.isHorizontalDirection()?(i.option("height","100%"),i.option("width",e?t.getRealPanelWidth():this._getPanelSize(n))):(i.option("width",Re(t.getOverlayTarget())),i.option("height",e?t.getRealPanelHeight():this._getPanelSize(n))))}onPanelContentRendered(){this._updateViewContentStyles()}_updateViewContentStyles(){const e=this.getDrawerInstance(),{minSize:t}=e.option();w(e.viewContent()).css(`padding${Et(e.calcTargetPosition(),!0)}`,t),w(e.viewContent()).css("transform","inherit")}_internalRenderPosition(e,t){const i=this.getDrawerInstance(),n=w(i.content()),{opened:s,revealMode:o,animationDuration:r}=i.option(),d=i.getOverlay().$content(),g=i.calcTargetPosition(),v=this._getPanelSize(s)??0,y=this._getPanelOffset(s)*i._getPositionCorrection(),C=i.getRealPanelHeight()-v;this._updateViewContentStyles(),e?o==="slide"?(this._initialPosition=i.isHorizontalDirection()?{left:y}:{top:y},qe.moveTo({complete:()=>{t==null||t.resolve()},duration:r,direction:g,$element:n,position:y})):o==="expand"&&(this._initialPosition=i.isHorizontalDirection()?{left:0}:{top:0},Ue(d,this._initialPosition),qe.size({complete:()=>{t==null||t.resolve()},duration:r,direction:g,$element:d,size:v,marginTop:C})):o==="slide"?(this._initialPosition=i.isHorizontalDirection()?{left:y}:{top:y},Ue(n,this._initialPosition)):o==="expand"&&(this._initialPosition=i.isHorizontalDirection()?{left:0}:{top:0},Ue(d,this._initialPosition),i.isHorizontalDirection()?w(d).css("width",v):(w(d).css("height",v),g==="bottom"&&w(d).css("marginTop",C)))}getPanelContent(){return w(this.getDrawerInstance().getOverlay().content())}_processOverlayZIndex(e){const i=w(e).get(0).style.zIndex||1;this.getDrawerInstance().setZIndex(i)}isViewContentFirst(e){return e==="right"||e==="bottom"}}class fs extends Pt{_internalRenderPosition(e,t){const i=this.getDrawerInstance(),{opened:n,animationDuration:s}=i.option(),o=this._getPanelSize(!0),r=this._getPanelSize(n)*i._getPositionCorrection();if(w(i.content()).css(i.isHorizontalDirection()?"width":"height",o),i.getMinSize()){let d="padding";switch(i.calcTargetPosition()){case"left":d+="Right";break;case"right":d+="Left";break;case"top":d+="Bottom";break;case"bottom":d+="Top"}w(i.viewContent()).css(d,i.getMinSize())}e?qe.moveTo({$element:w(i.viewContent()),position:r,direction:i.calcTargetPosition(),duration:s,complete:()=>{t==null||t.resolve()}}):i.isHorizontalDirection()?Ue(w(i.viewContent()),{left:r}):Ue(w(i.viewContent()),{top:r})}onPanelContentRendered(){w(this.getDrawerInstance().viewContent()).addClass("dx-theme-background-color")}}class gs extends Pt{_internalRenderPosition(e,t){const i=this.getDrawerInstance(),{opened:n,revealMode:s,animationDuration:o}=i.option(),r=i.calcTargetPosition(),d=w(i.content()),g=this._getPanelSize(n),v=this._getPanelOffset(n);e?s==="slide"?qe.margin({complete:()=>{t==null||t.resolve()},$element:d,duration:o,direction:r,margin:v}):s==="expand"&&qe.size({complete:()=>{t==null||t.resolve()},$element:d,duration:o,direction:r,size:g}):s==="slide"?d.css(`margin${Et(r,!0)}`,v):s==="expand"&&d.css(i.isHorizontalDirection()?"width":"height",g)}isViewContentFirst(e,t){return(t?e==="left":e==="right")||e==="bottom"}}class At extends Ce{_getDefaultOptions(){return Ge({},super._getDefaultOptions(),{position:"left",opened:!1,minSize:null,maxSize:null,shading:!1,template:"panel",openedStateMode:"shrink",revealMode:"slide",animationEnabled:!0,animationDuration:400,closeOnOutsideClick:!1,contentTemplate:"content"})}_init(){super._init(),this._initStrategy(),this.$element().addClass("dx-drawer"),this._whenAnimationCompleted=void 0,this._whenPanelContentRendered=void 0,this._whenPanelContentRefreshed=void 0,this._$wrapper=w("<div>").addClass("dx-drawer-wrapper"),this._$viewContentWrapper=w("<div>").addClass("dx-drawer-content"),this._$wrapper.append(this._$viewContentWrapper),this.$element().append(this._$wrapper)}_initStrategy(){const{openedStateMode:e}=this.option();switch(e){case"push":default:this._strategy=new fs(this);break;case"shrink":this._strategy=new gs(this);break;case"overlap":this._strategy=new _s(this)}}_getAnonymousTemplateName(){return"content"}_initTemplates(){const e={};e.panel=new Vt,e.content=new Vt,this._templateManager.addDefaultTemplates(e),super._initTemplates()}_viewContentWrapperClickHandler(e){const{opened:t,shading:i}=this.option();let{closeOnOutsideClick:n}=this.option();xe(n)&&(n=n(e)),n&&t&&(this.stopAnimations(),i&&e.preventDefault(),this.hide())}_initMarkup(){super._initMarkup();const{opened:e}=this.option();this._toggleOpenedStateClass(e),this._renderPanelContentWrapper(),this._refreshOpenedStateModeClass(),this._refreshRevealModeClass(),this._renderShader(),this._refreshPositionClass(),this._whenPanelContentRendered=te(),this._strategy.renderPanelContent(this._whenPanelContentRendered),this._strategy.onPanelContentRendered(),this._renderViewContent(),de.off(this._$viewContentWrapper,rt),de.on(this._$viewContentWrapper,rt,this._viewContentWrapperClickHandler.bind(this)),this._refreshWrapperChildrenOrder()}_render(){var e;this._initMinMaxSize(),super._render(),(e=this._whenPanelContentRendered)===null||e===void 0||e.always((()=>{this._initMinMaxSize();const{revealMode:t}=this.option();this._strategy.refreshPanelElementSize(t==="slide"),this._renderPosition(!0),this._removePanelManualPosition()}))}_removePanelManualPosition(){var e;(e=this._$panelContentWrapper)!==null&&e!==void 0&&e.attr("manualposition")&&(this._$panelContentWrapper.removeAttr("manualPosition"),this._$panelContentWrapper.css({position:"",top:"",left:"",right:"",bottom:""}))}_togglePanelContentHiddenClass(){const e=()=>{var t;const{minSize:i,opened:n}=this.option(),s=i?!1:!n;(t=this._$panelContentWrapper)===null||t===void 0||t.toggleClass("dx-drawer-panel-content-hidden",s)};this._whenAnimationCompleted&&!this.option("opened")?_e(this._whenAnimationCompleted).done(e):e()}_renderPanelContentWrapper(){const{openedStateMode:e,opened:t,minSize:i}=this.option();this._$panelContentWrapper=w("<div>").addClass("dx-drawer-panel-content"),this._togglePanelContentHiddenClass();const n=this.calcTargetPosition();e==="push"&&n&&["top","bottom"].includes(n)&&this._$panelContentWrapper.addClass("dx-drawer-panel-content-push-top-or-bottom"),e!=="overlap"&&!t&&!i&&(this._$panelContentWrapper.attr("manualposition",!0),this._$panelContentWrapper.css({position:"absolute",top:"-10000px",left:"-10000px",right:"auto",bottom:"auto"})),this._$wrapper.append(this._$panelContentWrapper)}_refreshOpenedStateModeClass(e){e&&this.$element().removeClass(`dx-drawer-${e}`);const{openedStateMode:t}=this.option();this.$element().addClass(`dx-drawer-${t}`)}_refreshPositionClass(){this.$element().removeClass(["left","right","top","bottom"].map((e=>`dx-drawer-${e}`)).join(" ")).addClass(`dx-drawer-${this.calcTargetPosition()}`)}_refreshWrapperChildrenOrder(){const e=this.calcTargetPosition(),{rtlEnabled:t}=this.option();this._strategy.isViewContentFirst(e,t)?this._$wrapper.prepend(this._$viewContentWrapper):this._$panelContentWrapper&&this._$wrapper.prepend(this._$panelContentWrapper)}_refreshRevealModeClass(e){e&&this.$element().removeClass(`dx-drawer-${e}`);const{revealMode:t}=this.option();this.$element().addClass(`dx-drawer-${t}`)}_renderViewContent(){const e=this.option("contentTemplate"),t=this._getTemplate(e);if(t){const i=t.render({container:this.viewContent(),noModel:!0,transclude:this._templateManager.anonymousTemplateName===e});i.hasClass("ng-scope")&&w(this._$viewContentWrapper).children().not(".dx-drawer-shader").replaceWith(i)}}_renderShader(){this._$shader=this._$shader||w("<div>").addClass("dx-drawer-shader"),this._$shader.appendTo(this.viewContent());const{opened:e}=this.option();this._toggleShaderVisibility(e)}_initSize(){this._initMinMaxSize()}_initMinMaxSize(){const e=this.isHorizontalDirection()?this.getRealPanelWidth():this.getRealPanelHeight(),{maxSize:t,minSize:i}=this.option();this._maxSize=t||e,this._minSize=i||0}calcTargetPosition(){const{position:e,rtlEnabled:t}=this.option();return e==="before"?t?"right":"left":e==="after"?t?"left":"right":e}getOverlayTarget(){return this._$wrapper}getOverlay(){return this._overlay}getMaxSize(){return this._maxSize}getMinSize(){return this._minSize}getRealPanelWidth(){if(be()){const{templateSize:e}=this.option();return se(e)?e:Lt(this._getPanelTemplateElement()).width}return 0}getRealPanelHeight(){if(be()){const{templateSize:e}=this.option();return se(e)?e:Lt(this._getPanelTemplateElement()).height}return 0}_getPanelTemplateElement(){const e=this._strategy.getPanelContent();let t=e;return e.children().length&&(t=e.children().eq(0),e.hasClass("dx-overlay-content")&&t.hasClass("dx-template-wrapper")&&t.children().length&&(t=t.children().eq(0))),t.get(0)}isHorizontalDirection(){const e=this.calcTargetPosition();return e==="left"||e==="right"}stopAnimations(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;we.stop(this._$shader.get(0),e),we.stop(w(this.content()).get(0),e),we.stop(w(this.viewContent()).get(0),e);const t=this.getOverlay();t&&we.stop(w(t.$content()).get(0),e)}setZIndex(e){var t;this._$shader.css("zIndex",e-1),(t=this._$panelContentWrapper)===null||t===void 0||t.css("zIndex",e)}resizeContent(){this.resizeViewContent()}resizeViewContent(){gi(this.viewContent())}_isInvertedPosition(){const e=this.calcTargetPosition();return e==="right"||e==="bottom"}_renderPosition(e,t){this.stopAnimations(t),this._whenAnimationCompleted=te();const{animationDuration:i,animationEnabled:n,opened:s}=this.option(),o=!e&&n;o||this._whenAnimationCompleted.resolve(),be()&&(w(this.viewContent()).css("paddingLeft",0),w(this.viewContent()).css("paddingRight",0),w(this.viewContent()).css("paddingTop",0),w(this.viewContent()).css("paddingBottom",0),s&&this._toggleShaderVisibility(s),this._strategy.renderPosition(o,i))}_animationCompleteHandler(){var e;this.resizeViewContent(),(e=this._whenAnimationCompleted)===null||e===void 0||e.resolve()}_getPositionCorrection(){return this._isInvertedPosition()?-1:1}_dispose(){qe.complete(w(this.viewContent())),super._dispose()}_visibilityChanged(e){e&&this._dimensionChanged()}_dimensionChanged(){this._initMinMaxSize();const{revealMode:e}=this.option();this._strategy.refreshPanelElementSize(e==="slide"),this._renderPosition(!0)}_toggleShaderVisibility(e){this.option("shading")?(this._$shader.toggleClass("dx-state-invisible",!e),this._$shader.css("visibility",e?"visible":"hidden")):this._$shader.toggleClass("dx-state-invisible",!0)}_toggleOpenedStateClass(e){this.$element().toggleClass("dx-drawer-opened",e)}_refreshPanel(){w(this.viewContent()).css("left",0),w(this.viewContent()).css("transform","translate(0px, 0px)"),w(this.viewContent()).removeClass("dx-theme-background-color"),this._removePanelContentWrapper(),this._removeOverlay(),this._renderPanelContentWrapper(),this._refreshWrapperChildrenOrder(),this._whenPanelContentRefreshed=te(),this._strategy.renderPanelContent(this._whenPanelContentRefreshed),this._strategy.onPanelContentRendered(),be()&&this._whenPanelContentRefreshed.always((()=>{const{revealMode:e}=this.option();this._strategy.refreshPanelElementSize(e==="slide"),this._renderPosition(!0,!0),this._removePanelManualPosition()}))}_clean(){this._cleanFocusState(),this._removePanelContentWrapper(),this._removeOverlay()}_removePanelContentWrapper(){this._$panelContentWrapper&&this._$panelContentWrapper.remove()}_removeOverlay(){this._overlay&&(this._overlay.dispose(),delete this._overlay,delete this._$panelContentWrapper)}_optionChanged(e){switch(e.name){case"width":super._optionChanged(e),this._dimensionChanged();break;case"opened":this._renderPosition(),this._toggleOpenedStateClass(e.value),this._togglePanelContentHiddenClass();break;case"position":this._refreshPositionClass(),this._refreshWrapperChildrenOrder(),this._invalidate();break;case"contentTemplate":case"template":this._invalidate();break;case"openedStateMode":this._initStrategy(),this._refreshOpenedStateModeClass(e.previousValue),this._refreshPanel();break;case"minSize":this._initMinMaxSize(),this._renderPosition(!0),this._togglePanelContentHiddenClass();break;case"maxSize":this._initMinMaxSize(),this._renderPosition(!0);break;case"revealMode":this._refreshRevealModeClass(e.previousValue),this._refreshPanel();break;case"shading":{const{opened:t}=this.option();this._toggleShaderVisibility(t);break}case"animationEnabled":case"animationDuration":case"closeOnOutsideClick":break;default:super._optionChanged(e)}}content(){return this._$panelContentWrapper?St(this._$panelContentWrapper):void 0}viewContent(){return St(this._$viewContentWrapper)}show(){return this.toggle(!0)}hide(){return this.toggle(!1)}toggle(e){var t;const{opened:i}=this.option(),n=e??!i;return this.option("opened",n),(t=this._whenAnimationCompleted)===null||t===void 0?void 0:t.promise()}}ft("dxDrawer",At);class Is extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._operationCount=0,this.$element().addClass("dx-filemanager-progress-panel");const e=w("<div>").appendTo(this.$element()),t=w("<div>").addClass("dx-filemanager-progress-panel-container").appendTo(e);this._scrollView=this._createComponent(e,Mt,{scrollByContent:!0,scrollByThumb:!0,showScrollbar:"onScroll"});const i=w("<div>").addClass("dx-filemanager-progress-panel-title").appendTo(t);w("<div>").text(U.format("dxFileManager-notificationProgressPanelTitle")).addClass("dx-filemanager-progress-panel-title-text").appendTo(i);const n=w("<div>").addClass("dx-filemanager-progress-panel-close-button").appendTo(i);this._createComponent(n,He,{icon:"close",stylingMode:"text",onClick:()=>this._raisePanelClosed()}),this._$infosContainer=w("<div>").addClass("dx-filemanager-progress-panel-infos-container").appendTo(t),this._renderEmptyListText()}_getDefaultOptions(){return X(super._getDefaultOptions(),{onOperationClosed:null,onOperationCanceled:null,onOperationItemCanceled:null,onPanelClosed:null})}_initActions(){this._actions={onOperationClosed:this._createActionByOption("onOperationClosed"),onOperationCanceled:this._createActionByOption("onOperationCanceled"),onOperationItemCanceled:this._createActionByOption("onOperationItemCanceled"),onPanelClosed:this._createActionByOption("onPanelClosed")}}_optionChanged(e){const t=e.name;switch(t){case"test":break;case"onOperationClosed":case"onOperationCanceled":case"onOperationItemCanceled":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}addOperation(e,t,i){this._operationCount?w("<div>").addClass("dx-filemanager-progress-panel-separator").prependTo(this._$infosContainer):this._$infosContainer.empty(),this._operationCount++;const n={customCloseHandling:t,allowProgressAutoUpdate:Ie(i,!0)},s=w("<div>").addClass("dx-filemanager-progress-panel-info").prependTo(this._$infosContainer);n.$info=s;const o=w("<div>").addClass("dx-filemanager-progress-panel-common").appendTo(s);return n.common=this._createProgressBox(o,{commonText:e,showCloseButton:!0,showCloseButtonAlways:t,onCloseButtonClick:()=>this._closeOperation(n)}),n}addOperationDetails(e,t,i){e.$info.addClass("dx-filemanager-progress-panel-info-with-details");const n=w("<div>").addClass("dx-filemanager-progress-panel-details").appendTo(e.$info);e.details=t.map(((s,o)=>(s.info=e,this._createDetailsItem(n,s,o,!1,i))))}_createDetailsItem(e,t,i,n,s){const o=w("<div>").appendTo(e);return i!==-1&&o.addClass("dx-card"),this._createProgressBox(o,{commonText:t.commonText,imageUrl:t.imageUrl,skipProgressBox:n,showCloseButton:s,showCloseButtonAlways:s,onCloseButtonClick:()=>this._cancelOperationItem(t,i)})}completeOperationItem(e,t,i){e.allowProgressAutoUpdate&&this.updateOperationItemProgress(e,t,100,i),this._setCloseButtonVisible(e.details[t],!1)}updateOperationItemProgress(e,t,i,n){this.updateOperationCommonProgress(e,n),e.details&&e.details[t].progressBar.option("value",i)}updateOperationCommonProgress(e,t){var i;(i=e.common.progressBar)===null||i===void 0||i.option("value",t)}completeOperation(e,t,i,n){e.completed=!0,e.common.$commonText.text(t),i?this._removeProgressBar(e.common):e.allowProgressAutoUpdate&&this.updateOperationCommonProgress(e,100),n&&this._setProgressBarText(e.common,n),this._setCloseButtonVisible(e.common,!0)}completeSingleOperationWithError(e,t){var i;const n=(i=e.details)===null||i===void 0?void 0:i[0];e.completed=!0,this._renderOperationError(n||e.common,t),this._setCloseButtonVisible(e.common,!0),n&&this._setCloseButtonVisible(n,!1)}addOperationDetailsError(e,t,i){const n=e.details[t];this._renderOperationError(n,i),this._setCloseButtonVisible(n,!1)}_renderError(e,t,i){w("<div>").text(i).addClass("dx-filemanager-progress-box-error").appendTo(e)}_renderEmptyListText(){this._$infosContainer.text(U.format("dxFileManager-notificationProgressPanelEmptyListText"))}_renderOperationError(e,t){this._removeProgressBar(e),this._renderError(e.$wrapper,e.$commonText,t)}_removeProgressBar(e){e.progressBar&&(e.progressBar.dispose(),e.progressBar.$element().remove(),e.progressBar=null)}_createProgressBox(e,t){e.addClass("dx-filemanager-progress-box"),t.showCloseButtonAlways||e.addClass("dx-filemanager-progress-box-without-close-button"),t.imageUrl&&gt(t.imageUrl).addClass("dx-filemanager-progress-box-image").appendTo(e);const i=w("<div>").addClass("dx-filemanager-progress-box-wrapper").appendTo(e),n=w("<div>").addClass("dx-filemanager-progress-box-common").text(t.commonText).appendTo(i);let s=null;if(!t.skipProgressBox){const r=w("<div>").addClass("dx-filemanager-progress-box-progress-bar").appendTo(i);s=this._createComponent(r,xi,{min:0,max:100,width:"100%",validationMessageMode:"always",statusFormat:(d,g)=>this._getStatusString(d,g)})}let o=null;if(t.showCloseButton){const r=w("<div>").addClass("dx-filemanager-progress-box-close-button").appendTo(e);o=this._createComponent(r,He,{icon:"dx-filemanager-i dx-filemanager-i-cancel",stylingMode:"text",visible:t.showCloseButtonAlways,onClick:t.onCloseButtonClick})}return{$commonText:n,progressBar:s,$element:e,$wrapper:i,closeButton:o}}_setCloseButtonVisible(e,t){e.closeButton&&(e.$element.toggleClass("dx-filemanager-progress-box-without-close-button",!t),e.closeButton.option("visible",t))}_setProgressBarText(e,t){e.progressBar.option("statusFormat",(()=>t))}_closeOperation(e){e.customCloseHandling&&!e.completed?(this._raiseOperationCanceled(e),this._setCloseButtonVisible(e.common,!1),e.details.forEach((t=>this._displayClosedOperationItem(t)))):(this._raiseOperationClosed(e),e.$info.next(".dx-filemanager-progress-panel-separator").remove(),e.$info.remove(),this._operationCount--,this._operationCount||this._renderEmptyListText())}_cancelOperationItem(e,t){this._raiseOperationItemCanceled(e,t);const i=e.info.details[t];this._displayClosedOperationItem(i)}_displayClosedOperationItem(e){this._setProgressBarText(e,U.format("dxFileManager-notificationProgressPanelOperationCanceled")),this._setCloseButtonVisible(e,!1)}_getStatusString(e,t){return e===1?U.format("Done"):Math.round(100*e)+"%"}_raiseOperationClosed(e){this._actions.onOperationClosed({info:e})}_raiseOperationCanceled(e){this._actions.onOperationCanceled({info:e})}_raiseOperationItemCanceled(e,t){this._actions.onOperationItemCanceled({item:e,itemIndex:t})}_raisePanelClosed(){this._actions.onPanelClosed()}}const kt="__operationInfoManager",Me={default:"default",progress:"progress",error:"error",success:"success"};class Ai{constructor(e){let{onActionProgressStatusChanged:t,isActual:i}=e;this._id=new Le().toString(),this._isActual=i||!1,this._actionProgressStatus=Me.default,this._raiseActionProgress=t}getId(){return this._id}isActual(){return this._isActual}createErrorDetailsProgressBox(e,t,i){const n=this._createDetailsItem(e,t);this.renderError(n.$wrapper,i)}renderError(e,t){w("<div>").text(t).addClass("dx-filemanager-progress-box-error").appendTo(e)}isActionProgressStatusDefault(){return this._actionProgressStatus===Me.default}_createDetailsItem(e,t){const i=w("<div>").appendTo(e);return this._createProgressBox(i,{commonText:t.commonText,imageUrl:t.imageUrl})}_createProgressBox(e,t){e.addClass("dx-filemanager-progress-box"),t.imageUrl&&gt(t.imageUrl).addClass("dx-filemanager-progress-box-image").appendTo(e);const i=w("<div>").addClass("dx-filemanager-progress-box-wrapper").appendTo(e);return{$commonText:w("<div>").addClass("dx-filemanager-progress-box-common").text(t.commonText).appendTo(i),$element:e,$wrapper:i}}}class ys extends Ai{addOperation(){return{[kt]:this._id}}addOperationDetails(){}updateOperationItemProgress(){}completeOperationItem(){}finishOperation(){}completeOperation(){}completeSingleOperationWithError(){}addOperationDetailsError(){}handleDimensionChanged(){return!1}ensureProgressPanelCreated(){}tryHideActionProgress(){this._updateActionProgress("",Me.default)}updateActionProgressStatus(){this._updateActionProgress("",Me.default)}_updateActionProgress(e,t){t!==Me.default&&t!==Me.progress||(this._actionProgressStatus=t,this._raiseActionProgress(e,t))}hasNoOperations(){return!0}get _operationInProgressCount(){return 0}set _operationInProgressCount(e){}get _failedOperationCount(){return 0}set _failedOperationCount(e){}}class Cs extends Ai{constructor(e){super(e),this._failedOperationCount=0,this._operationInProgressCount=0}addOperation(e,t,i){this._operationInProgressCount++;const n=this._progressPanel.addOperation(e,t,i);return n[kt]=this._id,this._updateActionProgress(e,Me.progress),n}addOperationDetails(e,t,i){this._progressPanel.addOperationDetails(e,t,i)}updateOperationItemProgress(e,t,i,n){this._progressPanel.updateOperationItemProgress(e,t,i,n)}completeOperationItem(e,t,i){this._progressPanel.completeOperationItem(e,t,i)}finishOperation(e,t){this._progressPanel.updateOperationCommonProgress(e,t)}completeOperation(e,t,i,n){this._operationInProgressCount--,i&&this._failedOperationCount++,this._progressPanel.completeOperation(e,t,i,n)}completeSingleOperationWithError(e,t){this._progressPanel.completeSingleOperationWithError(e,t.detailErrorText),this._notifyError(t)}addOperationDetailsError(e,t){this._progressPanel.addOperationDetailsError(e,t.itemIndex,t.detailErrorText),this._notifyError(t)}handleDimensionChanged(){return this._progressPanel&&this._progressPanel.$element().detach(),!0}ensureProgressPanelCreated(e,t){if(this._progressPanel)this._progressPanel.$element().appendTo(e);else{const i=w("<div>").appendTo(e),n=this._getProgressPanelComponent();this._progressPanel=new n(i,X({},t,{onOperationClosed:s=>{let{info:o}=s;return this._onProgressPanelOperationClosed(o)}}))}}_getProgressPanelComponent(){return Is}_onProgressPanelOperationClosed(e){e.hasError&&(this._failedOperationCount--,this.tryHideActionProgress())}tryHideActionProgress(){this.hasNoOperations()&&this._updateActionProgress("",Me.default)}updateActionProgressStatus(e){if(e){const t=this._failedOperationCount===0?Me.success:Me.error;this._updateActionProgress("",t)}}_notifyError(e){const t=this.hasNoOperations()?Me.default:Me.error;this._updateActionProgress(e.commonErrorText,t)}_updateActionProgress(e,t){this._actionProgressStatus=t,this._raiseActionProgress(e,t)}hasNoOperations(){return this._operationInProgressCount===0&&this._failedOperationCount===0}get _operationInProgressCount(){return this._operationInProgressCountInternal}set _operationInProgressCount(e){this._operationInProgressCountInternal=e}get _failedOperationCount(){return this._failedOperationCountInternal}set _failedOperationCount(e){this._failedOperationCountInternal=e}}const vs=ct();class bs extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._isInAdaptiveState=this._isSmallScreen(),this._managerMap={},this._notificationManagerStubId=null,this._setNotificationManager();const e=this.option("progressPanelContainer"),t=w("<div>").addClass("dx-filemanager-notification-drawer").appendTo(e);w("<div>").addClass("dx-filemanager-notification-drawer-panel").appendTo(t);const i=X({opened:!1,position:"right",template:o=>this._ensureProgressPanelCreated(o)},this._getProgressDrawerAdaptiveOptions());this._progressDrawer=this._createComponent(t,At,i);const n=t.find(".dx-filemanager-notification-drawer-panel").first(),s=this.option("contentTemplate");xe(s)&&s(n,this)}_setNotificationManager(e){if(e=X({onActionProgressStatusChanged:this._raiseActionProgress.bind(this)},e),!this._notificationManagerStubId){const t=new ys(e);this._notificationManagerStubId=t.getId(),this._managerMap[this._notificationManagerStubId]=t}if(!this._isProgressDrawerDisabled()){const t=this._getProgressManagerComponent();e.isActual=!0;const i=new t(e);this._managerMap[i.getId()]=i}}_getNotificationManager(e){const t=(e==null?void 0:e[kt])||this._getActualNotificationManagerId();return this._managerMap[t]||this._managerMap[this._notificationManagerStubId]}_clearManagerMap(){const e=this._managerMap[this._notificationManagerStubId];delete this._managerMap,this._managerMap={[this._notificationManagerStubId]:e}}_getActualNotificationManagerId(){return Object.keys(this._managerMap).filter((e=>this._managerMap[e].isActual()))[0]}tryShowProgressPanel(){const e=new te,t=this._getNotificationManager();return t.isActionProgressStatusDefault()||this._isProgressDrawerOpened()||this._isProgressDrawerDisabled()?e.resolve().promise():(setTimeout((()=>{this._progressDrawer.show().done(e.resolve),this._hidePopup(),t.tryHideActionProgress()})),e.promise())}addOperation(e,t,i){return this._getNotificationManager().addOperation(e,t,i)}addOperationDetails(e,t,i){this._getNotificationManager(e).addOperationDetails(e,t,i)}updateOperationItemProgress(e,t,i,n){this._getNotificationManager(e).updateOperationItemProgress(e,t,i,n)}completeOperationItem(e,t,i){this._getNotificationManager(e).completeOperationItem(e,t,i)}finishOperation(e,t){this._getNotificationManager(e).finishOperation(e,t)}completeOperation(e,t,i,n){const s=this._getNotificationManager(e);i||this._showPopup(t),s.completeOperation(e,t,i,n),!this._isProgressDrawerOpened()||!s.hasNoOperations()?s.updateActionProgressStatus(e):s.tryHideActionProgress()}completeSingleOperationWithError(e,t){this._getNotificationManager(e).completeSingleOperationWithError(e,t),this._showPopupError(t)}addOperationDetailsError(e,t){this._getNotificationManager(e).addOperationDetailsError(e,t),this._showPopupError(t)}_hideProgressPanel(){setTimeout((()=>this._progressDrawer.hide()))}_isSmallScreen(){return be()?Re(vs)<=1e3:!1}_dimensionChanged(e){e&&e==="height"||this._checkAdaptiveState()}_checkAdaptiveState(){const e=this._isInAdaptiveState;if(this._isInAdaptiveState=this._isSmallScreen(),e!==this._isInAdaptiveState&&this._progressDrawer&&this._getNotificationManager().handleDimensionChanged()){const i=this._getProgressDrawerAdaptiveOptions();this._progressDrawer.option(i)}}_getProgressDrawerAdaptiveOptions(){return this._isInAdaptiveState?{openedStateMode:"overlap",shading:!0,hideOnOutsideClick:!0}:{openedStateMode:"shrink",shading:!1,hideOnOutsideClick:!1}}_ensureProgressPanelCreated(e){this._getNotificationManager().ensureProgressPanelCreated(e,{onOperationCanceled:i=>{let{info:n}=i;return this._raiseOperationCanceled(n)},onOperationItemCanceled:i=>{let{item:n,itemIndex:s}=i;return this._raiseOperationItemCanceled(n,s)},onPanelClosed:()=>this._hideProgressPanel()})}_getProgressManagerComponent(){return Cs}_isProgressDrawerDisabled(){return!this.option("showProgressPanel")}_isProgressDrawerOpened(){return this._progressDrawer.option("opened")}_hidePopup(e){!this.option("showNotificationPopup")&&!e||this._getNotificationPopup().hide()}_showPopup(e,t){this._isProgressDrawerOpened()||!this.option("showNotificationPopup")||(this._getNotificationPopup().$wrapper().toggleClass("dx-filemanager-notification-popup-error",!!t),this._getNotificationPopup().option("contentTemplate",e),this._getNotificationPopup().option("visible")||this._getNotificationPopup().show())}_showPopupError(e){if(!this.option("showNotificationPopup"))return;const t=this._getNotificationManager(),i=w("<div>"),n=w("<div>").addClass("dx-filemanager-notification-common").text(e.commonErrorText),s=w("<div>").addClass("dx-filemanager-notification-separator");w("<div>").appendTo(s);const o=w("<div>").addClass("dx-filemanager-notification-details");e.item?t.createErrorDetailsProgressBox(o,e.item,e.detailErrorText):(n.addClass("dx-filemanager-notification-common-no-item"),t.renderError(o,e.detailErrorText)),i.append(n,s,o),this._showPopup(i,!0)}_getNotificationPopup(){if(!this._notificationPopup){const e=w("<div>").appendTo(this.$element());this._notificationPopup=this._createComponent(e,Ci,{container:this.$element(),width:"auto",height:"auto",showTitle:!1,dragEnabled:!1,shading:!1,visible:!1,hideOnOutsideClick:!0,animation:{duration:0},position:{my:"right top",at:"right top",of:this._progressDrawer.$element().find(this.option("positionTargetSelector")),offset:"-10 -5"},_wrapperClassExternal:"dx-filemanager-notification-popup"})}return this._notificationPopup}_raiseActionProgress(e,t){this._actions.onActionProgress({message:e,status:t})}_raiseOperationCanceled(e){this._actions.onOperationCanceled({info:e})}_raiseOperationItemCanceled(e,t){this._actions.onOperationItemCanceled({item:e,itemIndex:t})}_initActions(){this._actions={onActionProgress:this._createActionByOption("onActionProgress"),onOperationCanceled:this._createActionByOption("onOperationCanceled"),onOperationItemCanceled:this._createActionByOption("onOperationItemCanceled")}}_getDefaultOptions(){return X(super._getDefaultOptions(),{progressPanelContainer:null,contentTemplate:null,onActionProgress:null,onOperationCanceled:null,onOperationItemCanceled:null,showProgressPanel:!0,showNotificationPopup:!0})}_optionChanged(e){const t=e.name;switch(t){case"progressPanelContainer":case"contentTemplate":break;case"showProgressPanel":this._setNotificationManager(),this._getNotificationManager().updateActionProgressStatus(),e.value||(this._hideProgressPanel(),this._clearManagerMap()),this._progressDrawer.repaint();break;case"showNotificationPopup":e.value||this._hidePopup(!0);break;case"onActionProgress":case"onOperationCanceled":case"onOperationItemCanceled":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}}const xs="dx-filemanager-dialog-popup";class Tt extends Ce{_initMarkup(){super._initMarkup(),this._createOnClosedAction();const e=this._getDialogOptions(),t=w("<div>").appendTo(this.$element()),i={showTitle:!0,title:e.title,visible:!1,hideOnOutsideClick:!0,contentTemplate:this._createContentTemplate.bind(this),toolbarItems:[{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:e.buttonText,onClick:this._applyDialogChanges.bind(this)}},{widget:"dxButton",toolbar:"bottom",location:"after",options:{text:U.format("dxFileManager-dialogButtonCancel"),onClick:this._closeDialog.bind(this)}}],onInitialized:n=>{let{component:s}=n;s.registerKeyHandler("enter",this._applyDialogChanges.bind(this))},onHiding:this._onPopupHiding.bind(this),onShown:this._onPopupShown.bind(this),_wrapperClassExternal:`${xs} ${e.popupCssClass??""}`};se(e.height)&&(i.height=e.height),se(e.maxHeight)&&(i.maxHeight=e.maxHeight),this._popup=this._createComponent(t,Ci,i)}show(){this._dialogResult=null,this._popup.show()}_getDialogOptions(){return{title:"Title",buttonText:"ButtonText",contentCssClass:"",popupCssClass:""}}_createContentTemplate(e){this._$contentElement=w("<div>").appendTo(e).addClass("dx-filemanager-dialog");const t=this._getDialogOptions().contentCssClass;t&&this._$contentElement.addClass(t)}_getDialogResult(){return null}_applyDialogChanges(){const e=this._getDialogResult();e&&(this._dialogResult=e,this._closeDialog())}_closeDialog(){this._popup.hide()}_onPopupHiding(){this._onClosedAction({dialogResult:this._dialogResult})}_onPopupShown(){}_createOnClosedAction(){this._onClosedAction=this._createActionByOption("onClosed")}_setTitle(e){this._popup.option("title",e)}_setApplyButtonOptions(e){this._popup.option("toolbarItems[0].options",e)}_getDefaultOptions(){return X(super._getDefaultOptions(),{onClosed:null})}_optionChanged(e){e.name==="onClosed"?this._createOnPathChangedAction():super._optionChanged(e)}}const ws="dx-filemanager-dialog-name-editor",Ss="dx-filemanager-dialog-name-editor-popup";class oi extends Tt{show(e){e=e||"",this._nameTextBox?this._nameTextBox.option("value",e):this._initialNameValue=e,super.show()}_onPopupShown(){if(!this._nameTextBox)return;const e=this._nameTextBox._input();e.length&&e[0].select(),this._nameTextBox.focus()}_getDialogOptions(){return X(super._getDialogOptions(),{title:this.option("title"),buttonText:this.option("buttonText"),contentCssClass:ws,popupCssClass:Ss})}_createContentTemplate(e){super._createContentTemplate(e),this._nameTextBox=this._createComponent(w("<div>"),Un,{value:this._initialNameValue,onEnterKey:()=>this._hasCompositionJustEnded&&this._applyDialogChanges(),onKeyDown:t=>this._checkCompositionEnded(t)}),this._$contentElement.append(this._nameTextBox.$element())}_checkCompositionEnded(e){let{event:t}=e;this._hasCompositionJustEnded=t.which!==229}_getDialogResult(){const e=this._nameTextBox.option("value");return e?{name:e}:null}_getDefaultOptions(){return X(super._getDefaultOptions(),{title:"",buttonText:""})}}const Ds="dx-filemanager-dialog-folder-chooser",Es="dx-filemanager-dialog-folder-chooser-popup";class Ms extends Tt{show(){var e;this._setSelectedDirInfo(null),(e=this._filesTreeView)===null||e===void 0||e.refresh(),super.show()}switchToCopyDialog(e){this._targetItemInfos=e,this._setTitle(U.format("dxFileManager-dialogDirectoryChooserCopyTitle")),this._setApplyButtonOptions({text:U.format("dxFileManager-dialogDirectoryChooserCopyButtonText"),disabled:!0})}switchToMoveDialog(e){this._targetItemInfos=e,this._setTitle(U.format("dxFileManager-dialogDirectoryChooserMoveTitle")),this._setApplyButtonOptions({text:U.format("dxFileManager-dialogDirectoryChooserMoveButtonText"),disabled:!0})}_getDialogOptions(){return X(super._getDialogOptions(),{contentCssClass:Ds,popupCssClass:Es})}_createContentTemplate(e){super._createContentTemplate(e),this._filesTreeView=this._createComponent(w("<div>"),Fi,{getDirectories:this.option("getDirectories"),getCurrentDirectory:()=>this._getDialogSelectedDirectory(),onDirectoryClick:t=>this._onFilesTreeViewDirectoryClick(t),onFilesTreeViewContentReady:()=>this._toggleUnavailableLocationsDisabled(!0)}),this._$contentElement.append(this._filesTreeView.$element())}_getDialogResult(){const e=this._getDialogSelectedDirectory();return e&&{folder:e}}_getDefaultOptions(){return X(super._getDefaultOptions(),{getItems:null})}_getDialogSelectedDirectory(){return this._selectedDirectoryInfo}_onFilesTreeViewDirectoryClick(e){let{itemData:t}=e;this._setSelectedDirInfo(t),this._filesTreeView.updateCurrentDirectory()}_setSelectedDirInfo(e){this._selectedDirectoryInfo=e,this._setApplyButtonOptions({disabled:!e})}_onPopupShown(){this._toggleUnavailableLocationsDisabled(!0),super._onPopupShown()}_onPopupHiding(){this._toggleUnavailableLocationsDisabled(!1),super._onPopupHiding()}_toggleUnavailableLocationsDisabled(e){if(!this._filesTreeView)return;const t=this._getLocationsToProcess(e);this._filesTreeView.toggleDirectoryExpandedStateRecursive(t.locationsToExpand[0],e).then((()=>this._filesTreeView.toggleDirectoryLineExpandedState(t.locationsToCollapse,!e).then((()=>t.locationKeysToDisable.forEach((i=>this._filesTreeView.toggleNodeDisabledState(i,e)))))))}_getLocationsToProcess(e){const t={},i={};this._targetItemInfos.forEach((o=>{o.parentDirectory&&(t[o.parentDirectory.getInternalKey()]=o.parentDirectory),o.fileItem.isDirectory&&(i[o.getInternalKey()]=o)}));const n=qt(t),s=qt(i);return{locationsToExpand:e?n.values:[],locationsToCollapse:e?s.values:[],locationKeysToDisable:n.keys.concat(...s.keys)}}}const Fs="dx-filemanager-dialog-delete-item",Ps="dx-filemanager-dialog-delete-item-popup";class As extends Tt{show(e){let{itemName:t,itemCount:i}=e;const n=i===1?U.format("dxFileManager-dialogDeleteItemSingleItemConfirmation",t):U.format("dxFileManager-dialogDeleteItemMultipleItemsConfirmation",i);this._$text?this._$text.text(n):this._initialText=n,super.show()}_getDialogOptions(){return X(super._getDialogOptions(),{title:U.format("dxFileManager-dialogDeleteItemTitle"),buttonText:U.format("dxFileManager-dialogDeleteItemButtonText"),contentCssClass:Fs,popupCssClass:Ps,height:"auto",maxHeight:"80vh"})}_createContentTemplate(e){super._createContentTemplate(e),this._$text=w("<div>").text(this._initialText).appendTo(this._$contentElement),this._createComponent(this._$contentElement,Mt,{width:"100%",height:"100%"})}_getDialogResult(){return{}}}class ks{constructor(e,t){this._$element=e,this._options=t;const i={onClosed:this._options.onDialogClosed,rtlEnabled:this._options.rtlEnabled},n=w("<div>").appendTo(this._$element);this._chooseDirectoryDialog=new Ms(n,X(i,this._options.chooseDirectoryDialog));const s=w("<div>").appendTo(this._$element);this._renameItemDialog=new oi(s,X(i,{title:U.format("dxFileManager-dialogRenameItemTitle"),buttonText:U.format("dxFileManager-dialogRenameItemButtonText")}));const o=w("<div>").appendTo(this._$element);this._createItemDialog=new oi(o,X(i,{title:U.format("dxFileManager-dialogCreateDirectoryTitle"),buttonText:U.format("dxFileManager-dialogCreateDirectoryButtonText")}));const r=w("<div>").appendTo(this._$element);this._deleteItemDialog=new As(r,i)}getCopyDialog(e){return this._chooseDirectoryDialog.switchToCopyDialog(e),this._chooseDirectoryDialog}getMoveDialog(e){return this._chooseDirectoryDialog.switchToMoveDialog(e),this._chooseDirectoryDialog}getRenameItemDialog(){return this._renameItemDialog}getCreateItemDialog(){return this._createItemDialog}getDeleteItemDialog(){return this._deleteItemDialog}updateDialogRtl(e){[this._chooseDirectoryDialog,this._renameItemDialog,this._createItemDialog,this._deleteItemDialog].forEach((t=>{t.option("rtlEnabled",e)}))}}const at=ct();let Ts=()=>w("<input>").attr("type","file");const xt=()=>!!at.FormData;class Os{constructor(e,t){this.file=e,this.chunkSize=t,this.index=0}read(){if(!this.file)return null;const e=this.createBlobResult(this.file,this.index,this.chunkSize);return e.isCompleted&&(this.file=null),this.index+=1,e}createBlobResult(e,t,i){const n=t*i;return{blob:this.sliceFile(e,n,i),index:t,isCompleted:n+i>=e.size}}sliceFile(e,t,i){return e.slice?e.slice(t,t+i):"webkitSlice"in e&&typeof e.webkitSlice=="function"?e.webkitSlice(t,t+i):null}}class ki{constructor(e){this.fileUploader=e}upload(e){if(e.isInitialized&&e.isAborted){var t;(t=this.fileUploader)===null||t===void 0||t._resetFileState(e)}e.isValid()&&!e.uploadStarted&&(this._prepareFileBeforeUpload(e),this._uploadCore(e))}abortUpload(e){var t;if(!(e._isError||e._isLoaded||e.isAborted||!e.uploadStarted)&&(e.isAborted=!0,(t=e.request)===null||t===void 0||t.abort(),this._isCustomCallback("abortUpload"))){const{abortUpload:n}=this.fileUploader.option(),s=this._createUploadArgument(e);let o=null;try{const r=n==null?void 0:n(e.value,s);o=_t(r)}catch(r){o=te().reject(r).promise()}if(o&&"done"in o){var i;(i=o)===null||i===void 0||i.done((()=>e.onAbort.fire())).fail((r=>this._handleFileError(e,r)))}}}_beforeSend(e,t){var i,n;const s=this._createUploadArgument(t);(i=(n=this.fileUploader)._beforeSendAction)===null||i===void 0||i.call(n,{request:e,file:t.value,uploadInfo:s}),t.request=e}_createUploadArgument(e){return{bytesUploaded:0,chunkCount:0,customData:{},chunkBlob:new Blob,chunkIndex:0}}_uploadCore(e){}_isCustomCallback(e){var t;const i=(t=this.fileUploader)===null||t===void 0?void 0:t.option(e);return i&&xe(i)}_handleProgress(e,t){e._isError||(e._isProgressStarted=!0,this._handleProgressCore(e,t))}_handleProgressCore(e,t){}_handleFileError(e,t){e._isError=!0,e.onError.fire(t)}_prepareFileBeforeUpload(e){if(e.$file){var t;(t=e.progressBar)===null||t===void 0||t.dispose(),this.fileUploader._createFileProgressBar(e)}e.isInitialized||(e.onLoadStart.add(this._onUploadStarted.bind(this,e)),e.onLoad.add(this._onLoadedHandler.bind(this,e)),e.onError.add(this._onErrorHandler.bind(this,e)),e.onAbort.add(this._onAbortHandler.bind(this,e)),e.onProgress.add(this._onProgressHandler.bind(this,e)),e.isInitialized=!0)}_shouldHandleError(e,t){return(this._isStatusError(t.status)||!e._isProgressStarted)&&!e.isAborted}_isStatusError(e){return e>=400&&e<500||e>=500&&e<600}_onUploadStarted(e,t){var i,n;e.uploadStarted=!0,(i=this.fileUploader)===null||i===void 0||(n=i._uploadStartedAction)===null||n===void 0||n.call(i,{file:e.value,event:t,request:e.request})}_onAbortHandler(e,t){var i,n,s;const o={file:e.value,event:t,request:e.request,message:(i=this.fileUploader)===null||i===void 0?void 0:i._getUploadAbortedStatusMessage()};(n=(s=this.fileUploader)._uploadAbortedAction)===null||n===void 0||n.call(s,o),this.fileUploader._setStatusMessage(e,o.message),this.fileUploader._handleAllFilesUploaded()}_onErrorHandler(e,t){var i,n,s,o;const{uploadFailedMessage:r}=this.fileUploader.option(),d={file:e.value,event:void 0,request:e.request,error:t,message:r};(i=(n=this.fileUploader)._uploadErrorAction)===null||i===void 0||i.call(n,d),(s=(o=this.fileUploader)._setStatusMessage)===null||s===void 0||s.call(o,e,d.message),this.fileUploader._handleAllFilesUploaded()}_onLoadedHandler(e,t){var i,n;const{uploadedMessage:s}=this.fileUploader.option(),o={file:e.value,event:t,request:e.request,message:s};e._isLoaded=!0,(i=(n=this.fileUploader)._uploadedAction)===null||i===void 0||i.call(n,o),this.fileUploader._setStatusMessage(e,o.message),this.fileUploader._handleAllFilesUploaded()}_onProgressHandler(e,t){if(e){const i=this.fileUploader._getTotalFilesSize(),n=this.fileUploader._getTotalLoadedFilesSize(),s=t.loaded??0,o=Math.min(s,e.value.size),r=o-e.loadedSize;e.loadedSize=o,this.fileUploader._updateTotalProgress(i,n+r),this.fileUploader._updateProgressBar(e,this._getLoadedData(o,t.total,r,t))}}_getLoadedData(e,t,i,n){return{loaded:e,total:t,currentSegmentSize:i}}_extendFormData(e){const{uploadCustomData:t}=this.fileUploader.option();for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&se(t[i])&&e.append(i,t[i])}}class Ti extends ki{constructor(e){super(e);const{chunkSize:t}=this.fileUploader.option();this.chunkSize=t??0}_uploadCore(e){const t=e.value,i={name:t.name,loadedBytes:0,type:t.type,blobReader:new Os(t,this.chunkSize),guid:new Le,fileSize:t.size,count:this._getFileChunksCount(t),customData:{}};e.chunksData=i,this._sendChunk(e,i)}_getFileChunksCount(e){return e.size===0?1:Math.ceil(e.size/this.chunkSize)}_sendChunk(e,t){const i=t.blobReader.read();t.currentChunk=i,i&&this._sendChunkCore(e,t,i).done((()=>{var n;e.isAborted||(t.loadedBytes+=((n=i.blob)===null||n===void 0?void 0:n.size)??0,e.onProgress.fire({loaded:t.loadedBytes,total:e.value.size}),i.isCompleted&&e.onLoad.fire(),setTimeout((()=>this._sendChunk(e,t))))})).fail((n=>{this._shouldHandleError(e,n)&&this._handleFileError(e,n)}))}_sendChunkCore(e,t,i){return te().reject()}_tryRaiseStartLoad(e){e.isStartLoad||(e.isStartLoad=!0,e.onLoadStart.fire())}_getEvent(e){return null}_createUploadArgument(e){return this._createChunksInfo(e.chunksData)}_createChunksInfo(e){var t,i;return{bytesUploaded:(e==null?void 0:e.loadedBytes)??0,chunkCount:(e==null?void 0:e.count)??0,customData:(e==null?void 0:e.customData)??{},chunkBlob:(e==null||(t=e.currentChunk)===null||t===void 0?void 0:t.blob)??new Blob,chunkIndex:(e==null||(i=e.currentChunk)===null||i===void 0?void 0:i.index)??0}}}class Bs extends Ti{_sendChunkCore(e,t,i){const{uploadUrl:n,uploadMethod:s,uploadHeaders:o,name:r}=this.fileUploader.option();return st.sendRequest({url:n,method:s,headers:o,beforeSend:d=>this._beforeSend(d,e),upload:{onprogress:d=>this._handleProgress(e,d),onloadstart:()=>this._tryRaiseStartLoad(e),onabort:()=>e.onAbort.fire()},data:this._createFormData({fileName:t.name,blobName:r,blob:i.blob,index:i.index,count:t.count,type:t.type,guid:t.guid,size:t.fileSize})})}_createFormData(e){const t=new at.FormData;return t.append(e.blobName,e.blob),t.append("chunkMetadata",JSON.stringify({FileName:e.fileName,Index:e.index,TotalCount:e.count,FileSize:e.size,FileType:e.type,FileGuid:e.guid})),this._extendFormData(t),t}}class zs extends Ti{_sendChunkCore(e,t){this._tryRaiseStartLoad(e);const i=this._createChunksInfo(t),{uploadChunk:n}=this.fileUploader.option();try{const s=n==null?void 0:n(e.value,i);return _t(s)}catch(s){return te().reject(s).promise()}}_shouldHandleError(e,t){return!0}}class Oi extends ki{_uploadCore(e){e.loadedSize=0;const t=this._uploadFile(e);"done"in t&&t.done((()=>{e.isAborted||e.onLoad.fire()})).fail((i=>{this._shouldHandleError(e,i)&&this._handleFileError(e,i)}))}_uploadFile(e){return te().reject()}_handleProgressCore(e,t){e.onProgress.fire(t)}_getLoadedData(e,t,i,n){const s=super._getLoadedData(e,t,i,n);return s.event=n,s}}class $s extends Oi{_uploadFile(e){const{uploadUrl:t,uploadMethod:i,uploadHeaders:n,name:s}=this.fileUploader.option();return st.sendRequest({url:t,method:i,headers:n,beforeSend:o=>this._beforeSend(o,e),upload:{onprogress:o=>this._handleProgress(e,o),onloadstart:()=>e.onLoadStart.fire(),onabort:()=>e.onAbort.fire()},data:this._createFormData(s,e.value)})}_createFormData(e,t){const i=new at.FormData;return i.append(e,t,t==null?void 0:t.name),this._extendFormData(i),i}}class Rs extends Oi{_uploadFile(e){e.onLoadStart.fire();const t=n=>{const s={loaded:n,total:e.value.size};this._handleProgress(e,s)},{uploadFile:i}=this.fileUploader.option();try{const n=i==null?void 0:i(e.value,t);return _t(n)}catch(n){return te().reject(n).promise()}}_shouldHandleError(e,t){return!0}}class Bi extends Ln{_supportedKeys(){const e=t=>{t.preventDefault();const i=this._selectButton.$element();de.triggerHandler(i,{type:"dxclick"})};return Ge({},super._supportedKeys(),{space:e,enter:e})}_setOptionsByReference(){super._setOptionsByReference(),X(this._optionsByReference,{value:!0})}_getDefaultOptions(){return Ge({},super._getDefaultOptions(),{chunkSize:0,value:[],selectButtonText:U.format("dxFileUploader-selectFile"),uploadButtonText:U.format("dxFileUploader-upload"),labelText:U.format("dxFileUploader-dropFile"),name:"files[]",multiple:!1,accept:"",uploadUrl:"/",allowCanceling:!0,showFileList:!0,progress:0,dialogTrigger:void 0,dropZone:void 0,readyToUploadMessage:U.format("dxFileUploader-readyToUpload"),uploadedMessage:U.format("dxFileUploader-uploaded"),uploadFailedMessage:U.format("dxFileUploader-uploadFailedMessage"),uploadAbortedMessage:U.format("dxFileUploader-uploadAbortedMessage"),uploadMode:"instantly",uploadMethod:"POST",uploadHeaders:{},uploadCustomData:{},onBeforeSend:null,onUploadStarted:null,onUploaded:null,onFilesUploaded:null,onProgress:null,onUploadError:null,onUploadAborted:null,onDropZoneEnter:null,onDropZoneLeave:null,allowedFileExtensions:[],maxFileSize:0,minFileSize:0,inputAttr:{},invalidFileExtensionMessage:U.format("dxFileUploader-invalidFileExtension"),invalidMaxFileSizeMessage:U.format("dxFileUploader-invalidMaxFileSize"),invalidMinFileSizeMessage:U.format("dxFileUploader-invalidMinFileSize"),extendSelection:!0,validationMessageMode:"always",uploadFile:null,uploadChunk:null,abortUpload:null,validationMessageOffset:{h:0,v:0},hoverStateEnabled:!0,useNativeInputClick:!1,useDragOver:!0,nativeDropSupported:!0,_uploadButtonType:"normal",_buttonStylingMode:"contained"})}_defaultOptionsRules(){return super._defaultOptionsRules().concat([{device:()=>We.real().deviceType==="desktop"&&!We.isSimulator(),options:{focusStateEnabled:!0}},{device:[{platform:"android"}],options:{validationMessageOffset:{v:0}}},{device:()=>We.real().deviceType!=="desktop",options:{useDragOver:!1,nativeDropSupported:!1,labelText:""}},{device:()=>!xt(),options:{uploadMode:"useForm"}},{device:()=>vi(Gt()),options:{_uploadButtonType:"default"}},{device:()=>bi(Gt()),options:{_buttonStylingMode:"text"}}])}_initOptions(e){const t="labelText"in e;super._initOptions(e),!t&&!this._shouldDragOverBeRendered()&&this.option({labelText:""})}_init(){super._init(),this._initFileInput(),this._initLabel(),this._setUploadStrategy(),this._createFiles(),this._createBeforeSendAction(),this._createUploadStartedAction(),this._createUploadedAction(),this._createFilesUploadedAction(),this._createProgressAction(),this._createUploadErrorAction(),this._createUploadAbortedAction(),this._createDropZoneEnterAction(),this._createDropZoneLeaveAction()}_setUploadStrategy(){const{chunkSize:e=0}=this.option();if(e>0){const{uploadChunk:t}=this.option();this._uploadStrategy=t&&xe(t)?new zs(this):new Bs(this)}else{const{uploadFile:t}=this.option();this._uploadStrategy=t&&xe(t)?new Rs(this):new $s(this)}}_initFileInput(){this._isCustomClickEvent=!1;const{multiple:e,accept:t,hint:i}=this.option();this._$fileInput||(this._$fileInput=Ts(),de.on(this._$fileInput,"change",this._inputChangeHandler.bind(this)),de.on(this._$fileInput,"click",(s=>{s.stopPropagation(),this._resetInputValue();const{useNativeInputClick:o}=this.option();return o||this._isCustomClickEvent})));const n={multiple:e,accept:t,tabIndex:-1};se(i)&&(n.title=i),this._$fileInput.prop(n)}_inputChangeHandler(){if(this._doPreventInputChange)return;const e=this._$fileInput.val().replace(/^.*\\/,""),t=this._$fileInput.prop("files"),{uploadMode:i}=this.option();if(t&&!t.length&&i!=="useForm")return;const n=t?this._getFiles(t):[{name:e}];this._changeValue(n),i==="instantly"&&this._uploadFiles()}_shouldFileListBeExtended(){const{uploadMode:e,extendSelection:t,multiple:i}=this.option();return!!(e!=="useForm"&&t&&i)}_changeValue(e){const{value:t}=this.option(),i=this._shouldFileListBeExtended()?t==null?void 0:t.slice():[];this.option({value:i==null?void 0:i.concat(e)})}_getFiles(e){return[...e]}_getFile(e){var t;const{value:i}=this.option(),n=hi(e)?i==null?void 0:i[e]:e;return(t=this._files)===null||t===void 0?void 0:t.filter((s=>s.value===n))[0]}_initLabel(){this._$inputLabel||(this._$inputLabel=w("<div>")),this._updateInputLabelText()}_updateInputLabelText(){const{labelText:e}=this.option(),t=this._isInteractionDisabled()?"":e;this._$inputLabel.text(t??"")}_focusTarget(){return this.$element().find(".dx-fileuploader-button")}_getSubmitElement(){return this._$fileInput}_initMarkup(){super._initMarkup(),this.$element().addClass("dx-fileuploader"),this._renderWrapper(),this._renderInputWrapper(),this._renderSelectButton(),this._renderInputContainer(),this._renderUploadButton(),this._preventRecreatingFiles=!0,this._activeDropZone=null}_render(){const{dropZone:e}=this.option();this._preventRecreatingFiles=!1,this._attachDragEventHandlers(this._$inputWrapper),this._attachDragEventHandlers(e),this._renderFiles(),super._render()}_createFileProgressBar(e){e.progressBar=this._createProgressBar(e.value.size),e.$file&&e.progressBar.$element().appendTo(e.$file),this._initStatusMessage(e),this._ensureCancelButtonInitialized(e)}_setStatusMessage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";setTimeout((()=>{const{showFileList:i}=this.option();if(i&&e.$statusMessage){var n;e.$statusMessage.text(t),e.$statusMessage.css("display",""),(n=e.progressBar)===null||n===void 0||n.$element().remove()}}),400)}_getUploadAbortedStatusMessage(){const{uploadMode:e,uploadAbortedMessage:t,readyToUploadMessage:i}=this.option();return e==="instantly"?t:i}_createFiles(){const{value:e}=this.option();this._files&&((e==null?void 0:e.length)===0||!this._shouldFileListBeExtended())&&(this._preventFilesUploading(this._files),this._files=null),this._files||(this._files=[]),e==null||e.slice(this._files.length).forEach((t=>{var i;const n=this._createFile(t);this._validateFile(n),(i=this._files)===null||i===void 0||i.push(n)}))}_preventFilesUploading(e){e==null||e.forEach((t=>this._uploadStrategy.abortUpload(t)))}_validateFile(e){e.isValidFileExtension=this._validateFileExtension(e),e.isValidMinSize=this._validateMinFileSize(e),e.isValidMaxSize=this._validateMaxFileSize(e)}_validateFileExtension(e){const{allowedFileExtensions:t}=this.option();return t!=null&&t.length?this._isFileExtensionAllowed(e.value,t):!0}_validateMaxFileSize(e){const t=e.value.size,{maxFileSize:i=0}=this.option();return i>0?t<=i:!0}_validateMinFileSize(e){const t=e.value.size,{minFileSize:i=0}=this.option();return i>0?t>=i:!0}_isFileExtensionAllowed(e,t){for(let i=0,n=t.length;i<n;i+=1){let s=t[i];if(s.startsWith(".")){if(s=s.replace(".","\\."),new RegExp(`${s}$`,"i").exec(e.name))return!0}else if(s=s.replace(new RegExp("\\*","g"),""),new RegExp(s,"i").exec(e.type))return!0}return!1}_createBeforeSendAction(){this._beforeSendAction=this._createActionByOption("onBeforeSend",{excludeValidators:["readOnly"]})}_createUploadStartedAction(){this._uploadStartedAction=this._createActionByOption("onUploadStarted",{excludeValidators:["readOnly"]})}_createUploadedAction(){this._uploadedAction=this._createActionByOption("onUploaded",{excludeValidators:["readOnly"]})}_createFilesUploadedAction(){this._filesUploadedAction=this._createActionByOption("onFilesUploaded",{excludeValidators:["readOnly"]})}_createProgressAction(){this._progressAction=this._createActionByOption("onProgress",{excludeValidators:["readOnly"]})}_createUploadAbortedAction(){this._uploadAbortedAction=this._createActionByOption("onUploadAborted",{excludeValidators:["readOnly"]})}_createUploadErrorAction(){this._uploadErrorAction=this._createActionByOption("onUploadError",{excludeValidators:["readOnly"]})}_createDropZoneEnterAction(){this._dropZoneEnterAction=this._createActionByOption("onDropZoneEnter")}_createDropZoneLeaveAction(){this._dropZoneLeaveAction=this._createActionByOption("onDropZoneLeave")}_createFile(e){return{value:e,loadedSize:0,onProgress:it(),onAbort:it(),onLoad:it(),onError:it(),onLoadStart:it(),isValidFileExtension:!0,isValidMaxSize:!0,isValidMinSize:!0,isValid(){return!!this.isValidFileExtension&&!!this.isValidMaxSize&&!!this.isValidMinSize},isInitialized:!1}}_resetFileState(e){e.isAborted=!1,e.uploadStarted=!1,e.isStartLoad=!1,e.loadedSize=0,e.chunksData=void 0,e.request=void 0}_renderFiles(){var e;const{value:t,showFileList:i}=this.option();if(this._$filesContainer?(!this._shouldFileListBeExtended()||(t==null?void 0:t.length)===0)&&this._$filesContainer.empty():this._$filesContainer=w("<div>").addClass("dx-fileuploader-files-container").appendTo(this._$content),i){var n;(n=this._files)===null||n===void 0||n.forEach((s=>{s.$file||this._renderFile(s)}))}this.$element().toggleClass("dx-fileuploader-show-file-list",i),this._toggleFileUploaderEmptyClassName(),this._updateFileNameMaxWidth(),(e=this._validationMessage)===null||e===void 0||e.repaint()}_renderFile(e){const{value:t}=e;if(!this._$filesContainer)return;const i=w("<div>").addClass("dx-fileuploader-file-container").appendTo(this._$filesContainer);this._renderFileButtons(e,i),e.$file=w("<div>").addClass("dx-fileuploader-file").appendTo(i);const n=w("<div>").addClass("dx-fileuploader-file-info").appendTo(e.$file);if(e.$statusMessage=w("<div>").addClass("dx-fileuploader-file-status-message").appendTo(e.$file),w("<div>").addClass("dx-fileuploader-file-name").text(t.name).appendTo(n),se(t.size)&&w("<div>").addClass("dx-fileuploader-file-size").text(this._getFileSize(t.size)).appendTo(n),e.isValid()){const{readyToUploadMessage:s}=this.option();e.$statusMessage.text(s??"")}else e.isValidFileExtension||e.$statusMessage.append(this._createValidationElement("invalidFileExtensionMessage")),e.isValidMaxSize||e.$statusMessage.append(this._createValidationElement("invalidMaxFileSizeMessage")),e.isValidMinSize||e.$statusMessage.append(this._createValidationElement("invalidMinFileSizeMessage")),i.addClass("dx-fileuploader-invalid")}_createValidationElement(e){return w("<span>").text(this.option()[e])}_updateFileNameMaxWidth(){var e,t,i,n;const{allowCanceling:s,uploadMode:o}=this.option(),r=s&&o!=="useForm"?1:0,d=o==="useButtons"?1:0,g=Re((e=this._$filesContainer)===null||e===void 0?void 0:e.find(".dx-fileuploader-file-container").first())||Re(this._$filesContainer),v=(t=this._$filesContainer)===null||t===void 0?void 0:t.find(".dx-fileuploader-button-container").eq(0),y=Re(v)*(r+d),C=(i=this._$filesContainer)===null||i===void 0?void 0:i.find(".dx-fileuploader-file-size").eq(0),h=C==null?void 0:C.text();C==null||C.text("1000 Mb");const _=Re(C);C==null||C.text(h??""),(n=this._$filesContainer)===null||n===void 0||n.find(".dx-fileuploader-file-name").css("maxWidth",g-y-_)}_renderFileButtons(e,t){const i=this._getCancelButton(e);i&&t.append(i);const n=this._getUploadButton(e);n&&t.append(n)}_getCancelButton(e){const{uploadMode:t}=this.option();if(t==="useForm")return null;const{allowCanceling:i,readOnly:n,hoverStateEnabled:s,_buttonStylingMode:o}=this.option();return e.cancelButton=this._createComponent(w("<div>").addClass("dx-fileuploader-button dx-fileuploader-cancel-button"),He,{onClick:()=>{this._removeFile(e)},icon:"close",visible:i,disabled:n,integrationOptions:{},hoverStateEnabled:s,stylingMode:o}),w("<div>").addClass("dx-fileuploader-button-container").append(e.cancelButton.$element())}_getUploadButton(e){const{uploadMode:t}=this.option();if(!e.isValid()||t!=="useButtons")return null;const{hoverStateEnabled:i,_buttonStylingMode:n}=this.option();return e.uploadButton=this._createComponent(w("<div>").addClass("dx-fileuploader-button dx-fileuploader-upload-button"),He,{onClick:()=>this._uploadFile(e),icon:"upload",hoverStateEnabled:i,stylingMode:n}),e.onLoadStart.add((()=>{var s;return(s=e.uploadButton)===null||s===void 0?void 0:s.option({visible:!1,disabled:!0})})),e.onAbort.add((()=>{var s;return(s=e.uploadButton)===null||s===void 0?void 0:s.option({visible:!0,disabled:!1})})),w("<div>").addClass("dx-fileuploader-button-container").append(e.uploadButton.$element())}_removeFile(e){var t,i;(t=e.$file)===null||t===void 0||t.parent().remove(),(i=this._files)===null||i===void 0||i.splice(this._files.indexOf(e),1);const{value:n}=this.option(),s=n==null?void 0:n.slice();s==null||s.splice(s.indexOf(e.value),1),this._preventRecreatingFiles=!0,this.option({value:s}),this._preventRecreatingFiles=!1,this._toggleFileUploaderEmptyClassName(),this._resetInputValue(!0)}removeFile(e){const{uploadMode:t}=this.option();if(t==="useForm"||!se(e))return;const i=this._getFile(e);i&&(i.uploadStarted&&this._preventFilesUploading([i]),this._removeFile(i))}_toggleFileUploaderEmptyClassName(){var e;this.$element().toggleClass("dx-fileuploader-empty",!((e=this._files)!==null&&e!==void 0&&e.length)||this._hasInvalidFile(this._files))}_hasInvalidFile(e){return e.some((t=>!t.isValid()))}_getFileSize(e){const t=[U.format("dxFileUploader-bytes"),U.format("dxFileUploader-kb"),U.format("dxFileUploader-Mb"),U.format("dxFileUploader-Gb")],i=t.length-1;let n=e,s=0;for(;s<i&&n>=1024;)n/=1024,s+=1;return`${Math.round(n)} ${t[s]}`}_renderSelectButton(){const e=w("<div>").addClass("dx-fileuploader-button").appendTo(this._$inputWrapper),{selectButtonText:t,readOnly:i,hoverStateEnabled:n}=this.option();this._selectButton=this._createComponent(e,He,{text:t,focusStateEnabled:!1,integrationOptions:{},disabled:i,hoverStateEnabled:n}),We.real().deviceType==="desktop"?this._selectButton.option({onClick:()=>this._selectFileDialogClickHandler()}):this._attachSelectFileDialogHandlers(this._selectButton.$element());const{dialogTrigger:s}=this.option();this._attachSelectFileDialogHandlers(s)}_selectFileDialogClickHandler(){const{useNativeInputClick:e}=this.option();e||this._isInteractionDisabled()||(this._isCustomClickEvent=!0,de.triggerHandler(this._$fileInput,{type:"click"}),this._isCustomClickEvent=!1)}_attachSelectFileDialogHandlers(e){if(!se(e))return;this._detachSelectFileDialogHandlers(e);const t=w(e);de.on(t,ve("click","dxFileUploaderDialogTrigger"),(()=>{this._selectFileDialogClickHandler()})),de.on(t,ve("keyup","dxFileUploaderDialogTrigger"),(i=>{const n=vn(i);(n==="enter"||n==="space")&&this._selectFileDialogClickHandler()}))}_detachSelectFileDialogHandlers(e){if(!se(e))return;const t=w(e);de.off(t,".dxFileUploaderDialogTrigger")}_renderUploadButton(){const{uploadButtonText:e,_uploadButtonType:t,hoverStateEnabled:i,uploadMode:n}=this.option();if(n!=="useButtons")return;const s=w("<div>").addClass("dx-fileuploader-button").addClass("dx-fileuploader-upload-button").appendTo(this._$content);this._uploadButton=this._createComponent(s,He,{text:e,onClick:this._uploadButtonClickHandler.bind(this),type:t,integrationOptions:{},hoverStateEnabled:i})}_uploadButtonClickHandler(){this._uploadFiles()}_shouldDragOverBeRendered(){const{readOnly:e,uploadMode:t,nativeDropSupported:i}=this.option();return!e&&(t!=="useForm"||i)}_isInteractionDisabled(){const{readOnly:e,disabled:t}=this.option();return!!e||!!t}_renderInputContainer(){this._$inputContainer=w("<div>").addClass("dx-fileuploader-input-container").appendTo(this._$inputWrapper),this._$fileInput.addClass("dx-fileuploader-input"),this._renderInput();const e=`dx-fileuploader-input-label-${new Le}`;this._$inputLabel.attr("id",e).addClass("dx-fileuploader-input-label").appendTo(this._$inputContainer),this.setAria("labelledby",e,this._$fileInput)}_renderInput(){const{useNativeInputClick:e,inputAttr:t}=this.option();e?this._selectButton.option({template:this._selectButtonInputTemplate.bind(this)}):(this._$fileInput.appendTo(this._$inputContainer),this._selectButton.option({template:"content"})),this._applyInputAttributes(t)}_selectButtonInputTemplate(e,t){const i=w(t),n=w("<span>").addClass("dx-button-text").text(e.text);return i.append(n).append(this._$fileInput),i}_renderInputWrapper(){this._$content&&(this._$inputWrapper=w("<div>").addClass("dx-fileuploader-input-wrapper").appendTo(this._$content))}_detachDragEventHandlers(e){e&&de.off(w(e),ve("",this.NAME))}_attachDragEventHandlers(e){const t=e!==this._$inputWrapper;!se(e)||!this._shouldDragOverBeRendered()||(this._detachDragEventHandlers(e),de.on(w(e),ve("dragenter",this.NAME),this._dragEnterHandler.bind(this,t)),de.on(w(e),ve("dragover",this.NAME),this._dragOverHandler.bind(this,t)),de.on(w(e),ve("dragleave",this.NAME),this._dragLeaveHandler.bind(this,t)),de.on(w(e),ve("drop",this.NAME),this._dropHandler.bind(this,t)))}_applyInputAttributes(e){this._$fileInput.attr(e)}_useInputForDrop(){const{uploadMode:e,nativeDropSupported:t}=this.option();return!!t&&e==="useForm"}_getDropZoneElement(e,t){if(!t.currentTarget)return;const{dropZone:i}=this.option(),s=(e?w(i).toArray():[this._$inputWrapper]).map((r=>w(r).get(0))),o=s.indexOf(t.currentTarget);return s[o]}_dragEnterHandler(e,t){const{disabled:i}=this.option();if(i)return!1;this._useInputForDrop()||t.preventDefault();const n=this._getDropZoneElement(e,t);se(n)&&this._shouldRaiseDragOver(t,n)&&(this._activeDropZone=n,this._tryToggleDropZoneActive(!0,e,t))}_shouldRaiseDragOver(e,t){return this._activeDropZone===null&&this.isMouseOverElement(e,t,!1)&&e.originalEvent.dataTransfer.types.find((i=>i==="Files"))}_dragOverHandler(e,t){if(this._useInputForDrop()||t.preventDefault(),t.originalEvent.dataTransfer.dropEffect="copy",!e){const i=this._getDropZoneElement(!1,t);this._shouldRaiseDragOver(t,i)&&this._dragEnterHandler(!1,t),this._shouldRaiseDragLeave(t,!1)&&this._dragLeaveHandler(!1,t)}}_dragLeaveHandler(e,t){this._useInputForDrop()||t.preventDefault(),this._shouldRaiseDragLeave(t,e)&&(this._tryToggleDropZoneActive(!1,e,t),this._activeDropZone=null)}_shouldRaiseDragLeave(e,t){return this._activeDropZone!==null&&!this.isMouseOverElement(e,this._activeDropZone,!t,-1)}_tryToggleDropZoneActive(e,t,i){var n;const s=e?"addClass":"removeClass";(n=this[e?"_dropZoneEnterAction":"_dropZoneLeaveAction"])===null||n===void 0||n.call(this,{event:i,dropZoneElement:this._activeDropZone}),t||this.$element()[s]("dx-fileuploader-dragover")}_dropHandler(e,t){if(this._activeDropZone=null,e||this.$element().removeClass("dx-fileuploader-dragover"),this._useInputForDrop()||e&&this._isInteractionDisabled())return;t.preventDefault();const i=t.originalEvent.dataTransfer.files,n=this._getFiles(i),{multiple:s}=this.option();if(!s&&n.length>1||n.length===0)return;this._changeValue(n);const{uploadMode:o}=this.option();o==="instantly"&&this._uploadFiles()}_areAllFilesLoaded(){var e;return(e=this._files)===null||e===void 0?void 0:e.every((t=>!t.isValid()||t._isError||t._isLoaded||t.isAborted))}_handleAllFilesUploaded(){if(this._recalculateProgress(),this._areAllFilesLoaded()){var e;(e=this._filesUploadedAction)===null||e===void 0||e.call(this)}}_renderWrapper(){const e=w("<div>").addClass("dx-fileuploader-wrapper").appendTo(this.$element()),t=w("<div>").addClass("dx-fileuploader-container").appendTo(e);this._$content=w("<div>").addClass("dx-fileuploader-content").appendTo(t)}_clean(){this._$fileInput.detach(),this._$filesContainer=null;const{dialogTrigger:e,dropZone:t}=this.option();this._detachSelectFileDialogHandlers(e),this._detachDragEventHandlers(t),this._files&&this._files.forEach((i=>{i.$file=null,i.$statusMessage=null})),super._clean()}abortUpload(e){const{uploadMode:t}=this.option();if(t!=="useForm")if(se(e)){const i=this._getFile(e);i&&this._preventFilesUploading([i])}else this._preventFilesUploading(this._files)}upload(e){const{uploadMode:t}=this.option();if(t!=="useForm")if(se(e)){const i=this._getFile(e);i&&xt()&&this._uploadFile(i)}else this._uploadFiles()}_uploadFiles(){if(xt()){var e;(e=this._files)===null||e===void 0||e.forEach((t=>this._uploadFile(t)))}}_uploadFile(e){this._uploadStrategy.upload(e)}_updateProgressBar(e,t){var i,n;(i=e.progressBar)===null||i===void 0||i.option({value:t.loaded,showStatus:!0}),(n=this._progressAction)===null||n===void 0||n.call(this,{file:e.value,segmentSize:t.currentSegmentSize,bytesLoaded:t.loaded,bytesTotal:t.total,event:t.event,request:e.request})}_updateTotalProgress(e,t){let i=0;se(e)&&(this._files&&this._files.length>0&&this._areAllFilesLoaded()&&e===0&&t===0?i=this._getProgressValue(1):e&&(i=this._getProgressValue(t/e))),this.option({progress:i}),this._setLoadedSize(t)}_getProgressValue(e){return Math.floor(100*e)}_initStatusMessage(e){var t;(t=e.$statusMessage)===null||t===void 0||t.css("display","none")}_ensureCancelButtonInitialized(e){var t;if(e.isInitialized)return;(t=e.cancelButton)===null||t===void 0||t.option({onClick:()=>{this._preventFilesUploading([e]),this._removeFile(e)}});const i=()=>{setTimeout((()=>{var n;(n=e.cancelButton)===null||n===void 0||n.option({visible:!1})}),400)};e.onLoad.add(i),e.onError.add(i)}_createProgressBar(e){return this._createComponent(w("<div>"),xi,{value:void 0,min:0,max:e,statusFormat:t=>`${this._getProgressValue(t)}%`,showStatus:!1,statusPosition:"right"})}_getTotalFilesSize(){if(!this._totalFilesSize){var e;this._totalFilesSize=0,(e=this._files)===null||e===void 0||e.forEach((t=>{this._totalFilesSize+=t.value.size}))}return this._totalFilesSize}_getTotalLoadedFilesSize(){if(!this._totalLoadedFilesSize){var e;this._totalLoadedFilesSize=0,(e=this._files)===null||e===void 0||e.forEach((t=>{this._totalLoadedFilesSize+=t.loadedSize}))}return this._totalLoadedFilesSize}_setLoadedSize(e){this._totalLoadedFilesSize=e}_recalculateProgress(){this._totalFilesSize=0,this._totalLoadedFilesSize=0,this._updateTotalProgress(this._getTotalFilesSize(),this._getTotalLoadedFilesSize())}isMouseOverElement(e,t,i){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;if(!t)return!1;const s=i?parseFloat(at.getComputedStyle(t,":before").height):0,o=i?parseFloat(at.getComputedStyle(t,":after").height):0,r=Kt(t).left,d=Kt(t).top+s,g=t.offsetWidth,v=t.offsetHeight-s-o,y=this._getEventX(e),C=this._getEventY(e);return y+n>=r&&y-n<r+g&&C+n>=d&&C-n<d+v}_getEventX(e){return Wt(e)?this._getTouchEventX(e):e.clientX+this._getDocumentScrollLeft()}_getEventY(e){return Wt(e)?this._getTouchEventY(e):e.clientY+this._getDocumentScrollTop()}_getTouchEventX(e){let t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageX:0}_getTouchEventY(e){let t=null;return e.changedTouches.length>0?t=e.changedTouches:e.targetTouches.length>0&&(t=e.targetTouches),t?t[0].pageY:0}_getDocumentScrollTop(){const e=Ht.getDocument();return e.documentElement.scrollTop||e.body.scrollTop}_getDocumentScrollLeft(){const e=Ht.getDocument();return e.documentElement.scrollLeft||e.body.scrollLeft}_updateReadOnlyState(){var e;const{readOnly:t}=this.option();this._selectButton.option({disabled:t}),(e=this._files)===null||e===void 0||e.forEach((i=>{var n;return(n=i.cancelButton)===null||n===void 0?void 0:n.option({disabled:t})})),this._updateInputLabelText(),this._attachDragEventHandlers(this._$inputWrapper)}_updateHoverState(){var e,t,i;const{hoverStateEnabled:n}=this.option();(e=this._selectButton)===null||e===void 0||e.option({hoverStateEnabled:n}),(t=this._uploadButton)===null||t===void 0||t.option({hoverStateEnabled:n}),(i=this._files)===null||i===void 0||i.forEach((s=>{var o,r;(o=s.uploadButton)===null||o===void 0||o.option({hoverStateEnabled:n}),(r=s.cancelButton)===null||r===void 0||r.option({hoverStateEnabled:n})}))}_optionChanged(e){var t;const{name:i,value:n,previousValue:s}=e;switch(i){case"height":case"width":this._updateFileNameMaxWidth(),super._optionChanged(e);break;case"value":n!=null&&n.length||this._$fileInput.val(""),this._preventRecreatingFiles||(this._createFiles(),this._renderFiles()),this._recalculateProgress(),super._optionChanged(e);break;case"name":case"hint":this._initFileInput(),super._optionChanged(e);break;case"accept":this._initFileInput();break;case"multiple":this._initFileInput(),e.value||this.clear();break;case"readOnly":this._updateReadOnlyState(),super._optionChanged(e);break;case"disabled":this._updateInputLabelText(),super._optionChanged(e);break;case"selectButtonText":this._selectButton.option({text:n});break;case"uploadButtonText":this._uploadButton&&this._uploadButton.option({text:n});break;case"_uploadButtonType":this._uploadButton&&this._uploadButton.option({type:n});break;case"_buttonStylingMode":(t=this._files)===null||t===void 0||t.forEach((o=>{var r,d;(r=o.uploadButton)===null||r===void 0||r.option({stylingMode:n}),(d=o.cancelButton)===null||d===void 0||d.option({stylingMode:n})}));break;case"dialogTrigger":this._detachSelectFileDialogHandlers(s),this._attachSelectFileDialogHandlers(n);break;case"dropZone":this._detachDragEventHandlers(s),this._attachDragEventHandlers(n);break;case"maxFileSize":case"minFileSize":case"allowedFileExtensions":case"invalidFileExtensionMessage":case"invalidMaxFileSizeMessage":case"invalidMinFileSizeMessage":case"readyToUploadMessage":case"uploadedMessage":case"uploadFailedMessage":case"uploadAbortedMessage":case"nativeDropSupported":this._invalidate();break;case"labelText":this._updateInputLabelText();break;case"showFileList":this._preventRecreatingFiles||this._renderFiles();break;case"uploadFile":case"uploadChunk":case"chunkSize":this._setUploadStrategy();break;case"abortUpload":case"uploadUrl":case"progress":case"uploadMethod":case"uploadHeaders":case"uploadCustomData":case"extendSelection":break;case"hoverStateEnabled":this._updateHoverState(),super._optionChanged(e);break;case"allowCanceling":case"uploadMode":this.clear(),this._invalidate();break;case"onBeforeSend":this._createBeforeSendAction();break;case"onUploadStarted":this._createUploadStartedAction();break;case"onUploaded":this._createUploadedAction();break;case"onFilesUploaded":this._createFilesUploadedAction();break;case"onProgress":this._createProgressAction();break;case"onUploadError":this._createUploadErrorAction();break;case"onUploadAborted":this._createUploadAbortedAction();break;case"onDropZoneEnter":this._createDropZoneEnterAction();break;case"onDropZoneLeave":this._createDropZoneLeaveAction();break;case"useNativeInputClick":this._renderInput();break;case"useDragOver":this._attachDragEventHandlers(this._$inputWrapper);break;case"inputAttr":this._applyInputAttributes(this.option()[i]);break;default:super._optionChanged(e)}}_resetInputValue(e){const{uploadMode:t}=this.option();t==="useForm"&&!e||(this._doPreventInputChange=!0,this._$fileInput.val(""),this._doPreventInputChange=!1)}clear(){this.option({value:[]})}}ft("dxFileUploader",Bi);class Us extends Ce{_initMarkup(){this._initActions(),this.$element().addClass("dx-filemanager-fileuploader"),this._uploaderInfos=[],this._createInternalFileUploader(),this._createDropZonePlaceholder(),this._setDropZonePlaceholderVisible(!1),super._initMarkup()}_createInternalFileUploader(){const e=this._getController().chunkSize,t=w("<div>").appendTo(this.$element()),i=this._createComponent(t,Bi,{name:"file",multiple:!0,showFileList:!1,activeStateEnabled:!1,focusStateEnabled:!1,hoverStateEnabled:!1,labelText:"",readyToUploadMessage:"",accept:"*",chunkSize:e,dropZone:this.option("dropZone"),onValueChanged:s=>this._onFileUploaderValueChanged(s),onProgress:s=>this._onFileUploaderProgress(s),onUploaded:s=>this._onFileUploaderUploaded(s),onFilesUploaded:s=>this._onFileUploaderAllFilesUploaded(s),onUploadAborted:s=>this._onFileUploaderUploadAborted(s),onUploadError:s=>this._onFileUploaderUploadError(s),onDropZoneEnter:()=>this._setDropZonePlaceholderVisible(!0),onDropZoneLeave:()=>this._setDropZonePlaceholderVisible(!1)});i.option({uploadChunk:(s,o)=>this._fileUploaderUploadChunk(i,s,o),abortUpload:(s,o)=>this._fileUploaderAbortUpload(i,s,o)}),i._shouldRaiseDragLeaveBase=i._shouldRaiseDragLeave,i._shouldRaiseDragLeave=s=>this._shouldRaiseDragLeave(s,i);const n={fileUploader:i};this._uploaderInfos.push(n)}tryUpload(){const e=this._findAndUpdateAvailableUploaderInfo();e&&e.fileUploader._selectFileDialogClickHandler()}cancelUpload(e){this._cancelUpload(e)}cancelFileUpload(e,t){this._cancelUpload(e,t)}_cancelUpload(e,t){const{fileUploader:i}=this._findUploaderInfoBySessionId(e);i.abortUpload(t)}_fileUploaderUploadChunk(e,t,i){const{session:n,fileIndex:s}=this._findSessionByFile(e,t),o=n.controller;return i.fileIndex=s,o.uploadFileChunk(t,i)}_fileUploaderAbortUpload(e,t,i){const{session:n,fileIndex:s}=this._findSessionByFile(e,t),o=n.controller;return i.fileIndex=s,o.abortFileUpload(t,i)}_onFileUploaderValueChanged(e){let{component:t,value:i}=e;if(i.length===0)return;const n=i.slice(),s=this._findUploaderInfo(t);this._uploadFiles(s,n),setTimeout((()=>{this._findAndUpdateAvailableUploaderInfo()||this._createInternalFileUploader()}))}_onFileUploaderProgress(e){let{component:t,file:i,bytesLoaded:n,bytesTotal:s}=e;const{session:o,fileIndex:r}=this._findSessionByFile(t,i),d=s!==0?n/s:1,g=t.option("progress")/100,v={sessionId:o.id,fileIndex:r,commonValue:g,fileValue:d};this._raiseUploadProgress(v)}_onFileUploaderAllFilesUploaded(e){let{component:t}=e;const{session:i}=this._findSessionByFile(t,t._files[0].value);this._raiseUploadFinished({sessionId:i.id,commonValue:t.option("progress")/100})}_onFileUploaderUploaded(e){let{component:t,file:i}=e;this._getDeferredForFile(t,i).resolve()}_onFileUploaderUploadAborted(e){let{component:t,file:i}=e;this._getDeferredForFile(t,i).resolve({canceled:!0})}_onFileUploaderUploadError(e){let{component:t,file:i,error:n}=e;this._getDeferredForFile(t,i).reject(n)}_createDropZonePlaceholder(){this._$dropZonePlaceholder=w("<div>").addClass("dx-filemanager-fileuploader-dropzone-placeholder").appendTo(this.option("dropZonePlaceholderContainer"))}_adjustDropZonePlaceholder(){const e=this.option("dropZone");if(!be()||e.length===0)return;const t=parseFloat(this._$dropZonePlaceholder.css("borderTopWidth")),i=parseFloat(this._$dropZonePlaceholder.css("borderLeftWidth")),n=this.option("dropZonePlaceholderContainer"),s=parseFloat(n.css("borderBottomWidth")),o=parseFloat(n.css("borderLeftWidth")),r=mi(n),d=n.offset(),g=e.offset();this._$dropZonePlaceholder.css({top:g.top-d.top-r-s,left:g.left-d.left-o}),fi(this._$dropZonePlaceholder,e.get(0).offsetHeight-2*t),_i(this._$dropZonePlaceholder,e.get(0).offsetWidth-2*i)}_setDropZonePlaceholderVisible(e){e?(this._adjustDropZonePlaceholder(),this._$dropZonePlaceholder.css("display","")):this._$dropZonePlaceholder.css("display","none")}_shouldRaiseDragLeave(e,t){return t.isMouseOverElement(e,this.option("splitterElement"))||t._shouldRaiseDragLeaveBase(e,!0)}_uploadFiles(e,t){this._setDropZonePlaceholderVisible(!1);const i=new Le().toString(),n=this._getController(),s=t.map((()=>new te)),o={id:i,controller:n,files:t,deferreds:s};e.session=o;const r={sessionId:i,deferreds:s,files:t};return this._raiseUploadSessionStarted(r),Dt(s).always((()=>setTimeout((()=>{e.fileUploader.clear(),e.session=null}))))}_getDeferredForFile(e,t){const{session:i,fileIndex:n}=this._findSessionByFile(e,t);return i.deferreds[n]}_findSessionByFile(e,t){const n=this._findUploaderInfo(e).session,s=n.files.indexOf(t);return{session:n,fileIndex:s}}_findUploaderInfoBySessionId(e){for(let t=0;t<this._uploaderInfos.length;t++){const i=this._uploaderInfos[t],n=i.session;if(n&&n.id===e)return i}return null}_findAndUpdateAvailableUploaderInfo(){var e;let t=null;for(let i=0;i<this._uploaderInfos.length;i++){const n=this._uploaderInfos[i];n.fileUploader.option("dropZone",""),!t&&!n.session&&(t=n)}return(e=t)===null||e===void 0||e.fileUploader.option("dropZone",this.option("dropZone")),t}_findUploaderInfo(e){for(let t=0;t<this._uploaderInfos.length;t++){const i=this._uploaderInfos[t];if(i.fileUploader===e)return i}return null}_getController(){return this.option("getController")()}_raiseUploadSessionStarted(e){this._actions.onUploadSessionStarted({sessionInfo:e})}_raiseUploadProgress(e){this._actions.onUploadProgress(e)}_raiseUploadFinished(e){this._actions.onUploadFinished(e)}_initActions(){this._actions={onUploadSessionStarted:this._createActionByOption("onUploadSessionStarted"),onUploadProgress:this._createActionByOption("onUploadProgress"),onUploadFinished:this._createActionByOption("onUploadFinished")}}_getDefaultOptions(){return X(super._getDefaultOptions(),{getController:null,onUploadSessionStarted:null,onUploadProgress:null,onUploadFinished:null,splitterElement:null})}_optionChanged(e){const t=e.name;switch(t){case"getController":this.repaint();break;case"onUploadSessionStarted":case"onUploadProgress":case"onUploadFinished":this._actions[t]=this._createActionByOption(t);break;case"dropZone":this._findAndUpdateAvailableUploaderInfo(),this._adjustDropZonePlaceholder();break;case"dropZonePlaceholderContainer":this._$dropZonePlaceholder.detach(),this._$dropZonePlaceholder.appendTo(e.value);break;case"splitterElement":break;default:super._optionChanged(e)}}}const Ns={get:(N,e)=>{switch(N){case ge.NoAccess:return U.format("dxFileManager-errorNoAccess");case ge.FileExists:return U.format("dxFileManager-errorFileExistsFormat",e);case ge.FileNotFound:return U.format("dxFileManager-errorFileNotFoundFormat",e);case ge.DirectoryExists:return U.format("dxFileManager-errorDirectoryExistsFormat",e);case ge.DirectoryNotFound:return U.format("dxFileManager-errorDirectoryNotFoundFormat",e);case ge.WrongFileExtension:return U.format("dxFileManager-errorWrongFileExtension");case ge.MaxFileSizeExceeded:return U.format("dxFileManager-errorMaxFileSizeExceeded");case ge.InvalidSymbols:return U.format("dxFileManager-errorInvalidSymbols")}return U.format("dxFileManager-errorDefault")}};class Ls extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._controller=this.option("controller"),this._controller.on("EditActionStarting",this._onEditActionStarting.bind(this)),this._controller.on("EditActionResultAcquired",this._onEditActionResultAcquired.bind(this)),this._controller.on("EditActionItemError",this._onEditActionItemError.bind(this)),this._controller.on("EditActionError",this._onEditActionError.bind(this)),this._controller.on("CompleteEditActionItem",this._onCompleteEditActionItem.bind(this)),this._controller.on("CompleteEditAction",this._onCompleteEditAction.bind(this)),this._model=this.option("model"),this._uploadOperationInfoMap={},this._dialogManager=new ks(this.$element(),{chooseDirectoryDialog:{provider:this._controller._fileProvider,getDirectories:this._controller.getDirectories.bind(this._controller),getCurrentDirectory:this._controller.getCurrentDirectory.bind(this._controller)},rtlEnabled:this.option("rtlEnabled"),onDialogClosed:this._onDialogClosed.bind(this)}),this._fileUploader=this._createFileUploader();const e=this.option("notificationControl");e&&this._initNotificationControl(e),this._createMetadataMap()}_initNotificationControl(e){this._notificationControl=e,this._notificationControl.option({onOperationCanceled:t=>{let{info:i}=t;return this._onCancelUploadSession(i)},onOperationItemCanceled:t=>{let{item:i,itemIndex:n}=t;return this._onCancelFileUpload(i,n)}})}_getFileUploaderComponent(){return Us}_createFileUploader(){const e=w("<div>").appendTo(this.$element());return this._createComponent(e,this._getFileUploaderComponent(),{getController:this._getFileUploaderController.bind(this),dropZonePlaceholderContainer:this.option("uploadDropZonePlaceholderContainer"),onUploadSessionStarted:t=>this._onUploadSessionStarted(t),onUploadProgress:t=>this._onUploadProgress(t),onUploadFinished:t=>this._onUploadFinished(t)})}setUploaderDropZone(e){this._fileUploader.option("dropZone",e)}setUploaderSplitterElement(e){this._fileUploader.option("splitterElement",e)}_getFileUploaderController(){const e=this.uploadDirectoryInfo.fileItem;return{chunkSize:this._controller.getFileUploadChunkSize(),uploadFileChunk:(t,i)=>this._controller.uploadFileChunk(t,i,e),abortFileUpload:(t,i)=>this._controller.abortFileUpload(t,i,e)}}_createMetadataMap(){this._metadataMap={create:{action:e=>this._tryCreate(e),affectsAllItems:!0,singleItemProcessingMessage:U.format("dxFileManager-editingCreateSingleItemProcessingMessage"),singleItemSuccessMessage:U.format("dxFileManager-editingCreateSingleItemSuccessMessage"),singleItemErrorMessage:U.format("dxFileManager-editingCreateSingleItemErrorMessage"),commonErrorMessage:U.format("dxFileManager-editingCreateCommonErrorMessage")},rename:{action:e=>this._tryRename(e),singleItemProcessingMessage:U.format("dxFileManager-editingRenameSingleItemProcessingMessage"),singleItemSuccessMessage:U.format("dxFileManager-editingRenameSingleItemSuccessMessage"),singleItemErrorMessage:U.format("dxFileManager-editingRenameSingleItemErrorMessage"),commonErrorMessage:U.format("dxFileManager-editingRenameCommonErrorMessage")},delete:{action:e=>this._tryDelete(e),singleItemProcessingMessage:U.format("dxFileManager-editingDeleteSingleItemProcessingMessage"),multipleItemsProcessingMessage:U.format("dxFileManager-editingDeleteMultipleItemsProcessingMessage"),singleItemSuccessMessage:U.format("dxFileManager-editingDeleteSingleItemSuccessMessage"),multipleItemsSuccessMessage:U.format("dxFileManager-editingDeleteMultipleItemsSuccessMessage"),singleItemErrorMessage:U.format("dxFileManager-editingDeleteSingleItemErrorMessage"),multipleItemsErrorMessage:U.format("dxFileManager-editingDeleteMultipleItemsErrorMessage"),commonErrorMessage:U.format("dxFileManager-editingDeleteCommonErrorMessage")},move:{action:e=>this._tryMove(e),singleItemProcessingMessage:U.format("dxFileManager-editingMoveSingleItemProcessingMessage"),multipleItemsProcessingMessage:U.format("dxFileManager-editingMoveMultipleItemsProcessingMessage"),singleItemSuccessMessage:U.format("dxFileManager-editingMoveSingleItemSuccessMessage"),multipleItemsSuccessMessage:U.format("dxFileManager-editingMoveMultipleItemsSuccessMessage"),singleItemErrorMessage:U.format("dxFileManager-editingMoveSingleItemErrorMessage"),multipleItemsErrorMessage:U.format("dxFileManager-editingMoveMultipleItemsErrorMessage"),commonErrorMessage:U.format("dxFileManager-editingMoveCommonErrorMessage")},copy:{action:e=>this._tryCopy(e),singleItemProcessingMessage:U.format("dxFileManager-editingCopySingleItemProcessingMessage"),multipleItemsProcessingMessage:U.format("dxFileManager-editingCopyMultipleItemsProcessingMessage"),singleItemSuccessMessage:U.format("dxFileManager-editingCopySingleItemSuccessMessage"),multipleItemsSuccessMessage:U.format("dxFileManager-editingCopyMultipleItemsSuccessMessage"),singleItemErrorMessage:U.format("dxFileManager-editingCopySingleItemErrorMessage"),multipleItemsErrorMessage:U.format("dxFileManager-editingCopyMultipleItemsErrorMessage"),commonErrorMessage:U.format("dxFileManager-editingCopyCommonErrorMessage")},upload:{action:e=>this._tryUpload(e),allowCancel:!0,allowItemProgress:!0,singleItemProcessingMessage:U.format("dxFileManager-editingUploadSingleItemProcessingMessage"),multipleItemsProcessingMessage:U.format("dxFileManager-editingUploadMultipleItemsProcessingMessage"),singleItemSuccessMessage:U.format("dxFileManager-editingUploadSingleItemSuccessMessage"),multipleItemsSuccessMessage:U.format("dxFileManager-editingUploadMultipleItemsSuccessMessage"),singleItemErrorMessage:U.format("dxFileManager-editingUploadSingleItemErrorMessage"),multipleItemsErrorMessage:U.format("dxFileManager-editingUploadMultipleItemsErrorMessage"),canceledMessage:U.format("dxFileManager-editingUploadCanceledMessage")},download:{action:e=>this._download(e),singleItemProcessingMessage:"",multipleItemsProcessingMessage:"",singleItemErrorMessage:U.format("dxFileManager-editingDownloadSingleItemErrorMessage"),multipleItemsErrorMessage:U.format("dxFileManager-editingDownloadMultipleItemsErrorMessage")},getItemContent:{action:e=>this._getItemContent(e)},getItems:{singleItemProcessingMessage:"",singleItemErrorMessage:U.format("dxFileManager-errorDirectoryOpenFailed"),commonErrorMessage:U.format("dxFileManager-errorDirectoryOpenFailed")}}}getCommandActions(){const e={};return lt(this._metadataMap,(t=>{Object.prototype.hasOwnProperty.call(this._metadataMap,t)&&(e[t]=i=>this._executeAction(t,i))})),e}_executeAction(e,t){const i=this._metadataMap[e];return i?i.action(t):null}_onCancelUploadSession(e){this._fileUploader.cancelUpload(e.uploadSessionId)}_onCancelFileUpload(e,t){this._fileUploader.cancelFileUpload(e.info.uploadSessionId,t)}_onUploadProgress(e){let{sessionId:t,fileIndex:i,commonValue:n,fileValue:s}=e;const{operationInfo:o}=this._uploadOperationInfoMap[t];this._notificationControl.updateOperationItemProgress(o,i,100*s,100*n)}_onUploadFinished(e){let{sessionId:t,commonValue:i}=e;const{operationInfo:n}=this._uploadOperationInfoMap[t];this._notificationControl.finishOperation(n,100*i),this._scheduleUploadSessionDisposal(t,"uploader")}_onUploadSessionStarted(e){let{sessionInfo:t}=e;this._controller.processUploadSession(t,this.uploadDirectoryInfo)}_onEditActionStarting(e){const t=this._metadataMap[e.name],i=new Vs(t,e.itemInfos,e.directory),n=this._notificationControl.addOperation(i.processingMessage,t.allowCancel,!t.allowItemProgress);switch(X(e.customData,{context:i,operationInfo:n}),e.name){case"upload":{const s=e.customData.sessionInfo.sessionId;n.uploadSessionId=s,this._uploadOperationInfoMap[s]={operationInfo:n}}break;case"rename":e.customData.context.itemNewName=e.customData.itemNewName}}_onEditActionResultAcquired(e){const{context:t,operationInfo:i}=e.customData;t.singleRequest=e.singleRequest;const n=t.itemInfos.map((s=>this._getItemProgressDisplayInfo(s)));this._notificationControl.addOperationDetails(i,n,t.actionMetadata.allowCancel)}_onEditActionError(e,t){const{context:i,operationInfo:n}=e.customData;i.singleRequest=e.singleRequest,this._handleActionError(n,i,t),this._completeAction(n,i)}_onEditActionItemError(e,t){const{context:i,operationInfo:n}=e.customData;this._handleActionError(n,i,t)}_onCompleteEditActionItem(e,t){const{context:i,operationInfo:n}=e.customData;(!t.result||!t.result.canceled)&&(i.completeOperationItem(t.index),this._notificationControl.completeOperationItem(n,t.index,i.commonProgress))}_onCompleteEditAction(e){const{context:t,operationInfo:i}=e.customData;this._completeAction(i,t),e.name==="upload"&&this._scheduleUploadSessionDisposal(e.customData.sessionInfo.sessionId,"controller")}_scheduleUploadSessionDisposal(e,t){se(this._uploadOperationInfoMap[e].requester)&&this._uploadOperationInfoMap[e].requester!==t?delete this._uploadOperationInfoMap[e]:this._uploadOperationInfoMap[e].requester=t}_tryCreate(e){const t=e&&e[0]||this._getCurrentDirectory(),i=U.format("dxFileManager-newDirectoryName");return this._showDialog(this._dialogManager.getCreateItemDialog(),i).then((n=>{let{name:s}=n;return this._controller.createDirectory(t,s)}))}_tryRename(e){const t=e&&e[0]||this._model.getMultipleSelectedItems()[0];return t?this._showDialog(this._dialogManager.getRenameItemDialog(),t.fileItem.name).then((i=>{let{name:n}=i;return this._controller.renameItem(t,n)})):new te().reject().promise()}_tryDelete(e){if(e=e||this._model.getMultipleSelectedItems(),e.length===0)return new te().reject().promise();const t=e[0].fileItem.name,i=e.length;return this._showDialog(this._dialogManager.getDeleteItemDialog(),{itemName:t,itemCount:i}).then((()=>this._controller.deleteItems(e)))}_tryMove(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new te().reject().promise():this._showDialog(this._dialogManager.getMoveDialog(e)).then((t=>{let{folder:i}=t;return this._controller.moveItems(e,i)}))}_tryCopy(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new te().reject().promise():this._showDialog(this._dialogManager.getCopyDialog(e)).then((t=>{let{folder:i}=t;return this._controller.copyItems(e,i)}))}_tryUpload(e){this._uploadDirectoryInfo=e==null?void 0:e[0],this._fileUploader.tryUpload()}_download(e){return e=e||this._model.getMultipleSelectedItems(),e.length===0?new te().reject().promise():this._controller.downloadItems(e)}_getItemContent(e){return e=e||this._model.getMultipleSelectedItems(),this._controller.getItemContent(e)}_completeAction(e,t){this._notificationControl.completeOperation(e,t.completionMessage,!t.success,t.statusText),t.hasModifiedItems()&&this._raiseOnSuccess(t.onlyFiles)}_handleActionError(e,t,i){e.hasError=!0,t.singleRequest?this._handleSingleRequestActionError(e,t,i):this._handleMultipleRequestActionError(e,t,i)}_handleSingleRequestActionError(e,t,i){const n=t.getItemForSingleRequestError(),s=t.getItemName(i.errorCode),o=this._getErrorText(i,n,s);t.processSingleRequestError(o);const r=this._getOperationErrorInfo(t);this._notificationControl.completeSingleOperationWithError(e,r),t.multipleItems&&this._raiseOnSuccess(t.onlyFiles)}_handleMultipleRequestActionError(e,t,i){const n=t.getItemForMultipleRequestError(i.index),s=t.getItemName(i.errorCode,i.index),o=this._getErrorText(i,n,s);t.processMultipleRequestError(i.index,o);const r=this._getOperationErrorInfo(t);this._notificationControl.addOperationDetailsError(e,r)}_getOperationErrorInfo(e){const t=e.errorState.currentDetailError;return{commonErrorText:e.errorState.commonErrorText,item:t.itemInfo?this._getItemProgressDisplayInfo(t.itemInfo):null,itemIndex:t.itemIndex,detailErrorText:t.errorText}}_getErrorText(e,t,i){const n=e.errorText||Ns.get(e.errorCode,i),s={fileSystemItem:t==null?void 0:t.fileItem,errorCode:e.errorCode,errorText:n};return this._raiseOnError(s),s.errorText}_getItemProgressDisplayInfo(e){return{commonText:e.fileItem.name,imageUrl:this._getItemThumbnail(e)}}_showDialog(e,t){return this._dialogDeferred=new te,e.show(t),this._dialogDeferred.promise()}_onDialogClosed(e){const t=e.dialogResult;t?this._dialogDeferred.resolve(t):this._dialogDeferred.reject()}updateDialogRtl(e){this._dialogManager.updateDialogRtl(e)}_getItemThumbnail(e){const t=this.option("getItemThumbnail");if(!t)return null;const i=t(e);return i?i.thumbnail:null}_initActions(){this._actions={onSuccess:this._createActionByOption("onSuccess"),onError:this._createActionByOption("onError")}}_getDefaultOptions(){return X(super._getDefaultOptions(),{model:{getMultipleSelectedItems:null},notificationControl:null,getItemThumbnail:null,onSuccess:null,onError:null})}_optionChanged(e){const t=e.name;switch(t){case"model":this.repaint();break;case"notificationControl":this._initNotificationControl(e.value);break;case"getItemThumbnail":break;case"uploadDropZonePlaceholderContainer":this._fileUploader.option("dropZonePlaceholderContainer",e.value);break;case"onSuccess":case"onError":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}_raiseOnSuccess(e){this._actions.onSuccess({updatedOnlyFiles:e})}_raiseOnError(e){this._actions.onError(e)}_getCurrentDirectory(){return this._controller.getCurrentDirectory()}get uploadDirectoryInfo(){return this._uploadDirectoryInfo||this._getCurrentDirectory()}}class Vs{constructor(e,t,i){this._actionMetadata=e,this._itemInfos=t,this._onlyFiles=!this._actionMetadata.affectsAllItems&&this._itemInfos.every((n=>!n.fileItem.isDirectory)),this._items=this._itemInfos.map((n=>n.fileItem)),this._multipleItems=this._items.length>1,this._location=i.getDisplayName(),this._singleRequest=!0,this._completedItems=[],this._commonProgress=0,this._errorState={failedCount:0},this._itemNewName=""}completeOperationItem(e){if(this._singleRequest)this._completedItems=[...this._items];else{const t=this._items[e];this._completedItems.push(t)}this._actionMetadata.allowItemProgress||(this._commonProgress=this._completedItems.length/this._items.length*100)}processSingleRequestError(e){this._errorState.failedCount=1,this._errorState.commonErrorText=this._multipleItems?this._actionMetadata.commonErrorMessage:this._actionMetadata.singleItemErrorMessage;const t=this._multipleItems?-1:1,i=this.getItemForSingleRequestError();this._setCurrentDetailError(t,i,e)}processMultipleRequestError(e,t){this._errorState.failedCount++,this._errorState.commonErrorText=this._errorState.failedCount>1?Ye(this._actionMetadata.multipleItemsErrorMessage,this._errorState.failedCount):this._actionMetadata.singleItemErrorMessage;const i=this.getItemForMultipleRequestError(e);this._setCurrentDetailError(e,i,t)}hasModifiedItems(){return this._hasCompletedItems()||this._singleRequest&&!this.success&&this._multipleItems}getItemForSingleRequestError(){return this._multipleItems?null:this._itemInfos[0]}getItemForMultipleRequestError(e){return this._itemInfos[e]}getItemName(e,t){const i=this.singleRequest?this.getItemForSingleRequestError():this.getItemForMultipleRequestError(t);let n=i==null?void 0:i.fileItem.name;return this.itemNewName&&this._isItemExistsErrorCode(e)&&(n=this.itemNewName),n}_isItemExistsErrorCode(e){return e===ge.DirectoryExists||e===ge.FileExists}_setCurrentDetailError(e,t,i){this._errorState.currentDetailError={itemIndex:e,itemInfo:t,errorText:i}}_hasCompletedItems(){return this._completedItems.length>0}get actionMetadata(){return this._actionMetadata}get itemInfos(){return this._itemInfos}get itemNewName(){return this._itemNewName}set itemNewName(e){this._itemNewName=e}get errorState(){return this._errorState}get singleRequest(){return this._singleRequest}set singleRequest(e){this._singleRequest=e}get multipleItems(){return this._multipleItems}get onlyFiles(){return this._onlyFiles}get processingMessage(){return this._multipleItems?Ye(this._actionMetadata.multipleItemsProcessingMessage,this._items.length,this._location):Ye(this._actionMetadata.singleItemProcessingMessage,this._location)}get successMessage(){return this._hasCompletedItems()?this._multipleItems?Ye(this._actionMetadata.multipleItemsSuccessMessage,this._completedItems.length,this._location):Ye(this._actionMetadata.singleItemSuccessMessage,this._location):this._multipleItems?Ye(this._actionMetadata.multipleItemsErrorMessage,this._items.length):this._actionMetadata.singleItemErrorMessage}get completionMessage(){return this.success?this.successMessage:this.errorState.commonErrorText}get statusText(){return this.success&&!this._hasCompletedItems()?this._actionMetadata.canceledMessage:void 0}get commonProgress(){return this._commonProgress}get success(){return!this._errorState.failedCount}}class Ks extends Ce{_init(){super._init(),this._currentDirectory=null}_initMarkup(){super._initMarkup(),this._initActions(),this._currentDirectory&&this._renderMenu(),this.$element().addClass("dx-filemanager-breadcrumbs")}setCurrentDirectory(e){this._areDirsEqual(this._currentDirectory,e)||(this._currentDirectory=e,this.repaint())}_renderMenu(){const e=w("<div>").appendTo(this.$element());this._menu=this._createComponent(e,On,{dataSource:this._getMenuItems(),onItemClick:this._onItemClick.bind(this),onItemRendered:this._onItemRendered.bind(this)})}_getMenuItems(){const e=this._getParentDirsLine(),t=[{icon:"arrowup",directory:this._currentDirectory.parentDirectory,isPathItem:!0,cssClass:"dx-filemanager-breadcrumbs-parent-folder-item"},{text:"",cssClass:"dx-filemanager-breadcrumbs-separator-item"}];return e.forEach(((i,n)=>{t.push({text:i.getDisplayName(),directory:i,isPathItem:!0}),n!==e.length-1&&t.push({icon:"spinnext",cssClass:"dx-filemanager-breadcrumbs-path-separator-item"})})),t}_onItemClick(e){let{itemData:t}=e;if(!t.isPathItem)return;const i=t.directory;this._areDirsEqual(i,this._currentDirectory)||this._raiseCurrentDirectoryChanged(i)}_onItemRendered(e){let{itemElement:t,itemData:i}=e;i.cssClass&&w(t).addClass(i.cssClass)}_getParentDirsLine(){let e=this._currentDirectory;const t=[];for(;e;)t.unshift(e),e=e.parentDirectory;return t}_areDirsEqual(e,t){return e&&t&&e===t&&e.fileItem.key===t.fileItem.key}_initActions(){this._actions={onCurrentDirectoryChanging:this._createActionByOption("onCurrentDirectoryChanging")}}_raiseCurrentDirectoryChanged(e){this._actions.onCurrentDirectoryChanging({currentDirectory:e})}_getDefaultOptions(){return X(super._getDefaultOptions(),{rootFolderDisplayName:"Files",onCurrentDirectoryChanging:null})}_optionChanged(e){const t=e.name;switch(t){case"rootFolderDisplayName":this.repaint();break;case"onCurrentDirectoryChanging":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}}const Ws=ct(),ri="dx-drawer-panel-content-initial",Hs="dx-drawer-panel-content-adaptive";class js extends Ce{_initMarkup(){super._initMarkup(),this._initActions(),this._isInAdaptiveState=!1;const e=w("<div>").appendTo(this.$element());w("<div>").addClass("dx-filemanager-adaptivity-drawer-panel").appendTo(e),this._drawer=this._createComponent(e,At),this._drawer.option({opened:!0,template:this._createDrawerTemplate.bind(this)}),w(this._drawer.content()).addClass(ri);const t=e.find(".dx-filemanager-adaptivity-drawer-panel").first(),i=this.option("contentTemplate");xe(i)&&i(t),this._updateDrawerMaxSize()}_createDrawerTemplate(e){this.option("drawerTemplate")(e),this._splitter=this._createComponent("<div>",Vn,{container:this.$element(),leftElement:w(this._drawer.content()),rightElement:w(this._drawer.viewContent()),onApplyPanelSize:this._onApplyPanelSize.bind(this),onActiveStateChanged:this._onActiveStateChanged.bind(this)}),this._splitter.$element().appendTo(e),this._splitter.disableSplitterCalculation(!0)}_render(){super._render(),this._checkAdaptiveState()}_onApplyPanelSize(e){if(be()){if(!this._splitter.isSplitterMoved()){this._setDrawerWidth("");return}w(this._drawer.content()).removeClass(ri),this._setDrawerWidth(e.leftPanelWidth)}}_onActiveStateChanged(e){let{isActive:t}=e;this._splitter.disableSplitterCalculation(!t),!t&&this._splitter.$element().css("left","auto")}_setDrawerWidth(e){w(this._drawer.content()).css("width",e),this._updateDrawerMaxSize(),this._drawer.resizeViewContent()}_updateDrawerMaxSize(){this._drawer.option("maxSize",this._drawer.getRealPanelWidth())}_dimensionChanged(e){(!e||e!=="height")&&this._checkAdaptiveState()}_checkAdaptiveState(){const e=this._isInAdaptiveState;this._isInAdaptiveState=this._isSmallScreen(),e!==this._isInAdaptiveState&&(this.toggleDrawer(!this._isInAdaptiveState,!0),w(this._drawer.content()).toggleClass(Hs,this._isInAdaptiveState),this._raiseAdaptiveStateChanged(this._isInAdaptiveState)),this._isInAdaptiveState&&this._isDrawerOpened()&&this._updateDrawerMaxSize()}_isSmallScreen(){return Re(Ws)<=573}_isDrawerOpened(){return this._drawer.option("opened")}_initActions(){this._actions={onAdaptiveStateChanged:this._createActionByOption("onAdaptiveStateChanged")}}_raiseAdaptiveStateChanged(e){this._actions.onAdaptiveStateChanged({enabled:e})}_getDefaultOptions(){return X(super._getDefaultOptions(),{drawerTemplate:null,contentTemplate:null,onAdaptiveStateChanged:null})}_optionChanged(e){const t=e.name;switch(t){case"drawerTemplate":case"contentTemplate":this.repaint();break;case"onAdaptiveStateChanged":this._actions[t]=this._createActionByOption(t);break;default:super._optionChanged(e)}}isInAdaptiveState(){return this._isInAdaptiveState}toggleDrawer(e,t){this._updateDrawerMaxSize(),this._drawer.option("animationEnabled",!t),this._drawer.toggle(e);const i=this._isDrawerOpened()&&!this.isInAdaptiveState();this._splitter.toggleDisabled(!i)}getSplitterElement(){return this._splitter.getSplitterBorderElement().get(0)}}const Zs="[*DXPDK*]$40F96F03-FBD8-43DF-91BE-F55F4B8BA871$",Ve={folders:"navPane",items:"itemView"};class zi extends Ce{_initTemplates(){}_init(){super._init(),this._initActions(),this._providerUpdateDeferred=null,this._lockCurrentPathProcessing=!1,this._wasRendered=!1,this._controller=new Qn({currentPath:this.option("currentPath"),currentPathKeys:this.option("currentPathKeys"),rootText:this.option("rootFolderName"),fileProvider:this.option("fileSystemProvider"),allowedFileExtensions:this.option("allowedFileExtensions"),uploadMaxFileSize:this.option("upload").maxFileSize,uploadChunkSize:this.option("upload").chunkSize,onInitialized:this._onControllerInitialized.bind(this),onDataLoading:this._onDataLoading.bind(this),onSelectedDirectoryChanged:this._onSelectedDirectoryChanged.bind(this),onPathPotentiallyChanged:this._checkPathActuality.bind(this),editingEvents:this._actions.editing})}_initMarkup(){super._initMarkup(),this._firstItemViewLoad=!0,this._lockSelectionProcessing=!1,this._lockFocusedItemProcessing=!1,this._itemKeyToFocus=void 0,this._loadedWidgets=[],this._commandManager=new ts(this.option("permissions")),this.$element().addClass("dx-filemanager"),this._wasRendered?this._prepareToLoad():this._wasRendered=!0,this._createNotificationControl(),this._initCommandManager()}_createNotificationControl(){const e=w("<div>").addClass("dx-filemanager-notification-container").appendTo(this.$element());this._notificationControl=this._createComponent(e,bs,{progressPanelContainer:this.$element(),contentTemplate:(t,i)=>this._createWrapper(t,i),onActionProgress:t=>this._onActionProgress(t),positionTargetSelector:".dx-filemanager-container",showProgressPanel:this.option("notifications.showPanel"),showNotificationPopup:this.option("notifications.showPopup")})}_createWrapper(e,t){this._$wrapper=w("<div>").addClass("dx-filemanager-wrapper").appendTo(e),this._createEditing(t);const i=w("<div>").appendTo(this._$wrapper);this._toolbar=this._createComponent(i,ms,{commandManager:this._commandManager,generalItems:this.option("toolbar.items"),fileItems:this.option("toolbar.fileSelectionItems"),itemViewMode:this.option("itemView").mode,onItemClick:n=>this._actions.onToolbarItemClick(n)}),this._createAdaptivityControl()}_createAdaptivityControl(){const e=w("<div>").addClass("dx-filemanager-container").appendTo(this._$wrapper);this._adaptivityControl=this._createComponent(e,js,{drawerTemplate:t=>this._createFilesTreeView(t),contentTemplate:t=>this._createItemsPanel(t),onAdaptiveStateChanged:t=>this._onAdaptiveStateChanged(t)}),this._editing.setUploaderSplitterElement(this._adaptivityControl.getSplitterElement())}_createEditing(e){const t=w("<div>").addClass("dx-filemanager-editing-container").appendTo(this.$element());this._editing=this._createComponent(t,Ls,{controller:this._controller,model:{getMultipleSelectedItems:this._getSelectedItemInfos.bind(this)},getItemThumbnail:this._getItemThumbnailInfo.bind(this),notificationControl:e,uploadDropZonePlaceholderContainer:this.$element(),rtlEnabled:this.option("rtlEnabled"),onSuccess:i=>{let{updatedOnlyFiles:n}=i;return this._redrawComponent(n)},onError:i=>this._onEditingError(i)})}_createItemsPanel(e){this._$itemsPanel=w("<div>").addClass("dx-filemanager-items-panel").appendTo(e),this._createBreadcrumbs(this._$itemsPanel),this._createItemView(this._$itemsPanel),this._updateUploadDropZone()}_updateUploadDropZone(){const e=this._commandManager.isCommandAvailable("upload")?this._$itemsPanel:w();this._editing.setUploaderDropZone(e)}_createFilesTreeView(e){this._filesTreeViewContextMenu=this._createContextMenu(!1,Ve.folders);const t=w("<div>").addClass("dx-filemanager-dirs-panel").appendTo(e);this._filesTreeView=this._createComponent(t,Fi,{storeExpandedState:!0,contextMenu:this._filesTreeViewContextMenu,getDirectories:this.getDirectories.bind(this),getCurrentDirectory:this._getCurrentDirectory.bind(this),onDirectoryClick:i=>{let{itemData:n}=i;return this._setCurrentDirectory(n)},onItemListDataLoaded:()=>this._tryEndLoading(Ve.folders)}),this._filesTreeView.updateCurrentDirectory()}_createItemView(e,t){this._itemViewContextMenu=this._createContextMenu(!0,Ve.items);const i=this.option("itemView"),n={selectionMode:this.option("selectionMode"),selectedItemKeys:this.option("selectedItemKeys"),focusedItemKey:this.option("focusedItemKey"),contextMenu:this._itemViewContextMenu,getItems:this._getItemViewItems.bind(this),onError:r=>{let{error:d}=r;return this._showError(d)},onSelectionChanged:this._onItemViewSelectionChanged.bind(this),onFocusedItemChanged:this._onItemViewFocusedItemChanged.bind(this),onSelectedItemOpened:this._onSelectedItemOpened.bind(this),onContextMenuShowing:r=>this._onContextMenuShowing(Ve.items,r),onItemListItemsLoaded:()=>this._tryEndLoading(Ve.items),getItemThumbnail:this._getItemThumbnailInfo.bind(this),customizeDetailColumns:this.option("customizeDetailColumns"),detailColumns:this.option("itemView.details.columns")},s=w("<div>").appendTo(e);t=t||i.mode;const o=t==="thumbnails"?cs:as;this._itemView=this._createComponent(s,o,n)}_createBreadcrumbs(e){const t=w("<div>").appendTo(e);this._breadcrumbs=this._createComponent(t,Ks,{rootFolderDisplayName:this.option("rootFolderName"),onCurrentDirectoryChanging:i=>{let{currentDirectory:n}=i;return this._setCurrentDirectory(n,!0)}}),this._breadcrumbs.setCurrentDirectory(this._getCurrentDirectory())}_createContextMenu(e,t){const i=w("<div>").appendTo(this._$wrapper);return this._createComponent(i,ns,{commandManager:this._commandManager,items:this.option("contextMenu.items"),onItemClick:n=>this._actions.onContextMenuItemClick(n),onContextMenuShowing:n=>this._onContextMenuShowing(t,n),isolateCreationItemCommands:e,viewArea:t})}_initCommandManager(){const e=X(this._editing.getCommandActions(),{refresh:()=>this._refreshAndShowProgress(),thumbnails:()=>this.option("itemView.mode","thumbnails"),details:()=>this.option("itemView.mode","details"),clearSelection:()=>this._clearSelection(),showNavPane:()=>this._adaptivityControl.toggleDrawer()});this._commandManager.registerActions(e)}_onItemViewSelectionChanged(e){let{selectedItemInfos:t,selectedItems:i,selectedItemKeys:n,currentSelectedItemKeys:s,currentDeselectedItemKeys:o}=e;this._lockSelectionProcessing=!0,this.option("selectedItemKeys",n),this._lockSelectionProcessing=!1,this._actions.onSelectionChanged({selectedItems:i,selectedItemKeys:n,currentSelectedItemKeys:s,currentDeselectedItemKeys:o}),this._updateToolbar(t)}_onItemViewFocusedItemChanged(e){this._lockFocusedItemProcessing=!0,this.option("focusedItemKey",e.itemKey),this._lockFocusedItemProcessing=!1,this._actions.onFocusedItemChanged({item:e.item,itemElement:e.itemElement})}_onAdaptiveStateChanged(e){let{enabled:t}=e;this._commandManager.setCommandEnabled("showNavPane",t),this._updateToolbar()}_onActionProgress(e){let{message:t,status:i}=e;this._toolbar.updateRefreshItem(t,i),this._updateToolbar()}_onEditingError(e){const t=je({},e,["errorCode","errorText","fileSystemItem"]);this._actions.onErrorOccurred(t),e.errorText=t.errorText}_refreshAndShowProgress(){return this._prepareToLoad(),_e(this._notificationControl.tryShowProgressPanel(),this._controller.refresh()).then((()=>this._filesTreeView.refresh()))}_isAllWidgetsLoaded(){return this._loadedWidgets.length===2&&this._loadedWidgets.indexOf(Ve.folders)!==-1&&this._loadedWidgets.indexOf(Ve.items)!==-1}_tryEndLoading(e){this._loadedWidgets.push(e),this._isAllWidgetsLoaded()&&this._controller.endSingleLoad()}_prepareToLoad(){this._loadedWidgets=[],this._controller.startSingleLoad()}_updateToolbar(e){const t=e||this._getSelectedItemInfos();this._toolbar.option("contextItems",Ie(t,[]))}_switchView(e){this._disposeWidget(this._itemView.option("contextMenu")),this._disposeWidget(this._itemView),this._createItemView(this._$itemsPanel,e),this._toolbar.option({itemViewMode:e})}_disposeWidget(e){e.dispose(),e.$element().remove()}_clearSelection(){this._itemView.clearSelection()}_showError(e){this._showNotification(e,!1)}_showNotification(e,t){Dn({message:e,width:450},t?"success":"error",5e3)}_redrawComponent(e){this._itemView.refresh().then((()=>!e&&this._filesTreeView.refresh()))}_getItemViewItems(){const e=this.option("itemView").showFolders;let t=this._controller.getCurrentItems(!e);return this._updateToolbarWithSelectionOnFirstLoad(t),this.option("itemView.showParentFolder")&&(t=_e(t).then((i=>this._getPreparedItemViewItems(i)))),t}_updateToolbarWithSelectionOnFirstLoad(e){if(!this._firstItemViewLoad)return;this._firstItemViewLoad=!1;const t=this.option("selectedItemKeys");t.length>0&&_e(e).done((i=>{const n=Wn(i,t);n.length>0&&this._updateToolbar(n)}))}_getPreparedItemViewItems(e){const t=this._getCurrentDirectory();if(t.fileItem.isRoot())return e;const i=t.fileItem.createClone();i.isParentFolder=!0,i.name="..",i.relativeName="..",i.key=`${Zs}${t.fileItem.key}`;const n=[...e];return n.unshift({fileItem:i,icon:"parentfolder"}),n}_onContextMenuShowing(e,t){var i;let n=je({},t,["targetElement","cancel","event"]);n=X(n,{viewArea:e,fileSystemItem:(i=t.itemData)===null||i===void 0?void 0:i.fileItem,_isActionButton:t.isActionButton}),this._actions.onContextMenuShowing(n),t.cancel=Ie(n.cancel,!1)}_getItemThumbnailInfo(e){const t=this.option("customizeThumbnail"),i=xe(t)?t(e.fileItem):e.fileItem.thumbnail;return i?{thumbnail:i,cssClass:"dx-filemanager-item-custom-thumbnail"}:{thumbnail:e.icon}}_getDefaultOptions(){return X(super._getDefaultOptions(),{fileSystemProvider:null,currentPath:"",currentPathKeys:[],rootFolderName:U.format("dxFileManager-rootDirectoryName"),selectionMode:"multiple",selectedItemKeys:[],focusedItemKey:void 0,toolbar:{items:["showNavPane","create","upload","switchView",{name:"separator",location:"after"},"refresh"],fileSelectionItems:["download","separator","move","copy","rename","separator","delete","clearSelection",{name:"separator",location:"after"},"refresh"]},contextMenu:{items:["create","upload","rename","move","copy","delete","refresh","download"]},itemView:{details:{columns:["thumbnail","name","dateModified","size"]},mode:"details",showFolders:!0,showParentFolder:!0},customizeThumbnail:null,customizeDetailColumns:null,onContextMenuItemClick:null,onContextMenuShowing:null,onCurrentDirectoryChanged:null,onSelectedFileOpened:null,onSelectionChanged:null,onFocusedItemChanged:null,onToolbarItemClick:null,onErrorOccurred:null,onDirectoryCreating:null,onDirectoryCreated:null,onItemRenaming:null,onItemRenamed:null,onItemDeleting:null,onItemDeleted:null,onItemCopying:null,onItemCopied:null,onItemMoving:null,onItemMoved:null,onFileUploading:null,onFileUploaded:null,onItemDownloading:null,allowedFileExtensions:[],upload:{maxFileSize:0,chunkSize:2e5},permissions:X({},Ei),notifications:{showPanel:!0,showPopup:!0}})}option(e,t){const i=bn(e,t),n=arguments.length<2&&hn(e)!=="object",s=r=>se(i[r]),o=r=>{if(!s(r))return!1;const d=this.option(r),g=i[r];return!xn(d,g)};return!n&&s("fileSystemProvider")&&(this._providerUpdateDeferred=new te,(o("currentPath")||o("currentPathKeys"))&&(this._lockCurrentPathProcessing=!0)),super.option(...arguments)}_optionChanged(e){const t=e.name;switch(t){case"currentPath":{const i=()=>(this._lockCurrentPathProcessing=!1,this._controller.setCurrentPath(e.value));this._lockCurrentPathProcessing=!0,this._providerUpdateDeferred?this._providerUpdateDeferred.then(i):i()}break;case"currentPathKeys":{const i=()=>(this._lockCurrentPathProcessing=!1,this._controller.setCurrentPathByKeys(e.value));this._lockCurrentPathProcessing=!0,this._providerUpdateDeferred?this._providerUpdateDeferred.then(i):i()}break;case"selectedItemKeys":!this._lockSelectionProcessing&&this._itemView&&this._itemView.option("selectedItemKeys",e.value);break;case"focusedItemKey":!this._lockFocusedItemProcessing&&this._itemView&&this._itemView.option("focusedItemKey",e.value);break;case"rootFolderName":this._controller.setRootText(e.value),this._invalidate();break;case"fileSystemProvider":{this._lockCurrentPathProcessing||(this._providerUpdateDeferred=new te);const i=this._lockCurrentPathProcessing?void 0:this.option("currentPathKeys");this._controller.updateProvider(e.value,i).then((()=>this._providerUpdateDeferred.resolve())).always((()=>{this._providerUpdateDeferred=null,this.repaint()}));break}case"allowedFileExtensions":this._controller.setAllowedFileExtensions(e.value),this._invalidate();break;case"upload":this._controller.setUploadOptions(this.option("upload")),this._invalidate();break;case"permissions":this._commandManager.updatePermissions(this.option("permissions")),this._filesTreeViewContextMenu.tryUpdateVisibleContextMenu(),this._itemViewContextMenu.tryUpdateVisibleContextMenu(),this._toolbar.updateItemPermissions(),this._updateUploadDropZone();break;case"selectionMode":case"customizeThumbnail":case"customizeDetailColumns":this._invalidate();break;case"itemView":e.fullName==="itemView.mode"?this._switchView(e.value):this._invalidate();break;case"toolbar":{const i={};e.fullName==="toolbar"&&(e.value.items&&(i.generalItems=e.value.items),e.value.fileSelectionItems&&(i.fileItems=e.value.fileSelectionItems)),e.fullName.indexOf("toolbar.items")===0&&(i.generalItems=this.option("toolbar.items")),e.fullName.indexOf("toolbar.fileSelectionItems")===0&&(i.fileItems=this.option("toolbar.fileSelectionItems")),this._toolbar.option(i)}break;case"contextMenu":if(e.fullName==="contextMenu"&&e.value.items||e.fullName.indexOf("contextMenu.items")===0){const i=this.option("contextMenu.items");this._filesTreeViewContextMenu.option("items",i),this._itemViewContextMenu.option("items",i)}break;case"notifications":this._notificationControl.option("showProgressPanel",this.option("notifications.showPanel")),this._notificationControl.option("showNotificationPopup",this.option("notifications.showPopup"));break;case"onContextMenuItemClick":case"onContextMenuShowing":case"onCurrentDirectoryChanged":case"onSelectedFileOpened":case"onSelectionChanged":case"onFocusedItemChanged":case"onToolbarItemClick":case"onErrorOccurred":this._actions[t]=this._createActionByOption(t);break;case"onDirectoryCreating":case"onDirectoryCreated":case"onItemRenaming":case"onItemRenamed":case"onItemDeleting":case"onItemDeleted":case"onItemCopying":case"onItemCopied":case"onItemMoving":case"onItemMoved":case"onFileUploading":case"onFileUploaded":case"onItemDownloading":this._actions.editing[t]=this._createActionByOption(t);break;case"rtlEnabled":this._editing.updateDialogRtl(e.value),super._optionChanged(e);break;default:super._optionChanged(e)}}_initActions(){this._actions={onContextMenuItemClick:this._createActionByOption("onContextMenuItemClick"),onContextMenuShowing:this._createActionByOption("onContextMenuShowing"),onCurrentDirectoryChanged:this._createActionByOption("onCurrentDirectoryChanged"),onSelectedFileOpened:this._createActionByOption("onSelectedFileOpened"),onSelectionChanged:this._createActionByOption("onSelectionChanged"),onFocusedItemChanged:this._createActionByOption("onFocusedItemChanged"),onToolbarItemClick:this._createActionByOption("onToolbarItemClick"),onErrorOccurred:this._createActionByOption("onErrorOccurred"),editing:{onDirectoryCreating:this._createActionByOption("onDirectoryCreating"),onDirectoryCreated:this._createActionByOption("onDirectoryCreated"),onItemRenaming:this._createActionByOption("onItemRenaming"),onItemRenamed:this._createActionByOption("onItemRenamed"),onItemDeleting:this._createActionByOption("onItemDeleting"),onItemDeleted:this._createActionByOption("onItemDeleted"),onItemCopying:this._createActionByOption("onItemCopying"),onItemCopied:this._createActionByOption("onItemCopied"),onItemMoving:this._createActionByOption("onItemMoving"),onItemMoved:this._createActionByOption("onItemMoved"),onFileUploading:this._createActionByOption("onFileUploading"),onFileUploaded:this._createActionByOption("onFileUploaded"),onItemDownloading:this._createActionByOption("onItemDownloading")}}}executeCommand(e){return this._commandManager.executeCommand(e)}_setCurrentDirectory(e,t){this._controller.setCurrentDirectory(e,t)}_getCurrentDirectory(){return this._controller.getCurrentDirectory()}_onControllerInitialized(e){let{controller:t}=e;this._controller=this._controller||t,this._syncToCurrentDirectory()}_onDataLoading(e){let{operation:t}=e,i=null;t===Je.NAVIGATION&&(i={focusedItemKey:this._itemKeyToFocus,selectedItemKeys:this.option("selectedItemKeys")},this._itemKeyToFocus=void 0),this._itemView.refresh(i,t)}_onSelectedDirectoryChanged(){const e=this._getCurrentDirectory();this._syncToCurrentDirectory(),this._actions.onCurrentDirectoryChanged({directory:e.fileItem})}_syncToCurrentDirectory(){const e=this._getCurrentDirectory();this._filesTreeView&&this._filesTreeView.updateCurrentDirectory(),this._breadcrumbs&&this._breadcrumbs.setCurrentDirectory(e),this._checkPathActuality()}_checkPathActuality(){if(this._lockCurrentPathProcessing)return;const e=this._controller.getCurrentPath(),t=this._controller.getCurrentPathKeys(),i={};this.option("currentPath")!==e&&(i.currentPath=e),ci(this.option("currentPathKeys"),t)||(i.currentPathKeys=t),di(i)||this.option(i)}getDirectories(e,t){return this._controller.getDirectories(e,t)}_getSelectedItemInfos(){return this._itemView?this._itemView.getSelectedItems():[]}refresh(){return this.executeCommand("refresh")}getCurrentDirectory(){const e=this._getCurrentDirectory();return e&&e.fileItem||null}getSelectedItems(){return this._getSelectedItemInfos().map((e=>e.fileItem))}_onSelectedItemOpened(e){let{fileItemInfo:t}=e;const i=t.fileItem;if(!i.isDirectory){this._actions.onSelectedFileOpened({file:i});return}i.isParentFolder&&(this._itemKeyToFocus=this._getCurrentDirectory().fileItem.key);const n=i.isParentFolder?this._getCurrentDirectory().parentDirectory:t;this._setCurrentDirectory(n),n&&this._filesTreeView.toggleDirectoryExpandedState(n.parentDirectory,!0)}}ft("dxFileManager",zi);/*!
 * devextreme-vue
 * Version: 25.1.5
 * Build date: Wed Sep 03 2025
 *
 * Copyright (c) 2012 - 2025 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */const $i={props:{accessKey:String,activeStateEnabled:Boolean,allowedFileExtensions:Array,contextMenu:Object,currentPath:String,currentPathKeys:Array,customizeDetailColumns:Function,customizeThumbnail:Function,disabled:Boolean,elementAttr:Object,fileSystemProvider:{},focusedItemKey:String,focusStateEnabled:Boolean,height:[Number,String],hint:String,hoverStateEnabled:Boolean,itemView:Object,notifications:Object,onContentReady:Function,onContextMenuItemClick:Function,onContextMenuShowing:Function,onCurrentDirectoryChanged:Function,onDirectoryCreated:Function,onDirectoryCreating:Function,onDisposing:Function,onErrorOccurred:Function,onFileUploaded:Function,onFileUploading:Function,onFocusedItemChanged:Function,onInitialized:Function,onItemCopied:Function,onItemCopying:Function,onItemDeleted:Function,onItemDeleting:Function,onItemDownloading:Function,onItemMoved:Function,onItemMoving:Function,onItemRenamed:Function,onItemRenaming:Function,onOptionChanged:Function,onSelectedFileOpened:Function,onSelectionChanged:Function,onToolbarItemClick:Function,permissions:Object,rootFolderName:String,rtlEnabled:Boolean,selectedItemKeys:Array,selectionMode:String,tabIndex:Number,toolbar:Object,upload:Object,visible:Boolean,width:[Number,String]},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:activeStateEnabled":null,"update:allowedFileExtensions":null,"update:contextMenu":null,"update:currentPath":null,"update:currentPathKeys":null,"update:customizeDetailColumns":null,"update:customizeThumbnail":null,"update:disabled":null,"update:elementAttr":null,"update:fileSystemProvider":null,"update:focusedItemKey":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:itemView":null,"update:notifications":null,"update:onContentReady":null,"update:onContextMenuItemClick":null,"update:onContextMenuShowing":null,"update:onCurrentDirectoryChanged":null,"update:onDirectoryCreated":null,"update:onDirectoryCreating":null,"update:onDisposing":null,"update:onErrorOccurred":null,"update:onFileUploaded":null,"update:onFileUploading":null,"update:onFocusedItemChanged":null,"update:onInitialized":null,"update:onItemCopied":null,"update:onItemCopying":null,"update:onItemDeleted":null,"update:onItemDeleting":null,"update:onItemDownloading":null,"update:onItemMoved":null,"update:onItemMoving":null,"update:onItemRenamed":null,"update:onItemRenaming":null,"update:onOptionChanged":null,"update:onSelectedFileOpened":null,"update:onSelectionChanged":null,"update:onToolbarItemClick":null,"update:permissions":null,"update:rootFolderName":null,"update:rtlEnabled":null,"update:selectedItemKeys":null,"update:selectionMode":null,"update:tabIndex":null,"update:toolbar":null,"update:upload":null,"update:visible":null,"update:width":null},computed:{instance(){return this.$_instance}},beforeCreate(){this.$_WidgetClass=zi,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={contextMenu:{isCollectionItem:!1,optionName:"contextMenu"},itemView:{isCollectionItem:!1,optionName:"itemView"},notifications:{isCollectionItem:!1,optionName:"notifications"},permissions:{isCollectionItem:!1,optionName:"permissions"},toolbar:{isCollectionItem:!1,optionName:"toolbar"},upload:{isCollectionItem:!1,optionName:"upload"}}}};ui($i);const Gs=ye($i),Ri={emits:{"update:isActive":null,"update:hoveredElement":null,"update:alignment":null,"update:caption":null,"update:cssClass":null,"update:dataField":null,"update:dataType":null,"update:hidingPriority":null,"update:sortIndex":null,"update:sortOrder":null,"update:visible":null,"update:visibleIndex":null,"update:width":null},props:{alignment:String,caption:String,cssClass:String,dataField:String,dataType:String,hidingPriority:Number,sortIndex:Number,sortOrder:String,visible:Boolean,visibleIndex:Number,width:[Number,String]}};Se(Ri);const Ui=ye(Ri);Ui.$_optionName="columns";Ui.$_isCollectionItem=!0;const Ni={emits:{"update:isActive":null,"update:hoveredElement":null,"update:items":null},props:{items:Array}};Se(Ni);const Li=ye(Ni);Li.$_optionName="contextMenu";Li.$_expectedChildren={contextMenuItem:{isCollectionItem:!0,optionName:"items"},item:{isCollectionItem:!0,optionName:"items"}};const Vi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:beginGroup":null,"update:closeMenuOnClick":null,"update:disabled":null,"update:icon":null,"update:items":null,"update:name":null,"update:selectable":null,"update:selected":null,"update:text":null,"update:visible":null},props:{beginGroup:Boolean,closeMenuOnClick:Boolean,disabled:Boolean,icon:String,items:Array,name:String,selectable:Boolean,selected:Boolean,text:String,visible:Boolean}};Se(Vi);const Ot=ye(Vi);Ot.$_optionName="items";Ot.$_isCollectionItem=!0;Ot.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}};const Ki={emits:{"update:isActive":null,"update:hoveredElement":null,"update:columns":null},props:{columns:Array}};Se(Ki);const Wi=ye(Ki);Wi.$_optionName="details";Wi.$_expectedChildren={column:{isCollectionItem:!0,optionName:"columns"}};const Hi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:icon":null,"update:locateInMenu":null,"update:location":null,"update:name":null,"update:options":null,"update:showText":null,"update:text":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,icon:String,locateInMenu:String,location:String,name:String,options:{},showText:String,text:String,visible:Boolean,widget:String}};Se(Hi);const ji=ye(Hi);ji.$_optionName="fileSelectionItems";ji.$_isCollectionItem=!0;const Zi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:beginGroup":null,"update:closeMenuOnClick":null,"update:cssClass":null,"update:disabled":null,"update:icon":null,"update:items":null,"update:locateInMenu":null,"update:location":null,"update:name":null,"update:options":null,"update:selectable":null,"update:selected":null,"update:showText":null,"update:text":null,"update:visible":null,"update:widget":null},props:{beginGroup:Boolean,closeMenuOnClick:Boolean,cssClass:String,disabled:Boolean,icon:String,items:Array,locateInMenu:String,location:String,name:String,options:{},selectable:Boolean,selected:Boolean,showText:String,text:String,visible:Boolean,widget:String}};Se(Zi);const Bt=ye(Zi);Bt.$_optionName="items";Bt.$_isCollectionItem=!0;Bt.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}};const Gi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:details":null,"update:mode":null,"update:showFolders":null,"update:showParentFolder":null},props:{details:Object,mode:String,showFolders:Boolean,showParentFolder:Boolean}};Se(Gi);const qi=ye(Gi);qi.$_optionName="itemView";qi.$_expectedChildren={details:{isCollectionItem:!1,optionName:"details"}};const Yi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:showPanel":null,"update:showPopup":null},props:{showPanel:Boolean,showPopup:Boolean}};Se(Yi);const qs=ye(Yi);qs.$_optionName="notifications";const Xi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:copy":null,"update:create":null,"update:delete":null,"update:download":null,"update:move":null,"update:rename":null,"update:upload":null},props:{copy:Boolean,create:Boolean,delete:Boolean,download:Boolean,move:Boolean,rename:Boolean,upload:Boolean}};Se(Xi);const Ji=ye(Xi);Ji.$_optionName="permissions";const Qi={emits:{"update:isActive":null,"update:hoveredElement":null,"update:fileSelectionItems":null,"update:items":null},props:{fileSelectionItems:Array,items:Array}};Se(Qi);const zt=ye(Qi);zt.$_optionName="toolbar";zt.$_expectedChildren={fileSelectionItem:{isCollectionItem:!0,optionName:"fileSelectionItems"},item:{isCollectionItem:!0,optionName:"items"},toolbarItem:{isCollectionItem:!0,optionName:"items"}};const en={emits:{"update:isActive":null,"update:hoveredElement":null,"update:cssClass":null,"update:disabled":null,"update:icon":null,"update:locateInMenu":null,"update:location":null,"update:name":null,"update:options":null,"update:showText":null,"update:text":null,"update:visible":null,"update:widget":null},props:{cssClass:String,disabled:Boolean,icon:String,locateInMenu:String,location:String,name:String,options:{},showText:String,text:String,visible:Boolean,widget:String}};Se(en);const Ke=ye(en);Ke.$_optionName="items";Ke.$_isCollectionItem=!0;const tn={emits:{"update:isActive":null,"update:hoveredElement":null,"update:chunkSize":null,"update:maxFileSize":null},props:{chunkSize:Number,maxFileSize:Number}};Se(tn);const Ys=ye(tn);Ys.$_optionName="upload";const Xs="dx-gallery-item-image";class ai extends Ce{_supportedKeys(){return Ge({},super._supportedKeys(),{pageUp:Ee,pageDown:Ee})}_getDefaultOptions(){return Ge({},super._getDefaultOptions(),{direction:"next",onClick:null,hoverStateEnabled:!0,activeStateEnabled:!0})}_render(){super._render();const e=this.$element(),t=ve(rt,this.NAME),{direction:i}=this.option();e.addClass(`dx-gallery-nav-button-${i}`),de.off(e,t),de.on(e,t,(n=>{this._createActionByOption("onClick")({event:n})}))}_optionChanged(e){switch(e.name){case"onClick":case"direction":this._invalidate();break;default:super._optionChanged(e)}}}class Ze extends Ii{_getDefaultOptions(){return Ge({},super._getDefaultOptions(),{activeStateEnabled:!1,animationDuration:400,animationEnabled:!0,loop:!1,swipeEnabled:!0,indicatorEnabled:!0,showIndicator:!0,selectedIndex:0,slideshowDelay:0,showNavButtons:!1,wrapAround:!1,stretchImages:!1,loopItemFocus:!1,selectOnFocus:!0,selectionMode:"single",selectionRequired:!0,selectByClick:!1,_itemAttributes:{role:"option","aria-label":U.format("dxGallery-itemName")}})}_defaultOptionsRules(){return[...super._defaultOptionsRules(),{device:()=>We.real().deviceType==="desktop"&&!We.isSimulator(),options:{focusStateEnabled:!0}}]}_init(){super._init();const{loop:e}=this.option();this._activeStateUnit=".dx-gallery-item",this.option("loopItemFocus",e)}_initTemplates(){super._initTemplates(),this._templateManager.addDefaultTemplates({item:new yi(((e,t)=>{const i=w("<img>").addClass(Xs);un(t)?(this._prepareDefaultItemTemplate(t,e),i.attr({src:t.imageSrc,alt:t.imageAlt}).appendTo(e)):i.attr("src",String(t)).appendTo(e)}),["imageSrc","imageAlt","text","html"],this.option("integrationOptions.watchMethod"))})}_dataSourceOptions(){return{paginate:!1}}_itemContainer(){return this._$container}_itemClass(){return"dx-gallery-item"}_itemDataKey(){return"dxGalleryItemData"}_actualItemWidth(){const{wrapAround:e,stretchImages:t}=this.option();return t?1/(e?this._itemsPerPage()+1:this._itemsPerPage()):e?this._itemPercentWidth()*this._itemsPerPage()/(this._itemsPerPage()+1):this._itemPercentWidth()}_itemPercentWidth(){const e=wt(this.$element()),{initialItemWidth:t}=this.option();return t&&t<=e?t/e:1}_itemsPerPage(){const e=be()?Math.floor(1/this._itemPercentWidth()):1;return Math.min(e,this._itemsCount())}_pagesCount(){return Math.ceil(this._itemsCount()/this._itemsPerPage())}_itemsCount(){const{items:e=[]}=this.option();return e.length}_offsetDirection(){const{rtlEnabled:e}=this.option();return e?-1:1}_initMarkup(){this._renderWrapper(),this._renderItemsContainer(),this.$element().addClass("dx-gallery");const{loop:e}=this.option();this.$element().toggleClass("dx-gallery-loop",e),super._initMarkup();const i={role:this._itemsCount()>0?"listbox":void 0,label:"gallery"};this.setAria(i)}_render(){this._renderDragHandler(),this._renderContainerPosition(),this._renderItemSizes(),this._renderItemPositions(),this._renderNavButtons(),this._renderIndicator(),this._renderSelectedItem(),this._renderItemVisibility(),this._renderUserInteraction(),this._setupSlideShow(),this._reviseDimensions(),super._render()}_dimensionChanged(){const{selectedIndex:e=0}=this.option();this._stopItemAnimations(),this._clearCacheWidth(),this._cloneDuplicateItems(),this._renderItemSizes(),this._renderItemPositions(),this._renderIndicator(),this._renderContainerPosition(this._calculateIndexOffset(e),!0),this._renderItemVisibility()}_renderDragHandler(){const e=ve("dragstart",this.NAME);de.off(this.$element(),e),de.on(this.$element(),e,"img",(()=>!1))}_renderWrapper(){this._$wrapper||(this._$wrapper=w("<div>").addClass("dx-gallery-wrapper").appendTo(this.$element()))}_renderItems(e){if(!be()){const{selectedIndex:t=0}=this.option();e=e.length>t?e.slice(t,t+1):e.slice(0,1)}super._renderItems(e),this._loadNextPageIfNeeded()}_onItemTemplateRendered(){return()=>{Ze._wasAnyItemTemplateRendered||(Ze._wasAnyItemTemplateRendered=!0,gi(this.$element()))}}_renderItemsContainer(){this._$container||(this._$container=w("<div>").addClass("dx-gallery-container").appendTo(this._$wrapper))}_cloneDuplicateItems(){const{loop:e,items:t=[]}=this.option(),i=t.length;if(!e||!i)return;this._getLoopedItems().remove();const n=i-1,s=Math.min(this._itemsPerPage(),i),o=this._getRealItems(),r=this._itemContainer();for(let d=0;d<s;d+=1)this._cloneItemForDuplicate(o[d],r);for(let d=0;d<s;d+=1)this._cloneItemForDuplicate(o[n-d],r)}_cloneItemForDuplicate(e,t){if(e){const i=w(e).clone(!1).addClass("dx-gallery-item-loop").removeAttr("id").css("margin",0).appendTo(t);this.setAria({hidden:!0},i)}}_getRealItems(){return this.$element().find(".dx-gallery-item:not(.dx-gallery-item-loop)")}_getLoopedItems(){return this.$element().find(".dx-gallery-item-loop")}_emptyMessageContainer(){return this._$wrapper}_renderItemSizes(e){let t=this._itemElements();const i=this._actualItemWidth();e!==void 0&&(t=t.slice(e)),t.each(((n,s)=>(wn(w(s),100*i+"%"),!0)))}_renderItemPositions(){const{rtlEnabled:e,wrapAround:t,selectedIndex:i=0}=this.option(),n=this._actualItemWidth(),s=this._itemsCount(),o=this._itemsPerPage(),r=this.$element().find(".dx-gallery-item-loop").length,d=s+r-1,g=t?.5:0,v=this._itemFreeSpace(),y=!!v,C=e?"Right":"Left";this._itemElements().each(((h,_)=>{let c=h;const p=w(_).hasClass("dx-gallery-item-loop");if(h>s+o-1&&(c=d-c-o),!p&&c!==0)return y&&w(_).css(`margin${C}`,100*v+"%"),!0;const u=n*(c+g)+v*(c+1-g),I=p?C.toLowerCase():`margin${C}`;return w(_).css(I,100*u+"%"),!0})),this._relocateItems(i,i,!0)}_itemFreeSpace(){const{wrapAround:e}=this.option(),t=e?this._itemsPerPage()+1:this._itemsPerPage();return(1-this._actualItemWidth()*t)/(t+1)}_renderContainerPosition(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this._releaseInvisibleItems();const n=this._actualItemWidth(),s=this._offsetDirection()*e*(n+this._itemFreeSpace());let o=i,r;return se(this._animationOverride)&&(o=this._animationOverride,delete this._animationOverride),o?(this._startSwipe(),r=this._animate(s).done(this._endSwipe)):(Ue(this._$container,{left:s*this._elementWidth(),top:0}),r=te().resolveWith(this)),r.done((()=>{var d;(d=this._deferredAnimate)===null||d===void 0||d.resolveWith(this),t&&this._renderItemVisibility()})),r.promise()}_startSwipe(){this.$element().addClass("dx-gallery-active")}_endSwipe(){this.$element().removeClass("dx-gallery-active")}_animate(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=this._$container,n=te(),{animationDuration:s}=this.option(),o=this;return we.animate(this._$container.get(0),Ge({type:"slide",to:{left:e*(this._elementWidth()??0)},duration:s,complete(){o._needMoveContainerForward()&&Ue(i,{left:0,top:0}),o._needMoveContainerBack()&&Ue(i,{left:o._maxContainerOffset()*(o._elementWidth()??0),top:0}),n.resolveWith(o)}},t)),n}_needMoveContainerForward(){var e;const t=(((e=this._$container.position())===null||e===void 0?void 0:e.left)??0)*this._offsetDirection(),i=-this._maxItemWidth()*(this._elementWidth()??0)*this._itemsCount();return t<=i+1}_needMoveContainerBack(){var e;const t=(((e=this._$container.position())===null||e===void 0?void 0:e.left)??0)*this._offsetDirection(),i=this._actualItemWidth()*(this._elementWidth()??0);return t>=i-1}_maxContainerOffset(){const e=this._itemsCount()-this._itemsPerPage();return-this._maxItemWidth()*e*this._offsetDirection()}_maxItemWidth(){return this._actualItemWidth()+this._itemFreeSpace()}_reviseDimensions(){const e=this._itemElements().first().find(".dx-item-content");if(!e||e.is(":hidden"))return;const{height:t,width:i}=this.option();t||this.option("height",pi(e)),i||this.option("width",wt(e)),this._dimensionChanged()}_renderIndicator(){const{showIndicator:e}=this.option();if(this._cleanIndicators(),this.$element().toggleClass("dx-gallery-indicator-visible",e),!e)return;this._$indicator=w("<div>").addClass("dx-gallery-indicator").appendTo(this._$wrapper);const{indicatorEnabled:t}=this.option();for(let i=0;i<this._pagesCount();i+=1){const n=w("<div>").addClass("dx-gallery-indicator-item").appendTo(this._$indicator);t&&this._attachIndicatorClickHandler(n,i)}this._renderSelectedPageIndicator()}_attachIndicatorClickHandler(e,t){de.on(e,ve(rt,this.NAME),(i=>{this._indicatorSelectHandler(i,t)}))}_detachIndicatorClickHandler(e){de.off(e,ve(rt,this.NAME))}_toggleIndicatorInteraction(e){var t;const i=((t=this._$indicator)===null||t===void 0?void 0:t.find(".dx-gallery-indicator-item"))??w();i.length&&i.each(((n,s)=>(e?this._attachIndicatorClickHandler(w(s),n):this._detachIndicatorClickHandler(w(s)),!0)))}_cleanIndicators(){this._$indicator&&this._$indicator.remove()}_renderSelectedItem(){const{selectedIndex:e}=this.option();this._itemElements().removeClass("dx-gallery-item-selected"),se(e)&&this._itemElements().eq(e).addClass("dx-gallery-item-selected")}_renderItemVisibility(){const{initialItemWidth:e,wrapAround:t,selectedIndex:i}=this.option();if(e||t){this._releaseInvisibleItems();return}this._itemElements().each(((n,s)=>(i!==n&&w(s).find(".dx-item-content").addClass("dx-gallery-item-invisible"),!0)))}_releaseInvisibleItems(){this._itemElements().find(".dx-item-content").removeClass("dx-gallery-item-invisible")}_renderSelectedPageIndicator(){if(!this._$indicator)return;const{selectedIndex:e=0}=this.option(),t=this._pagesCount()-1;let i=Math.ceil(e/this._itemsPerPage());i=Math.min(t,i),this._$indicator.find(".dx-gallery-indicator-item").removeClass("dx-gallery-indicator-item-selected").eq(i).addClass("dx-gallery-indicator-item-selected")}_renderUserInteraction(){const{swipeEnabled:e,disabled:t}=this.option(),i=this.$element(),n=e&&this._itemsCount()>1;this._createComponent(i,Bn,{disabled:!!t||!n,onStart:s=>{const{event:o}=s;this._swipeStartHandler(o)},onUpdated:s=>{const{event:o}=s;this._swipeUpdateHandler(o)},onEnd:s=>{const{event:o}=s;this._swipeEndHandler(o)},itemSizeFunc:this._elementWidth.bind(this)})}_indicatorSelectHandler(e,t){const{indicatorEnabled:i}=this.option();if(!i)return;const n=this._fitPaginatedIndex(t*this._itemsPerPage());this._needLongMove=!0,this.option("selectedIndex",n),this._loadNextPageIfNeeded(n)}_renderNavButtons(){const{showNavButtons:e}=this.option();if(!e){this._cleanNavButtons();return}const t=this._nextPage.bind(this),i=this._prevPage.bind(this);this._prevNavButton=w("<div>").appendTo(this._$wrapper),this._createComponent(this._prevNavButton,ai,{direction:"prev",onClick(){i()}}),this._nextNavButton=w("<div>").appendTo(this._$wrapper),this._createComponent(this._nextNavButton,ai,{direction:"next",onClick(){t()}}),this._renderNavButtonsVisibility()}_prevPage(){const e=this._itemsPerPage(),{selectedIndex:t=0}=this.option(),i=t-e;return i===-e&&e===this._itemsCount()?this._relocateItems(i,0):this.goToItem(this._fitPaginatedIndex(i))}_nextPage(){const e=this._itemsPerPage(),{selectedIndex:t=0}=this.option(),i=t+e;return i===e&&e===this._itemsCount()?this._relocateItems(i,0):this.goToItem(this._fitPaginatedIndex(i)).done(this._loadNextPageIfNeeded)}_loadNextPageIfNeeded(e){var t;const{selectedIndex:i=0}=this.option(),n=e??i;(t=this._dataSource)!==null&&t!==void 0&&t.paginate()&&this._shouldLoadNextPage(n)&&!this._isDataSourceLoading()&&!this._isLastPage()&&this._loadNextPage().done((()=>{this._renderIndicator(),this._cloneDuplicateItems(),this._renderItemPositions(),this._renderNavButtonsVisibility(),this._renderItemSizes(n)}))}_shouldLoadNextPage(e){const t=this._itemsPerPage(),{items:i=[]}=this.option();return e+2*t>i.length}_allowDynamicItemsAppend(){return!0}_fitPaginatedIndex(e){const t=this._itemsPerPage(),i=e<0?t+e:this._itemsCount()-e;return e>this._itemsCount()-1?(this._goToGhostItem=!0,0):i<t&&i>0?e>0?e-t+i:e+t-i:e}_cleanNavButtons(){this._prevNavButton&&(this._prevNavButton.remove(),delete this._prevNavButton),this._nextNavButton&&(this._nextNavButton.remove(),delete this._nextNavButton)}_renderNavButtonsVisibility(){var e;const{showNavButtons:t,selectedIndex:i,loop:n}=this.option();if(!t||!this._prevNavButton||!this._nextNavButton)return;const s=this._itemsCount();if(this._prevNavButton.show(),this._nextNavButton.show(),s===0&&(this._prevNavButton.hide(),this._nextNavButton.hide()),n)return;let o=i===s-this._itemsPerPage();const r=s<2||i===0;(e=this._dataSource)!==null&&e!==void 0&&e.paginate()?o=o&&this._isLastPage():o=o||s<2,r&&this._prevNavButton.hide(),o&&this._nextNavButton.hide()}_getUserInteraction(){return this._userInteraction}_setupSlideShow(){const{slideshowDelay:e}=this.option();if(clearTimeout(this._slideshowTimer),!e)return;const t=this._getUserInteraction.bind(this),i=this._setupSlideShow.bind(this),n=this.nextItem.bind(this);this._slideshowTimer=setTimeout((()=>{if(t()){i();return}n(!0).done(i)}),e)}_elementWidth(){return this._cacheElementWidth||(this._cacheElementWidth=Re(this.$element())),this._cacheElementWidth}_clearCacheWidth(){delete this._cacheElementWidth}_swipeStartHandler(e){this._releaseInvisibleItems(),this._clearCacheWidth(),this._elementWidth();const t=this._itemsCount();if(!t){e.cancel=!0;return}this._stopItemAnimations(),this._startSwipe(),this._userInteraction=!0;const{selectedIndex:i=0,rtlEnabled:n,loop:s}=this.option();if(!s){const o=t-i-this._itemsPerPage(),r=i;e.maxLeftOffset=n?r:o,e.maxRightOffset=n?o:r}}_stopItemAnimations(){we.stop(this._$container.get(0),!0)}_swipeUpdateHandler(e){const{selectedIndex:t=0,wrapAround:i}=this.option(),n=i?1:0,s=this._itemsPerPage()+n,o=this._offsetDirection()*e.offset*s-t;o<0&&this._loadNextPageIfNeeded(Math.ceil(Math.abs(o))),this._renderContainerPosition(o)}_swipeEndHandler(e){const t=e.targetOffset*this._offsetDirection()*this._itemsPerPage(),{selectedIndex:i=0}=this.option(),n=this._fitIndex(i-t),s=this._fitPaginatedIndex(n);if(Math.abs(t)<this._itemsPerPage()){this._relocateItems(i);return}if(this._itemsPerPage()===this._itemsCount()){t>0?this._relocateItems(-t):this._relocateItems(0);return}this.option("selectedIndex",s)}_setFocusOnSelect(){this._userInteraction=!0;const e=this._getRealItems().filter(".dx-gallery-item-selected");this.option("focusedElement",St(e)),this._userInteraction=!1}_fitIndex(e){const{loop:t}=this.option();if(!t)return e;const i=this._itemsCount();let n=e;return(n>=i||n<0)&&(this._goToGhostItem=!0),n>=i&&(n=i-n),n%=i,n<0&&(n+=i),n}_clean(){super._clean(),this._cleanIndicators(),this._cleanNavButtons()}_dispose(){Ze._wasAnyItemTemplateRendered=null,clearTimeout(this._slideshowTimer),super._dispose()}_updateSelection(e,t){this._stopItemAnimations(),this._renderNavButtonsVisibility(),this._renderSelectedItem(),this._relocateItems(e[0],t[0]),this._renderSelectedPageIndicator()}_relocateItems(e,t,i){const n=this._calculateIndexOffset(e,t??e),{animationEnabled:s}=this.option();this._renderContainerPosition(n,!0,s&&!i).done((function(){this._setFocusOnSelect(),this._userInteraction=!1,this._setupSlideShow()}))}_focusInHandler(e){we.isAnimating(this._$container.get(0))||this._userInteraction||super._focusInHandler(e)}_focusOutHandler(e){we.isAnimating(this._$container.get(0))||this._userInteraction||super._focusOutHandler(e)}_selectFocusedItem(){}_moveFocus(e,t){this._stopItemAnimations(),super._moveFocus(e,t);const{focusedElement:i,animationEnabled:n}=this.option(),s=this.itemElements().index(w(i));this.goToItem(s,n)}_visibilityChanged(e){e&&this._reviseDimensions()}_calculateIndexOffset(e,t){const{loop:i}=this.option(),n=t??e;let s=n-e;return i&&!this._needLongMove&&this._goToGhostItem&&(this._isItemOnFirstPage(e)&&this._isItemOnLastPage(n)?s=-this._itemsPerPage():this._isItemOnLastPage(e)&&this._isItemOnFirstPage(n)&&(s=this._itemsPerPage()),this._goToGhostItem=!1),this._needLongMove=!1,s-=n,s}_isItemOnLastPage(e){return e>=this._itemsCount()-this._itemsPerPage()}_isItemOnFirstPage(e){return e<=this._itemsPerPage()}_optionChanged(e){const{name:t,value:i}=e;switch(t){case"width":case"initialItemWidth":super._optionChanged(e),this._dimensionChanged();break;case"animationDuration":this._renderNavButtonsVisibility();break;case"animationEnabled":break;case"loop":this.$element().toggleClass("dx-gallery-loop",i),this.option("loopItemFocus",i),be()&&(this._cloneDuplicateItems(),this._renderItemPositions(),this._renderNavButtonsVisibility());break;case"showIndicator":this._renderIndicator();break;case"showNavButtons":this._renderNavButtons();break;case"slideshowDelay":this._setupSlideShow();break;case"wrapAround":case"stretchImages":be()&&(this._renderItemSizes(),this._renderItemPositions(),this._renderItemVisibility());break;case"swipeEnabled":this._renderUserInteraction();break;case"indicatorEnabled":this._toggleIndicatorInteraction(i);break;default:super._optionChanged(e)}}goToItem(e,t){const{selectedIndex:i}=this.option(),n=this._itemsCount();t!==void 0&&(this._animationOverride=t);const s=this._fitIndex(e);return this._deferredAnimate=te(),s>n-1||s<0||i===s?this._deferredAnimate.resolveWith(this).promise():(this.option("selectedIndex",s),this._deferredAnimate.promise())}prevItem(e){const{selectedIndex:t=0}=this.option();return this.goToItem(t-1,e)}nextItem(e){const{selectedIndex:t=0}=this.option();return this.goToItem(t+1,e)}}Ze._wasAnyItemTemplateRendered=!1;ft("dxGallery",Ze);/*!
 * devextreme-vue
 * Version: 25.1.5
 * Build date: Wed Sep 03 2025
 *
 * Copyright (c) 2012 - 2025 Developer Express Inc. ALL RIGHTS RESERVED
 *
 * This software may be modified and distributed under the terms
 * of the MIT license. See the LICENSE file in the root of the project for details.
 *
 * https://github.com/DevExpress/devextreme-vue
 */const nn={props:{accessKey:String,animationDuration:Number,animationEnabled:Boolean,dataSource:[Array,Object,String],disabled:Boolean,elementAttr:Object,focusStateEnabled:Boolean,height:[Number,String],hint:String,hoverStateEnabled:Boolean,indicatorEnabled:Boolean,initialItemWidth:Number,itemHoldTimeout:Number,items:Array,itemTemplate:{},loop:Boolean,noDataText:String,onContentReady:Function,onDisposing:Function,onInitialized:Function,onItemClick:Function,onItemContextMenu:Function,onItemHold:Function,onItemRendered:Function,onOptionChanged:Function,onSelectionChanged:Function,rtlEnabled:Boolean,selectedIndex:Number,selectedItem:{},showIndicator:Boolean,showNavButtons:Boolean,slideshowDelay:Number,stretchImages:Boolean,swipeEnabled:Boolean,tabIndex:Number,visible:Boolean,width:[Number,String],wrapAround:Boolean},emits:{"update:isActive":null,"update:hoveredElement":null,"update:accessKey":null,"update:animationDuration":null,"update:animationEnabled":null,"update:dataSource":null,"update:disabled":null,"update:elementAttr":null,"update:focusStateEnabled":null,"update:height":null,"update:hint":null,"update:hoverStateEnabled":null,"update:indicatorEnabled":null,"update:initialItemWidth":null,"update:itemHoldTimeout":null,"update:items":null,"update:itemTemplate":null,"update:loop":null,"update:noDataText":null,"update:onContentReady":null,"update:onDisposing":null,"update:onInitialized":null,"update:onItemClick":null,"update:onItemContextMenu":null,"update:onItemHold":null,"update:onItemRendered":null,"update:onOptionChanged":null,"update:onSelectionChanged":null,"update:rtlEnabled":null,"update:selectedIndex":null,"update:selectedItem":null,"update:showIndicator":null,"update:showNavButtons":null,"update:slideshowDelay":null,"update:stretchImages":null,"update:swipeEnabled":null,"update:tabIndex":null,"update:visible":null,"update:width":null,"update:wrapAround":null},computed:{instance(){return this.$_instance}},beforeCreate(){this.$_WidgetClass=Ze,this.$_hasAsyncTemplate=!0,this.$_expectedChildren={item:{isCollectionItem:!0,optionName:"items"}}}};ui(nn);const Js=ye(nn),sn={emits:{"update:isActive":null,"update:hoveredElement":null,"update:disabled":null,"update:html":null,"update:imageAlt":null,"update:imageSrc":null,"update:template":null,"update:text":null},props:{disabled:Boolean,html:String,imageAlt:String,imageSrc:String,template:{},text:String}};Se(sn);const on=ye(sn);on.$_optionName="items";on.$_isCollectionItem=!0;const Qs={style:{padding:"32px",border:"1px solid #eee",margin:"auto",background:"#fff","max-inline-size":"1200px"}},eo=ye({__name:"dosya-yonetimi",setup(N){const e=Ne(!1),t=Ne([]),i=Ne(null),n=Ne(0),s=Ne(Math.min(window.innerWidth*.9,1200)),o=Ne(Math.min(window.innerHeight*.9,900)),r=Ne([]),d=Ne(0);pn(async()=>{const _=await mn.get("/api/file-manager");console.log("API file-manager response:",_.data),t.value=[{name:"root",isDirectory:!0,items:Array.isArray(_.data)?_.data:[_.data],key:"",relativeName:""}],n.value++,console.log("fileSystemData (wrapped):",t.value)});function g(_){i.value=_.selectedItems&&_.selectedItems.length?_.selectedItems[0]:null}function v(_){const c=_.url||(_.relativeName?window.location.origin+"/storage/"+_.relativeName:null);if(!c)return;const p=document.createElement("a");p.href=c,p.download=_.name||"",document.body.appendChild(p),p.click(),p.remove()}function y(_){const c=_.toolbarOptions.items;for(const p of c)if(p.name==="download"){const u=p.onClick;p.onClick=I=>{i.value&&(i.value.url||i.value.relativeName)?v(i.value):u&&u(I)}}}function C(_){var x;const c=_.file.parentPath||((x=_.file.key)==null?void 0:x.split("/").slice(0,-1).join("/"))||_.file.parentKey||"";console.log("parentKey:",c,"file:",_.file);function p(D,E){var T;if(!D)return[];const z=D.relativeName||D.key||D.name;if(z===E||(z==null?void 0:z.split("/").pop())===(E==null?void 0:E.split("/").pop()))return((T=D.items)==null?void 0:T.filter(V=>!V.items&&/\.(jpg|jpeg|png|gif)$/i.test(V.name)))||[];if(D.items)for(const V of D.items){const k=p(V,E);if(k.length)return k}return[]}let u=[];for(const D of t.value)if(u=p(D,c),u.length)break;r.value=u.map(D=>{const E=D.relativeName||D.key||"";return{name:D.name,url:E?window.location.origin+"/storage/"+E:""}}),console.log("galleryFiles:",r.value);const I=window.location.origin+"/storage/"+(_.file.relativeName||_.file.key||"");d.value=r.value.findIndex(D=>D.url===I),e.value=!0}function h(_){return`<img src='${_.url}' alt='${_.name}' style='width:100%;height:100%;object-fit:contain;' />`}return(_,c)=>{var p;return Ut(),_n("div",Qs,[(Ut(),fn(ke(Gs),{"file-system-provider":t.value,"on-selected-file-opened":C,"on-selection-changed":g,"on-toolbar-preparing":y,key:n.value,"current-path":""},{default:Ct(()=>[$e(ke(Ji),{create:!0,copy:!0,move:!0,delete:!0,rename:!0,upload:!0,download:!0}),$e(ke(zt),null,{default:Ct(()=>[$e(ke(Ke),{name:"create"}),$e(ke(Ke),{name:"upload"}),$e(ke(Ke),{name:"download"}),$e(ke(Ke),{name:"delete"}),$e(ke(Ke),{name:"refresh"})]),_:1})]),_:1},8,["file-system-provider"])),$e(ke(Kn),{"hide-on-outside-click":!0,"show-close-button":!0,visible:e.value,"onUpdate:visible":c[0]||(c[0]=u=>e.value=u),title:((p=r.value[d.value])==null?void 0:p.name)||"",width:s.value+50,height:o.value,class:"photo-popup-content"},{default:Ct(()=>[$e(ke(Js),{items:r.value,"selected-index":d.value,"show-indicator":!0,"show-nav-buttons":!0,height:o.value-80,width:s.value,loop:!0,"item-template":h},null,8,["items","selected-index","height","width"])]),_:1},8,["visible","title","width","height"])])}}}),Co=gn(eo,[["__scopeId","data-v-76b28a80"]]);export{Co as default};
