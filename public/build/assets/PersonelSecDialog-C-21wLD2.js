import{d as Y,f6 as D,f7 as K,r as y,G as H,b3 as g,w as F,g as I,f as l,o as V,b as i,c as h,l as G,e as p,ba as O,t as f,v as C,ae as b,Z as R,m as v,F as $,i as U}from"./main-0A_x4B75.js";import{d as Z}from"./dayjs.min-WZT4ZYRx.js";import{D as q,a as A,l as J,e as Q}from"./data-grid-CdCaZwRc.js";import{V as W}from"./VDialog-CVO4vIpf.js";import{V as X,b as ee,c as ae}from"./VCard-DHjz5lbD.js";import{V as ie}from"./VCardText-DHEFRlen.js";import{V as te}from"./VRow-KF1QWxH8.js";import{V as N}from"./VCol-DoZGG4g-.js";import{V as se,a as le,b as re}from"./VList-CLf4GeLi.js";import{V as oe}from"./VSpacer-C9G17y0Z.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./editor-CRTpc74D.js";import"./overlay-Cy1Y74ET.js";import"./m_row_dragging-C47XIC01.js";import"./m_select_box-BqlSp3Tc.js";import"./themes-BCp5f1F_.js";import"./VOverlay-C2bwGmm8.js";import"./easing-Bybner-F.js";import"./delay-CZeozyM1.js";import"./lazy-len405F8.js";import"./scopeId-B4JW0iet.js";import"./VImg-D0S7k270.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-y3qh7W6J.js";import"./VAvatar-CS5jcLRq.js";/* empty css              */import"./ssrBoot-1UUo5E25.js";import"./VDivider-BMZafjm5.js";const de={key:0,class:"dialog-loading-overlay d-flex flex-column align-center justify-center"},ue={class:"text-caption text-end"},me={class:"ps-6"},ce=Y({__name:"PersonelSecDialog",props:D({isemriID:{},istasyonId:{},guid:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:D(["kaydedildi","iptal"],["update:modelValue"]),setup(x,{emit:P}){const w=P,_=K(x,"modelValue"),d=x,S=y([]),n=y([]),o=y([]),u=y(!1);H(async()=>{const{data:t}=await g.get("/api/personeller");S.value=t}),F(_,async t=>{if(t){n.value=S.value.map(e=>({...e}));try{const e=await g.get("/api/aktif-ekipler",{params:{isemriID:d.isemriID,guid:d.guid}}),s=Array.isArray(e.data)?e.data:Object.values(e.data);o.value=s.map(a=>({register_id:a.register_id,ad_soyad:a.personel_full_name,kimlik_no:a.citizenship_no,istasyon_id:a.istasyon_id,sicil_no:a.sicil_no}));const m=new Set(o.value.map(a=>a.register_id));n.value=n.value.filter(a=>!m.has(a.register_id))}catch(e){console.error("Aktif ekip yüklenemedi:",e)}}});const z=t=>{const e=n.value.splice(t,1)[0];o.value.push(e)},B=t=>{const e=o.value.splice(t,1)[0];n.value.push(e)},E=t=>{const e=n.value.findIndex(s=>s.register_id===t);e!==-1&&z(e)},M=async()=>{if(u.value)return;u.value=!0;const t=Z().format("YYYY-MM-DD HH:mm:ss");try{const{data:e}=await g.get("/api/aktif-ekipler",{params:{isemriID:d.isemriID,guid:d.guid}}),s=new Set((Array.isArray(e)?e:Object.values(e)).filter(r=>r.end_work_time===null).map(r=>r.register_id)),m=new Set(o.value.map(r=>r.register_id)),a=o.value.filter(r=>!s.has(r.register_id)),c=Array.from(s).filter(r=>!m.has(r));if(a.length){const r=a.map(k=>({istasyon_id:d.istasyonId,worder_m_id:d.isemriID,register_id:k.register_id,sicil_no:k.sicil_no,personel_full_name:k.ad_soyad,citizenship_no:k.kimlik_no,co_id:2517,start_work_time:t,end_work_time:null,guid:d.guid}));await g.post("/api/aktif-ekipler",r)}c.length&&await g.put("/api/aktif-ekipler/kapat",{register_ids:c,guid:d.guid,end_work_time:t}),w("kaydedildi")}catch(e){console.error("KAYIT HATASI:",e)}finally{u.value=!1,_.value=!1}},T=()=>{_.value=!1,w("iptal")},j=t=>{t||w("iptal")},L=()=>{const t=new Set(o.value.map(a=>Number(a.register_id))),e=[];for(let a=n.value.length-1;a>=0;a--){const c=n.value[a],r=Number(c.register_id);c.istasyon_id===d.istasyonId&&!t.has(r)&&(e.push(c),n.value.splice(a,1))}const s=new Set(o.value.map(a=>Number(a.register_id))),m=e.filter(a=>!s.has(Number(a.register_id)));o.value.push(...m)};return(t,e)=>(V(),I(W,{modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>_.value=s),j],"max-width":"800"},{default:l(()=>[i(X,{class:"personel-dialog-card"},{default:l(()=>[u.value?(V(),h("div",de,[i(O,{indeterminate:"",color:"primary",size:"48",class:"mb-3"}),e[3]||(e[3]=p("span",{style:{"font-weight":"600"}},"Kayıt yapılıyor...",-1))])):G("",!0),i(ee,{class:"text-h6 d-flex justify-space-between align-center"},{default:l(()=>[e[5]||(e[5]=f(" Personel Seçimi ")),p("div",ue,[p("div",null,[e[4]||(e[4]=p("strong",null,"Seçilen:",-1)),f(" "+C(o.value.length)+" kişi",1)])])]),_:1,__:[5]}),p("div",me,[i(b,{variant:"outlined",onClick:e[0]||(e[0]=s=>L()),disabled:u.value},{default:l(()=>[i(R,{start:"",icon:"tabler-users"}),e[6]||(e[6]=f(" Ekip Aktar "))]),_:1,__:[6]},8,["disabled"])]),i(ie,null,{default:l(()=>[i(te,null,{default:l(()=>[i(N,{cols:"6"},{default:l(()=>[i(v(q),{"data-source":n.value,height:600,"key-expr":"register_id","show-borders":!0,"hover-state-enabled":!0,onRowClick:e[1]||(e[1]=s=>E(s.data.register_id))},{default:l(()=>[i(v(A),{"data-field":"ad_soyad",caption:"Ad Soyad","sort-order":"asc"}),i(v(A),{"data-field":"sicil_no",caption:"Sicil No",width:"100",visible:!1}),i(v(J),{visible:!0,"highlight-case-sensitive":!1}),i(v(Q),{mode:"virtual","row-rendering-mode":"virtual","show-scrollbar":"always"})]),_:1},8,["data-source"])]),_:1}),i(N,{cols:"6"},{default:l(()=>[e[7]||(e[7]=p("h5",{class:"text-subtitle-2 mt-9 mb-2"},"Ekip Listesi",-1)),i(se,{class:"border rounded",style:{"max-block-size":"535px","overflow-y":"auto"}},{default:l(()=>[(V(!0),h($,null,U(o.value,(s,m)=>(V(),I(le,{key:s.sicil_no,onClick:a=>B(m),class:"cursor-pointer"},{default:l(()=>[i(re,null,{default:l(()=>[f(C(s.ad_soyad),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1,__:[7]})]),_:1})]),_:1}),i(ae,null,{default:l(()=>[i(oe),i(b,{variant:"outlined",color:"warning",onClick:T,disabled:u.value},{default:l(()=>e[8]||(e[8]=[f("Vazgeç")])),_:1,__:[8]},8,["disabled"]),i(b,{onClick:M,variant:"outlined",color:"success",disabled:u.value},{default:l(()=>e[9]||(e[9]=[f("Kaydet")])),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Fe=ne(ce,[["__scopeId","data-v-0f8b1407"]]);export{Fe as default};
