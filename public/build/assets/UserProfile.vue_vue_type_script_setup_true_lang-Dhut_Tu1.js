import{d as L,j as P,b1 as S,b2 as _,X as Y,r as d,c as $,o as v,g as k,l as R,e as f,b as t,m as e,f as l,Z as j,v as b,t as u,ae as y,aU as E,b3 as M}from"./main-nZPIp3zM.js";import{C as Z}from"./vue3-perfect-scrollbar-ve0ZoxWR.js";import{V as q}from"./VBadge-Bd6yJObI.js";import{V as F}from"./VImg-CLhjQ_EV.js";import{V as K}from"./VMenu-CirLoP7d.js";import{V as X,a as G,d as H}from"./VList-B1s16OL7.js";import{V as J}from"./VAvatar-D2P1Ci0o.js";import{V as O,b as Q,c as W}from"./VCard-DUgU9KaA.js";import{V as ee}from"./VCardText-CM2of7En.js";import{V as x}from"./VTextField-DxmJk7KO.js";import{V as ae}from"./VDialog-CG_LdRfI.js";import{V as oe}from"./VSnackbar-erp3uETj.js";const te={class:"d-flex align-center gap-2"},se={class:"d-flex gap-2 align-center"},le={class:"text-h6 font-weight-medium"},re={class:"px-4 py-2"},ne={class:"px-4 py-2"},ie={class:"d-none d-sm-inline text-body-1 font-weight-medium"},ke=L({__name:"UserProfile",setup(de){const N=P(),h=S(),n=_("userData"),z=Y(()=>{const o=n.value;return o?typeof o=="string"?o:o.name||o.fullName||o.username||o.email||"":""}),C=async()=>{_("accessToken").value=null,n.value=null,await N.push("/login"),_("userAbilityRules").value=null,h.update([])},p=d(!1),r=d({current_password:"",password:"",password_confirmation:""}),i=d(!1),c=d(!1),w=d(!1),V=d(!1),m=d({show:!1,color:"success",text:""}),g=o=>!!o||"Zorunlu alan",D=o=>((o==null?void 0:o.length)??0)>=8||"En az 8 karakter",I=o=>o!==r.value.current_password||"Yeni şifre mevcut şifreyle aynı olamaz",T=o=>o===r.value.password||"Şifreler uyuşmuyor",U=()=>{r.value={current_password:"",password:"",password_confirmation:""},p.value=!0},B=async()=>{var o,a;if(!(!r.value.current_password||!r.value.password||r.value.password!==r.value.password_confirmation))try{i.value=!0,await M.post("/api/auth/change-password",r.value),m.value={show:!0,color:"success",text:"Şifre güncellendi. Lütfen tekrar giriş yapın."},p.value=!1,setTimeout(()=>{C()},800)}catch(s){const A=((a=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:a.message)||"İşlem sırasında hata oluştu";m.value={show:!0,color:"error",text:String(A)}}finally{i.value=!1}};return(o,a)=>(v(),$("div",te,[e(n)?(v(),k(q,{key:0,dot:"",bordered:"",location:"bottom right","offset-x":"1","offset-y":"2",color:"success"},{default:l(()=>[t(J,{size:"38",class:"cursor-pointer",color:e(n)&&e(n).avatar?void 0:"primary",variant:e(n)&&e(n).avatar?void 0:"tonal"},{default:l(()=>[e(n)&&e(n).avatar?(v(),k(F,{key:0,src:e(n).avatar},null,8,["src"])):(v(),k(j,{key:1,icon:"tabler-user"})),t(K,{activator:"parent",width:"240",location:"bottom end",offset:"12px"},{default:l(()=>[t(X,null,{default:l(()=>[t(G,null,{default:l(()=>[f("div",se,[f("div",null,[f("h6",le,b(e(n).fullName||e(n).username),1),t(H,{class:"text-capitalize text-disabled"},{default:l(()=>[u(b(e(n).role),1)]),_:1})])])]),_:1}),t(e(Z),{options:{wheelPropagation:!1}},{default:l(()=>[f("div",re,[t(y,{block:"",size:"small",color:"primary","append-icon":"tabler-lock-password",onClick:U,class:"mb-2",variant:"tonal"},{default:l(()=>a[9]||(a[9]=[u(" Şifre Değiştir ")])),_:1,__:[9]})]),f("div",ne,[t(y,{block:"",size:"small",color:"error","append-icon":"tabler-logout",onClick:C},{default:l(()=>a[10]||(a[10]=[u(" Çıkış Yap ")])),_:1,__:[10]})])]),_:1})]),_:1})]),_:1})]),_:1},8,["color","variant"])]),_:1})):R("",!0),f("span",ie,b(e(z)),1),t(ae,{modelValue:e(p),"onUpdate:modelValue":a[7]||(a[7]=s=>E(p)?p.value=s:null),"max-width":"420",persistent:""},{default:l(()=>[t(O,null,{default:l(()=>[t(Q,null,{default:l(()=>a[11]||(a[11]=[u("Şifre Değiştir")])),_:1,__:[11]}),t(ee,null,{default:l(()=>[t(x,{modelValue:e(r).current_password,"onUpdate:modelValue":a[0]||(a[0]=s=>e(r).current_password=s),label:"Mevcut Şifre",type:e(c)?"text":"password",disabled:e(i),autocomplete:"current-password",rules:[g],"append-inner-icon":e(c)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[1]||(a[1]=s=>c.value=!e(c))},null,8,["modelValue","type","disabled","rules","append-inner-icon"]),t(x,{class:"mt-2",modelValue:e(r).password,"onUpdate:modelValue":a[2]||(a[2]=s=>e(r).password=s),label:"Yeni Şifre",type:e(w)?"text":"password",disabled:e(i),autocomplete:"new-password",rules:[g,D,I],"append-inner-icon":e(w)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[3]||(a[3]=s=>w.value=!e(w))},null,8,["modelValue","type","disabled","rules","append-inner-icon"]),t(x,{class:"mt-2",modelValue:e(r).password_confirmation,"onUpdate:modelValue":a[4]||(a[4]=s=>e(r).password_confirmation=s),label:"Yeni Şifre (Tekrar)",type:e(V)?"text":"password",disabled:e(i),autocomplete:"new-password",rules:[g,T],"append-inner-icon":e(V)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[5]||(a[5]=s=>V.value=!e(V))},null,8,["modelValue","type","disabled","rules","append-inner-icon"])]),_:1}),t(W,{class:"justify-end"},{default:l(()=>[t(y,{variant:"tonal",onClick:a[6]||(a[6]=s=>p.value=!1),disabled:e(i)},{default:l(()=>a[12]||(a[12]=[u("Vazgeç")])),_:1,__:[12]},8,["disabled"]),t(y,{color:"primary",onClick:B,loading:e(i)},{default:l(()=>a[13]||(a[13]=[u("Kaydet")])),_:1,__:[13]},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(oe,{modelValue:e(m).show,"onUpdate:modelValue":a[8]||(a[8]=s=>e(m).show=s),color:e(m).color,timeout:"2500"},{default:l(()=>[u(b(e(m).text),1)]),_:1},8,["modelValue","color"])]))}});export{ke as _};
