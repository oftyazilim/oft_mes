import{_ as ye}from"./AppSelect.vue_vue_type_script_setup_true_lang-BgLD6FQ4.js";import{_ as _e}from"./AppTextarea.vue_vue_type_script_setup_true_lang-D_lIZ7IT.js";import{_ as Ve}from"./AppTextField.vue_vue_type_script_setup_true_lang-D2_miT5K.js";import{d as ke,r as m,i as xe,aK as De,s as f,w as Ce,c as ee,b as t,f as n,F as te,g as K,m as M,e as d,cU as Se,T as v,aF as w,l as i,p as b,ay as Ae,o as h}from"./main-DutK4zgt.js";import{s as ae,D as r}from"./data-grid-BcYbL45-.js";import{n as D}from"./notify-DCBxAOyw.js";import{V as le}from"./VRow-MyJ-KYMf.js";import{V as Ie}from"./VDialog-LOGGFm6w.js";import{V as Ke}from"./VSnackbar-CGx-yv3a.js";import{V as g}from"./VCol-008_lOYC.js";import{V as y,b as Te}from"./VCard-BEwag10s.js";import{V as ie}from"./VDivider-Bd4h0ODD.js";import{V as Fe}from"./VTextField-bGtyiGQC.js";import{V as Be}from"./VFileInput-CToiKZOb.js";import{V as N}from"./VImg-BLt3cdJ-.js";import{V as Ue}from"./VSpacer-DXIMElh0.js";import{V as T}from"./VCardText-CYfYjjc9.js";import"./form-B1zQy7mP.js";import"./VSelect-Kw_S0OIq.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-6neKh0p8.js";import"./ssrBoot-bcqS95-j.js";import"./index-C0EN1ist.js";import"./createSimpleFunctional-CGq-ys4F.js";import"./VAvatar-CzcOFsPX.js";import"./dialog-transition-fjiO2-FX.js";import"./easing-Bybner-F.js";import"./VMenu-C3kJZXRp.js";import"./VOverlay-eYtWPkCX.js";import"./delay-LKHUCO3l.js";import"./lazy-DZg7rPMf.js";import"./scopeId-D8EwU8hI.js";import"./VCheckboxBtn-CXaweKMs.js";import"./VSelectionControl-CrEcWiRY.js";import"./VChip-CwzDRZm1.js";import"./VSlideGroup-AG9uRfwa.js";import"./VTextarea-DGNeIFGF.js";/* empty css                   */import"./VCounter-Ei-HxEww.js";import"./VField-D9msNBbh.js";import"./VInput-BqpuYsFQ.js";import"./index-DIfmgJ8D.js";import"./dom_component-shw5uKZe.js";import"./m_row_dragging-xHAtL4Rq.js";import"./m_resize_observer-B1BT89PP.js";import"./m_select_box-NqlHKh9l.js";import"./themes-wZ3oZpf3.js";import"./editor-LR9BS2LK.js";import"./overlay-C-nqNLyB.js";import"./format_helper-DUDNzW9h.js";/* empty css              */const Re={class:"w-100 sticky-header overflow-hidden rounded-t"},qe={class:"d-flex align-center gap-4 flex-wrap bg-custom-background pa-6"},$e={class:"d-flex align-center gap-4",style:{flex:"1"}},Pe={class:"w-100 sticky-header overflow-hidden rounded-t"},ze={class:"text-h5 mt-2"},Oe={class:"toplam"},Me={class:"toplam"},Ne={class:"toplam"},Ee={class:"w-100 sticky-header overflow-hidden rounded-t"},Le={class:"text-h5 mt-2"},We={class:"d-flex align-center gap-4 flex-wrap bg-custom-background pa-6"},je={class:"w-100 sticky-header overflow-hidden rounded-t"},He={class:"d-flex align-center mt-2 gap-4",style:{flex:"1"}},Ye={class:"w-100 sticky-header overflow-hidden rounded-t"},Ge={class:"d-flex align-center gap-4 flex-wrap bg-custom-background pa-6"},Je={class:"d-flex align-center gap-4",style:{flex:"1"}},Qe={class:"d-flex align-center gap-4",style:{flex:"1"}},Xe={class:"d-flex align-center mt-1"},Ze={class:"ms-2 text-caption"},Xt=ke({__name:"urun-sorgula-trm",setup(et){document.title="OFT - Ürün Sorgula";const C=m(null),l=m({barkod:"",urunID:0,urunKodu:"",urunAdi:"",urunAdi2:"",toplama:0,toplami:0,toplamSayim:0}),F=m([]),B=m([]);xe(()=>{de(),De(()=>{var a,e;(e=(a=C.value)==null?void 0:a.focus)==null||e.call(a)})});const _=m(!1),U=m(!1),E=m(""),L=m("success"),W=async()=>{var a,e;if(l.value.barkod){_.value=!0;try{l.value.urunID=0,l.value.urunKodu="",l.value.urunAdi="",l.value.urunAdi2="",l.value.toplama=0,l.value.toplami=0,l.value.toplamSayim=0,F.value=[],B.value=[],await oe(),l.value.barkod="",(e=(a=C.value)==null?void 0:a.focus)==null||e.call(a)}catch(u){console.error("Hata:",u),E.value="Bir hata oluştu!",L.value="error",U.value=!0}finally{_.value=!1}}},oe=async()=>{try{const a=await f.get("/api/urunsorgula",{params:{itemID:l.value.barkod}});l.value.urunID=a.data.urun.item_id,l.value.urunKodu=a.data.urun.item_code,l.value.urunAdi=a.data.urun.item_name,l.value.urunAdi2=a.data.urun.item_name2,l.value.toplama=a.data.toplama,l.value.toplami=a.data.toplami,l.value.toplamSayim=a.data.toplamSayim,F.value=a.data.stoklar||[],B.value=a.data.detay||[],V.value="",P()}catch(a){throw console.error("Veri çekilirken hata oluştu: ",a),a}},j=a=>{a.rowType==="data"&&a.column.dataField==="qty_prm"&&a.value>0&&(a.cellElement.style.fontWeight="bold",a.cellElement.style.color="green"),a.rowType==="data"&&a.column.dataField==="qty_prm"&&a.value<0&&(a.cellElement.style.fontWeight="bold",a.cellElement.style.color="red")},p=m(null),R=m([]),V=m(""),q=m(""),H=m(),$=m([]),Y=m([]),re=()=>{var a,e,u;(u=(e=(a=H.value)==null?void 0:a.$el)==null?void 0:e.querySelector("input[type=file]"))==null||u.click()},ne=async a=>{try{const e={depoID:$.value,raf:q.value,itemID:a};await f.post("/api/rafgir",e),D("Başarıyla kaydedildi.","success",2e3)}catch(e){console.error("Kayıt sırasında hata oluştu:",e)}},de=async()=>{try{const a=await f.get("/api/depolarial",{params:{}});Y.value=a.data.depolar}catch(a){console.error("Veri çekilirken hata oluştu: ",a)}},ue=async a=>{if(!p.value){D("Fotoğraf seçiniz.","warning",2e3);return}if(!l.value.urunKodu){D("Ürün kodu yok.","error",2e3);return}const e=await pe(p.value,{maxWidth:1600,maxHeight:1600,quality:.8,mimeType:"image/jpeg",targetKB:900}),u=new FormData;u.append("photo",e,ce(p.value.name)),u.append("itemCode",l.value.urunKodu);try{await f.post("/api/stok-foto/upload",u),D("Fotoğraf yüklendi","success",1500),p.value=null,V.value="",P()}catch(s){console.error(s),D("Yükleme hatası","error",2e3)}};Ce(p,a=>{a&&(V.value=URL.createObjectURL(a))});const P=async()=>{if(!l.value.urunKodu){R.value=[];return}try{const{data:a}=await f.get("/api/stok-foto/list",{params:{itemCode:l.value.urunKodu}});R.value=a}catch(a){console.error("Foto listeleme hata",a)}},se=async a=>{if(confirm("Silmek istediğinize emin misiniz?"))try{await f.delete("/api/stok-foto/delete",{data:{itemCode:l.value.urunKodu,name:a}}),P()}catch(e){console.error("Silme hata",e)}},S=m(!1),G=m(""),me=a=>{G.value=a,S.value=!0},A=a=>new Intl.NumberFormat("tr-TR",{maximumFractionDigits:1}).format(a);function ce(a){return`${a.replace(/\.[^.]+$/,"")}.jpg`}async function pe(a,e){const{maxWidth:u=1600,maxHeight:s=1600,quality:c=.8,mimeType:o="image/jpeg",targetKB:k=900}=e||{},be=await ve(a),z=await we(be),{width:Q,height:X}=fe(z.naturalWidth,z.naturalHeight,u,s),x=document.createElement("canvas"),he=x.getContext("2d");x.width=Q,x.height=X,he.drawImage(z,0,0,Q,X);let I=c,O=await J(x,o,I);const ge=k*1024;let Z=0;for(;O.size>ge&&I>.4&&Z<4;)I-=.1,O=await J(x,o,I),Z++;return O}function fe(a,e,u,s){const c=Math.min(u/a,s/e,1);return{width:Math.round(a*c),height:Math.round(e*c)}}function ve(a){return new Promise((e,u)=>{const s=new FileReader;s.onload=()=>e(String(s.result)),s.onerror=u,s.readAsDataURL(a)})}function we(a){return new Promise((e,u)=>{const s=new Image;s.onload=()=>e(s),s.onerror=u,s.src=a})}function J(a,e,u){return new Promise(s=>a.toBlob(c=>s(c||new Blob),e,u))}return(a,e)=>{const u=Ve,s=_e,c=ye;return h(),ee(te,null,[t(le,null,{default:n(()=>[t(g,{md:"6",cols:"12",class:"mx-auto"},{default:n(()=>[t(y,{class:"overflow-visible"},{default:n(()=>[d("div",Re,[d("div",qe,[d("div",$e,[t(u,{ref_key:"barkodInput",ref:C,modelValue:l.value.barkod,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.barkod=o),placeholder:"BARKOD",class:"flex-1",onKeyup:Se(W,["enter"]),disabled:_.value},null,8,["modelValue","disabled"]),t(v,{loading:_.value,disabled:_.value||!C.value,onClick:W},{default:n(()=>e[13]||(e[13]=[w(" Ara ")])),_:1,__:[13]},8,["loading","disabled"])])])]),t(i(T),null,{default:n(()=>[e[14]||(e[14]=d("h5",{class:"text-h5 mb-2"}," Ürün Bilgileri ",-1)),t(ie,{class:"my-2"}),t(u,{modelValue:l.value.urunID,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.urunID=o),label:"Ürün ID",class:"mb-2",readOnly:""},null,8,["modelValue"]),t(u,{modelValue:l.value.urunKodu,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.urunKodu=o),label:"Ürün Kodu",class:"mb-2",readOnly:""},null,8,["modelValue"]),t(s,{modelValue:l.value.urunAdi,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.urunAdi=o),label:"Ürün Adı",class:"mb-2","auto-grow":"",rows:"1",readOnly:""},null,8,["modelValue"]),t(s,{modelValue:l.value.urunAdi2,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.urunAdi2=o),label:"Ürün Adı 2","auto-grow":"",rows:"1",readOnly:""},null,8,["modelValue"])]),_:1,__:[14]})]),_:1})]),_:1}),t(g,{md:"6",cols:"12",class:"mx-auto"},{default:n(()=>[t(y,{class:"overflow-visible"},{default:n(()=>[t(i(T),null,{default:n(()=>[d("div",Pe,[e[18]||(e[18]=d("h5",{class:"text-h5 mb-2"}," Depo Bilgileri ",-1)),t(i(ae),{id:"gridDepo",ref:"dataGridRefD","data-source":F.value,"show-borders":!0,"column-auto-width":!0,"row-alternation-enabled":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:j,height:"332px"},{default:n(()=>[t(i(r),{"data-field":"branch_desc",caption:"Firma Adı",visible:!0,width:120}),t(i(r),{"data-field":"whouse_code",caption:"Depo Kodu",visible:!0,width:80}),t(i(r),{"data-field":"description",caption:"Depo Adı",visible:!0,"min-width":180}),t(i(r),{"data-field":"add_string01",caption:"Raf Yeri",visible:!0,width:80}),t(i(r),{"data-field":"qty_prm",caption:"Miktar","data-type":"number",visible:!0,"min-width":50,format:{type:"fixedPoint",precision:2,thousandsSeparator:","}}),t(i(r),{"data-field":"unit_code",caption:"Birim",visible:!0,"min-width":40})]),_:1},8,["data-source"]),d("h5",ze,[e[15]||(e[15]=w(" Ana Depo: ")),d("span",Oe,b(A(l.value.toplama,1)),1),e[16]||(e[16]=w("       İstasyon Depo: ")),d("span",Me,b(A(l.value.toplami,1)),1),e[17]||(e[17]=w("       Genel       : ")),d("span",Ne,b(A(l.value.toplama+l.value.toplami,1)),1)])])]),_:1})]),_:1})]),_:1}),t(g,{cols:"12",class:"mx-auto"},{default:n(()=>[t(y,{class:"overflow-visible"},{default:n(()=>[t(i(T),null,{default:n(()=>[d("div",Ee,[e[19]||(e[19]=d("h5",{class:"text-h5 mb-2"}," Sayım Bilgileri ",-1)),t(i(ae),{id:"gridSayim","data-source":B.value,"show-borders":!0,"column-auto-width":"true","row-alternation-enabled":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:j},{default:n(()=>[t(i(r),{"data-field":"id",caption:"#",visible:!0,"min-width":50}),t(i(r),{"data-field":"qty_prm",caption:"Miktar","data-type":"number",visible:!0,"min-width":60,format:{type:"fixedPoint",precision:2,thousandsSeparator:","}}),t(i(r),{"data-field":"note1",caption:"Raf Yeri",visible:!0,"min-width":60}),t(i(r),{"data-field":"whouse_code",caption:"Depo",visible:!0,"min-width":40}),t(i(r),{"data-field":"sorumlu",caption:"Sorumlu",visible:!0,"min-width":80}),t(i(r),{"data-field":"create_date",caption:"Sayım Tarihi",visible:!0,"min-width":60,"data-type":"date",format:{formatter:o=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(o)).replace(/\//g,".")}},null,8,["format"]),t(i(r),{"data-field":"doc_no",caption:"Sayım No",visible:!0,"min-width":60}),t(i(r),{"data-field":"description",caption:"Depo Adı",visible:!0,"min-width":60}),t(i(r),{"data-field":"serial_m_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"barcode",visible:!0,"min-width":60}),t(i(r),{"data-field":"item_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"item_code",visible:!0,"min-width":60}),t(i(r),{"data-field":"item_name",visible:!0,"min-width":60}),t(i(r),{"data-field":"qty",visible:!0,"min-width":60}),t(i(r),{"data-field":"qty_free_prm",visible:!0,"min-width":60}),t(i(r),{"data-field":"qty_free_sec",visible:!0,"min-width":60}),t(i(r),{"data-field":"create_user_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"update_user_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"update_date",visible:!0,"min-width":60,"data-type":"date",format:{formatter:o=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(o)).replace(/\//g,".")}},null,8,["format"]),t(i(r),{"data-field":"whouse_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"location_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"us_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"unit_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"cycle_count_m_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"cycle_count_d_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"co_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"branch_id",visible:!0,"min-width":60}),t(i(r),{"data-field":"is_passive",visible:!0,"min-width":60})]),_:1},8,["data-source"]),d("h5",Le," Toplam: "+b(A(l.value.toplamSayim)),1)])]),_:1})]),_:1})]),_:1}),l.value.urunKodu?(h(),K(g,{key:0,cols:"12",class:"mx-auto"},{default:n(()=>[t(y,{class:"overflow-visible"},{default:n(()=>[d("div",We,[t(c,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=o=>$.value=o),items:Y.value,"item-title":"description","item-value":"whouse_id",label:"Depo","persistent-hint":"","return-object":"","single-line":"",placeholder:"Seçiniz...",variant:"outlined"},null,8,["modelValue","items"]),d("div",je,[d("div",He,[t(Fe,{modelValue:q.value,"onUpdate:modelValue":e[6]||(e[6]=o=>q.value=o),label:"Raf Yeri",variant:"outlined"},null,8,["modelValue"]),t(v,{icon:"tabler-device-floppy",rounded:"",onClick:e[7]||(e[7]=o=>ne(l.value.urunID))})])])])]),_:1})]),_:1})):M("",!0),l.value.urunKodu?(h(),K(g,{key:1,cols:"12",class:"mx-auto"},{default:n(()=>[t(y,{class:"overflow-visible"},{default:n(()=>[d("div",Ye,[d("div",Ge,[d("div",Je,[t(Be,{ref_key:"fileInput",ref:H,modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=o=>p.value=o),accept:"image/*",capture:"environment",label:"Fotoğraf Çek veya Seç","prepend-icon":"mdi-camera"},null,8,["modelValue"])]),d("div",Qe,[t(v,{icon:"tabler-camera-plus",rounded:"",onClick:re}),t(v,{icon:"tabler-upload",rounded:"",onClick:e[9]||(e[9]=o=>ue(l.value.urunID))})])]),V.value?(h(),K(N,{key:0,src:V.value,class:"ma-4"},null,8,["src"])):M("",!0)]),t(i(T),null,{default:n(()=>[e[20]||(e[20]=d("h5",{class:"text-h5 mb-2"}," Ürün Fotoğrafları ",-1)),t(ie,{class:"my-2"}),t(le,null,{default:n(()=>[(h(!0),ee(te,null,Ae(R.value,o=>(h(),K(g,{key:o.name,cols:"12",sm:"4",md:"3"},{default:n(()=>[t(N,{src:o.url,"max-height":"200",style:{cursor:"pointer","margin-inline-start":"-18px"},class:"rounded-lg",onClick:k=>me(o.url)},null,8,["src","onClick"]),d("div",Xe,[t(v,{icon:"tabler-trash",color:"error",rounded:"",onClick:k=>se(o.name)},null,8,["onClick"]),d("span",Ze,b(o.name),1)])]),_:2},1024))),128))]),_:1})]),_:1,__:[20]})]),_:1})]),_:1})):M("",!0)]),_:1}),t(Ie,{modelValue:S.value,"onUpdate:modelValue":e[11]||(e[11]=o=>S.value=o),"max-width":"1200"},{default:n(()=>[t(y,null,{default:n(()=>[t(N,{src:G.value,class:"ma-4","aspect-ratio":"1.5"},null,8,["src"]),t(Te,null,{default:n(()=>[t(Ue),t(v,{text:"",onClick:e[10]||(e[10]=o=>S.value=!1)},{default:n(()=>e[21]||(e[21]=[w("Kapat")])),_:1,__:[21]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ke,{modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=o=>U.value=o),color:L.value,timeout:"3000",location:"bottom center"},{default:n(()=>[w(b(E.value),1)]),_:1},8,["modelValue","color"])],64)}}});export{Xt as default};
