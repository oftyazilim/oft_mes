import{v as V,D as n,d as D,k as F,l as R,s as w,u as _}from"./data-grid-D8XIqW3F.js";import{d as L,r as u,i as N,c as O,e as M,g as b,b as t,f as m,l as a,s as d,o as v}from"./main-Y9vXpBPp.js";import{u as j}from"./pageTitle-DvZnyfUQ.js";import"./index-BsKGeb5Q.js";import"./dom_component-DPrQqB6J.js";import"./m_row_dragging-Bu6MIzqd.js";import"./m_resize_observer-unsydr3X.js";import"./m_select_box-KlxWyKhv.js";import"./themes-GOplzqTy.js";import"./editor-CRuWP15b.js";import"./overlay-BI_S-jHv.js";import"./format_helper-B9lqlWI4.js";const q={class:"grids"},se=L({__name:"roller",setup(H){const g=j();g.setTitle("Kullanıcı Rolleri"),g.setToplam(""),document.title="OFT - Roller";const f=u([]),h=u([]),l=u([]),r=u([]),i=u([]),x=u(0),k=u(0),y=e=>e&&["ALL"].indexOf(e.trim().toUpperCase())>=0,P=e=>!y(e.row.data.name),A=e=>!y(e.row.data.name),E=e=>{$(e)},I=e=>{K(e)},S=e=>{z(e)},$=e=>{e.promise=new Promise(async(o,s)=>{try{const c={...e.oldData,...e.newData};await d.put(`/api/rolGuncelle/${e.key}`,c),await p(),e.component.cancelEditData(),o()}catch(c){console.error("Error updating data:",c),s()}})},K=e=>{e.promise=new Promise(async(o,s)=>{try{await d.post("/api/rolEkle",{name:e.data.name}),await p(),e.component.cancelEditData(),o()}catch(c){console.error("Error adding data:",c),s()}})},z=e=>{e.promise=new Promise(async(o,s)=>{try{await d.delete(`/api/rolSil/${e.key}`),await p(),e.component.cancelEditData(),o()}catch(c){console.error("Error deleting data:",c),s()}})},p=async()=>{const{data:e}=await d.get("/api/roles-count");f.value=e},C=async()=>{const e=await d.get(`/api/roles-users/${l.value.name}`);h.value=e.data},G=async()=>{if(!l.value)return;const{data:e}=await d.get(`/api/roles/${l.value.id}/permissions`);i.value=e.assigned,r.value=e.available},T=async e=>{try{const o=e.itemData;if(!l.value||!o)return;i.value.push(o),r.value=r.value.filter(s=>s.id!==o.id),i.value=[...i.value],r.value=[...r.value],await d.post(`/api/roles/${l.value.id}/permissions`,{permission_id:o.id})}catch(o){console.error("İzin atama işlemi başarısız oldu:",o)}},U=async e=>{const o=e.itemData;!l.value||!o||(r.value.push(o),i.value=i.value.filter(s=>s.id!==o.id),i.value=[...i.value],r.value=[...r.value],await d.delete(`/api/roles/${l.value.id}/permissions/${o.id}`))};N(async()=>{p()});const B=e=>{const o=e.row.data;l.value=o,G(),C()};return(e,o)=>(v(),O("div",null,[M("div",q,[(v(),b(a(w),{"data-source":f.value,key:x.value,"key-expr":"id","show-borders":!0,width:"400","columns-auto-width":!0,"row-alternation-enabled":!0,"focused-row-enabled":!0,"show-indicator":!0,onFocusedRowChanged:B,onRowUpdating:E,onRowInserting:I,onRowRemoving:S},{default:m(()=>[t(a(V),{"allow-updating":A,"allow-adding":!0,"allow-deleting":P,"use-icons":!0,mode:"row"}),t(a(n),{"data-field":"id",caption:"Rol ID",width:"60","allow-editing":!1}),t(a(n),{"data-field":"name",caption:"Rol Adı",width:"120"}),t(a(n),{"data-field":"guard_name",caption:"Guard",width:"70"}),t(a(n),{"data-field":"users_count",caption:"KllAd",width:"60"}),t(a(D),{mode:"virtual","column-rendering-mode":"virtual"}),t(a(F),{visible:!0,width:240,placeholder:"Ara..."}),t(a(R),{mode:"none"})]),_:1},8,["data-source"])),(v(),b(a(w),{"data-source":h.value,key:k.value,"key-expr":"id","show-borders":!0,width:"300",title:"Atanmış İzinler","columns-auto-width":!0,"row-alternation-enabled":!1,"focused-row-enabled":!0,"show-indicator":!0,"allow-column-reordering":!0},{default:m(()=>[t(a(n),{caption:"Atanmış Kullanıcılar",alignment:"center"},{default:m(()=>[t(a(n),{"data-field":"id",caption:"ID",width:"60","allow-editing":!1}),t(a(n),{"data-field":"name",caption:"Kullanıcı Adı",width:"200"})]),_:1}),t(a(D),{mode:"virtual","column-rendering-mode":"virtual"}),t(a(R),{mode:"none"})]),_:1},8,["data-source"])),t(a(w),{"data-source":r.value,"show-borders":!0},{default:m(()=>[t(a(_),{group:"permissionsGroup","on-add":U}),t(a(n),{"data-field":"name",caption:"Atanmamış İzinler"})]),_:1},8,["data-source"]),t(a(w),{"data-source":i.value,"show-borders":!0},{default:m(()=>[t(a(_),{group:"permissionsGroup","on-add":T}),t(a(n),{"data-field":"name",caption:"Atanmış İzinler"})]),_:1},8,["data-source"])])]))}});export{se as default};
