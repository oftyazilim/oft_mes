import{d as L,eY as D,eZ as K,r as y,i as F,s as g,w as H,g as I,f as r,b as i,c as h,m as O,e as p,aY as R,aF as f,p as C,T as b,y as $,l as k,ay as G,F as U,o as V,x as Z}from"./main-dui5Vje2.js";import{d as q}from"./dayjs.min-WZT4ZYRx.js";import{s as J,D as A,k as Q,d as W}from"./data-grid-CXRT5XFU.js";import{V as X}from"./VDialog-CI4XP-Kl.js";import{a as ee,b as ae,V as ie}from"./VCard-Ce1yszRz.js";import{V as te}from"./VCardText-Cy5QQT_n.js";import{V as se}from"./VRow-BzW310ld.js";import{V as N}from"./VCol-igawGPh2.js";import{V as re,a as le,b as oe}from"./VList-8ZDPaazy.js";import{V as ne}from"./VSpacer-BCrgTeGd.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-BWoz3xnY.js";import"./dom_component-rNBeBBGQ.js";import"./m_row_dragging-BmVEM4WT.js";import"./m_resize_observer-QIriJutP.js";import"./m_select_box-DnG5dNH2.js";import"./themes-Dz-rJM0x.js";import"./editor-DdcKiGMI.js";import"./overlay-CqnVo2M6.js";import"./format_helper-CXC1133K.js";import"./VOverlay-BXyXhy3o.js";import"./easing-Bybner-F.js";import"./delay-CMuwXp9_.js";import"./lazy-b0Kybsre.js";import"./scopeId-C7PK8FF5.js";import"./index-C5J8P44N.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-D0Ybi4xJ.js";import"./createSimpleFunctional-B2d7GdJi.js";import"./VAvatar-D1E6dIOr.js";import"./VImg-DqPPsg4R.js";/* empty css              */import"./ssrBoot-GyBfYfFD.js";import"./VDivider-DWzx84o8.js";const de={key:0,class:"dialog-loading-overlay d-flex flex-column align-center justify-center"},ue={class:"text-caption text-end"},me={class:"ps-6"},ce=L({__name:"PersonelSecDialog",props:D({isemriID:{},istasyonId:{},guid:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:D(["kaydedildi","iptal"],["update:modelValue"]),setup(x,{emit:P}){const w=P,_=K(x,"modelValue"),d=x,S=y([]),n=y([]),o=y([]),u=y(!1);F(async()=>{const{data:t}=await g.get("/api/personeller");S.value=t}),H(_,async t=>{if(t){n.value=S.value.map(e=>({...e}));try{const e=await g.get("/api/aktif-ekipler",{params:{isemriID:d.isemriID,guid:d.guid}}),s=Array.isArray(e.data)?e.data:Object.values(e.data);o.value=s.map(a=>({register_id:a.register_id,ad_soyad:a.personel_full_name,kimlik_no:a.citizenship_no,istasyon_id:a.istasyon_id,sicil_no:a.sicil_no}));const m=new Set(o.value.map(a=>a.register_id));n.value=n.value.filter(a=>!m.has(a.register_id))}catch(e){console.error("Aktif ekip yüklenemedi:",e)}}});const z=t=>{const e=n.value.splice(t,1)[0];o.value.push(e)},B=t=>{const e=o.value.splice(t,1)[0];n.value.push(e)},T=t=>{const e=n.value.findIndex(s=>s.register_id===t);e!==-1&&z(e)},Y=async()=>{if(u.value)return;u.value=!0;const t=q().format("YYYY-MM-DD HH:mm:ss");try{const{data:e}=await g.get("/api/aktif-ekipler",{params:{isemriID:d.isemriID,guid:d.guid}}),s=new Set((Array.isArray(e)?e:Object.values(e)).filter(l=>l.end_work_time===null).map(l=>l.register_id)),m=new Set(o.value.map(l=>l.register_id)),a=o.value.filter(l=>!s.has(l.register_id)),c=Array.from(s).filter(l=>!m.has(l));if(a.length){const l=a.map(v=>({istasyon_id:d.istasyonId,worder_m_id:d.isemriID,register_id:v.register_id,sicil_no:v.sicil_no,personel_full_name:v.ad_soyad,citizenship_no:v.kimlik_no,co_id:2517,start_work_time:t,end_work_time:null,guid:d.guid}));await g.post("/api/aktif-ekipler",l)}c.length&&await g.put("/api/aktif-ekipler/kapat",{register_ids:c,guid:d.guid,end_work_time:t}),w("kaydedildi")}catch(e){console.error("KAYIT HATASI:",e)}finally{u.value=!1,_.value=!1}},E=()=>{_.value=!1,w("iptal")},M=t=>{t||w("iptal")},j=()=>{const t=new Set(o.value.map(a=>Number(a.register_id))),e=[];for(let a=n.value.length-1;a>=0;a--){const c=n.value[a],l=Number(c.register_id);c.istasyon_id===d.istasyonId&&!t.has(l)&&(e.push(c),n.value.splice(a,1))}const s=new Set(o.value.map(a=>Number(a.register_id))),m=e.filter(a=>!s.has(Number(a.register_id)));o.value.push(...m)};return(t,e)=>(V(),I(X,{modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>_.value=s),M],"max-width":"800"},{default:r(()=>[i(ie,{class:"personel-dialog-card"},{default:r(()=>[u.value?(V(),h("div",de,[i(R,{indeterminate:"",color:"primary",size:"48",class:"mb-3"}),e[3]||(e[3]=p("span",{style:{"font-weight":"600"}},"Kayıt yapılıyor...",-1))])):O("",!0),i(ee,{class:"text-h6 d-flex justify-space-between align-center"},{default:r(()=>[e[5]||(e[5]=f(" Personel Seçimi ")),p("div",ue,[p("div",null,[e[4]||(e[4]=p("strong",null,"Seçilen:",-1)),f(" "+C(o.value.length)+" kişi",1)])])]),_:1,__:[5]}),p("div",me,[i(b,{variant:"outlined",onClick:e[0]||(e[0]=s=>j()),disabled:u.value},{default:r(()=>[i($,{start:"",icon:"tabler-users"}),e[6]||(e[6]=f(" Ekip Aktar "))]),_:1,__:[6]},8,["disabled"])]),i(te,null,{default:r(()=>[i(se,null,{default:r(()=>[i(N,{cols:"6"},{default:r(()=>[i(k(J),{"data-source":n.value,height:600,"key-expr":"register_id","show-borders":!0,"hover-state-enabled":!0,onRowClick:e[1]||(e[1]=s=>T(s.data.register_id))},{default:r(()=>[i(k(A),{"data-field":"ad_soyad",caption:"Ad Soyad","sort-order":"asc"}),i(k(A),{"data-field":"sicil_no",caption:"Sicil No",width:"100",visible:!1}),i(k(Q),{visible:!0,"highlight-case-sensitive":!1}),i(k(W),{mode:"virtual","row-rendering-mode":"virtual","show-scrollbar":"always"})]),_:1},8,["data-source"])]),_:1}),i(N,{cols:"6"},{default:r(()=>[e[7]||(e[7]=p("h5",{class:"text-subtitle-2 mt-9 mb-2"},"Ekip Listesi",-1)),i(re,{class:"border rounded",style:{"max-block-size":"535px","overflow-y":"auto"}},{default:r(()=>[(V(!0),h(U,null,G(o.value,(s,m)=>(V(),I(le,{key:s.sicil_no,onClick:a=>B(m),class:"cursor-pointer"},{default:r(()=>[i(oe,null,{default:r(()=>[f(C(s.ad_soyad),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1,__:[7]})]),_:1})]),_:1}),i(ae,null,{default:r(()=>[i(ne),i(b,{variant:"outlined",color:"warning",onClick:E,disabled:u.value},{default:r(()=>e[8]||(e[8]=[f("Vazgeç")])),_:1,__:[8]},8,["disabled"]),i(b,{onClick:Y,variant:"outlined",color:"success",disabled:u.value},{default:r(()=>e[9]||(e[9]=[f("Kaydet")])),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ue=Z(ce,[["__scopeId","data-v-0f8b1407"]]);export{Ue as default};
