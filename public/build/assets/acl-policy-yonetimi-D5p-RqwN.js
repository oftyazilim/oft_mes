import{u as Z}from"./pageTitle-DkHCUcBi.js";import{d as h,r,D as y,w as $,i as ee,g as U,o as Y,f as a,b as o,e as b,T as f,aF as m,p as S,m as te,s as V,aK as E}from"./main-DNkPWIUY.js";import{V as P,a as B,b as le}from"./VCard-BKhxokUp.js";import{V as M}from"./VTextField-CdYgpAvP.js";import{V as N}from"./VCardText-B6W6a2uu.js";import{V as oe}from"./VDataTable-BaL5XGaP.js";import{V as ae}from"./VDialog-DQSSxphZ.js";import{V as j}from"./VCombobox-Bs4dmcB3.js";import{V as ie}from"./VSpacer-2cUjllsJ.js";import{V as se}from"./VContainer-q0WLrFFU.js";import"./createSimpleFunctional-CW70GlvX.js";import"./VAvatar-Dep-akKp.js";import"./VImg-Bbs71nfh.js";import"./index-Dg0diuT-.js";/* empty css                   */import"./VCounter-DVRz9sKU.js";import"./VField-B5kZ2PFq.js";import"./focus-Crm5ce-M.js";import"./easing-Bybner-F.js";import"./VInput-BzsUHwpb.js";import"./form-CBR7azYR.js";import"./forwardRefs-C-GTDzx5.js";import"./VPagination-CF2ZDF0T.js";import"./VSelect-COol4o5P.js";import"./VList-DA42wGxz.js";import"./ssrBoot-BplPmvzO.js";import"./VDivider-zvu06q90.js";import"./dialog-transition-BBjtZvz_.js";import"./VMenu-D0l3nCiy.js";import"./VOverlay-BMgLBg2C.js";import"./delay-BS2GBqcy.js";import"./lazy-BGAgNuzq.js";import"./scopeId-DYetfNDJ.js";import"./VCheckboxBtn-Tq5p1nu0.js";import"./VSelectionControl-BX_nttJy.js";import"./VChip-CCSRBoOd.js";import"./VSlideGroup-CboOnnQZ.js";import"./VTable-CgZd80_V.js";import"./filter-HWHFjz1W.js";/* empty css              */const O="Policy Yönetimi",z="ACL",Je=h({__name:"acl-policy-yonetimi",setup(ne){Z().setTitle(`${O} (${z})`),document.title=`OFT - ${O} | ${z}`;const u=r([]),k=r(!1),i=r(null),n=r(!1),c=r([]),d=r([]),w=r(""),K=y(()=>{const t=w.value.trim().toLowerCase();return t?u.value.filter(e=>e.key.toLowerCase().includes(t)||(e.description||"").toLowerCase().includes(t)):u.value}),q=y(()=>{const t=new Set;for(const e of u.value)t.add(e.key);return Array.from(t).sort()}),F=y(()=>{const t=new Set;for(const e of u.value)for(const l of e.actions||[])t.add(String(l));return Array.from(t).sort()}),X=y(()=>{const t=new Set;for(const e of u.value)for(const l of e.subjects||[])t.add(String(l));return Array.from(t).sort()});$(n,t=>{t?E(x):i.value=null});function x(){const t=document.querySelectorAll(".v-overlay--active .v-overlay__content"),e=t[t.length-1];if(!e)return;e.style.position="absolute",e.style.inset="unset";const l=e.querySelector(".v-card-title");if(!l)return;l.style.cursor="move";let s=0,T=0,_=0,A=0,C=!1;const D=p=>{if(!C)return;const v=p.clientX-s,W=p.clientY-T;e.style.left=`${_+v}px`,e.style.top=`${A+W}px`},L=()=>{C=!1,window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",L)},Q=p=>{C=!0;const v=e.getBoundingClientRect();s=p.clientX,T=p.clientY,_=v.left,A=v.top,window.addEventListener("mousemove",D),window.addEventListener("mouseup",L)};l.addEventListener("mousedown",Q,{passive:!0})}$(n,t=>{t&&E(x)});async function g(){k.value=!0;try{const{data:t}=await V.get("/api/ability-policies");u.value=(t||[]).map(e=>({id:e.id,key:e.key,actions:e.actions||[],subjects:e.subjects||[],description:e.description||""}))}finally{k.value=!1}}function I(){i.value={key:"",actions:[],subjects:[],description:""},c.value=[],d.value=[],n.value=!0}function R(t){i.value={...t},c.value=[...t.actions||[]],d.value=[...t.subjects||[]],n.value=!0}async function G(){var e;if(!i.value)return;const t={key:i.value.key.trim(),actions:[...c.value],subjects:[...d.value],description:((e=i.value.description)==null?void 0:e.trim())||null};try{i.value.id?await V.put(`/api/ability-policies/${i.value.id}`,t):await V.post("/api/ability-policies",t),n.value=!1,i.value=null,await g()}catch(l){console.error(l)}}function H(){n.value=!1,i.value=null}async function J(t){t.id&&(await V.delete(`/api/ability-policies/${t.id}`),await g())}return ee(g),(t,e)=>(Y(),U(se,null,{default:a(()=>[o(P,null,{default:a(()=>[o(B,{class:"d-flex align-center justify-space-between"},{default:a(()=>[e[7]||(e[7]=b("span",null,"ACL Policy Yönetimi",-1)),b("div",null,[o(M,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=l=>w.value=l),density:"compact",label:"Ara (key/description)",class:"me-2"},null,8,["modelValue"]),o(f,{color:"primary",onClick:I,class:"mt-2"},{default:a(()=>e[6]||(e[6]=[m("Yeni Policy")])),_:1,__:[6]})])]),_:1,__:[7]}),o(N,null,{default:a(()=>[o(oe,{items:K.value,loading:k.value,headers:[{title:"Key",key:"key"},{title:"Actions",key:"actions"},{title:"Subjects",key:"subjects"},{title:"Description",key:"description"},{title:"",key:"act",sortable:!1}]},{"item.actions":a(({item:l})=>{var s;return[b("div",null,S((s=l.actions)==null?void 0:s.join(", ")),1)]}),"item.subjects":a(({item:l})=>{var s;return[b("div",null,S((s=l.subjects)==null?void 0:s.join(", ")),1)]}),"item.act":a(({item:l})=>[o(f,{size:"small",class:"me-2",onClick:s=>R(l)},{default:a(()=>e[8]||(e[8]=[m("Düzenle")])),_:2,__:[8]},1032,["onClick"]),o(f,{size:"small",color:"error",onClick:s=>J(l)},{default:a(()=>e[9]||(e[9]=[m("Sil")])),_:2,__:[9]},1032,["onClick"])]),_:1},8,["items","loading"])]),_:1})]),_:1}),o(ae,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value=l),"max-width":"640"},{default:a(()=>[i.value?(Y(),U(P,{key:0},{default:a(()=>[o(B,null,{default:a(()=>{var l;return[m(S((l=i.value)!=null&&l.id?"Policy Düzenle":"Yeni Policy"),1)]}),_:1}),o(N,null,{default:a(()=>[o(j,{class:"mb-4",modelValue:i.value.key,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.key=l),items:q.value,label:"Key (örn: route:dashboards-analytics)","hide-details":"auto",clearable:""},null,8,["modelValue","items"]),o(j,{class:"mb-4",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=l=>c.value=l),items:F.value,label:"Actions (çoklu)",multiple:"",chips:"","closable-chips":"","hide-details":"auto",clearable:""},null,8,["modelValue","items"]),o(j,{class:"mb-4",modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=l=>d.value=l),items:X.value,label:"Subjects (çoklu)",multiple:"",chips:"","closable-chips":"","hide-details":"auto",clearable:""},null,8,["modelValue","items"]),o(M,{class:"mb-2",modelValue:i.value.description,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.description=l),label:"Açıklama"},null,8,["modelValue"])]),_:1}),o(le,null,{default:a(()=>[o(ie),o(f,{variant:"text",onClick:H},{default:a(()=>e[10]||(e[10]=[m("İptal")])),_:1,__:[10]}),o(f,{color:"primary",onClick:G},{default:a(()=>e[11]||(e[11]=[m("Kaydet")])),_:1,__:[11]})]),_:1})]),_:1})):te("",!0)]),_:1},8,["modelValue"])]),_:1}))}});export{Je as default};
