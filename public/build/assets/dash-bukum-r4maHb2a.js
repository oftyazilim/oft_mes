import{d as Re,r as n,D as f,i as ue,b2 as R,c as h,m as W,b as a,e as s,f as r,F as We,s as Oe,p as S,V as O,az as qe,l as u,o as b,x as Be}from"./main-CC0S-MzY.js";import{D as de,a as ce,b as me,c as J,d as ve,e as fe,f as pe,g as ye,h as he}from"./chart-EZLShlE8.js";import{V as Fe}from"./VRow-BiJFK6vz.js";import{V as v}from"./VCol-BvCN_tSW.js";import{V as Q}from"./VCard-XhBRIBq8.js";import{V as ee}from"./VCardText-C_q08Dmo.js";import"./index-DeuxNzHb.js";import"./dom_component-1A2f9Qu7.js";import"./m_base_widget-xbd_9XUJ.js";import"./format_helper-DpHqrsjQ.js";import"./m_resize_observer-BKHPyj29.js";import"./themes-Ce9PQQKT.js";/* empty css              */import"./createSimpleFunctional-Dz-Ql0QD.js";import"./VAvatar-BHWqmz1z.js";import"./VImg-D4hgsP19.js";import"./index-B4A6uSHN.js";const Pe={key:0,class:"loading-overlay"},$e={class:"summary-kpis px-4"},je={class:"kpi"},Ie={class:"kpi"},Ye={class:"kpi border-e pe-2"},Ge={class:"dash-actions mt-3"},He=["disabled"],Ke={key:0},Ue={key:1},Xe={key:0,class:"last-updated"},Ze={key:1,class:"warn",title:"API geçici boş yanıt verdi; önceki veriler gösteriliyor"},Je={key:2,class:"warn"},Qe={key:3,class:"hint"},et={class:"weekly-vertical ma-0 ms-2"},tt={class:"weekly-vertical ma-0 ms-2"},E=1e4,at=Re({__name:"dash-bukum",setup(lt){const te=n(["Üretimde süreklilik için proaktif bakım planı devrede","Operatör güvenliği: Koruyucu ekipman kontrolü yapılmalı","Enerji verimliliği izleniyor – gereksiz duruşları azaltın","Kalite ilk seferde doğru üretimle başlar","Anlık OEE analizi ile darboğazları tespit edin"]);f(()=>[...te.value,...te.value]);const k=n(0),be=n(!1);let A=null;const ke=[60,100,140,200],ge=n(2),we=f(()=>ke[ge.value]||140),_e=n(null),q=n(0),p=n(0);let M=0;f(()=>({transform:`translateX(${k.value}px)`,inlineSize:q.value+"px"}));function B(){const t=_e.value;if(!t)return;const e=t.querySelectorAll(".ticker-item");if(!e.length)return;const i=Math.floor(e.length/2);let l=0;for(let d=0;d<i;d++){const o=e[d];l+=o.offsetWidth,d<i-1&&(l+=42)}p.value=l,q.value=l*2,k.value<-p.value&&(k.value=(k.value%p.value+p.value)%p.value*-1)}function ae(t){M||(M=t);const e=(t-M)/1e3;M=t,!be.value&&q.value&&(k.value-=we.value*e,p.value&&k.value<=-p.value&&(k.value+=p.value)),A=requestAnimationFrame(ae)}ue(()=>{requestAnimationFrame(()=>{B(),A=requestAnimationFrame(ae)}),window.addEventListener("resize",B),D=new ResizeObserver(()=>ie()),g.value&&D.observe(g.value),requestAnimationFrame(()=>ie())}),R(()=>{A&&cancelAnimationFrame(A)}),R(()=>{window.removeEventListener("resize",B)}),R(()=>{if(D){try{g.value&&D.unobserve(g.value)}catch{}D.disconnect(),D=null}});const F=n([]),c=n({availability:0,performance:0,quality:1,oee:0}),le=n([]),P=n([]),oe=n([]),_=n(!0),$=n(!1),z=n(!1),N=n(null),j=n(!1),I=n(!1),Y=n(0),x=n(E),xe=n(null),De=f(()=>_.value&&!N.value),V=t=>isFinite(t)?`%${Math.round(t*100)}`:"-",Te=t=>{const e=t*100;return e<50?"oee-red":e<70?"oee-yellow":e<85?"oee-orange":"oee-green"};function Se(t){const e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${l}`}const G=f(()=>{const t=[],e=new Date,l=(e.getDay()+6)%7,d=new Date(e);d.setHours(0,0,0,0),d.setDate(e.getDate()-l);const o=["Paz","Pzt","Sal","Çar","Per","Cum","Cmt"];for(let X=0;X<7;X++){const Z=new Date(d);Z.setDate(d.getDate()+X);const Ve=Se(Z),Le=o[Z.getDay()]||"";t.push({date:Ve,label:Le,work:0,stop:0})}return t}),H=f(()=>{const t=new Map;for(const e of G.value)t.set(e.date,{...e});for(const e of P.value){const i=String(e.date);if(!t.has(i))continue;const l=t.get(i);t.set(i,{date:i,label:l.label,work:Number(e.work||0),stop:Number(e.stop||0)})}return G.value.map(e=>t.get(e.date)||e)});f(()=>[{name:"Çalışma",data:H.value.map(t=>t.work)},{name:"Duruş",data:H.value.map(t=>t.stop)}]),f(()=>({chart:{stacked:!0,toolbar:{show:!1},width:"100%"},plotOptions:{bar:{horizontal:!1,columnWidth:"70%",borderRadius:4}},dataLabels:{enabled:!1},grid:{strokeDashArray:3,borderColor:"rgba(255,255,255,0.08)"},xaxis:{categories:G.value.map(t=>t.label)},yaxis:{labels:{formatter:t=>`${Math.round(t)}`},title:{text:"dk"}},tooltip:{shared:!0,intersect:!1},colors:["#189c49","#efb803"]}));const Ce=f(()=>H.value.map(t=>({label:t.label,work:t.work,stop:t.stop})));function se(t){return{text:(Array.isArray(t.points)?t.points:[t]).map(l=>`${l.seriesName}: ${Math.round(l.value)}`).join(`
`)}}const g=n(null),K=n(void 0);let D=null;function ie(){const t=g.value;if(!t)return;const e=Math.max(0,Math.floor(t.clientWidth));K.value=e||void 0}let w=null;const T=n(null);async function Ee(t){var e;try{F.value.length===0?_.value=!0:z.value=!0,w&&(clearTimeout(w),w=null),w=window.setTimeout(()=>{$.value=!0},2500),T.value=null;const{data:l}=await Oe.get("/api/dash-bukum/overview",{signal:t,timeout:1e4}),d=((l==null?void 0:l.machines)||[]).map(o=>({id:Number(o.id),name:String(o.name??""),operator:o.operator||void 0,breakDescription:o.break_description??o.breakDescription??o.break_desc??void 0,statuTime:o.statu_time??o.statuTime??void 0,itemCode:o.itemCode??o.item_code??void 0,itemName:o.itemName??o.item_name??void 0,counter:o.counter!==void 0&&o.counter!==null?Number(o.counter):void 0,status:o.status??"stopped",availability:Number(o.availability)||0,performance:Number(o.performance)||0,quality:Number(o.quality)||1,oee:Number(o.oee)||0,workRatio:Number(o.workRatio)||0,stopRatio:Number(o.stopRatio)||0,code:o.code||"",segments:Array.isArray(o.segments)?o.segments:Array.isArray(o.barData)?o.barData:Array.isArray(o.timeline)?o.timeline:void 0}));xe.value=(l==null?void 0:l.meta)||null,d.length===0?F.value.length===0?j.value=!0:I.value=!0:(F.value=d,j.value=!1,I.value=!1),c.value=(l==null?void 0:l.daySummary)||c.value,le.value=(l==null?void 0:l.reasons)||le.value,P.value=(l==null?void 0:l.weekly)||P.value,oe.value=((l==null?void 0:l.weeklyCounts)||(l==null?void 0:l.weekly_counts)||[]).map(o=>({date:String(o.date),label:String(o.label??""),count:Number(o.count??0)})),N.value=new Date,Y.value=0,x.value=E}catch(i){Y.value+=1,x.value=Math.min(E*Math.pow(2,Y.value),6e4);const l=(e=i==null?void 0:i.response)==null?void 0:e.status;l===401?T.value="Yetki hatası (401).":l===404?T.value="Endpoint bulunamadı (404).":l===500?T.value="Sunucu hatası (500).":(i==null?void 0:i.code)==="ECONNABORTED"?T.value="Zaman aşımı.":(i==null?void 0:i.name)==="CanceledError"||(i==null?void 0:i.message)==="canceled"||(T.value="Beklenmeyen hata.")}finally{_.value=!1,z.value=!1,w&&(clearTimeout(w),w=null),$.value&&setTimeout(()=>{$.value=!1},400)}}const Ae=E;let m=null,L=!1,y=null;function C(t=x.value){m&&clearTimeout(m),m=window.setTimeout(ne,t)}async function ne(){if(document.hidden){C(Math.max(3e4,x.value));return}if(L){C(500);return}L=!0,y&&y.abort(),y=new AbortController;try{await Ee(y.signal)}finally{L=!1,C(Ae)}}function re(){document.hidden?(y&&y.abort(),m&&(clearTimeout(m),m=null)):C(0)}function Me(){L||(m&&(clearTimeout(m),m=null),C(0))}function ze(t){return t?t.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}const Ne=n(Date.now());let U=null;return ue(async()=>{document.addEventListener("visibilitychange",re),await ne(),U=window.setInterval(()=>{Ne.value=Date.now()},1e3)}),R(()=>{document.removeEventListener("visibilitychange",re),y&&y.abort(),m&&clearTimeout(m),U&&clearInterval(U)}),(t,e)=>(b(),h(We,null,[De.value?(b(),h("div",Pe,e[0]||(e[0]=[s("div",{class:"loader-box"},[s("div",{class:"spinner","aria-hidden":"true"}),s("h2",null,"Veriler yükleniyor"),s("p",null,"Makine durumları, OEE ve haftalık istatistikler getiriliyor. Lütfen bekleyin…")],-1)]))):W("",!0),a(Fe,{class:"match-height"},{default:r(()=>[a(v,{cols:"12",md:"4"},{default:r(()=>[a(Q,{height:"260"},{default:r(()=>[a(ee,null,{default:r(()=>e[1]||(e[1]=[s("h5",{class:"text-h5"},"Günlük Genel Değerlendirme",-1)])),_:1,__:[1]}),s("div",$e,[s("div",je,[e[2]||(e[2]=s("span",null,"Çlş.",-1)),s("strong",null,S(V(c.value.availability)),1),a(O,{"model-value":c.value.availability*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",Ie,[e[3]||(e[3]=s("span",null,"Perf.",-1)),s("strong",null,S(V(c.value.performance)),1),a(O,{"model-value":c.value.performance*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",Ye,[e[4]||(e[4]=s("span",null,"Kalite",-1)),s("strong",null,S(V(c.value.quality)),1),a(O,{"model-value":c.value.quality*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",{class:qe(["kpi oee",Te(c.value.oee)])},[e[5]||(e[5]=s("span",null,"OEE",-1)),s("strong",null,S(V(c.value.oee)),1),a(O,{"model-value":c.value.oee*100,color:"success",height:"10"},null,8,["model-value"])],2)]),s("div",Ge,[s("button",{class:"refresh-btn",onClick:Me,disabled:z.value||_.value},[z.value?(b(),h("span",Ke,"⟳ Yenileniyor...")):(b(),h("span",Ue,"⟳ Yenile"))],8,He),N.value?(b(),h("small",Xe,"Güncellendi: "+S(ze(N.value)),1)):W("",!0),I.value?(b(),h("small",Ze,"Geçici boş yanıt")):j.value&&!_.value?(b(),h("small",Je,"Veri yok")):W("",!0),x.value>E&&!_.value?(b(),h("small",Qe,"Bekleme: "+S(Math.round(x.value/1e3))+"sn",1)):W("",!0)])]),_:1})]),_:1}),a(v,{cols:"12",md:"4",sm:"6"},{default:r(()=>[a(Q,{height:"260"},{default:r(()=>[a(ee,{class:"pa-5"},{default:r(()=>e[6]||(e[6]=[s("h5",{class:"text-h5"},"Haftalık Çalışma / Duruş (dk)",-1)])),_:1,__:[6]}),s("div",et,[s("div",{class:"dx-weekly-wrap",ref_key:"dxWrapEl",ref:g},[a(u(de),{"data-source":Ce.value,size:{height:180,width:K.value||void 0}},{default:r(()=>[a(u(ce),{right:16,left:8,top:8,bottom:0}),a(u(me),{"argument-field":"label",type:"stackedBar"}),a(u(J),{"value-field":"work",name:"Çalışma",color:"#189c49"}),a(u(J),{"value-field":"stop",name:"Duruş",color:"#efb803"}),a(u(ve),{"discrete-axis-division-mode":"betweenLabels"}),a(u(fe),null,{default:r(()=>[a(u(pe),{visible:!0})]),_:1}),a(u(ye),{enabled:!0,shared:!0,"customize-tooltip":se}),a(u(he),{position:"bottom","horizontal-alignment":"center",visible:!1})]),_:1},8,["data-source","size"])],512)])]),_:1})]),_:1}),a(v,{cols:"12",md:"4",sm:"6"},{default:r(()=>[a(Q,{height:"260"},{default:r(()=>[a(ee,{class:"pa-5"},{default:r(()=>e[7]||(e[7]=[s("h5",{class:"text-h5"},"Haftalık Sayaç (adet)",-1)])),_:1,__:[7]}),s("div",tt,[s("div",{class:"dx-weekly-wrap",ref_key:"dxWrapEl",ref:g},[a(u(de),{"data-source":oe.value,size:{height:180,width:K.value||void 0}},{default:r(()=>[a(u(ce),{right:16,left:8,top:8,bottom:0}),a(u(me),{"argument-field":"label",type:"bar"}),a(u(J),{"value-field":"count",name:"Sayaç",color:"rgba(115, 103, 240, 0.8)"}),a(u(ve),{"discrete-axis-division-mode":"betweenLabels"}),a(u(fe),null,{default:r(()=>[a(u(pe),{visible:!0})]),_:1}),a(u(ye),{enabled:!0,shared:!0,"customize-tooltip":se}),a(u(he),{position:"bottom","horizontal-alignment":"center",visible:!1})]),_:1},8,["data-source","size"])],512)])]),_:1})]),_:1}),a(v,{cols:"12",md:"6"},{default:r(()=>e[8]||(e[8]=[s("h1",null,"Earning Reports Weekly Overview",-1)])),_:1,__:[8]}),a(v,{cols:"12",md:"6"},{default:r(()=>e[9]||(e[9]=[s("h1",null,"Support Tracker",-1)])),_:1,__:[9]}),a(v,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[10]||(e[10]=[s("h1",null,"Sales by Countries",-1)])),_:1,__:[10]}),a(v,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[11]||(e[11]=[s("h1",null,"Total Earning",-1)])),_:1,__:[11]}),a(v,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[12]||(e[12]=[s("h1",null,"Monthly Campaign State",-1)])),_:1,__:[12]}),a(v,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[13]||(e[13]=[s("h1",null,"Source Visits",-1)])),_:1,__:[13]}),a(v,{cols:"12",lg:"8"},{default:r(()=>e[14]||(e[14]=[s("h1",null,"pjjjpjpjpo",-1)])),_:1,__:[14]})]),_:1})],64))}}),wt=Be(at,[["__scopeId","data-v-8c9849e1"]]);export{wt as default};
