import{d as M,r as d,aH as N,v as C,b1 as U,c as Y,b as n,f as m,aB as o,e as l,L as h,cT as A,av as B,k as x,o as F,l as j}from"./main-DG2COk99.js";import{u as J}from"./pageTitle-aDP9veXP.js";import{V as Q,a as X,d as Z}from"./VCard-Q9HEIHlx.js";import{V as ee}from"./VCardText-CFGOaZUI.js";import{V as ae}from"./VSelect-DHBtjvgK.js";import{V as te}from"./VTextField-DJshNw_H.js";import{V as O}from"./VDivider-N10VLxZw.js";import{V as le}from"./VChip-CATV_F1S.js";import"./VAvatar-BGvYJZ-O.js";import"./VImg-DcNf1myo.js";import"./form-Ct1W7Trc.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-DZd-QbBw.js";import"./ssrBoot-CILVRgqf.js";import"./dialog-transition-BX_aMg7Q.js";import"./easing-Bybner-F.js";import"./VMenu-DWE3GCwL.js";import"./VOverlay-C4Ua6FUB.js";import"./delay-rYjYUmCc.js";import"./lazy-CJ7bwycN.js";import"./scopeId-BSJ-dWYb.js";import"./VCheckboxBtn-B-ngirMB.js";import"./VSelectionControl-Dd6NBoHl.js";import"./focus-CSQ9xd9N.js";/* empty css                   */import"./VCounter-CziJUmF_.js";import"./VField-zIHGM_xx.js";import"./VInput-D5lfXicO.js";import"./VSlideGroup-B6rP7OyL.js";const se={class:"pa-4"},ne={class:"d-flex flex-wrap gap-4 align-center"},re={class:"d-flex align-center gap-6 my-4"},ie={class:"mt-4 d-flex flex-column gap-2"},oe=M({__name:"seri-port",setup(ue){J().setTitle("Seri Port (CH340)");const c=d(""),p=d(""),W=[9600,19200,38400,57600,115200],k=d(9600),S=d(!1),f=d(!1),u=N({switchOn:!1,machineRun:!1,pulse:!1}),_=d(0),P=d(!1),g=d(""),z=C(()=>u.switchOn?"status-green":"status-gray"),G=C(()=>u.machineRun?"status-green":"status-gray"),H=C(()=>u.pulse?"status-blue":"status-gray");let t=null,r=null,T=null,y=null;const R=new TextEncoder,$=new TextDecoder;function D(){return typeof navigator<"u"&&"serial"in navigator}async function K(){if(!D()){c.value+=`
Tarayıcı Web Serial desteklemiyor. Lütfen Chrome/Edge kullanın ve HTTPS üzerinden bağlanın.`;return}try{S.value=!0,t=await navigator.serial.requestPort({filters:[]}),await t.open({baudRate:k.value});const e=new TransformStream({transform(i,b){b.enqueue(R.encode(i))}}),s=t.writable;if(!s)throw new Error("Yazma akışı yok");T=e.writable.getWriter(),e.readable.pipeTo(s).catch(()=>{});const w=new TransformStream({transform(i,b){b.enqueue($.decode(i,{stream:!0}))}}),v=t.readable;if(!v)throw new Error("Okuma akışı yok");y=new AbortController,r=v.pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform(i,b){b.enqueue(String(i))}})).getReader({signal:y.signal}),f.value=!0,c.value+=`
Bağlandı: ${String(t)}`,q().catch(i=>{c.value+=`
Okuma hatası: ${(i==null?void 0:i.message)||i}`,V()})}catch(a){c.value+=`
Bağlanılamadı: ${(a==null?void 0:a.message)||a}`}finally{S.value=!1}}async function q(){for(;f.value&&r;){const{value:a,done:e}=await r.read();if(e)break;a&&L(String(a))}}async function E(){try{if(!f.value||!T)return;const a=p.value.endsWith(`
`)?p.value:`${p.value}
`,e=R.encode(a),s=t==null?void 0:t.writable;if(!s)return;const w=s.getWriter();await w.write(e),w.releaseLock(),p.value=""}catch(a){c.value+=`
Gönderme hatası: ${(a==null?void 0:a.message)||a}`}}async function V(){var a;try{f.value=!1,y==null||y.abort(),await(r==null?void 0:r.cancel().catch(()=>{})),r==null||r.releaseLock();const e=await((a=t==null?void 0:t.getSignals)==null?void 0:a.call(t));await(t==null?void 0:t.close()),c.value+=`
Bağlantı kesildi.`}catch(e){c.value+=`
Kapatma hatası: ${(e==null?void 0:e.message)||e}`}finally{r=null,T=null,t=null}}U(()=>{f.value&&V()});function L(a){for(g.value+=a;;){const e=g.value.indexOf("#");if(e===-1)break;const s=g.value.slice(0,e);g.value=g.value.slice(e+1),I(s)}}function I(a){const e=a.trim().split("|");if(e.length<8)return;const s=e[0].trim()==="1",w=e[1].trim()==="1",v=e[6].trim()==="1";u.switchOn=s,u.machineRun=w,v&&!P.value&&(_.value+=1),u.pulse=v,P.value=v}return(a,e)=>(F(),Y("div",se,[n(Q,null,{default:m(()=>[n(X,null,{default:m(()=>e[2]||(e[2]=[o("Seri Port (Web Serial) - CH340/Arduino")])),_:1,__:[2]}),n(Z,null,{default:m(()=>e[3]||(e[3]=[o(" - Chrome/Edge (HTTPS veya localhost) gerektirir. - Windows’ta CH340 sürücüsü yüklü olmalıdır. ")])),_:1,__:[3]}),n(ee,null,{default:m(()=>[l("div",ne,[n(h,{color:"primary",onClick:K,disabled:S.value},{default:m(()=>e[4]||(e[4]=[o("Cihaza Bağlan")])),_:1,__:[4]},8,["disabled"]),n(ae,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),items:W,label:"Baud Rate",style:{"max-inline-size":"200px"}},null,8,["modelValue"]),n(te,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),label:"Gönder",style:{"max-inline-size":"300px"},onKeyup:A(E,["enter"])},null,8,["modelValue"]),n(h,{color:"secondary",onClick:E,disabled:!f.value},{default:m(()=>e[5]||(e[5]=[o("Gönder")])),_:1,__:[5]},8,["disabled"]),n(h,{color:"error",onClick:V,disabled:!f.value},{default:m(()=>e[6]||(e[6]=[o("Bağlantıyı Kes")])),_:1,__:[6]},8,["disabled"])]),n(O,{class:"my-4"}),l("div",re,[l("div",{class:B(["status-box",z.value]),title:"Şalter (0 → gri, 1 → yeşil)"},null,2),l("div",{class:B(["status-box",G.value]),title:"Makine (0 → gri, 1 → yeşil)"},null,2),l("div",{class:B(["status-box",H.value]),title:"Sayaç Tetik (0 → gri, 1 → mavi)"},null,2)]),l("div",ie,[l("div",null,[e[7]||(e[7]=o("Şalter: ")),l("strong",null,x(u.switchOn?"Açık (Yeşil)":"Kapalı (Gri)"),1)]),l("div",null,[e[8]||(e[8]=o("Makine: ")),l("strong",null,x(u.machineRun?"Çalışıyor (Yeşil)":"Bekliyor (Gri)"),1)]),l("div",null,[e[9]||(e[9]=o("Tetik: ")),l("strong",null,x(u.pulse?"1 (Mavi)":"0 (Gri)"),1)]),n(O,{class:"my-2"}),l("div",null,[e[10]||(e[10]=o("Sayaç: ")),n(le,{color:"primary",variant:"flat"},{default:m(()=>[o(x(_.value),1)]),_:1})]),e[11]||(e[11]=l("div",{class:"text-medium-emphasis text-caption"},'Çerçeve formatı: 0|1|0# (\\"#\\" ile biter)',-1))])]),_:1})]),_:1})]))}}),Le=j(oe,[["__scopeId","data-v-53a1e0d1"]]);export{Le as default};
