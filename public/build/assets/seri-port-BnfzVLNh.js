import{d as M,r as d,a$ as N,X as C,bi as U,c as Y,b as n,f as m,t as o,e as l,af as h,d4 as A,x as B,v as x,o as F,_ as X}from"./main-PIO7dkvE.js";import{u as j}from"./pageTitle-BvSfb5Xm.js";import{V as J,a as Q,d as Z}from"./VCard-Dd-LZgmu.js";import{V as ee}from"./VCardText-XQayp_gG.js";import{V as ae}from"./VSelect-C5byv37D.js";import{V as te}from"./VTextField-wgidcyfN.js";import{V as O}from"./VDivider-B0NzdLDu.js";import{V as le}from"./VChip-CiQrzYhT.js";import"./VAvatar-DefvcMrz.js";import"./VImg-DRuoOn4X.js";import"./form-Hec9IYfH.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-CNAVxJVz.js";import"./ssrBoot-9Ss2u4GO.js";import"./dialog-transition-CjbHA-wx.js";import"./easing-Bybner-F.js";import"./VMenu-BOqjKPkX.js";import"./VOverlay-BzTMFyk6.js";import"./delay-DKTpx_xn.js";import"./lazy-D3_Pitd8.js";import"./scopeId-CsXtvMjk.js";import"./VCheckboxBtn-SBDcvQHy.js";import"./VSelectionControl-DSIZs85O.js";import"./focus--AY2Vyh7.js";/* empty css                   */import"./VCounter-BVktfWCx.js";import"./VField-Dk2Amc53.js";import"./VInput-X0HQAo38.js";import"./VSlideGroup-Drv1S0ve.js";const se={class:"pa-4"},ne={class:"d-flex flex-wrap gap-4 align-center"},ie={class:"d-flex align-center gap-6 my-4"},re={class:"mt-4 d-flex flex-column gap-2"},oe=M({__name:"seri-port",setup(ue){j().setTitle("Seri Port (CH340)");const c=d(""),p=d(""),W=[9600,19200,38400,57600,115200],k=d(9600),S=d(!1),f=d(!1),u=N({switchOn:!1,machineRun:!1,pulse:!1}),_=d(0),P=d(!1),g=d(""),$=C(()=>u.switchOn?"status-green":"status-gray"),z=C(()=>u.machineRun?"status-green":"status-gray"),G=C(()=>u.pulse?"status-blue":"status-gray");let t=null,i=null,T=null,y=null;const R=new TextEncoder,D=new TextDecoder;function H(){return typeof navigator<"u"&&"serial"in navigator}async function K(){if(!H()){c.value+=`
Tarayıcı Web Serial desteklemiyor. Lütfen Chrome/Edge kullanın ve HTTPS üzerinden bağlanın.`;return}try{S.value=!0,t=await navigator.serial.requestPort({filters:[]}),await t.open({baudRate:k.value});const e=new TransformStream({transform(r,b){b.enqueue(R.encode(r))}}),s=t.writable;if(!s)throw new Error("Yazma akışı yok");T=e.writable.getWriter(),e.readable.pipeTo(s).catch(()=>{});const w=new TransformStream({transform(r,b){b.enqueue(D.decode(r,{stream:!0}))}}),v=t.readable;if(!v)throw new Error("Okuma akışı yok");y=new AbortController,i=v.pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform(r,b){b.enqueue(String(r))}})).getReader({signal:y.signal}),f.value=!0,c.value+=`
Bağlandı: ${String(t)}`,q().catch(r=>{c.value+=`
Okuma hatası: ${(r==null?void 0:r.message)||r}`,V()})}catch(a){c.value+=`
Bağlanılamadı: ${(a==null?void 0:a.message)||a}`}finally{S.value=!1}}async function q(){for(;f.value&&i;){const{value:a,done:e}=await i.read();if(e)break;a&&I(String(a))}}async function E(){try{if(!f.value||!T)return;const a=p.value.endsWith(`
`)?p.value:`${p.value}
`,e=R.encode(a),s=t==null?void 0:t.writable;if(!s)return;const w=s.getWriter();await w.write(e),w.releaseLock(),p.value=""}catch(a){c.value+=`
Gönderme hatası: ${(a==null?void 0:a.message)||a}`}}async function V(){var a;try{f.value=!1,y==null||y.abort(),await(i==null?void 0:i.cancel().catch(()=>{})),i==null||i.releaseLock();const e=await((a=t==null?void 0:t.getSignals)==null?void 0:a.call(t));await(t==null?void 0:t.close()),c.value+=`
Bağlantı kesildi.`}catch(e){c.value+=`
Kapatma hatası: ${(e==null?void 0:e.message)||e}`}finally{i=null,T=null,t=null}}U(()=>{f.value&&V()});function I(a){for(g.value+=a;;){const e=g.value.indexOf("#");if(e===-1)break;const s=g.value.slice(0,e);g.value=g.value.slice(e+1),L(s)}}function L(a){const e=a.trim().split("|");if(e.length<8)return;const s=e[0].trim()==="1",w=e[1].trim()==="1",v=e[6].trim()==="1";u.switchOn=s,u.machineRun=w,v&&!P.value&&(_.value+=1),u.pulse=v,P.value=v}return(a,e)=>(F(),Y("div",se,[n(J,null,{default:m(()=>[n(Q,null,{default:m(()=>e[2]||(e[2]=[o("Seri Port (Web Serial) - CH340/Arduino")])),_:1,__:[2]}),n(Z,null,{default:m(()=>e[3]||(e[3]=[o(" - Chrome/Edge (HTTPS veya localhost) gerektirir. - Windows’ta CH340 sürücüsü yüklü olmalıdır. ")])),_:1,__:[3]}),n(ee,null,{default:m(()=>[l("div",ne,[n(h,{color:"primary",onClick:K,disabled:S.value},{default:m(()=>e[4]||(e[4]=[o("Cihaza Bağlan")])),_:1,__:[4]},8,["disabled"]),n(ae,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),items:W,label:"Baud Rate",style:{"max-inline-size":"200px"}},null,8,["modelValue"]),n(te,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),label:"Gönder",style:{"max-inline-size":"300px"},onKeyup:A(E,["enter"])},null,8,["modelValue"]),n(h,{color:"secondary",onClick:E,disabled:!f.value},{default:m(()=>e[5]||(e[5]=[o("Gönder")])),_:1,__:[5]},8,["disabled"]),n(h,{color:"error",onClick:V,disabled:!f.value},{default:m(()=>e[6]||(e[6]=[o("Bağlantıyı Kes")])),_:1,__:[6]},8,["disabled"])]),n(O,{class:"my-4"}),l("div",ie,[l("div",{class:B(["status-box",$.value]),title:"Şalter (0 → gri, 1 → yeşil)"},null,2),l("div",{class:B(["status-box",z.value]),title:"Makine (0 → gri, 1 → yeşil)"},null,2),l("div",{class:B(["status-box",G.value]),title:"Sayaç Tetik (0 → gri, 1 → mavi)"},null,2)]),l("div",re,[l("div",null,[e[7]||(e[7]=o("Şalter: ")),l("strong",null,x(u.switchOn?"Açık (Yeşil)":"Kapalı (Gri)"),1)]),l("div",null,[e[8]||(e[8]=o("Makine: ")),l("strong",null,x(u.machineRun?"Çalışıyor (Yeşil)":"Bekliyor (Gri)"),1)]),l("div",null,[e[9]||(e[9]=o("Tetik: ")),l("strong",null,x(u.pulse?"1 (Mavi)":"0 (Gri)"),1)]),n(O,{class:"my-2"}),l("div",null,[e[10]||(e[10]=o("Sayaç: ")),n(le,{color:"primary",variant:"flat"},{default:m(()=>[o(x(_.value),1)]),_:1})]),e[11]||(e[11]=l("div",{class:"text-medium-emphasis text-caption"},'Çerçeve formatı: 0|1|0# (\\"#\\" ile biter)',-1))])]),_:1})]),_:1})]))}}),Ie=X(oe,[["__scopeId","data-v-53a1e0d1"]]);export{Ie as default};
