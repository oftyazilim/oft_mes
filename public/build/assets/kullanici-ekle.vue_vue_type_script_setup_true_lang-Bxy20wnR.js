import{r as _,e as ee}from"./validators-BwBNGiur.js";import{d as ae,q as le,r as d,aL as re,w as N,i as se,s as z,g as ie,f as u,b as t,e as te,p as E,aM as ne,l as y,aF as T,T as C,aK as h,o as oe}from"./main-Dda-fDvo.js";import{_ as ue}from"./AppTextField.vue_vue_type_script_setup_true_lang-B3bRrojW.js";import{_ as de}from"./AppSelect.vue_vue_type_script_setup_true_lang-CFJRkC5q.js";import{V as me}from"./VDialog-DHcbDZyz.js";import{c as pe,a as fe,V as K}from"./VCard-RYBfV1Ap.js";import{V as ve}from"./VDivider-CObc4qPN.js";import{V as ce}from"./VCardText-BRuZaizK.js";import{V as Ve}from"./VForm-D-XI-V9e.js";import{V as ye}from"./VRow-BHNh141H.js";import{V as c}from"./VCol-B4SanIbp.js";const _e={class:"text-h4 mb-2"},De=ae({__name:"kullanici-ekle",props:{isDrawerOpen:{type:Boolean},userData:{default:()=>({id:0,name:"",email:"",roles:"",proses:"",tip:"",unvan:"",ismerkezi:"",istasyon:"",firma_id:0,firma_adi:""})}},emits:["update:isDrawerOpen","submit"],setup(q,{emit:I}){const M=I;le("userData");const D=d([]);d(!1);const A=d(),F=d(""),L=d(null),B=d(null);d([]);const b=d([]),P=d(null),J=d(null),Y=d(null),V=d([]),O=d(0),p=d(null),f=d([]),S=d([]),k=d([]);d(""),d("false");const v=q,j=d([{name:"AR-GE"},{name:"BAKIM"},{name:"BOYAHANE"},{name:"CAM YAPIŞTIRMA"},{name:"DEPO"},{name:"DUVAR TİPİ MONTAJ"},{name:"DİKİLİ TİP MONTAJ"},{name:"FAN-PDU MONTAJ"},{name:"FİNANS"},{name:"FO-CU MEKANİK MONTAJ"},{name:"GENEL"},{name:"IP PDU MONTAJ"},{name:"İNSAN KAYNAKLARI"},{name:"KALİTE"},{name:"MEKANİK"},{name:"MONTAJ"},{name:"MUHASEBE"},{name:"OUTDOOR ÜRÜN MONTAJ"},{name:"OUTDOOR ÖZEL ÜRÜN MONTAJ"},{name:"PAKETLEME"},{name:"PASİF AKSESUAR MONTAJ"},{name:"PLANLAMA"},{name:"SERİGRAFİ"},{name:"SEVKİYAT"},{name:"SATINALMA"},{name:"SATIŞ"}]),g=async()=>{var e,a;if(p.value===null||p.value===""){k.value=[{istasyon_id:"",ist_adi:"Seçim yok"}];return}try{const{data:r}=await z.get("/api/istasyonal",{params:{ismerkezi:String(p.value??"")}}),s=r,n=(s==null?void 0:s.istasyonlar)??((e=s==null?void 0:s.data)==null?void 0:e.istasyonlar)??s,w=Array.isArray(n)?n:[];if(k.value=w.map(o=>{const i=(o==null?void 0:o.istasyon_id)??(o==null?void 0:o.id)??o,m=typeof i=="number"?i:Number(i);return{istasyon_id:Number.isFinite(m)?m:typeof i=="string"?i:0,ist_adi:(o==null?void 0:o.ist_adi)??(o==null?void 0:o.name)??String(i??"")}}).filter(o=>o.istasyon_id!==0||typeof o.istasyon_id=="string"&&o.istasyon_id!==""),k.value.unshift({istasyon_id:"",ist_adi:"Seçim yok"}),(a=v.userData)!=null&&a.id&&v.userData.istasyon){const o=v.userData.istasyon.split(",").map(m=>Number(m.trim())),i=k.value.map(m=>m.istasyon_id);f.value=o.filter(m=>i.includes(m))}}catch(r){console.error("İstasyonlar alınırken hata oluştu:",r)}},H=async()=>{var e,a;try{const{data:r}=await z.get("/api/merkezal",{params:{coID:O.value||null}}),s=r,n=(s==null?void 0:s.merkezler)??((e=s==null?void 0:s.data)==null?void 0:e.merkezler)??s,o=(Array.isArray(n)?n:[]).map(i=>{const m=(i==null?void 0:i.is_merkezi_id)??(i==null?void 0:i.id)??i,R=typeof m=="number"?m:Number(m);return{is_merkezi_id:Number.isFinite(R)?R:typeof m=="string"?m:0,mrk_adi:(i==null?void 0:i.mrk_adi)??(i==null?void 0:i.name)??String(m??"")}}).filter(i=>i.is_merkezi_id!==0||typeof i.is_merkezi_id=="string"&&i.is_merkezi_id!=="");if(S.value=[{is_merkezi_id:"",mrk_adi:"Seçim yok"},...o],(a=v.userData)!=null&&a.id){const i=(v.userData.ismerkezi||"").split(",").map(m=>m.trim()).filter(Boolean)[0];p.value=i?isNaN(Number(i))?i:Number(i):null,g()}}catch(r){console.error("Veri çekilirken hata oluştu: ",r)}},l=re({...v.userData});N(()=>v.userData,e=>{Object.assign(l,e)}),N(()=>v.userData,e=>{if(e&&e.id>0){F.value=e.name||"",L.value=e.email||"",V.value=e.roles!=""?e.roles.split(",").map(a=>a.trim()):[],P.value=e.proses||"",Y.value=e.tip||"",B.value=e.unvan||"",O.value=e.firma_id||0,J.value=e.firma_adi||"";{const a=(e.ismerkezi||"").split(",").map(r=>r.trim()).filter(Boolean)[0];p.value=a?isNaN(Number(a))?a:Number(a):null}f.value=e.istasyon!=""?e.istasyon.split(",").map(a=>Number(a.trim())):[]}else V.value=[],p.value=null,f.value=[],Object.assign(l,{id:0,name:"",email:"",roles:null,proses:"",tip:"",unvan:"",ismerkezi:null,istasyon:null,firma_id:0,firma_adi:""})},{immediate:!0}),se(()=>{G()}),N(p,e=>{e!==null&&e!==""?(f.value=[],b.value=null,g()):(k.value=[{istasyon_id:"",ist_adi:"Seçim yok"}],f.value=[],b.value=null)}),N(()=>l.firma_adi,e=>{if(e!==null&&e!==""){const a=e==="Canovate"?2715:e==="Coolaer"?2729:0;l.firma_id=a,O.value=a,f.value=[],b.value=null,H()}else l.firma_id=0,O.value=0,S.value=[],f.value=[],b.value=null},{immediate:!0}),N(f,e=>{Array.isArray(e)&&e.includes("")&&(f.value=[""])});const G=async()=>{try{const{data:e}=await z.get("/api/roles/available"),a=Array.isArray(e==null?void 0:e.roles)?e.roles:Array.isArray(e)?e:[];D.value=a.map(r=>typeof r=="string"?{name:r}:{name:String((r==null?void 0:r.name)??"")}).filter(r=>r.name)}catch(e){console.error("Roller alınırken hata oluştu:",e)}},$=()=>{M("update:isDrawerOpen",!1),h(()=>{var e,a;(e=A.value)==null||e.reset(),(a=A.value)==null||a.resetValidation()})},Z=()=>{var e;(e=A.value)==null||e.validate().then(({valid:a})=>{var r;a&&((r=v.userData)!=null&&r.id?W():Q(),M("update:isDrawerOpen",!1),h(()=>{var s,n;(s=A.value)==null||s.reset(),(n=A.value)==null||n.resetValidation()}))})},Q=async()=>{var e,a,r;try{const s=await z.post("/api/users",{name:l.name,email:l.email,password:"pass1234",roles:V.value,proses:l.proses,tip:l.tip,unvan:l.unvan,ismerkezi:String(p.value??""),istasyon:U(f.value),firma_id:l.firma_id,firma_adi:l.firma_adi});try{const n=((e=s==null?void 0:s.data)==null?void 0:e.id)??0;window.dispatchEvent(new CustomEvent("user-updated",{detail:{id:n,roles:V.value}}))}catch{}}catch(s){(r=(a=s==null?void 0:s.response)==null?void 0:a.data)!=null&&r.errors?console.error("Doğrulama hataları:",s.response.data.errors):console.error("Beklenmeyen hata:",s)}M("update:isDrawerOpen",!1)},W=async()=>{var e;try{const a=await z.put(`/api/users/${l.id}`,{name:l.name,email:l.email,roles:V.value,proses:l.proses,tip:l.tip,unvan:l.unvan,ismerkezi:String(p.value??""),istasyon:U(f.value),firma_id:l.firma_id,firma_adi:l.firma_adi});try{window.dispatchEvent(new CustomEvent("user-updated",{detail:{id:l.id,roles:V.value}}))}catch{}}catch(a){console.error("Kullanıcı güncellenirken hata oluştu:",((e=a==null?void 0:a.response)==null?void 0:e.data)??a)}};N(S,e=>{var a;if((a=v.userData)!=null&&a.id&&(p.value===null||p.value==="")){const r=(v.userData.ismerkezi||"").split(",").map(s=>s.trim()).filter(Boolean)[0];p.value=r?isNaN(Number(r))?r:Number(r):null}});const X=e=>{M("update:isDrawerOpen",e)},x=e=>{p.value=e,f.value=[],b.value=null,g()},U=e=>Array.isArray(e)?e.filter(a=>a!==null&&a!=="").join(","):e==null?"":e instanceof Set?Array.from(e).join(","):typeof e=="object"&&Array.isArray(e.value)?e.value.join(","):String(e);return(e,a)=>{const r=de,s=ue;return oe(),ie(me,{temporary:"",width:800,location:"end",class:"scrollable-content","model-value":v.isDrawerOpen,"onUpdate:modelValue":X},{default:u(()=>[t(K,{class:"pa-2 pa-sm-10"},{default:u(()=>[t(pe,{class:"text-center"},{default:u(()=>[t(fe,null,{default:u(()=>[te("h4",_e,E(v.userData.id>0?"Kullanıcı Düzenle":"Yeni Kullanıcı Ekle"),1)]),_:1})]),_:1}),t(ve),t(K,{flat:""},{default:u(()=>[t(ce,null,{default:u(()=>[t(Ve,{ref_key:"refForm",ref:A,"lazy-validation":"",onSubmit:ne(Z,["prevent"])},{default:u(()=>[t(ye,null,{default:u(()=>[t(c,{cols:"6"},{default:u(()=>[t(r,{modelValue:l.firma_adi,"onUpdate:modelValue":a[0]||(a[0]=n=>l.firma_adi=n),rules:["requiredValidator"in e?e.requiredValidator:y(_)],label:"Firma Adı",items:["Canovate","Coolaer"],"item-title":"firma"},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(s,{modelValue:l.firma_id,"onUpdate:modelValue":a[1]||(a[1]=n=>l.firma_id=n),label:"Firma ID",disabled:""},null,8,["modelValue"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(s,{modelValue:l.name,"onUpdate:modelValue":a[2]||(a[2]=n=>l.name=n),rules:["requiredValidator"in e?e.requiredValidator:y(_)],label:"Adı Soyadı",placeholder:"Ali VELİ"},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(s,{modelValue:l.email,"onUpdate:modelValue":a[3]||(a[3]=n=>l.email=n),rules:["requiredValidator"in e?e.requiredValidator:y(_),"emailValidator"in e?e.emailValidator:y(ee)],label:"Email",placeholder:"aliveli@email.com"},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(s,{modelValue:l.unvan,"onUpdate:modelValue":a[4]||(a[4]=n=>l.unvan=n),rules:["requiredValidator"in e?e.requiredValidator:y(_)],label:"Ünvan",placeholder:"Yönetici"},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(r,{modelValue:l.proses,"onUpdate:modelValue":a[5]||(a[5]=n=>l.proses=n),rules:["requiredValidator"in e?e.requiredValidator:y(_)],label:"Görev Yeri (Proses)",items:j.value,"item-title":"name"},null,8,["modelValue","rules","items"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(r,{modelValue:l.tip,"onUpdate:modelValue":a[6]||(a[6]=n=>l.tip=n),rules:["requiredValidator"in e?e.requiredValidator:y(_)],label:"Kademe",items:["YÖNETİM","ÜRETİM"]},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(r,{modelValue:V.value,"onUpdate:modelValue":a[7]||(a[7]=n=>V.value=n),rules:["requiredValidator"in e?e.requiredValidator:y(_)],items:D.value,"item-title":"name","item-value":"name","return-object":!1,"menu-props":{maxHeight:"400"},label:"Roller",multiple:"","persistent-hint":"",placeholder:"Rol seçiniz...",chips:"","closable-chips":""},null,8,["modelValue","rules","items"])]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(r,{modelValue:p.value,"onUpdate:modelValue":[a[8]||(a[8]=n=>p.value=n),x],items:S.value,"item-title":"mrk_adi","menu-props":{maxHeight:"400"},label:"İş Merkezleri","persistent-hint":"","item-value":"is_merkezi_id",placeholder:"İş merkezi seçiniz..."},null,8,["modelValue","items"]),T(E(p.value),1)]),_:1}),t(c,{cols:"6"},{default:u(()=>[t(r,{modelValue:f.value,"onUpdate:modelValue":a[9]||(a[9]=n=>f.value=n),items:k.value,"item-title":"ist_adi","menu-props":{maxHeight:"400"},label:"İş İstasyonları","persistent-hint":"","item-value":"istasyon_id",placeholder:"İş istasyonu seçiniz..."},null,8,["modelValue","items"]),T(E(f.value),1)]),_:1}),t(c,{cols:"12",class:"text-center mt-2"},{default:u(()=>[t(C,{type:"submit",class:"me-3"},{default:u(()=>a[10]||(a[10]=[T(" Kaydet ")])),_:1,__:[10]}),t(C,{type:"reset",variant:"tonal",color:"error",onClick:$},{default:u(()=>a[11]||(a[11]=[T(" Vazgeç ")])),_:1,__:[11]})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{De as _};
