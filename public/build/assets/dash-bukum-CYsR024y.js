import{d as j,r as p,G as J,bg as Q,c as i,e,v as o,x,l as r,F as c,i as u,b3 as X,o as l,I as n,aI as Y,t as Z}from"./main-nZPIp3zM.js";import{_ as ss}from"./_plugin-vue_export-helper-DlAUqK2U.js";const es={class:"dash-container"},ts={class:"dash-header"},as={class:"header-left"},is={class:"summary-card stretch"},ls={class:"summary-kpis"},os={class:"kpi"},ns={class:"kpi"},rs={class:"kpi"},ds={class:"header-right"},cs={class:"weekly-card"},us={class:"weekly-vertical mt-2"},vs={class:"wv-bars"},ms={class:"wv-stack"},ks=["title"],ys={key:0,class:"wv-val"},fs={key:0,class:"wv-val"},ps={class:"wv-day"},bs={class:"weekly-count-card"},ws={class:"weekly-vertical mt-2"},_s={class:"wvc-bars"},hs={class:"wvc-stack"},gs=["title"],Ss={key:0,class:"wvc-label"},Ns={class:"wvc-day"},Ms={key:0,class:"slow-hint"},Cs={class:"cards-grid"},xs={class:"card-top"},zs={class:"names"},Ds={class:"machine-name"},Ts={key:0,class:"operator-name"},As={class:"label"},Rs={key:0,class:"meta-row"},Es={class:"meta-left"},qs={key:0,class:"pill code"},Bs={key:1,class:"meta-name"},Ks={key:0,class:"meta-right"},Ls={class:"kpi-row"},Vs={class:"kpi-item"},Fs={class:"kpi-item"},Hs={class:"kpi-item"},Ps={class:"mini-bars"},$s={key:0,class:"multi-bar"},Os=["title"],Gs={key:1,class:"multi-bar",title:"Çalışma/Duruş oranı"},Is={class:"charts-grid"},Us={class:"chart-card"},Ws={key:0,class:"reason-bars mt-2"},js={class:"bar"},Js={key:1,class:"reason-bars mt-2"},Qs={class:"row-label"},Xs={class:"bar mt-2"},Ys={class:"value"},z=5e3,Zs=j({__name:"dash-bukum",setup(se){const S=p([]),b=p({availability:0,performance:0,quality:1,oee:0}),D=p([]),N=p([]),M=p([]),y=p(!0),_=p(!1),v=a=>isFinite(a)?`${Math.round(a*100)}%`:"-",T=a=>{const t=a*100;return t<50?"oee-red":t<70?"oee-yellow":t<85?"oee-orange":"oee-green"},K=a=>a==="running"?"Çalışıyor":a==="stopped"?"Duruyor":"Kapalı",L=a=>`${Math.min(100,a)}%`,V=()=>Math.max(1,...N.value.map(a=>a.work+a.stop)),A=a=>`${Math.round(a/V()*100)}%`,F=()=>Math.max(1,...M.value.map(a=>a.count)),H=a=>`${Math.round(a/F()*100)}%`;function h(a){const t=Math.max(0,Math.min(100,Number(a.workRatio)||0)),s=Math.max(0,Math.min(100,Number(a.stopRatio)||0)),d=t+s;if(d>100){const B=100/d,U=Math.round(t*B*100)/100,W=Math.round(s*B*100)/100;return{work:U,stop:W,remain:0}}const w=Math.max(0,100-d);return{work:Math.round(t*100)/100,stop:Math.round(s*100)/100,remain:Math.round(w*100)/100}}const P={calisma:"#189c49",running:"#189c49",work:"#189c49",durus:"#efb803",stopped:"#efb803",stop:"#efb803",ayar:"#a59ef7",mola:"#f4b73f",kalan:"lightgray",offline:"#9e9e9e"};function R(a){const t={running:"calisma",work:"calisma",stopped:"durus",stop:"durus",setup:"ayar",break:"mola",idle:"kalan"},s=(a||"").toLowerCase();return t[s]||s}function $(a){return a.reduce((t,s)=>t+(Number(s.duration)||0),0)||0}function O(a,t){const s=Math.max(1,$(t)),d=Math.max(0,(Number(a.duration)||0)/s*100),w=P[R(String(a.type))]||"#888";return{inlineSize:`${d}%`,backgroundColor:w,borderRadius:"999px"}}function G(a,t){const s=R(String(a.type));return s==="calisma"?t.itemName||t.itemCode||"Çalışıyor":s==="durus"?a.reason||a.sebep||a.code||"Duruyor":{calisma:"Çalışma",durus:"Duruş",ayar:"Ayar",mola:"Mola",kalan:"Kalan",offline:"Kapalı"}[s]||String(a.type)}let f=null;async function I(a){try{S.value.length===0&&(y.value=!0),f&&(clearTimeout(f),f=null),f=window.setTimeout(()=>{_.value=!0},2500);const{data:t}=await X.get("/api/dash-bukum/overview",{signal:a,timeout:4500});S.value=((t==null?void 0:t.machines)||[]).map(s=>({id:Number(s.id),name:String(s.name??""),operator:s.operator||void 0,itemCode:s.itemCode??s.item_code??void 0,itemName:s.itemName??s.item_name??void 0,counter:s.counter!==void 0&&s.counter!==null?Number(s.counter):void 0,status:s.status??"offline",availability:Number(s.availability)||0,performance:Number(s.performance)||0,quality:Number(s.quality)||1,oee:Number(s.oee)||0,workRatio:Number(s.workRatio)||0,stopRatio:Number(s.stopRatio)||0,code:s.code||"",segments:Array.isArray(s.segments)?s.segments:Array.isArray(s.barData)?s.barData:Array.isArray(s.timeline)?s.timeline:void 0})),b.value=(t==null?void 0:t.daySummary)||{availability:0,performance:0,quality:1,oee:0},D.value=(t==null?void 0:t.reasons)||[],N.value=(t==null?void 0:t.weekly)||[],M.value=((t==null?void 0:t.weeklyCounts)||(t==null?void 0:t.weekly_counts)||[]).map(s=>({date:String(s.date),label:String(s.label??""),count:Number(s.count??0)}))}catch{}finally{y.value=!1,f&&(clearTimeout(f),f=null),_.value&&setTimeout(()=>{_.value=!1},400)}}let m=null,C=!1,k=null;function g(a=z){m&&clearTimeout(m),m=window.setTimeout(E,a)}async function E(){if(document.hidden){g(z);return}if(C){g(500);return}C=!0,k&&k.abort(),k=new AbortController;try{await I(k.signal)}finally{C=!1,g(z)}}function q(){document.hidden?(k&&k.abort(),m&&(clearTimeout(m),m=null)):g(0)}return J(async()=>{document.addEventListener("visibilitychange",q),await E()}),Q(()=>{document.removeEventListener("visibilitychange",q),k&&k.abort(),m&&clearTimeout(m)}),(a,t)=>(l(),i("div",es,[e("header",ts,[e("div",as,[t[5]||(t[5]=e("div",{class:"title-block ms-4"},[e("h1",null,"Büküm Dashboard"),e("p",{class:"muted"},"Full HD ekran için optimize, mobilde akıcı.")],-1)),e("div",is,[t[4]||(t[4]=e("div",{class:"summary-title"},"Günlük Genel Değerlendirme",-1)),e("div",ls,[e("div",os,[t[0]||(t[0]=e("span",null,"Uyg.",-1)),e("strong",null,o(v(b.value.availability)),1)]),e("div",ns,[t[1]||(t[1]=e("span",null,"Perf.",-1)),e("strong",null,o(v(b.value.performance)),1)]),e("div",rs,[t[2]||(t[2]=e("span",null,"Kalite",-1)),e("strong",null,o(v(b.value.quality)),1)]),e("div",{class:x(["kpi oee",T(b.value.oee)])},[t[3]||(t[3]=e("span",null,"OEE",-1)),e("strong",null,o(v(b.value.oee)),1)],2)])])]),e("div",ds,[e("div",cs,[t[7]||(t[7]=e("h4",null,"Haftalık Çalışma / Duruş (dk)",-1)),e("div",us,[e("div",vs,[y.value?(l(),i(c,{key:0},u(7,s=>e("div",{key:"wv-skel-"+s,class:"wv-col"},[e("div",ms,[e("div",{class:"wv-fill sk-fill",style:n({blockSize:20+s*6+"%"})},null,4)]),t[6]||(t[6]=e("div",{class:"wv-day"}," ",-1))])),64)):(l(!0),i(c,{key:1},u(N.value,s=>(l(),i("div",{key:s.date,class:"wv-col"},[e("div",{class:"wv-stack",title:s.work+" dk çalışma / "+s.stop+" dk duruş"},[e("div",{class:"wv-seg work",style:n({blockSize:A(s.work)}),title:"Çalışma"},[s.work>0?(l(),i("span",ys,o(s.work),1)):r("",!0)],4),e("div",{class:"wv-seg stop",style:n({blockSize:A(s.stop)}),title:"Duruş"},[s.stop>0?(l(),i("span",fs,o(s.stop),1)):r("",!0)],4)],8,ks),e("div",ps,o(s.label),1)]))),128))])])]),e("div",bs,[t[9]||(t[9]=e("h4",null,"Haftalık Sayaç (adet)",-1)),e("div",ws,[e("div",_s,[y.value?(l(),i(c,{key:0},u(7,s=>e("div",{key:"wvc-skel-"+s,class:"wvc-col"},[e("div",hs,[e("div",{class:"wvc-fill sk-fill",style:n({blockSize:20+s*4+"%"})},null,4)]),t[8]||(t[8]=e("div",{class:"wvc-day"}," ",-1))])),64)):(l(!0),i(c,{key:1},u(M.value,s=>(l(),i("div",{key:s.date,class:"wvc-col"},[e("div",{class:"wvc-stack",title:s.count+" adet"},[e("div",{class:"wvc-bar",style:n({blockSize:H(s.count)}),title:"Adet"},[s.count>0?(l(),i("span",Ss,o(s.count),1)):r("",!0)],4)],8,gs),e("div",Ns,o(s.label),1)]))),128))])])]),_.value&&y.value?(l(),i("div",Ms,"Veri yükleniyor…")):r("",!0)])]),e("section",Cs,[y.value?(l(),i(c,{key:0},u(6,s=>e("article",{key:"skeleton-"+s,class:"machine-card skeleton"},t[10]||(t[10]=[Y('<div class="card-top" data-v-b1dc0f35><div class="names" data-v-b1dc0f35><div class="sk-line w-60" data-v-b1dc0f35></div><div class="sk-line w-40 mt-1" data-v-b1dc0f35></div></div><div class="status" data-v-b1dc0f35><span class="dot" data-v-b1dc0f35></span><span class="sk-line w-20" data-v-b1dc0f35></span></div></div><div class="kpi-row" data-v-b1dc0f35><div class="kpi-item" data-v-b1dc0f35><div class="sk-line w-60" data-v-b1dc0f35></div><div class="sk-line w-40 mt-1" data-v-b1dc0f35></div></div><div class="kpi-item" data-v-b1dc0f35><div class="sk-line w-60" data-v-b1dc0f35></div><div class="sk-line w-40 mt-1" data-v-b1dc0f35></div></div><div class="kpi-item" data-v-b1dc0f35><div class="sk-line w-60" data-v-b1dc0f35></div><div class="sk-line w-40 mt-1" data-v-b1dc0f35></div></div><div class="kpi-item" data-v-b1dc0f35><div class="sk-line w-60" data-v-b1dc0f35></div><div class="sk-line w-40 mt-1" data-v-b1dc0f35></div></div></div><div class="mini-bars" data-v-b1dc0f35><div class="multi-bar" data-v-b1dc0f35><div class="multi-seg sk-fill" style="inline-size:65%;" data-v-b1dc0f35></div><div class="multi-seg sk-fill" style="inline-size:20%;" data-v-b1dc0f35></div><div class="multi-seg sk-fill" style="inline-size:15%;" data-v-b1dc0f35></div></div></div>',3)]))),64)):(l(!0),i(c,{key:1},u(S.value,s=>(l(),i("article",{key:s.id,class:"machine-card"},[e("div",xs,[e("div",zs,[e("h3",Ds,o(s.code)+" - "+o(s.name),1),s.operator?(l(),i("p",Ts,"Operatör: "+o(s.operator),1)):r("",!0)]),e("div",{class:x(["status",s.status])},[t[11]||(t[11]=e("span",{class:"dot"},null,-1)),e("span",As,o(K(s.status)),1)],2)]),s.itemCode||s.itemName||s.counter!==void 0?(l(),i("div",Rs,[e("div",Es,[s.itemCode?(l(),i("span",qs,o(s.itemCode),1)):r("",!0),s.itemName?(l(),i("span",Bs,o(s.itemName),1)):r("",!0)]),s.counter!==void 0?(l(),i("div",Ks,[t[12]||(t[12]=Z("Sayaç: ")),e("strong",null,o(s.counter),1)])):r("",!0)])):r("",!0),e("div",Ls,[e("div",Vs,[t[13]||(t[13]=e("span",null,"Uygulanabilirlik",-1)),e("strong",null,o(v(s.availability)),1)]),e("div",Fs,[t[14]||(t[14]=e("span",null,"Performans",-1)),e("strong",null,o(v(s.performance)),1)]),e("div",Hs,[t[15]||(t[15]=e("span",null,"Kalite",-1)),e("strong",null,o(v(s.quality)),1)]),e("div",{class:x(["kpi-item oee",T(s.oee)])},[t[16]||(t[16]=e("span",null,"OEE",-1)),e("strong",null,o(v(s.oee)),1)],2)]),e("div",Ps,[s.segments&&s.segments.length?(l(),i("div",$s,[(l(!0),i(c,null,u(s.segments,(d,w)=>(l(),i("div",{key:s.id+"-seg-"+w,class:"multi-seg",style:n(O(d,s.segments)),title:G(d,s)},null,12,Os))),128))])):(l(),i("div",Gs,[e("div",{class:"multi-seg work",style:n({inlineSize:h(s).work+"%"}),title:"Çalışma"},null,4),e("div",{class:"multi-seg stop",style:n({inlineSize:h(s).stop+"%"}),title:"Duruş"},null,4),h(s).remain>0?(l(),i("div",{key:0,class:"multi-seg remain",style:n({inlineSize:h(s).remain+"%"}),title:"Kalan"},null,4)):r("",!0)]))])]))),128))]),e("section",Is,[e("div",Us,[t[19]||(t[19]=e("h4",null,"Duruş Sebepleri (Süre)",-1)),y.value?(l(),i("div",Ws,[(l(),i(c,null,u(5,s=>e("div",{key:"rs-"+s,class:"reason-row"},[t[17]||(t[17]=e("div",{class:"row-label"},[e("div",{class:"sk-line w-40"})],-1)),e("div",js,[e("div",{class:"fill sk-fill",style:n({width:100-s*12+"%"})},null,4)]),t[18]||(t[18]=e("div",{class:"value"},[e("div",{class:"sk-line w-20 ml-auto"})],-1))])),64))])):(l(),i("div",Js,[(l(!0),i(c,null,u(D.value,s=>(l(),i("div",{key:s.name,class:"reason-row"},[e("div",Qs,o(s.name),1),e("div",Xs,[e("div",{class:"fill reason",style:n({width:L(s.minutes)})},null,4)]),e("div",Ys,o(s.minutes)+" dk",1)]))),128))]))])])]))}}),ae=ss(Zs,[["__scopeId","data-v-b1dc0f35"]]);export{ae as default};
