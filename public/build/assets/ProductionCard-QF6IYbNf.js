import{_ as ce}from"./AppSelect.vue_vue_type_script_setup_true_lang-B6yCZToJ.js";import{m as me}from"./vue3-apexcharts-q7lqByvj.js";import{d as be,r as m,aO as fe,v as U,A as ge,w as ye,ak as ke,aY as ve,c as z,b as l,f as o,av as he,u as r,F as $,aI as y,j as we,e as s,aX as xe,aw as _,aB as f,k as u,au as Ie,L as v,o as V,l as _e}from"./main-BYaGs_gV.js";import{D as B,a as P}from"./popup-DVtnbNNd.js";import{D as h}from"./tooltip-H0h75CjT.js";import{n as D}from"./notify-Bue8ofbg.js";import De from"./PersonelSecDialog-BoM3vqBN.js";import{V as Ce,a as Se}from"./VCard-BbNBwq9f.js";import{V as b}from"./VRow-CTEBk3EW.js";import{V as n}from"./VCol-D1hxu7Xc.js";import{V as Ne}from"./VBadge-B4GceSp5.js";import{V as ze}from"./VTextField-B7Tiyxvr.js";import"./focus-DQzyK_z8.js";import"./VSelect-DPunVcMx.js";import"./form-3kGnkFgx.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-Ce623_H6.js";import"./ssrBoot-CQ7VRsvc.js";import"./index-C3csQ-DQ.js";import"./createSimpleFunctional-CKl1yCO_.js";import"./VAvatar-CqZfINw5.js";import"./VImg-DlDtDwK8.js";import"./VDivider-YGLtFVKF.js";import"./dialog-transition-BZFFtmp1.js";import"./easing-Bybner-F.js";import"./VMenu-DADsnB9o.js";import"./VOverlay-DsA4feGQ.js";import"./delay-aYct_xoS.js";import"./lazy-CkSm6jn9.js";import"./scopeId-BFdpl8_G.js";import"./VCheckboxBtn-Uol4IYb_.js";import"./VSelectionControl-B-ZwGcRT.js";import"./VChip-Dmmn_s5B.js";import"./VSlideGroup-D00ZvkUJ.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./editor-BxB5X-6d.js";import"./overlay-CX79FWTF.js";import"./m_row_dragging-DZWWMV3u.js";import"./m_select_box-e0iLTi5k.js";import"./themes-DJudCCmN.js";import"./m_popover-BjoYqJE3.js";import"./dayjs.min-WZT4ZYRx.js";import"./data-grid-BVs-SVXU.js";import"./VDialog-D0xt--js.js";import"./VCardText-DqZn3ld0.js";import"./VSpacer-8LY9MZ5o.js";/* empty css              *//* empty css                   */import"./VCounter-CE_3-zwM.js";import"./VField-rVYIuLLa.js";import"./VInput-CD_Y1EX6.js";const Ve={key:0,class:"loading-overlay d-flex flex-column align-center justify-center"},Ae={style:{"font-size":"18px","padding-block":"2px","padding-inline":"8px"}},Ke={style:{"font-size":"16px"}},Te={class:"time-display"},Ge={style:{fontSize:"28px",color:"#429193"}},Be={style:{"font-size":"28px"}},Le={class:"text-center",style:{"margin-block":"-12px -10px"}},Re={id:"bar"},Oe=["title"],Me={style:{"font-style":"italic"}},Ee={style:{"font-style":"italic"}},Ue={style:{"font-style":"italic"}},$e={style:{"font-style":"italic"}},Pe=be({__name:"ProductionCard",props:{status:{},isemriId:{},isemriNo:{},runTime:{},totalDown:{},totalTime:{},sonDurumSuresi:{},target:{},actual:{},efficiency:{},quality:{},partId:{},partCode:{},partName:{},sebep:{},baslikArkarenk:{},barData:{},barTotal:{},guid:{},isSelected:{type:Boolean},kontrolGerekli:{type:Boolean},kontrolcuCagrildi:{type:Boolean},plnNote:{},prdNote:{},personelId:{},personelName:{},baslangicZamani:{},aksesuarli:{},ekipSayisi:{}},emits:["show-details","ekipGuncellendi","panelKapatildi","durusGirildi"],setup(H,{emit:Y}){const w=Y,c=m(!1),A=m(!1);function C(){w("ekipGuncellendi")}function Z(){w("ekipGuncellendi")}const x=m(!1),S=m(0),d=fe("userData"),k=m(!1),L=m([]),I=m(""),K=m(!0),T=m(!1),N=m(!1),W=async()=>{try{const{data:t}=await y.get("/api/aktif-ekipler",{params:{isemriID:Number(a.isemriId),guid:a.guid}}),e=(t||[]).map(p=>p.id).filter(p=>p!=null);if(!e.length)return;await y.post("/api/ekip-bitir-toplu",{ids:e}),D("Ekibin görevleri bitirildi.","success")}catch(t){console.error(t),D("Toplu bitirme sırasında hata oluştu.","error")}},j=async()=>{if(c.value||A.value)return;c.value=!0;try{await W(),await F(),C()}finally{c.value=!1}A.value=!0,setTimeout(()=>{w("panelKapatildi",a.isemriNo)},1500)},F=async()=>{try{const t=await y.post("/api/insert-workorder",{WorderMId:Number(a.isemriId),guid:a.guid,userId:d.value.id,selectedDurus:a.sebep,uretimMiktari:S.value});S.value=0,Z()}catch(t){console.error(t)}x.value=!1},q=()=>{C()},g=m(null),X=()=>{const t={isemriNo:a.isemriNo,isemriId:a.isemriId,partId:a.partId,partCode:a.partCode,partName:a.partName,guid:a.guid,status:I.value,sebep:a.sebep,baslangicZamani:a.baslangicZamani,personelId:a.personelId,personelName:a.personelName,kontrolGerekli:a.kontrolGerekli,kontrolcuCagrildi:a.kontrolcuCagrildi,plnNote:a.plnNote,prdNote:a.prdNote,ekipSayisi:a.ekipSayisi};w("show-details",t)},a=H,R={width:100,marginBottom:30,type:"success",text:"Kaydet",stylingMode:"contained"},J={width:100,type:"normal",text:"Vazgeç",stylingMode:"contained",onClick:()=>{k.value=!1,x.value=!1}};I.value=a.status;const O={durus:"#ec5a58",ayar:"#a59ef7",calisma:"#6ABE63",mola:"#f4b73f",kalan:"lightgray"},Q=t=>{const e=O[t.type]||"gray",p=t.duration/a.barTotal*100;return{backgroundColor:e,width:`${p}%`,borderRadius:"3px"}},ee=t=>({type:["durus","ayar","calisma","mola","kalan"].includes(t.type)?t.type:"kalan",duration:t.duration,sebep:t.sebep}),te={durus:"Duruş Süreci",ayar:"Ayar Süreci",calisma:"Çalışma Süreci",mola:"Molada Geçen Süre",kalan:"Kalan Süre"},ae=t=>{const e=ee(t),p=te[e.type]||e.type;return e.sebep!=null?`${p}: ${e.sebep}`:p},le=U(()=>O[a.baslikArkarenk]||a.baslikArkarenk||"#999"),G=async t=>{if(I.value.toLocaleLowerCase()===t.toLocaleLowerCase()){console.log("Durum zaten bu:",t),M();return}else{g.value=t==="HAZIRLIK"?{break_reason_code:"",description:"HAZIRLIK ÇALIŞMASI"}:null,I.value=t==="ÇALIŞIYOR"?"Çalışıyor":t==="DURUYOR"?"Duruyor":t==="HAZIRLIK"?"Ayar":t;try{if(c.value)return;c.value=!0,await y.post("/api/durumKaydet",{isEmriId:a.isemriId,isEmriNo:a.isemriNo,urunID:a.partId,urunKodu:a.partCode,urunAdi:a.partName,durum:t,vardiya:2,istasyonKodu:d.value.istasyon_id,userId:d.value.id,personelSayisi:0,selectedDurus:g.value,guid:a.guid}),C()}catch(e){console.error("Kaydetme sırasında bir hata oluştu:",e)}finally{c.value=!1}t==="DURUYOR"&&M()}},oe=async t=>{if(t!==null)try{if(c.value)return;c.value=!0,await y.post("/api/kontrolcu-cagir-guncelle",{isEmriID:a.isemriId,istasyonID:d.value.istasyon_id,personelID:d.value.id,is_check_quality_opr:t?1:0}),C()}catch(e){console.error("Kontrolcü durumu güncellenemedi:",e)}finally{c.value=!1}},se=async()=>{try{const t=await y.get("/api/durus-sebepleri-al",{params:{istasyon:d.value.istasyon_id}});L.value=t.data.durusSebepleri}catch(t){console.error("Veri çekme hatası:",t)}};ge(()=>{se()});const M=async()=>{g.value={break_reason_code:"0000",description:"GİRİLMEDİ"},k.value=!0},ie=async()=>{if(!N.value){if(!g.value){D({message:"Lütfen bir duruş sebebi seçiniz.",type:"error",displayTime:3e3});return}try{N.value=!0,K.value=!1;const t=await y.post("/api/durusKaydet",{isEmriId:a.isemriId,istasyonKodu:d.value.istasyon_id,userId:d.value.id,selectedDurus:g.value});D({message:"Duruş kaydedildi.",type:"success",displayTime:2e3})}catch(t){console.error("Kaydetme sırasında bir hata oluştu:",t),D({message:"Duruş kaydedilemedi.",type:"error",displayTime:3e3})}finally{N.value=!1,K.value=!0,k.value=!1}}},re=t=>{K.value||(t.cancel=!0)};ye(k,(t,e)=>{e===!0&&t===!1&&w("durusGirildi")});const ne=[a.efficiency||0],E=ke(),de=U(()=>{const t=E.current.value.colors,e=E.current.value.variables;return{chart:{sparkline:{enabled:!0},parentHeightOffset:0,type:"radialBar"},colors:["rgba(var(--v-theme-warning), 1)"],plotOptions:{radialBar:{offsetY:0,startAngle:-90,endAngle:90,hollow:{size:"60%"},track:{strokeWidth:"40%",background:"rgba(var(--v-track-bg))"},dataLabels:{name:{show:!1},value:{fontSize:"24px",color:"#429193",fontWeight:500,offsetY:-8,formatter:function(p){return p}}}}},grid:{show:!1,padding:{bottom:5}},stroke:{lineCap:"round"},labels:["Progress"],responsive:[{breakpoint:1442,options:{chart:{height:125},plotOptions:{radialBar:{dataLabels:{value:{fontSize:"20px",fontWeight:500,color:`rgba(${ve(t["on-background"])},${e["high-emphasis-opacity"]})`}},hollow:{size:"60%"}}}}},{breakpoint:1370,options:{chart:{height:120}}},{breakpoint:1280,options:{chart:{height:200},plotOptions:{radialBar:{dataLabels:{value:{fontSize:"18px"}},hollow:{size:"70%"}}}}},{breakpoint:960,options:{chart:{height:250},plotOptions:{radialBar:{hollow:{size:"70%"},dataLabels:{value:{fontSize:"24px"}}}}}}]}});return(t,e)=>{const p=me,ue=ce;return V(),z($,null,[l(Ce,{class:he(["pa-3 production-card",{"selected-card":t.isSelected,"fading-out":A.value}]),elevation:"3",rounded:"lg",onClick:X},{default:o(()=>[c.value?(V(),z("div",Ve,[l(xe,{indeterminate:"",color:"primary",size:"40",class:"mb-3"}),e[12]||(e[12]=s("span",{style:{"font-weight":"600"}},"İşlem yapılıyor...",-1))])):we("",!0),l(b,{align:"center",justify:"space-between",class:"mb-0",style:_({backgroundColor:le.value,color:"white",padding:"0px 8px",borderRadius:"3px 3px 0 0"})},{default:o(()=>[s("span",Ae,[f(u(t.isemriNo)+"   ",1),s("span",Ke,u(t.sebep!=null?t.sebep.substring(0,30):""),1)]),s("span",Te,u(t.sonDurumSuresi),1)]),_:1},8,["style"]),l(b,{class:"ma-0 mt-2",align:"center",justify:"space-between"},{default:o(()=>[l(n,{cols:"10",class:"text-center pa-2 pt-0"},{default:o(()=>[l(b,{class:"text-center pa-0 my-1"},{default:o(()=>[l(n,{cols:"4",class:"pa-1"},{default:o(()=>[s("div",Ge,u(t.totalTime),1),e[13]||(e[13]=s("div",{style:{"font-size":"14px"}},"Toplam Süre",-1))]),_:1,__:[13]}),l(n,{cols:"4",class:"pa-1"},{default:o(()=>[s("div",Be,u(t.totalDown),1),e[14]||(e[14]=s("div",{style:{"font-size":"14px"}},"Toplam Duruş",-1))]),_:1,__:[14]}),l(n,{cols:"4",class:"pa-1 mt-0 pt-0 ps-0"},{default:o(()=>[s("div",Le,[l(p,{options:de.value,series:ne,type:"radialBar",height:125},null,8,["options"]),e[15]||(e[15]=s("div",{style:{"font-size":"14px","margin-block-start":"-8px"}},"MEÇO %",-1))])]),_:1})]),_:1}),s("div",Re,[(V(!0),z($,null,Ie(t.barData,(i,pe)=>(V(),z("div",{key:pe,class:"bar-segment",style:_(Q(i)),title:ae(i)},null,12,Oe))),128))]),l(b,{justify:"space-between",style:{"font-size":"14px"},class:"ma-0 mt-1"},{default:o(()=>[s("span",null,u(t.partName.substring(0,30)),1),s("span",null,u(t.partCode),1)]),_:1})]),_:1}),l(n,{cols:"1",class:"pa-0"},{default:o(()=>[l(Ne,{content:a.ekipSayisi,bordered:"",location:"start","offset-x":"-5","offset-y":"5",class:"v-badge--tonal"},{default:o(()=>[l(v,{disabled:a.personelId!=r(d).id,icon:"tabler-users-plus",variant:"tonal",color:"primary",rounded:"",class:"mb-1",id:"ekipSec",onClick:e[0]||(e[0]=i=>T.value=!0)},null,8,["disabled"])]),_:1},8,["content"]),l(r(h),{"hide-on-outside-click":!1,target:"#ekipSec","show-event":"mouseenter","hide-event":"mouseleave"},{default:o(()=>e[16]||(e[16]=[f(" Ekip Seç ")])),_:1,__:[16]}),l(v,{disabled:Number(a.kontrolGerekli)===1||a.personelId!=r(d).id,icon:"tabler-phone",variant:"tonal",color:"primary",rounded:"",class:"ps-1 mb-1",id:"kaliteCagir",onClick:e[1]||(e[1]=i=>oe(!a.kontrolcuCagrildi))},null,8,["disabled"]),l(r(h),{"hide-on-outside-click":!1,target:"#kaliteCagir","show-event":"mouseenter","hide-event":"mouseleave"},{default:o(()=>e[17]||(e[17]=[f(" Kaliteci Çağır ")])),_:1,__:[17]}),l(v,{disabled:a.personelId!=r(d).id,icon:"tabler-logout",variant:"tonal",color:"error",rounded:"",class:"mb-0",id:"kapat",onClick:e[2]||(e[2]=i=>x.value=!0)},null,8,["disabled"]),l(r(h),{"hide-on-outside-click":!1,target:"#kapat","show-event":"mouseenter","hide-event":"mouseleave"},{default:o(()=>e[18]||(e[18]=[f(" İş Emrini Kapat ")])),_:1,__:[18]})]),_:1}),l(n,{cols:"1",class:"pa-0",style:{"margin-block-start":"4px"}},{default:o(()=>[l(v,{disabled:a.personelId!=r(d).id||I.value==="Çalışıyor",icon:"tabler-play",variant:"tonal",color:"success",rounded:"",class:"mb-1",id:"calisma",onClick:e[3]||(e[3]=i=>G("ÇALIŞIYOR"))},null,8,["disabled"]),l(r(h),{"hide-on-outside-click":!1,target:"#calisma","show-event":"mouseenter","hide-event":"mouseleave"},{default:o(()=>e[19]||(e[19]=[f(" Çalışmaya Başla ")])),_:1,__:[19]}),l(v,{disabled:a.personelId!=r(d).id,icon:"tabler-pause",variant:"tonal",color:"warning",rounded:"",class:"mb-1",id:"durus",onClick:e[4]||(e[4]=i=>G("DURUYOR"))},null,8,["disabled"]),l(r(h),{"hide-on-outside-click":!1,target:"#durus","show-event":"mouseenter","hide-event":"mouseleave"},{default:o(()=>e[20]||(e[20]=[f(" Duruşa Geç ")])),_:1,__:[20]}),l(v,{disabled:a.personelId!=r(d).id,icon:"tabler-settings-share",variant:"tonal",color:"info",rounded:"",class:"mb-1",id:"hazirlik",onClick:e[5]||(e[5]=i=>G("HAZIRLIK"))},null,8,["disabled"]),l(r(h),{"hide-on-outside-click":!1,target:"#hazirlik","show-event":"mouseenter","hide-event":"mouseleave"},{default:o(()=>e[21]||(e[21]=[f(" Hazırlığa Geç ")])),_:1,__:[21]})]),_:1})]),_:1}),e[26]||(e[26]=s("hr",null,null,-1)),l(n,{class:"pa-0 ma-0"},{default:o(()=>[l(b,{class:"pa-0 ma-0",style:{"margin-block-end":"-20px"}},{default:o(()=>[l(n,{cols:"2",class:"ps-2 pt-2 pe-0"},{default:o(()=>e[22]||(e[22]=[s("span",{style:{"font-weight":"bold"}},"Pln. Notu",-1)])),_:1,__:[22]}),l(n,{cols:"10",class:"ps-2 pt-2 pe-0"},{default:o(()=>[s("span",Me," :  "+u(t.plnNote),1)]),_:1})]),_:1}),l(b,{class:"pa-0 ma-0"},{default:o(()=>[l(n,{cols:"2",class:"ps-2 pt-2 pe-0",style:{"margin-block-start":"-20px"}},{default:o(()=>e[23]||(e[23]=[s("span",{style:{"font-weight":"bold"}},"Ürt. Notu",-1)])),_:1,__:[23]}),l(n,{cols:"10",class:"ps-2 pt-2 pe-0",style:{"margin-block-start":"-20px"}},{default:o(()=>[s("span",Ee," :  "+u(t.prdNote),1)]),_:1})]),_:1}),l(b,{class:"pa-0 ma-0"},{default:o(()=>[l(n,{cols:"2",class:"ps-2 pt-2 pe-0",style:{"margin-block-start":"-20px"}},{default:o(()=>e[24]||(e[24]=[s("span",{style:{"font-weight":"bold"}},"Başlatan",-1)])),_:1,__:[24]}),l(n,{cols:"4",class:"ps-2 pt-2 pe-0",style:{"margin-block-start":"-20px"}},{default:o(()=>[s("span",Ue," :  "+u(t.personelName),1)]),_:1}),l(n,{cols:"2",class:"ps-2 pt-2 pe-0",style:{"margin-block-start":"-20px"}},{default:o(()=>e[25]||(e[25]=[s("span",{style:{"font-weight":"bold"}},"Başlangıç",-1)])),_:1,__:[25]}),l(n,{cols:"4",class:"ps-2 pt-2 pe-0",style:{"margin-block-start":"-20px"}},{default:o(()=>[s("span",$e," :  "+u(t.baslangicZamani),1)]),_:1})]),_:1}),l(b,{class:"pa-0 ma-0 pe-2"},{default:o(()=>[l(n,{cols:"4",class:"ps-2 pt-1 pe-0 text-center",style:{"margin-block":"-10px -17px"}},{default:o(()=>[s("div",{style:_({padding:"5px",backgroundColor:a.kontrolGerekli===!0?"gold":"transparent",fontWeight:"bold",width:"100%",borderRadius:"5px",border:"1px solid gold",color:a.kontrolGerekli===!0?"black":"#999"})},u(a.kontrolGerekli===!0?"Kontrol Gerekli":"Kontrol Gereksiz"),5)]),_:1}),l(n,{cols:"4",class:"ps-2 pt-1 pe-0 text-center",style:{"margin-block":"-10px -17px"}},{default:o(()=>[s("div",{style:_({padding:"5px",backgroundColor:a.kontrolcuCagrildi===!0?"gold":"transparent",fontWeight:"bold",width:"100%",borderRadius:"5px",border:"1px solid gold",color:a.kontrolcuCagrildi===!0?"black":"#999"})},u(a.kontrolcuCagrildi===!0?"Kaliteci çağrıldı":"Kaliteci çağrılmadı"),5)]),_:1}),l(n,{cols:"4",class:"ps-2 pt-1 pe-0 text-center",style:{"margin-block":"-10px -17px"}},{default:o(()=>[s("div",{style:_({padding:"5px",backgroundColor:a.aksesuarli==="1"?"gold":"transparent",fontWeight:"bold",width:"100%",borderRadius:"5px",border:"1px solid gold",color:a.aksesuarli==="1"?"black":"#999"})},u(a.aksesuarli==="1"?"Aksesuarlı":"Aksesuarsız"),5)]),_:1})]),_:1})]),_:1})]),_:1,__:[26]},8,["class"]),l(r(P),{visible:k.value,"onUpdate:visible":e[7]||(e[7]=i=>k.value=i),width:500,height:240,"hide-on-outside-click":!1,"show-close-button":!1,"drag-enabled":!1,"close-on-back-button":!1,"defer-rendering":!1,"focus-state-enabled":!1,shading:!0,"shading-color":"rgba(0, 0, 0, 0.5)","on-hiding":re,titleTemplate:"title"},{content:o(()=>[l(b,{class:"pa-4"},{default:o(()=>[l(ue,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=i=>g.value=i),items:L.value,"item-title":"description","item-value":"break_reason_code","return-object":"",label:"Duruş Sebebi","single-line":"",placeholder:"Seçiniz...",variant:"outlined"},null,8,["modelValue","items"])]),_:1})]),title:o(()=>e[27]||(e[27]=[s("p",{class:"popup-title"},"Duruş Sebebini Giriniz",-1)])),default:o(()=>[l(r(B),{widget:"dxButton",toolbar:"bottom",location:"center",options:{...R,onClick:ie,disabled:N.value}},null,8,["options"]),e[28]||(e[28]=s("br",null,null,-1))]),_:1,__:[28]},8,["visible"]),l(r(P),{visible:x.value,"onUpdate:visible":e[9]||(e[9]=i=>x.value=i),width:400,height:240,"hide-on-outside-click":!1,"show-close-button":!0},{title:o(()=>e[29]||(e[29]=[s("p",{class:"popup-title"},"Değerleri Giriniz",-1)])),content:o(()=>[l(Se,null,{default:o(()=>e[30]||(e[30]=[f("Üretim Miktarı Giriniz")])),_:1,__:[30]}),l(ze,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=i=>S.value=i),type:"number"},null,8,["modelValue"])]),default:o(()=>[l(r(B),{widget:"dxButton",toolbar:"bottom",location:"center",options:{...R,onClick:j,disabled:c.value}},null,8,["options"]),l(r(B),{widget:"dxButton",toolbar:"bottom",location:"center",options:{...J,disabled:c.value}},null,8,["options"])]),_:1},8,["visible"]),l(De,{modelValue:T.value,"onUpdate:modelValue":e[10]||(e[10]=i=>T.value=i),isemriID:Number(a.isemriId),"istasyon-id":Number(r(d).istasyon_id),guid:a.guid,onIptal:e[11]||(e[11]=i=>console.log("Dialog kapatıldı")),onKaydedildi:q},null,8,["modelValue","isemriID","istasyon-id","guid"])],64)}}}),Ut=_e(Pe,[["__scopeId","data-v-c21adfd8"]]);export{Ut as default};
