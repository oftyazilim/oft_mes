import{u as Z}from"./pageTitle-DtS471j8.js";import{d as h,r,D as y,w as $,i as ee,g as U,o as Y,f as i,b as o,e as p,T as v,aF as b,p as x,m as te,s as V,aK as E}from"./main-CcIa1HPl.js";import{V as P,a as B,b as le}from"./VCard-DWziF1jn.js";import{V as M}from"./VTextField-BAh_jwT4.js";import{V as N}from"./VCardText-DbElftoT.js";import{V as oe}from"./VDataTable-Bz7BLfsy.js";import{V as ae}from"./VDialog-GfqLk7F3.js";import{V as S}from"./VCombobox-D4A5g9BQ.js";import{V as ie}from"./VSpacer-Civ95lbn.js";import{V as se}from"./VContainer-CXKuXXYU.js";import"./createSimpleFunctional-MLkkMb8d.js";import"./VAvatar-Tt7m8rPe.js";import"./VImg-K7rD3lBB.js";import"./index-9Hgif7L6.js";/* empty css                   */import"./VCounter-BWAfyOL-.js";import"./VField-BDN9Ni5A.js";import"./form-DCcyOPlW.js";import"./easing-Bybner-F.js";import"./VInput-CqVw3DlZ.js";import"./forwardRefs-C-GTDzx5.js";import"./VPagination-B3Yi-wJw.js";import"./VSelect-QoIMwF4m.js";import"./VList-D-C9NoVj.js";import"./ssrBoot-P0xXRp0P.js";import"./VDivider-BiPaU4vY.js";import"./dialog-transition-CaG9jBaX.js";import"./VMenu-BWFZTK6G.js";import"./VOverlay-BTvm3XXD.js";import"./delay-D7pMG0rO.js";import"./lazy-B10RISM_.js";import"./scopeId-BbjyFoxa.js";import"./VCheckboxBtn--TVa-agu.js";import"./VSelectionControl-N_SqpwCp.js";import"./VChip-BU_47J6V.js";import"./VSlideGroup-BqpbnCrl.js";import"./VTable-BfcOarex.js";import"./filter-Ep4_eqAn.js";/* empty css              */const ne={class:"d-inline-flex align-center",style:{gap:"6px"}},O="Policy Yönetimi",z="ACL",Je=h({__name:"acl-policy-yonetimi",setup(re){Z().setTitle(`${O} (${z})`),document.title=`OFT - ${O} | ${z}`;const u=r([]),k=r(!1),a=r(null),n=r(!1),c=r([]),m=r([]),g=r(""),K=y(()=>{const t=g.value.trim().toLowerCase();return t?u.value.filter(e=>e.key.toLowerCase().includes(t)||(e.description||"").toLowerCase().includes(t)):u.value}),q=y(()=>{const t=new Set;for(const e of u.value)t.add(e.key);return Array.from(t).sort()}),F=y(()=>{const t=new Set;for(const e of u.value)for(const l of e.actions||[])t.add(String(l));return Array.from(t).sort()}),X=y(()=>{const t=new Set;for(const e of u.value)for(const l of e.subjects||[])t.add(String(l));return Array.from(t).sort()});$(n,t=>{t?E(j):a.value=null});function j(){const t=document.querySelectorAll(".v-overlay--active .v-overlay__content"),e=t[t.length-1];if(!e)return;e.style.position="absolute",e.style.inset="unset";const l=e.querySelector(".v-card-title");if(!l)return;l.style.cursor="move";let s=0,T=0,_=0,A=0,C=!1;const D=d=>{if(!C)return;const f=d.clientX-s,W=d.clientY-T;e.style.left=`${_+f}px`,e.style.top=`${A+W}px`},L=()=>{C=!1,window.removeEventListener("mousemove",D),window.removeEventListener("mouseup",L)},Q=d=>{C=!0;const f=e.getBoundingClientRect();s=d.clientX,T=d.clientY,_=f.left,A=f.top,window.addEventListener("mousemove",D),window.addEventListener("mouseup",L)};l.addEventListener("mousedown",Q,{passive:!0})}$(n,t=>{t&&E(j)});async function w(){k.value=!0;try{const{data:t}=await V.get("/api/ability-policies");u.value=(t||[]).map(e=>({id:e.id,key:e.key,actions:e.actions||[],subjects:e.subjects||[],description:e.description||""}))}finally{k.value=!1}}function I(){a.value={key:"",actions:[],subjects:[],description:""},c.value=[],m.value=[],n.value=!0}function R(t){a.value={...t},c.value=[...t.actions||[]],m.value=[...t.subjects||[]],n.value=!0}async function G(){var e;if(!a.value)return;const t={key:a.value.key.trim(),actions:[...c.value],subjects:[...m.value],description:((e=a.value.description)==null?void 0:e.trim())||null};try{a.value.id?await V.put(`/api/ability-policies/${a.value.id}`,t):await V.post("/api/ability-policies",t),n.value=!1,a.value=null,await w()}catch(l){console.error(l)}}function H(){n.value=!1,a.value=null}async function J(t){t.id&&(await V.delete(`/api/ability-policies/${t.id}`),await w())}return ee(w),(t,e)=>(Y(),U(se,null,{default:i(()=>[o(P,null,{default:i(()=>[o(B,{class:"d-flex align-center justify-space-between"},{default:i(()=>[e[7]||(e[7]=p("span",null,"ACL Policy Yönetimi",-1)),p("div",null,[o(M,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=l=>g.value=l),density:"compact",label:"Ara (key/description)",class:"me-2"},null,8,["modelValue"]),o(v,{color:"primary",onClick:I,variant:"outlined",class:"mt-2"},{default:i(()=>e[6]||(e[6]=[b("Yeni Policy")])),_:1,__:[6]})])]),_:1,__:[7]}),o(N,null,{default:i(()=>[o(oe,{items:K.value,loading:k.value,headers:[{title:"Key",key:"key"},{title:"Actions",key:"actions"},{title:"Subjects",key:"subjects"},{title:"Description",key:"description"},{title:"",key:"act",sortable:!1}]},{"item.actions":i(({item:l})=>{var s;return[p("div",null,x((s=l.actions)==null?void 0:s.join(", ")),1)]}),"item.subjects":i(({item:l})=>{var s;return[p("div",null,x((s=l.subjects)==null?void 0:s.join(", ")),1)]}),"item.act":i(({item:l})=>[p("div",ne,[o(v,{size:"small",icon:"tabler-edit",variant:"outlined","aria-label":"Düzenle",onClick:s=>R(l)},null,8,["onClick"]),o(v,{size:"small",color:"error",icon:"tabler-trash",variant:"outlined","aria-label":"Sil",onClick:s=>J(l)},null,8,["onClick"])])]),_:1},8,["items","loading"])]),_:1})]),_:1}),o(ae,{modelValue:n.value,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value=l),"max-width":"640"},{default:i(()=>[a.value?(Y(),U(P,{key:0},{default:i(()=>[o(B,null,{default:i(()=>{var l;return[b(x((l=a.value)!=null&&l.id?"Policy Düzenle":"Yeni Policy"),1)]}),_:1}),o(N,null,{default:i(()=>[o(S,{class:"mb-4",modelValue:a.value.key,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.key=l),items:q.value,label:"Key (örn: route:dashboards-analytics)","hide-details":"auto",clearable:""},null,8,["modelValue","items"]),o(S,{class:"mb-4",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=l=>c.value=l),items:F.value,label:"Actions (çoklu)",multiple:"",chips:"","closable-chips":"","hide-details":"auto",clearable:""},null,8,["modelValue","items"]),o(S,{class:"mb-4",modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=l=>m.value=l),items:X.value,label:"Subjects (çoklu)",multiple:"",chips:"","closable-chips":"","hide-details":"auto",clearable:""},null,8,["modelValue","items"]),o(M,{class:"mb-2",modelValue:a.value.description,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.description=l),label:"Açıklama"},null,8,["modelValue"])]),_:1}),o(le,null,{default:i(()=>[o(ie),o(v,{variant:"text",onClick:H},{default:i(()=>e[8]||(e[8]=[b("İptal")])),_:1,__:[8]}),o(v,{color:"primary",onClick:G},{default:i(()=>e[9]||(e[9]=[b("Kaydet")])),_:1,__:[9]})]),_:1})]),_:1})):te("",!0)]),_:1},8,["modelValue"])]),_:1}))}});export{Je as default};
