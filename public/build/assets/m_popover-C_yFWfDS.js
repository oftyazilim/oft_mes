import{a$ as g,dI as F,d4 as M,d1 as S,dc as b,da as z,d8 as R}from"./main-BcuU0xZR.js";import{n as y,w as W,aI as p,o as k,s as c,B as j,g as H,e as m,d as A,W as N,as as G,b1 as U,aG as I,au as P,q}from"./dom_component-Bxo5mHIn.js";import{i as Y,a as J}from"./themes-B7jtTysC.js";import{P as K}from"./m_select_box-Br_vgrK0.js";import{a as Q}from"./overlay-48ilMUZl.js";const X={left:"borderLeftWidth",top:"borderTopWidth",right:"borderRightWidth",bottom:"borderBottomWidth"},l={left:-1,top:-1,center:0,right:1,bottom:1},V={top:{my:"bottom center",at:"top center",collision:"fit flip"},bottom:{my:"top center",at:"bottom center",collision:"fit flip"},right:{my:"left center",at:"right center",collision:"flip fit"},left:{my:"right center",at:"left center",collision:"flip fit"}},Z={h:10,v:10},tt=C=>b(C);class et extends Q{constructor(t){super(t);const e=this._properties,{properties:i,elements:o}=t,{shading:s,target:n}=i,{$arrow:r}=o;this._properties=g({},e,{shading:s,target:n}),this._$arrow=r,this._positionSide=void 0,this.updatePosition(this._properties.position)}positionWrapper(){if(this._properties.shading){var t;(t=this._$wrapper)===null||t===void 0||t.css({top:0,left:0})}}updateTarget(t){this._properties.target=t,this.updatePosition(this._properties.position)}_renderBoundaryOffset(){}_getContainerPosition(){var t;const e=F(((t=this._position)===null||t===void 0?void 0:t.offset)??"");let{h:i,v:o}=e;const s=this._isVerticalSide(),n=this._isHorizontalSide();if(s||n){const a=this._isPopoverInside(),h=this._positionSide?l[this._positionSide]:l.center,_=(a?-1:1)*h,d=s?y(this._$arrow):W(this._$arrow),v=this._getContentBorderWidth(this._positionSide),u=_*(d-v);s?o+=u:i+=u}return g({},this._position,{offset:`${i} ${o}`})}_getContentBorderWidth(t){var e;const i=t?((e=this._$content)===null||e===void 0?void 0:e.css(X[t]))??"":"";return parseInt(i,10)||0}_isPopoverInside(){var t,e;const i=p.setup.normalizeAlign((t=this._position)===null||t===void 0?void 0:t.my),o=p.setup.normalizeAlign((e=this._position)===null||e===void 0?void 0:e.at);return i.h===o.h&&i.v===o.v}_isVerticalSide(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._positionSide;return t==="top"||t==="bottom"}_isHorizontalSide(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._positionSide;return t==="left"||t==="right"}_getDisplaySide(t){const e=p.setup.normalizeAlign(t.my),i=p.setup.normalizeAlign(t.at),o=l[e.h]===l[i.h]&&l[e.v]===l[i.v]?-1:1,s=Math.abs(l[e.h]-o*l[i.h]),n=Math.abs(l[e.v]-o*l[i.v]);return s>n?i.h:i.v}_normalizePosition(t){const e={of:this._properties.target,boundaryOffset:Z},i=M(t)?this._positionToObject(t):{},o=S(!0,{},e,i);return this._positionSide=this._getDisplaySide(o),o}_positionToObject(t){return tt(t)?g({},V[t]):t}}const x={left:"right",top:"bottom",right:"left",bottom:"top",center:"center"};class it extends K{_getDefaultOptions(){return g({},super._getDefaultOptions(),{shading:!1,position:S({},V.bottom),hideOnOutsideClick:!0,animation:{show:{type:"fade",from:0,to:1},hide:{type:"fade",from:1,to:0}},showTitle:!1,width:"auto",height:"auto",dragEnabled:!1,resizeEnabled:!1,fullScreen:!1,hideOnParentScroll:!0,arrowPosition:"",arrowOffset:0,_fixWrapperPosition:!0})}_defaultOptionsRules(){return[{device:{platform:"ios"},options:{arrowPosition:{boundaryOffset:{h:20,v:-10},collision:"fit"}}},{device:()=>!k(),options:{animation:null}},{device:()=>Y(),options:{useFlatToolbarButtons:!0}},{device:()=>J(),options:{useDefaultToolbarButtons:!0,showCloseButton:!1}}]}_init(){super._init(),this._renderArrow(),this._timeouts={},this.$element().addClass("dx-popover"),this.$wrapper().addClass("dx-popover-wrapper");const{toolbarItems:t}=this.option(),e=t==null?void 0:t.length;this.setAria("role",e?"dialog":"tooltip")}_render(){super._render.apply(this,arguments),this._detachEvents(this.option("target")),this._attachEvents()}_detachEvents(t){this._detachEvent(t,"show"),this._detachEvent(t,"hide")}_attachEvents(){this._attachEvent("show"),this._attachEvent("hide")}_createEventHandler(t){const e=this._createAction((()=>{const i=this._getEventDelay(`${t}Event`);this._clearEventsTimeouts(),i?this._timeouts[t]=setTimeout((()=>{this[t]()}),i):this[t]()}),{validatingTargetName:"target"});return i=>{e({event:i,target:c(i.currentTarget)})}}_attachEvent(t){const{target:e,shading:i,disabled:o,hideEvent:s}=this.option(),n=i&&t==="hide";n&&s&&j.log("W1020");const r=n?null:this._getEventName(`${t}Event`);if(!r||o)return;const a=this._getEventHandlerName(t);this[a]=this._createEventHandler(t);const h=H(r,this.NAME);b(e)?m.on(A.getDocument(),h,e,this[a]):m.on(N(c(e)),h,this[a])}_detachEvent(t,e,i){let o=i||this._getEventName(`${e}Event`);if(!o)return;o=H(o,this.NAME);const s=this._getEventHandlerName(e);b(t)?m.off(A.getDocument(),o,t,this[s]):m.off(N(c(t)),o,this[s])}_getEventHandlerName(t){return`_${t}EventHandler`}_getEventNameByOption(t){return z(t)?t.name:t}_getEventName(t){const e=this.option(t);return this._getEventNameByOption(e)}_getEventDelay(t){const e=this.option(t);return z(e)&&e.delay}_renderArrow(){this._$arrow=c("<div>").addClass("dx-popover-arrow").prependTo(this.$overlayContent())}_documentDownHandler(t){return this._isOutsideClick(t)?super._documentDownHandler(t):!0}_isOutsideClick(t){const{target:e}=this.option();return!c(t.target).closest(e).length}_animate(t){t!=null&&t.to&&typeof t.to=="object"&&S(t.to,{position:this._getContainerPosition()}),super._animate.apply(this,arguments)}_stopAnimation(){super._stopAnimation.apply(this,arguments)}_renderTopToolbar(){this.$wrapper().toggleClass("dx-popover-without-title",!this.option("showTitle")),super._renderTopToolbar()}_renderPosition(){var t,e;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;super._renderPosition(),this._renderOverlayPosition(i),(t=this._actions)===null||t===void 0||(e=t.onPositioned)===null||e===void 0||e.call(t)}_renderOverlayPosition(t){this._resetOverlayPosition(t),this._updateContentSize(t);const e=this._getContainerPosition(),i=p.setup(this.$overlayContent(),e),o=this._getSideByLocation(i);this._togglePositionClass(`dx-position-${o}`),this._toggleFlippedClass(i.h.flip,i.v.flip),(this._isHorizontalSide()||this._isVerticalSide())&&this._renderArrowPosition(o)}_resetOverlayPosition(t){this._setContentHeight(t),this._togglePositionClass(`dx-position-${this._positionController._positionSide}`),G(this.$overlayContent(),{left:0,top:0}),this._$arrow.css({top:"auto",right:"auto",bottom:"auto",left:"auto"})}_updateContentSize(t){if(!this.$content()||!t)return;const e=p.calculate(this.$overlayContent(),this._getContainerPosition());if(e.h.oversize>0&&this._isHorizontalSide()&&!e.h.fit){const i=W(this.$overlayContent())-e.h.oversize;U(this.$overlayContent(),i)}if(e.v.oversize>0&&this._isVerticalSide()&&!e.v.fit){const i=y(this.$overlayContent())-e.v.oversize,o=y(this.$content())-e.v.oversize;I(this.$overlayContent(),i),I(this.$content(),o)}}_getContainerPosition(){return this._positionController._getContainerPosition()}_getHideOnParentScrollTarget(){var t;return c(((t=this._positionController._position)===null||t===void 0?void 0:t.of)||super._getHideOnParentScrollTarget())}_getSideByLocation(t){const e=t.v.flip,i=t.h.flip,o=this._isVerticalSide()&&e,s=this._isHorizontalSide()&&i,n=this._isPopoverInside(),r=o||s||n,a=this._positionController._positionSide;if(r&&a)return x[a];if(a)return a}_togglePositionClass(t){this.$wrapper().removeClass("dx-position-left dx-position-right dx-position-top dx-position-bottom").addClass(t)}_toggleFlippedClass(t,e){this.$wrapper().toggleClass("dx-popover-flipped-horizontal",t).toggleClass("dx-popover-flipped-vertical",e)}_renderArrowPosition(t){var e;const i=P(this._$arrow.get(0)),o=-(this._isVerticalSide(t)?i.height:i.width);this._$arrow.css(x[t],o);const s=this._isVerticalSide(t)?"left":"top",n=this._isVerticalSide(t)?"width":"height",r=c((e=this._positionController._position)===null||e===void 0?void 0:e.of),a=p.offset(r)??{top:0,left:0},h=p.offset(this.$overlayContent()),_=i[n],d=h==null?void 0:h[s],v=P(this.$overlayContent().get(0))[n],u=a[s],w=r.get(0),B=w&&!w.preventDefault?P(w)[n]:0,$=Math.max(d,u),O=Math.min(d+v,u+B);let f;const{arrowPosition:T}=this.option();T==="start"?f=$-d:T==="end"?f=O-d-_:f=($+O)/2-d-_/2;const E=this._positionController._getContentBorderWidth(t),{arrowOffset:D}=this.option(),L=R(f-E+D,E,v-_-2*E);this._$arrow.css(s,L)}_isPopoverInside(){return this._positionController._isPopoverInside()}_setContentHeight(t){t&&super._setContentHeight()}_getPositionControllerConfig(){const t=super._getPositionControllerConfig(),{shading:e,target:i}=this.option(),o=g({},t.properties,{target:i,shading:e}),s=g({},t.elements,{$arrow:this._$arrow});return{properties:o,elements:s}}_initPositionController(){this._positionController=new et(this._getPositionControllerConfig())}_renderWrapperDimensions(){this.option("shading")&&this.$wrapper().css({width:"100%",height:"100%"})}_isVerticalSide(t){return this._positionController._isVerticalSide(t)}_isHorizontalSide(t){return this._positionController._isHorizontalSide(t)}_clearEventTimeout(t){clearTimeout(this._timeouts[t])}_clearEventsTimeouts(){this._clearEventTimeout("show"),this._clearEventTimeout("hide")}_clean(){this._detachEvents(this.option("target")),super._clean.apply(this,arguments)}_optionChanged(t){const{name:e,value:i,previousValue:o}=t;switch(e){case"arrowPosition":case"arrowOffset":this._renderGeometry();break;case"fullScreen":i&&this.option("fullScreen",!1);break;case"target":o&&this._detachEvents(o),this._positionController.updateTarget(i),this._invalidate();break;case"showEvent":case"hideEvent":{const s=e.substring(0,4),n=this._getEventNameByOption(o);this.hide();const{target:r}=this.option();this._detachEvent(r,s,n),this._attachEvent(s);break}case"visible":this._clearEventTimeout(i?"show":"hide"),super._optionChanged(t);break;case"disabled":this._detachEvents(this.option("target")),this._attachEvents(),super._optionChanged(t);break;default:super._optionChanged(t)}}show(t){return t&&this.option("target",t),super.show()}}q("dxPopover",it);export{it as P};
