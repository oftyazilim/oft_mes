import{d as we,r as i,D as k,i as Q,b2 as K,c as v,m as V,b as n,e as s,f as r,F as ee,s as _e,p as T,V as z,az as Te,ay as De,aA as Se,l as Ce,o as m,x as xe}from"./main-Dh6YAbtd.js";import{m as Ee}from"./vue3-apexcharts-BVFBgcNi.js";import{V as Ae}from"./VRow-Dlb2a_Yu.js";import{V as f}from"./VCol-CqyCBbsI.js";import{V as le}from"./VCard-BKR0XACv.js";import{V as te}from"./VCardText-BfxFwl-E.js";import"./_commonjsHelpers-D6-XlEtG.js";/* empty css              */import"./createSimpleFunctional-zLu9_cFY.js";import"./VAvatar-BfzPBUW8.js";import"./VImg-BWwshrZ6.js";import"./index-Cqgfc0gq.js";const Ne={key:0,class:"loading-overlay"},Me={class:"summary-kpis px-4"},Ve={class:"kpi"},ze={class:"kpi"},Le={class:"kpi border-e pe-2"},Oe={class:"dash-actions mt-3"},Re=["disabled"],Pe={key:0},qe={key:1},Be={key:0,class:"last-updated"},Fe={key:1,class:"warn",title:"API geçici boş yanıt verdi; önceki veriler gösteriliyor"},Ie={key:2,class:"warn"},We={key:3,class:"hint"},je={class:"weekly-vertical ma-2"},Ge={key:0,class:"wv-bars"},Ye={class:"wv-stack"},Ke={key:1,class:"apex-weekly-wrap"},S=1e4,Ue=we({__name:"dash-bukum",setup($e){const U=i(["Üretimde süreklilik için proaktif bakım planı devrede","Operatör güvenliği: Koruyucu ekipman kontrolü yapılmalı","Enerji verimliliği izleniyor – gereksiz duruşları azaltın","Kalite ilk seferde doğru üretimle başlar","Anlık OEE analizi ile darboğazları tespit edin"]);k(()=>[...U.value,...U.value]);const h=i(0),ae=i(!1);let C=null;const se=[60,100,140,200],oe=i(2),ie=k(()=>se[oe.value]||140),ne=i(null),L=i(0),p=i(0);let x=0;k(()=>({transform:`translateX(${h.value}px)`,inlineSize:L.value+"px"}));function O(){const t=ne.value;if(!t)return;const e=t.querySelectorAll(".ticker-item");if(!e.length)return;const o=Math.floor(e.length/2);let a=0;for(let u=0;u<o;u++){const l=e[u];a+=l.offsetWidth,u<o-1&&(a+=42)}p.value=a,L.value=a*2,h.value<-p.value&&(h.value=(h.value%p.value+p.value)%p.value*-1)}function $(t){x||(x=t);const e=(t-x)/1e3;x=t,!ae.value&&L.value&&(h.value-=ie.value*e,p.value&&h.value<=-p.value&&(h.value+=p.value)),C=requestAnimationFrame($)}Q(()=>{requestAnimationFrame(()=>{O(),C=requestAnimationFrame($)}),window.addEventListener("resize",O)}),K(()=>{C&&cancelAnimationFrame(C)}),K(()=>{window.removeEventListener("resize",O)});const R=i([]),d=i({availability:0,performance:0,quality:1,oee:0}),H=i([]),P=i([]),re=i([]),b=i(!0),q=i(!1),E=i(!1),A=i(null),B=i(!1),F=i(!1),I=i(0),w=i(S),ue=i(null),de=k(()=>b.value&&!A.value),N=t=>isFinite(t)?`${Math.round(t*100)}%`:"-",ce=t=>{const e=t*100;return e<50?"oee-red":e<70?"oee-yellow":e<85?"oee-orange":"oee-green"},W=k(()=>{const t=[],e=new Date,a=(e.getDay()+6)%7,u=new Date(e);u.setHours(0,0,0,0),u.setDate(e.getDate()-a);const l=["Paz","Pzt","Sal","Çar","Per","Cum","Cmt"];for(let G=0;G<7;G++){const Y=new Date(u);Y.setDate(u.getDate()+G);const be=Y.toISOString().slice(0,10),ge=l[Y.getDay()]||"";t.push({date:be,label:ge,work:0,stop:0})}return t}),X=k(()=>{const t=new Map;for(const e of W.value)t.set(e.date,{...e});for(const e of P.value){const o=String(e.date);if(!t.has(o))continue;const a=t.get(o);t.set(o,{date:o,label:a.label,work:Number(e.work||0),stop:Number(e.stop||0)})}return W.value.map(e=>t.get(e.date)||e)}),ve=k(()=>[{name:"Çalışma",data:X.value.map(t=>t.work)},{name:"Duruş",data:X.value.map(t=>t.stop)}]),me=k(()=>({chart:{stacked:!0,toolbar:{show:!1},foreColor:"#cfd8dc",width:"100%"},plotOptions:{bar:{horizontal:!1,columnWidth:"70%",borderRadius:4}},dataLabels:{enabled:!1},grid:{strokeDashArray:3,borderColor:"rgba(255,255,255,0.08)"},xaxis:{categories:W.value.map(t=>t.label)},yaxis:{labels:{formatter:t=>`${Math.round(t)}`},title:{text:"dk"}},tooltip:{shared:!0,intersect:!1},colors:["#189c49","#efb803"]}));let g=null;const _=i(null);async function fe(t){var e;try{R.value.length===0?b.value=!0:E.value=!0,g&&(clearTimeout(g),g=null),g=window.setTimeout(()=>{q.value=!0},2500),_.value=null;const{data:a}=await _e.get("/api/dash-bukum/overview",{signal:t,timeout:1e4});console.log("API veri:",a);const u=((a==null?void 0:a.machines)||[]).map(l=>({id:Number(l.id),name:String(l.name??""),operator:l.operator||void 0,breakDescription:l.break_description??l.breakDescription??l.break_desc??void 0,statuTime:l.statu_time??l.statuTime??void 0,itemCode:l.itemCode??l.item_code??void 0,itemName:l.itemName??l.item_name??void 0,counter:l.counter!==void 0&&l.counter!==null?Number(l.counter):void 0,status:l.status??"stopped",availability:Number(l.availability)||0,performance:Number(l.performance)||0,quality:Number(l.quality)||1,oee:Number(l.oee)||0,workRatio:Number(l.workRatio)||0,stopRatio:Number(l.stopRatio)||0,code:l.code||"",segments:Array.isArray(l.segments)?l.segments:Array.isArray(l.barData)?l.barData:Array.isArray(l.timeline)?l.timeline:void 0}));ue.value=(a==null?void 0:a.meta)||null,u.length===0?R.value.length===0?B.value=!0:F.value=!0:(R.value=u,B.value=!1,F.value=!1),d.value=(a==null?void 0:a.daySummary)||d.value,H.value=(a==null?void 0:a.reasons)||H.value,P.value=(a==null?void 0:a.weekly)||P.value,re.value=((a==null?void 0:a.weeklyCounts)||(a==null?void 0:a.weekly_counts)||[]).map(l=>({date:String(l.date),label:String(l.label??""),count:Number(l.count??0)})),A.value=new Date,I.value=0,w.value=S}catch(o){I.value+=1,w.value=Math.min(S*Math.pow(2,I.value),6e4);const a=(e=o==null?void 0:o.response)==null?void 0:e.status;a===401?_.value="Yetki hatası (401).":a===404?_.value="Endpoint bulunamadı (404).":a===500?_.value="Sunucu hatası (500).":(o==null?void 0:o.code)==="ECONNABORTED"?_.value="Zaman aşımı.":(o==null?void 0:o.name)==="CanceledError"||(o==null?void 0:o.message)==="canceled"||(_.value="Beklenmeyen hata.")}finally{b.value=!1,E.value=!1,g&&(clearTimeout(g),g=null),q.value&&setTimeout(()=>{q.value=!1},400)}}const pe=S;let c=null,M=!1,y=null;function D(t=w.value){c&&clearTimeout(c),c=window.setTimeout(Z,t)}async function Z(){if(document.hidden){D(Math.max(3e4,w.value));return}if(M){D(500);return}M=!0,y&&y.abort(),y=new AbortController;try{await fe(y.signal)}finally{M=!1,D(pe)}}function J(){document.hidden?(y&&y.abort(),c&&(clearTimeout(c),c=null)):D(0)}function ye(){M||(c&&(clearTimeout(c),c=null),D(0))}function ke(t){return t?t.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}const he=i(Date.now());let j=null;return Q(async()=>{document.addEventListener("visibilitychange",J),await Z(),j=window.setInterval(()=>{he.value=Date.now()},1e3)}),K(()=>{document.removeEventListener("visibilitychange",J),y&&y.abort(),c&&clearTimeout(c),j&&clearInterval(j)}),(t,e)=>(m(),v(ee,null,[de.value?(m(),v("div",Ne,e[0]||(e[0]=[s("div",{class:"loader-box"},[s("div",{class:"spinner","aria-hidden":"true"}),s("h2",null,"Veriler yükleniyor"),s("p",null,"Makine durumları, OEE ve haftalık istatistikler getiriliyor. Lütfen bekleyin…")],-1)]))):V("",!0),n(Ae,{class:"match-height"},{default:r(()=>[n(f,{cols:"12",md:"4"},{default:r(()=>[n(le,{height:"260"},{default:r(()=>[n(te,null,{default:r(()=>e[1]||(e[1]=[s("h5",{class:"text-h5"},"Günlük Genel Değerlendirme",-1)])),_:1,__:[1]}),s("div",Me,[s("div",Ve,[e[2]||(e[2]=s("span",null,"Uyg.",-1)),s("strong",null,T(N(d.value.availability)),1),n(z,{"model-value":d.value.availability*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",ze,[e[3]||(e[3]=s("span",null,"Perf.",-1)),s("strong",null,T(N(d.value.performance)),1),n(z,{"model-value":d.value.performance*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",Le,[e[4]||(e[4]=s("span",null,"Kalite",-1)),s("strong",null,T(N(d.value.quality)),1),n(z,{"model-value":d.value.quality*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",{class:Te(["kpi oee",ce(d.value.oee)])},[e[5]||(e[5]=s("span",null,"OEE",-1)),s("strong",null,T(N(d.value.oee)),1),n(z,{"model-value":d.value.oee*100,color:"success",height:"10"},null,8,["model-value"])],2)]),s("div",Oe,[s("button",{class:"refresh-btn",onClick:ye,disabled:E.value||b.value},[E.value?(m(),v("span",Pe,"⟳ Yenileniyor...")):(m(),v("span",qe,"⟳ Yenile"))],8,Re),A.value?(m(),v("small",Be,"Güncellendi: "+T(ke(A.value)),1)):V("",!0),F.value?(m(),v("small",Fe,"Geçici boş yanıt")):B.value&&!b.value?(m(),v("small",Ie,"Veri yok")):V("",!0),w.value>S&&!b.value?(m(),v("small",We,"Bekleme: "+T(Math.round(w.value/1e3))+"sn",1)):V("",!0)])]),_:1})]),_:1}),n(f,{cols:"12",md:"4",sm:"6"},{default:r(()=>[n(le,{height:"260"},{default:r(()=>[n(te,null,{default:r(()=>e[6]||(e[6]=[s("h5",{class:"text-h5"},"Haftalık Çalışma / Duruş (dk)",-1)])),_:1,__:[6]}),s("div",je,[b.value?(m(),v("div",Ge,[(m(),v(ee,null,De(7,o=>s("div",{key:"wv-skel-"+o,class:"wv-col"},[s("div",Ye,[s("div",{class:"wv-fill sk-fill",style:Se({blockSize:20+o*6+"%"})},null,4)]),e[7]||(e[7]=s("div",{class:"wv-day"}," ",-1))])),64))])):(m(),v("div",Ke,[n(Ce(Ee),{class:"wv-chart",type:"bar",width:"100%",height:"230",options:me.value,series:ve.value},null,8,["options","series"])]))])]),_:1})]),_:1}),n(f,{cols:"12",md:"3",sm:"6"},{default:r(()=>e[8]||(e[8]=[s("h1",null,"Sales Overview",-1)])),_:1,__:[8]}),n(f,{cols:"12",md:"6"},{default:r(()=>e[9]||(e[9]=[s("h1",null,"Earning Reports Weekly Overview",-1)])),_:1,__:[9]}),n(f,{cols:"12",md:"6"},{default:r(()=>e[10]||(e[10]=[s("h1",null,"Support Tracker",-1)])),_:1,__:[10]}),n(f,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[11]||(e[11]=[s("h1",null,"Sales by Countries",-1)])),_:1,__:[11]}),n(f,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[12]||(e[12]=[s("h1",null,"Total Earning",-1)])),_:1,__:[12]}),n(f,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[13]||(e[13]=[s("h1",null,"Monthly Campaign State",-1)])),_:1,__:[13]}),n(f,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[14]||(e[14]=[s("h1",null,"Source Visits",-1)])),_:1,__:[14]}),n(f,{cols:"12",lg:"8"},{default:r(()=>e[15]||(e[15]=[s("h1",null,"pjjjpjpjpo",-1)])),_:1,__:[15]})]),_:1})],64))}}),nl=xe(Ue,[["__scopeId","data-v-4bb1e6a9"]]);export{nl as default};
