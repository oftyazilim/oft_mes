import{d as Be,r as c,D as O,i as ce,b2 as Q,c as n,m as d,e as s,p as r,az as q,F as p,ay as f,aA as v,s as Le,ao as Fe,aF as ee,o,x as He}from"./main-DopL9iyZ.js";const Oe={class:"dash-container"},qe={key:0,class:"loading-overlay"},Pe={class:"dash-header"},Ie={class:"header-left"},Ve={class:"summary-card stretch"},Ke={class:"summary-kpis"},We={class:"kpi"},Ge={class:"kpi"},Ue={class:"kpi"},Ye={class:"dash-actions mt-3"},je=["disabled"],Xe={key:0},Ze={key:1},Je={key:0,class:"last-updated"},Qe={key:1,class:"warn",title:"API geçici boş yanıt verdi; önceki veriler gösteriliyor"},et={key:2,class:"warn"},tt={key:3,class:"hint"},st={class:"header-right"},at={class:"weekly-card"},lt={class:"weekly-vertical mt-2"},it={class:"wv-bars"},nt={class:"wv-stack"},ot=["title"],rt={key:0,class:"wv-val"},ut={key:0,class:"wv-val"},ct={class:"wv-day"},dt={class:"weekly-count-card"},vt={class:"weekly-vertical mt-2"},kt={class:"wvc-bars"},mt={class:"wvc-stack"},pt=["title"],ft={key:0,class:"wvc-label"},yt={class:"wvc-day"},bt={class:"cards-grid"},ht={class:"names"},gt={class:"machine-name",style:{"font-size":"20px"}},_t={class:"machine-name"},wt={class:"mb-1"},St={key:0,class:"operator-name"},Mt={class:"duration pe-3"},Tt={key:0,class:"meta-row"},xt={class:"meta-left"},Ct={key:0,class:"pill code"},zt={key:1,class:"meta-name"},Dt={key:0,class:"meta-right"},Nt={class:"kpi-row"},At={class:"kpi-item"},Et={class:"kpi-item"},$t={class:"kpi-item"},Rt={class:"mini-bars"},Bt={key:0,class:"multi-bar"},Lt=["title"],Ft={key:1,class:"multi-bar",title:"Çalışma/Duruş oranı"},Ht={key:2,class:"status-extra"},Ot={class:"extra-right"},qt=["title"],Pt={class:"charts-grid"},It={class:"chart-card"},Vt={key:0,class:"alert error mt-2"},Kt={class:"msg"},Wt={key:1,class:"alert empty mt-2"},Gt={key:2,class:"reason-bars mt-2"},Ut={class:"bar"},Yt={key:3,class:"reason-bars mt-2"},jt={class:"row-label"},Xt={class:"bar mt-2"},Zt={class:"value"},Jt={class:"chart-card ticker-card","aria-label":"Bilgilendirme akışı"},Qt={key:0,class:"ticker-hint"},es={class:"ticker-controls"},ts=["onClick","title"],z=1e4,ss=Be({__name:"dash-bukum-bak",setup(as){const te=c(["Üretimde süreklilik için proaktif bakım planı devrede","Operatör güvenliği: Koruyucu ekipman kontrolü yapılmalı","Enerji verimliliği izleniyor – gereksiz duruşları azaltın","Kalite ilk seferde doğru üretimle başlar","Anlık OEE analizi ile darboğazları tespit edin"]),de=O(()=>[...te.value,...te.value]),_=c(0),D=c(!1);let N=null;const se=[60,100,140,200],P=c(2),ve=O(()=>se[P.value]||140),ae=c(null),I=c(0),y=c(0);let A=0;const ke=O(()=>({transform:`translateX(${_.value}px)`,inlineSize:I.value+"px"}));function V(){const a=ae.value;if(!a)return;const t=a.querySelectorAll(".ticker-item");if(!t.length)return;const e=Math.floor(t.length/2);let l=0;for(let u=0;u<e;u++){const i=t[u];l+=i.offsetWidth,u<e-1&&(l+=42)}y.value=l,I.value=l*2,_.value<-y.value&&(_.value=(_.value%y.value+y.value)%y.value*-1)}function le(a){A||(A=a);const t=(a-A)/1e3;A=a,!D.value&&I.value&&(_.value-=ve.value*t,y.value&&_.value<=-y.value&&(_.value+=y.value)),N=requestAnimationFrame(le)}ce(()=>{requestAnimationFrame(()=>{V(),N=requestAnimationFrame(le)}),window.addEventListener("resize",V)}),Q(()=>{N&&cancelAnimationFrame(N)}),Q(()=>{window.removeEventListener("resize",V)});const E=c([]),w=c({availability:0,performance:0,quality:1,oee:0}),K=c([]),$=c([]),W=c([]),k=c(!0),G=c(!1),R=c(!1),B=c(null),L=c(!1),U=c(!1),Y=c(0),M=c(z),me=c(null),pe=O(()=>k.value&&!B.value),b=a=>isFinite(a)?`${Math.round(a*100)}%`:"-",ie=a=>{const t=a*100;return t<50?"oee-red":t<70?"oee-yellow":t<85?"oee-orange":"oee-green"},fe=a=>`${Math.min(100,a)}%`,ye=()=>Math.max(1,...$.value.map(a=>a.work+a.stop)),ne=a=>`${Math.round(a/ye()*100)}%`,be=()=>Math.max(1,...W.value.map(a=>a.count)),he=a=>`${Math.round(a/be()*100)}%`;function F(a){const t=Math.max(0,Math.min(100,Number(a.workRatio)||0)),e=Math.max(0,Math.min(100,Number(a.stopRatio)||0)),l=t+e;if(l>100){const i=100/l,T=Math.round(t*i*100)/100,C=Math.round(e*i*100)/100;return{work:T,stop:C,remain:0}}const u=Math.max(0,100-l);return{work:Math.round(t*100)/100,stop:Math.round(e*100)/100,remain:Math.round(u*100)/100}}const ge={calisma:"#189c49",running:"#189c49",work:"#189c49",durus:"#efb803",stopped:"#efb803",stop:"#efb803",ayar:"#a59ef7",mola:"#f4b73f",kalan:"lightgray",offline:"#9e9e9e"};function j(a){const t={running:"calisma",work:"calisma",stopped:"durus",stop:"durus",setup:"ayar",break:"mola",idle:"kalan"},e=(a||"").toLowerCase();return t[e]||e}function _e(a){return a.reduce((t,e)=>t+(Number(e.duration)||0),0)||0}function we(a,t=20){return a.length>t?a.slice(0,t)+"…":a}function Se(a,t){const e=Math.max(1,_e(t)),l=Math.max(0,(Number(a.duration)||0)/e*100),u=ge[j(String(a.type))]||"#888";return{inlineSize:`${l}%`,backgroundColor:u,borderRadius:"999px"}}function Me(a,t){const e=j(String(a.type));return e==="calisma"?t.itemName||t.itemCode||"Çalışıyor":e==="durus"?a.reason||a.sebep||a.code||"Duruyor":{calisma:"Çalışma",durus:"Duruş",ayar:"Ayar",mola:"Mola",kalan:"Kalan",offline:"Kapalı"}[e]||String(a.type)}function Te(a){return a==="running"?"var(--v-theme-success, #22c55e)":a==="stopped"?"var(--v-theme-warning, #fb923c)":"var(--v-theme-on-surface-variant, #9e9e9e)"}function xe(a){const t=Te(a.status),e=a.status==="running"?"#298e4e":a.status==="stopped"?"#cc3f3f":"#605050",l=Ce(e,.26);return{background:`color-mix(in oklab, ${t} 26%, #000)`,backgroundColor:l}}function Ce(a,t){const{r:e,g:l,b:u}=ze(a),i=Math.round(e*(1-t)),T=Math.round(l*(1-t)),C=Math.round(u*(1-t));return De(i,T,C)}function ze(a){let t=a.replace("#","");t.length===3&&(t=t.split("").map(l=>l+l).join(""));const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:e&255}}function De(a,t,e){const l=u=>u.toString(16).padStart(2,"0");return`#${l(a)}${l(t)}${l(e)}`}let S=null;const h=c(null);async function Ne(a){var t;try{E.value.length===0?k.value=!0:R.value=!0,S&&(clearTimeout(S),S=null),S=window.setTimeout(()=>{G.value=!0},2500),h.value=null;const{data:l}=await Le.get("/api/dash-bukum/overview",{signal:a,timeout:1e4});console.log("API veri:",l);const u=((l==null?void 0:l.machines)||[]).map(i=>({id:Number(i.id),name:String(i.name??""),operator:i.operator||void 0,breakDescription:i.break_description??i.breakDescription??i.break_desc??void 0,statuTime:i.statu_time??i.statuTime??void 0,itemCode:i.itemCode??i.item_code??void 0,itemName:i.itemName??i.item_name??void 0,counter:i.counter!==void 0&&i.counter!==null?Number(i.counter):void 0,status:i.status??"stopped",availability:Number(i.availability)||0,performance:Number(i.performance)||0,quality:Number(i.quality)||1,oee:Number(i.oee)||0,workRatio:Number(i.workRatio)||0,stopRatio:Number(i.stopRatio)||0,code:i.code||"",segments:Array.isArray(i.segments)?i.segments:Array.isArray(i.barData)?i.barData:Array.isArray(i.timeline)?i.timeline:void 0}));me.value=(l==null?void 0:l.meta)||null,u.length===0?E.value.length===0?L.value=!0:U.value=!0:(E.value=u,L.value=!1,U.value=!1),w.value=(l==null?void 0:l.daySummary)||w.value,K.value=(l==null?void 0:l.reasons)||K.value,$.value=(l==null?void 0:l.weekly)||$.value,W.value=((l==null?void 0:l.weeklyCounts)||(l==null?void 0:l.weekly_counts)||[]).map(i=>({date:String(i.date),label:String(i.label??""),count:Number(i.count??0)})),B.value=new Date,Y.value=0,M.value=z}catch(e){Y.value+=1,M.value=Math.min(z*Math.pow(2,Y.value),6e4);const l=(t=e==null?void 0:e.response)==null?void 0:t.status;l===401?h.value="Yetki hatası (401).":l===404?h.value="Endpoint bulunamadı (404).":l===500?h.value="Sunucu hatası (500).":(e==null?void 0:e.code)==="ECONNABORTED"?h.value="Zaman aşımı.":(e==null?void 0:e.name)==="CanceledError"||(e==null?void 0:e.message)==="canceled"||(h.value="Beklenmeyen hata.")}finally{k.value=!1,R.value=!1,S&&(clearTimeout(S),S=null),G.value&&setTimeout(()=>{G.value=!1},400)}}const Ae=z;let m=null,H=!1,g=null;function x(a=M.value){m&&clearTimeout(m),m=window.setTimeout(oe,a)}async function oe(){if(document.hidden){x(Math.max(3e4,M.value));return}if(H){x(500);return}H=!0,g&&g.abort(),g=new AbortController;try{await Ne(g.signal)}finally{H=!1,x(Ae)}}function re(){document.hidden?(g&&g.abort(),m&&(clearTimeout(m),m=null)):x(0)}function X(){H||(m&&(clearTimeout(m),m=null),x(0))}function Ee(a){return a?a.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}const ue=c(Date.now());let Z=null;function $e(a){if(a==null)return null;if(typeof a=="number")return a>1e12||a>1e10?a:Math.round(a*1e3);const e=(a instanceof Date?a:new Date(String(a))).getTime();return Number.isFinite(e)?e:null}function Re(a){const t=$e(a);if(!t)return"-";let e=Math.max(0,Math.floor((ue.value-t)/1e3));const l=Math.floor(e/3600);e%=3600;const u=Math.floor(e/60),i=e%60,T=C=>String(C).padStart(2,"0");return l>0?`${l}h ${T(u)}m`:u>0?`${u}m ${T(i)}s`:`${i}s`}function J(a){var e;if(a.breakDescription)return String(a.breakDescription);const t=Array.isArray(a.segments)?a.segments:[];for(let l=t.length-1;l>=0;l--)if(j(String((e=t[l])==null?void 0:e.type))==="durus"){const i=t[l].reason||t[l].sebep||t[l].code;if(i)return String(i)}}return ce(async()=>{document.addEventListener("visibilitychange",re),await oe(),Z=window.setInterval(()=>{ue.value=Date.now()},1e3)}),Q(()=>{document.removeEventListener("visibilitychange",re),g&&g.abort(),m&&clearTimeout(m),Z&&clearInterval(Z)}),(a,t)=>(o(),n("div",Oe,[pe.value?(o(),n("div",qe,t[2]||(t[2]=[s("div",{class:"loader-box"},[s("div",{class:"spinner","aria-hidden":"true"}),s("h2",null,"Veriler yükleniyor"),s("p",null,"Makine durumları, OEE ve haftalık istatistikler getiriliyor. Lütfen bekleyin…")],-1)]))):d("",!0),s("header",Pe,[s("div",Ie,[t[8]||(t[8]=s("div",{class:"title-block ms-4"},[s("h1",null,"Büküm Dashboard")],-1)),s("div",Ve,[t[7]||(t[7]=s("div",{class:"summary-title"},"Günlük Genel Değerlendirme",-1)),s("div",Ke,[s("div",We,[t[3]||(t[3]=s("span",null,"Uyg.",-1)),s("strong",null,r(b(w.value.availability)),1)]),s("div",Ge,[t[4]||(t[4]=s("span",null,"Perf.",-1)),s("strong",null,r(b(w.value.performance)),1)]),s("div",Ue,[t[5]||(t[5]=s("span",null,"Kalite",-1)),s("strong",null,r(b(w.value.quality)),1)]),s("div",{class:q(["kpi oee",ie(w.value.oee)])},[t[6]||(t[6]=s("span",null,"OEE",-1)),s("strong",null,r(b(w.value.oee)),1)],2)]),s("div",Ye,[s("button",{class:"refresh-btn",onClick:X,disabled:R.value||k.value},[R.value?(o(),n("span",Xe,"⟳ Yenileniyor...")):(o(),n("span",Ze,"⟳ Yenile"))],8,je),B.value?(o(),n("small",Je,"Güncellendi: "+r(Ee(B.value)),1)):d("",!0),U.value?(o(),n("small",Qe,"Geçici boş yanıt")):L.value&&!k.value?(o(),n("small",et,"Veri yok")):d("",!0),M.value>z&&!k.value?(o(),n("small",tt,"Bekleme: "+r(Math.round(M.value/1e3))+"sn",1)):d("",!0)])])]),s("div",st,[s("div",at,[t[10]||(t[10]=s("h4",null,"Haftalık Çalışma / Duruş (dk)",-1)),s("div",lt,[s("div",it,[k.value?(o(),n(p,{key:0},f(7,e=>s("div",{key:"wv-skel-"+e,class:"wv-col"},[s("div",nt,[s("div",{class:"wv-fill sk-fill",style:v({blockSize:20+e*6+"%"})},null,4)]),t[9]||(t[9]=s("div",{class:"wv-day"}," ",-1))])),64)):(o(!0),n(p,{key:1},f($.value,e=>(o(),n("div",{key:e.date,class:"wv-col"},[s("div",{class:"wv-stack",title:e.work+" dk çalışma / "+e.stop+" dk duruş"},[s("div",{class:"wv-seg work",style:v({blockSize:ne(e.work)}),title:"Çalışma"},[e.work>0?(o(),n("span",rt,r(e.work),1)):d("",!0)],4),s("div",{class:"wv-seg stop",style:v({blockSize:ne(e.stop)}),title:"Duruş"},[e.stop>0?(o(),n("span",ut,r(e.stop),1)):d("",!0)],4)],8,ot),s("div",ct,r(e.label),1)]))),128))])])]),s("div",dt,[t[12]||(t[12]=s("h4",null,"Haftalık Sayaç (adet)",-1)),s("div",vt,[s("div",kt,[k.value?(o(),n(p,{key:0},f(7,e=>s("div",{key:"wvc-skel-"+e,class:"wvc-col"},[s("div",mt,[s("div",{class:"wvc-fill sk-fill",style:v({blockSize:20+e*4+"%"})},null,4)]),t[11]||(t[11]=s("div",{class:"wvc-day"}," ",-1))])),64)):(o(!0),n(p,{key:1},f(W.value,e=>(o(),n("div",{key:e.date,class:"wvc-col"},[s("div",{class:"wvc-stack",title:e.count+" adet"},[s("div",{class:"wvc-bar",style:v({blockSize:he(e.count)}),title:"Adet"},[e.count>0?(o(),n("span",ft,r(e.count),1)):d("",!0)],4)],8,pt),s("div",yt,r(e.label),1)]))),128))])])])])]),s("section",bt,[k.value?(o(),n(p,{key:0},f(6,e=>s("article",{key:"skeleton-"+e,class:"machine-card skeleton"},t[13]||(t[13]=[Fe('<div class="card-top" data-v-215eb195><div class="names" data-v-215eb195><div class="sk-line w-60" data-v-215eb195></div><div class="sk-line w-40 mt-1" data-v-215eb195></div></div><div class="status" data-v-215eb195><span class="dot" data-v-215eb195></span><span class="sk-line w-20" data-v-215eb195></span></div></div><div class="kpi-row" data-v-215eb195><div class="kpi-item" data-v-215eb195><div class="sk-line w-60" data-v-215eb195></div><div class="sk-line w-40 mt-1" data-v-215eb195></div></div><div class="kpi-item" data-v-215eb195><div class="sk-line w-60" data-v-215eb195></div><div class="sk-line w-40 mt-1" data-v-215eb195></div></div><div class="kpi-item" data-v-215eb195><div class="sk-line w-60" data-v-215eb195></div><div class="sk-line w-40 mt-1" data-v-215eb195></div></div><div class="kpi-item" data-v-215eb195><div class="sk-line w-60" data-v-215eb195></div><div class="sk-line w-40 mt-1" data-v-215eb195></div></div></div><div class="mini-bars" data-v-215eb195><div class="multi-bar" data-v-215eb195><div class="multi-seg sk-fill" style="inline-size:65%;" data-v-215eb195></div><div class="multi-seg sk-fill" style="inline-size:20%;" data-v-215eb195></div><div class="multi-seg sk-fill" style="inline-size:15%;" data-v-215eb195></div></div></div>',3)]))),64)):(o(!0),n(p,{key:1},f(E.value,e=>(o(),n("article",{key:e.id,class:"machine-card"},[s("div",{class:"card-top",style:v(xe(e))},[s("div",ht,[s("h3",gt,[ee(r(e.code)+" - ",1),s("span",_t,r(we(e.name,35)),1)]),s("p",wt,[t[14]||(t[14]=ee("Operatör: ")),e.operator?(o(),n("span",St,r(e.operator),1)):d("",!0)])]),s("div",{class:q(["status",e.status])},[s("span",Mt,r(Re(e.statuTime)),1),t[15]||(t[15]=s("span",{class:"dot"},null,-1))],2)],4),e.itemCode||e.itemName||e.counter!==void 0?(o(),n("div",Tt,[s("div",xt,[e.itemCode?(o(),n("span",Ct,r(e.itemCode),1)):d("",!0),e.itemName?(o(),n("span",zt,r(e.itemName),1)):d("",!0)]),e.counter!==void 0?(o(),n("div",Dt,[t[16]||(t[16]=ee("Sayaç: ")),s("strong",null,r(e.counter),1)])):d("",!0)])):d("",!0),s("div",Nt,[s("div",At,[t[17]||(t[17]=s("span",null,"Uygulanabilirlik",-1)),s("strong",null,r(b(e.availability)),1)]),s("div",Et,[t[18]||(t[18]=s("span",null,"Performans",-1)),s("strong",null,r(b(e.performance)),1)]),s("div",$t,[t[19]||(t[19]=s("span",null,"Kalite",-1)),s("strong",null,r(b(e.quality)),1)]),s("div",{class:q(["kpi-item oee",ie(e.oee)])},[t[20]||(t[20]=s("span",null,"OEE",-1)),s("strong",null,r(b(e.oee)),1)],2)]),s("div",Rt,[e.segments&&e.segments.length?(o(),n("div",Bt,[(o(!0),n(p,null,f(e.segments,(l,u)=>(o(),n("div",{key:e.id+"-seg-"+u,class:"multi-seg",style:v(Se(l,e.segments)),title:Me(l,e)},null,12,Lt))),128))])):(o(),n("div",Ft,[s("div",{class:"multi-seg work",style:v({inlineSize:F(e).work+"%"}),title:"Çalışma"},null,4),s("div",{class:"multi-seg stop",style:v({inlineSize:F(e).stop+"%"}),title:"Duruş"},null,4),F(e).remain>0?(o(),n("div",{key:0,class:"multi-seg remain",style:v({inlineSize:F(e).remain+"%"}),title:"Kalan"},null,4)):d("",!0)])),e.status==="stopped"&&J(e)?(o(),n("div",Ht,[s("div",Ot,[t[21]||(t[21]=s("span",null,"Sebep: ",-1)),s("span",{class:"value reason",title:J(e)},r(J(e)),9,qt)])])):d("",!0)])]))),128))]),s("section",Pt,[s("div",It,[t[26]||(t[26]=s("h4",null,"Duruş Sebepleri (Süre)",-1)),h.value?(o(),n("div",Vt,[t[22]||(t[22]=s("strong",null,"Veri alınamadı:",-1)),s("span",Kt,r(h.value),1),s("button",{class:"retry-btn",onClick:X},"Tekrar Dene")])):L.value&&!k.value?(o(),n("div",Wt,[t[23]||(t[23]=s("span",null,"Henüz veri yok.",-1)),s("button",{class:"retry-btn subtle",onClick:X},"Yenile")])):d("",!0),k.value?(o(),n("div",Gt,[(o(),n(p,null,f(5,e=>s("div",{key:"rs-"+e,class:"reason-row"},[t[24]||(t[24]=s("div",{class:"row-label"},[s("div",{class:"sk-line w-40"})],-1)),s("div",Ut,[s("div",{class:"fill sk-fill",style:v({width:100-e*12+"%"})},null,4)]),t[25]||(t[25]=s("div",{class:"value"},[s("div",{class:"sk-line w-20 ml-auto"})],-1))])),64))])):(o(),n("div",Yt,[(o(!0),n(p,null,f(K.value,e=>(o(),n("div",{key:e.name,class:"reason-row"},[s("div",jt,r(e.name),1),s("div",Xt,[s("div",{class:"fill reason",style:v({width:fe(e.minutes)})},null,4)]),s("div",Zt,r(e.minutes)+" dk",1)]))),128))]))]),s("div",Jt,[t[27]||(t[27]=s("h4",null,"Canlı Akış",-1)),s("div",{class:"ticker-shell",onMouseenter:t[0]||(t[0]=e=>D.value=!0),onMouseleave:t[1]||(t[1]=e=>D.value=!1)},[s("div",{class:"ticker-track",style:v(ke.value),ref_key:"tickerTrackEl",ref:ae},[(o(!0),n(p,null,f(de.value,(e,l)=>(o(),n("span",{key:"tk-"+l,class:"ticker-item"},r(e),1))),128))],4)],32),D.value?d("",!0):(o(),n("small",Qt,"Üzerine gelince durur")),s("div",es,[(o(),n(p,null,f(se,(e,l)=>s("button",{key:"sp-"+e,class:q(["speed-btn",{active:P.value===l}]),onClick:u=>P.value=l,title:e+" px/sn"},r(e),11,ts)),64))])])])]))}}),is=He(ss,[["__scopeId","data-v-215eb195"]]);export{is as default};
