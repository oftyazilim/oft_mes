import{d as M,r as d,cx as N,X as C,bg as U,c as Y,b as n,f as m,o as A,t as o,e as l,ae as h,d3 as F,x as B,v as x}from"./main-DnpAGNqn.js";import{u as X}from"./pageTitle-CtaiwNa2.js";import{V as j,b as J,d as Q}from"./VCard-Cg69DJDN.js";import{V as Z}from"./VCardText-Bs6WdY43.js";import{V as ee}from"./VSelect-DBcbGfn1.js";import{V as te}from"./VTextField-DAGBGwGu.js";import{V as O}from"./VDivider-BwS-spH5.js";import{V as ae}from"./VChip-CLLe59th.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VAvatar-CsZfNcOZ.js";import"./VImg-Ce65q7r2.js";import"./form-aJjKEqR1.js";import"./forwardRefs-C-GTDzx5.js";import"./VList-zsuiivE3.js";import"./ssrBoot--n5eGGNZ.js";import"./dialog-transition-CI7_de3x.js";import"./easing-Bybner-F.js";import"./VMenu-CYE27Zks.js";import"./VOverlay-6_SLVxrh.js";import"./delay-DYnsdEP-.js";import"./lazy-CeUEeR93.js";import"./scopeId-dKSq_F92.js";import"./VCheckboxBtn-BcRiKjpR.js";import"./VSelectionControl-D6jCOpOV.js";import"./focus-Dwg9QRHH.js";/* empty css                   */import"./VCounter-C2sJAJhW.js";import"./VField-Drn2Cy1R.js";import"./VInput-Ca9o50wa.js";import"./VSlideGroup-ChPCJwy9.js";const se={class:"pa-4"},ne={class:"d-flex flex-wrap gap-4 align-center"},re={class:"d-flex align-center gap-6 my-4"},ie={class:"mt-4 d-flex flex-column gap-2"},oe=M({__name:"seri-port",setup(ue){X().setTitle("Seri Port (CH340)");const c=d(""),p=d(""),W=[9600,19200,38400,57600,115200],k=d(9600),S=d(!1),f=d(!1),u=N({switchOn:!1,machineRun:!1,pulse:!1}),_=d(0),P=d(!1),g=d(""),z=C(()=>u.switchOn?"status-green":"status-gray"),G=C(()=>u.machineRun?"status-green":"status-gray"),$=C(()=>u.pulse?"status-blue":"status-gray");let a=null,r=null,T=null,y=null;const R=new TextEncoder,D=new TextDecoder;function H(){return typeof navigator<"u"&&"serial"in navigator}async function K(){if(!H()){c.value+=`
Tarayıcı Web Serial desteklemiyor. Lütfen Chrome/Edge kullanın ve HTTPS üzerinden bağlanın.`;return}try{S.value=!0,a=await navigator.serial.requestPort({filters:[]}),await a.open({baudRate:k.value});const e=new TransformStream({transform(i,b){b.enqueue(R.encode(i))}}),s=a.writable;if(!s)throw new Error("Yazma akışı yok");T=e.writable.getWriter(),e.readable.pipeTo(s).catch(()=>{});const w=new TransformStream({transform(i,b){b.enqueue(D.decode(i,{stream:!0}))}}),v=a.readable;if(!v)throw new Error("Okuma akışı yok");y=new AbortController,r=v.pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform(i,b){b.enqueue(String(i))}})).getReader({signal:y.signal}),f.value=!0,c.value+=`
Bağlandı: ${String(a)}`,q().catch(i=>{c.value+=`
Okuma hatası: ${(i==null?void 0:i.message)||i}`,V()})}catch(t){c.value+=`
Bağlanılamadı: ${(t==null?void 0:t.message)||t}`}finally{S.value=!1}}async function q(){for(;f.value&&r;){const{value:t,done:e}=await r.read();if(e)break;t&&I(String(t))}}async function E(){try{if(!f.value||!T)return;const t=p.value.endsWith(`
`)?p.value:`${p.value}
`,e=R.encode(t),s=a==null?void 0:a.writable;if(!s)return;const w=s.getWriter();await w.write(e),w.releaseLock(),p.value=""}catch(t){c.value+=`
Gönderme hatası: ${(t==null?void 0:t.message)||t}`}}async function V(){var t;try{f.value=!1,y==null||y.abort(),await(r==null?void 0:r.cancel().catch(()=>{})),r==null||r.releaseLock();const e=await((t=a==null?void 0:a.getSignals)==null?void 0:t.call(a));await(a==null?void 0:a.close()),c.value+=`
Bağlantı kesildi.`}catch(e){c.value+=`
Kapatma hatası: ${(e==null?void 0:e.message)||e}`}finally{r=null,T=null,a=null}}U(()=>{f.value&&V()});function I(t){for(g.value+=t;;){const e=g.value.indexOf("#");if(e===-1)break;const s=g.value.slice(0,e);g.value=g.value.slice(e+1),L(s)}}function L(t){const e=t.trim().split("|");if(e.length<8)return;const s=e[0].trim()==="1",w=e[1].trim()==="1",v=e[6].trim()==="1";u.switchOn=s,u.machineRun=w,v&&!P.value&&(_.value+=1),u.pulse=v,P.value=v}return(t,e)=>(A(),Y("div",se,[n(j,null,{default:m(()=>[n(J,null,{default:m(()=>e[2]||(e[2]=[o("Seri Port (Web Serial) - CH340/Arduino")])),_:1,__:[2]}),n(Q,null,{default:m(()=>e[3]||(e[3]=[o(" - Chrome/Edge (HTTPS veya localhost) gerektirir. - Windows’ta CH340 sürücüsü yüklü olmalıdır. ")])),_:1,__:[3]}),n(Z,null,{default:m(()=>[l("div",ne,[n(h,{color:"primary",onClick:K,disabled:S.value},{default:m(()=>e[4]||(e[4]=[o("Cihaza Bağlan")])),_:1,__:[4]},8,["disabled"]),n(ee,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),items:W,label:"Baud Rate",style:{"max-inline-size":"200px"}},null,8,["modelValue"]),n(te,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=s=>p.value=s),label:"Gönder",style:{"max-inline-size":"300px"},onKeyup:F(E,["enter"])},null,8,["modelValue"]),n(h,{color:"secondary",onClick:E,disabled:!f.value},{default:m(()=>e[5]||(e[5]=[o("Gönder")])),_:1,__:[5]},8,["disabled"]),n(h,{color:"error",onClick:V,disabled:!f.value},{default:m(()=>e[6]||(e[6]=[o("Bağlantıyı Kes")])),_:1,__:[6]},8,["disabled"])]),n(O,{class:"my-4"}),l("div",re,[l("div",{class:B(["status-box",z.value]),title:"Şalter (0 → gri, 1 → yeşil)"},null,2),l("div",{class:B(["status-box",G.value]),title:"Makine (0 → gri, 1 → yeşil)"},null,2),l("div",{class:B(["status-box",$.value]),title:"Sayaç Tetik (0 → gri, 1 → mavi)"},null,2)]),l("div",ie,[l("div",null,[e[7]||(e[7]=o("Şalter: ")),l("strong",null,x(u.switchOn?"Açık (Yeşil)":"Kapalı (Gri)"),1)]),l("div",null,[e[8]||(e[8]=o("Makine: ")),l("strong",null,x(u.machineRun?"Çalışıyor (Yeşil)":"Bekliyor (Gri)"),1)]),l("div",null,[e[9]||(e[9]=o("Tetik: ")),l("strong",null,x(u.pulse?"1 (Mavi)":"0 (Gri)"),1)]),n(O,{class:"my-2"}),l("div",null,[e[10]||(e[10]=o("Sayaç: ")),n(ae,{color:"primary",variant:"flat"},{default:m(()=>[o(x(_.value),1)]),_:1})]),e[11]||(e[11]=l("div",{class:"text-medium-emphasis text-caption"},'Çerçeve formatı: 0|1|0# (\\"#\\" ile biter)',-1))])]),_:1})]),_:1})]))}}),Le=le(oe,[["__scopeId","data-v-53a1e0d1"]]);export{Le as default};
