import{d as Me,r as u,X as q,G as le,bg as Y,c as i,l as d,e as a,v as r,x as $,F as y,i as p,I as v,b3 as Ce,o as n,aI as Te,t as ze}from"./main-B_DZspM6.js";import{_ as Ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe={class:"dash-container"},Ee={key:0,class:"loading-overlay"},De={class:"dash-header"},Ae={class:"header-left"},Le={class:"summary-card stretch"},Re={class:"summary-kpis"},Be={class:"kpi"},Oe={class:"kpi"},qe={class:"kpi"},$e={class:"dash-actions mt-3"},Fe=["disabled"],Ke={key:0},Pe={key:1},Ve={key:0,class:"last-updated"},Ie={key:1,class:"warn",title:"API geçici boş yanıt verdi; önceki veriler gösteriliyor"},We={key:2,class:"warn"},Ge={key:3,class:"hint"},He={class:"header-right"},Ue={class:"weekly-card"},Ye={class:"weekly-vertical mt-2"},Xe={class:"wv-bars"},je={class:"wv-stack"},Ze=["title"],Je={key:0,class:"wv-val"},Qe={key:0,class:"wv-val"},ea={class:"wv-day"},aa={class:"weekly-count-card"},sa={class:"weekly-vertical mt-2"},ta={class:"wvc-bars"},la={class:"wvc-stack"},ia=["title"],na={key:0,class:"wvc-label"},oa={class:"wvc-day"},ra={class:"cards-grid"},ua={class:"card-top"},da={class:"names"},ca={class:"machine-name"},va={key:0,class:"operator-name"},ka={class:"label"},ma={key:0,class:"meta-row"},ya={class:"meta-left"},pa={key:0,class:"pill code"},fa={key:1,class:"meta-name"},ba={key:0,class:"meta-right"},ha={class:"kpi-row"},_a={class:"kpi-item"},wa={class:"kpi-item"},ga={class:"kpi-item"},Sa={class:"mini-bars"},Ma={key:0,class:"multi-bar"},Ca=["title"],Ta={key:1,class:"multi-bar",title:"Çalışma/Duruş oranı"},za={class:"charts-grid"},Na={class:"chart-card"},xa={key:0,class:"alert error mt-2"},Ea={class:"msg"},Da={key:1,class:"alert empty mt-2"},Aa={key:2,class:"reason-bars mt-2"},La={class:"bar"},Ra={key:3,class:"reason-bars mt-2"},Ba={class:"row-label"},Oa={class:"bar mt-2"},qa={class:"value"},$a={class:"chart-card ticker-card","aria-label":"Bilgilendirme akışı"},Fa={key:0,class:"ticker-hint"},Ka={class:"ticker-controls"},Pa=["onClick","title"],T=1e4,Va=Me({__name:"dash-bukum",setup(Ia){const X=u(["Üretimde süreklilik için proaktif bakım planı devrede","Operatör güvenliği: Koruyucu ekipman kontrolü yapılmalı","Enerji verimliliği izleniyor – gereksiz duruşları azaltın","Kalite ilk seferde doğru üretimle başlar","Anlık OEE analizi ile darboğazları tespit edin"]),ie=q(()=>[...X.value,...X.value]),w=u(0),z=u(!1);let N=null;const j=[60,100,140,200],F=u(2),ne=q(()=>j[F.value]||140),Z=u(null),K=u(0),f=u(0);let x=0;const oe=q(()=>({transform:`translateX(${w.value}px)`,inlineSize:K.value+"px"}));function P(){const t=Z.value;if(!t)return;const s=t.querySelectorAll(".ticker-item");if(!s.length)return;const e=Math.floor(s.length/2);let l=0;for(let c=0;c<e;c++){const o=s[c];l+=o.offsetWidth,c<e-1&&(l+=42)}f.value=l,K.value=l*2,w.value<-f.value&&(w.value=(w.value%f.value+f.value)%f.value*-1)}function J(t){x||(x=t);const s=(t-x)/1e3;x=t,!z.value&&K.value&&(w.value-=ne.value*s,f.value&&w.value<=-f.value&&(w.value+=f.value)),N=requestAnimationFrame(J)}le(()=>{requestAnimationFrame(()=>{P(),N=requestAnimationFrame(J)}),window.addEventListener("resize",P)}),Y(()=>{N&&cancelAnimationFrame(N)}),Y(()=>{window.removeEventListener("resize",P)});const E=u([]),g=u({availability:0,performance:0,quality:1,oee:0}),V=u([]),D=u([]),I=u([]),k=u(!0),W=u(!1),A=u(!1),L=u(null),R=u(!1),G=u(!1),H=u(0),M=u(T),re=u(null),ue=q(()=>k.value&&!L.value),b=t=>isFinite(t)?`${Math.round(t*100)}%`:"-",Q=t=>{const s=t*100;return s<50?"oee-red":s<70?"oee-yellow":s<85?"oee-orange":"oee-green"},de=t=>t==="running"?"Çalışıyor":t==="stopped"?"Duruyor":"Kapalı",ce=t=>`${Math.min(100,t)}%`,ve=()=>Math.max(1,...D.value.map(t=>t.work+t.stop)),ee=t=>`${Math.round(t/ve()*100)}%`,ke=()=>Math.max(1,...I.value.map(t=>t.count)),me=t=>`${Math.round(t/ke()*100)}%`;function B(t){const s=Math.max(0,Math.min(100,Number(t.workRatio)||0)),e=Math.max(0,Math.min(100,Number(t.stopRatio)||0)),l=s+e;if(l>100){const o=100/l,ge=Math.round(s*o*100)/100,Se=Math.round(e*o*100)/100;return{work:ge,stop:Se,remain:0}}const c=Math.max(0,100-l);return{work:Math.round(s*100)/100,stop:Math.round(e*100)/100,remain:Math.round(c*100)/100}}const ye={calisma:"#189c49",running:"#189c49",work:"#189c49",durus:"#efb803",stopped:"#efb803",stop:"#efb803",ayar:"#a59ef7",mola:"#f4b73f",kalan:"lightgray",offline:"#9e9e9e"};function ae(t){const s={running:"calisma",work:"calisma",stopped:"durus",stop:"durus",setup:"ayar",break:"mola",idle:"kalan"},e=(t||"").toLowerCase();return s[e]||e}function pe(t){return t.reduce((s,e)=>s+(Number(e.duration)||0),0)||0}function fe(t,s){const e=Math.max(1,pe(s)),l=Math.max(0,(Number(t.duration)||0)/e*100),c=ye[ae(String(t.type))]||"#888";return{inlineSize:`${l}%`,backgroundColor:c,borderRadius:"999px"}}function be(t,s){const e=ae(String(t.type));return e==="calisma"?s.itemName||s.itemCode||"Çalışıyor":e==="durus"?t.reason||t.sebep||t.code||"Duruyor":{calisma:"Çalışma",durus:"Duruş",ayar:"Ayar",mola:"Mola",kalan:"Kalan",offline:"Kapalı"}[e]||String(t.type)}let S=null;const h=u(null);async function he(t){var s;try{E.value.length===0?k.value=!0:A.value=!0,S&&(clearTimeout(S),S=null),S=window.setTimeout(()=>{W.value=!0},2500),h.value=null;const{data:l}=await Ce.get("/api/dash-bukum/overview",{signal:t,timeout:1e4}),c=((l==null?void 0:l.machines)||[]).map(o=>({id:Number(o.id),name:String(o.name??""),operator:o.operator||void 0,itemCode:o.itemCode??o.item_code??void 0,itemName:o.itemName??o.item_name??void 0,counter:o.counter!==void 0&&o.counter!==null?Number(o.counter):void 0,status:o.status??"offline",availability:Number(o.availability)||0,performance:Number(o.performance)||0,quality:Number(o.quality)||1,oee:Number(o.oee)||0,workRatio:Number(o.workRatio)||0,stopRatio:Number(o.stopRatio)||0,code:o.code||"",segments:Array.isArray(o.segments)?o.segments:Array.isArray(o.barData)?o.barData:Array.isArray(o.timeline)?o.timeline:void 0}));re.value=(l==null?void 0:l.meta)||null,c.length===0?E.value.length===0?R.value=!0:G.value=!0:(E.value=c,R.value=!1,G.value=!1),g.value=(l==null?void 0:l.daySummary)||g.value,V.value=(l==null?void 0:l.reasons)||V.value,D.value=(l==null?void 0:l.weekly)||D.value,I.value=((l==null?void 0:l.weeklyCounts)||(l==null?void 0:l.weekly_counts)||[]).map(o=>({date:String(o.date),label:String(o.label??""),count:Number(o.count??0)})),L.value=new Date,H.value=0,M.value=T}catch(e){H.value+=1,M.value=Math.min(T*Math.pow(2,H.value),6e4);const l=(s=e==null?void 0:e.response)==null?void 0:s.status;l===401?h.value="Yetki hatası (401).":l===404?h.value="Endpoint bulunamadı (404).":l===500?h.value="Sunucu hatası (500).":(e==null?void 0:e.code)==="ECONNABORTED"?h.value="Zaman aşımı.":(e==null?void 0:e.name)==="CanceledError"||(e==null?void 0:e.message)==="canceled"||(h.value="Beklenmeyen hata.")}finally{k.value=!1,A.value=!1,S&&(clearTimeout(S),S=null),W.value&&setTimeout(()=>{W.value=!1},400)}}const _e=T;let m=null,O=!1,_=null;function C(t=M.value){m&&clearTimeout(m),m=window.setTimeout(se,t)}async function se(){if(document.hidden){C(Math.max(3e4,M.value));return}if(O){C(500);return}O=!0,_&&_.abort(),_=new AbortController;try{await he(_.signal)}finally{O=!1,C(_e)}}function te(){document.hidden?(_&&_.abort(),m&&(clearTimeout(m),m=null)):C(0)}function U(){O||(m&&(clearTimeout(m),m=null),C(0))}function we(t){return t?t.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}return le(async()=>{document.addEventListener("visibilitychange",te),await se()}),Y(()=>{document.removeEventListener("visibilitychange",te),_&&_.abort(),m&&clearTimeout(m)}),(t,s)=>(n(),i("div",xe,[ue.value?(n(),i("div",Ee,s[2]||(s[2]=[a("div",{class:"loader-box"},[a("div",{class:"spinner","aria-hidden":"true"}),a("h2",null,"Veriler yükleniyor"),a("p",null,"Makine durumları, OEE ve haftalık istatistikler getiriliyor. Lütfen bekleyin…")],-1)]))):d("",!0),a("header",De,[a("div",Ae,[s[8]||(s[8]=a("div",{class:"title-block ms-4"},[a("h1",null,"Büküm Dashboard")],-1)),a("div",Le,[s[7]||(s[7]=a("div",{class:"summary-title"},"Günlük Genel Değerlendirme",-1)),a("div",Re,[a("div",Be,[s[3]||(s[3]=a("span",null,"Uyg.",-1)),a("strong",null,r(b(g.value.availability)),1)]),a("div",Oe,[s[4]||(s[4]=a("span",null,"Perf.",-1)),a("strong",null,r(b(g.value.performance)),1)]),a("div",qe,[s[5]||(s[5]=a("span",null,"Kalite",-1)),a("strong",null,r(b(g.value.quality)),1)]),a("div",{class:$(["kpi oee",Q(g.value.oee)])},[s[6]||(s[6]=a("span",null,"OEE",-1)),a("strong",null,r(b(g.value.oee)),1)],2)]),a("div",$e,[a("button",{class:"refresh-btn",onClick:U,disabled:A.value||k.value},[A.value?(n(),i("span",Ke,"⟳ Yenileniyor...")):(n(),i("span",Pe,"⟳ Yenile"))],8,Fe),L.value?(n(),i("small",Ve,"Güncellendi: "+r(we(L.value)),1)):d("",!0),G.value?(n(),i("small",Ie,"Geçici boş yanıt")):R.value&&!k.value?(n(),i("small",We,"Veri yok")):d("",!0),M.value>T&&!k.value?(n(),i("small",Ge,"Bekleme: "+r(Math.round(M.value/1e3))+"sn",1)):d("",!0)])])]),a("div",He,[a("div",Ue,[s[10]||(s[10]=a("h4",null,"Haftalık Çalışma / Duruş (dk)",-1)),a("div",Ye,[a("div",Xe,[k.value?(n(),i(y,{key:0},p(7,e=>a("div",{key:"wv-skel-"+e,class:"wv-col"},[a("div",je,[a("div",{class:"wv-fill sk-fill",style:v({blockSize:20+e*6+"%"})},null,4)]),s[9]||(s[9]=a("div",{class:"wv-day"}," ",-1))])),64)):(n(!0),i(y,{key:1},p(D.value,e=>(n(),i("div",{key:e.date,class:"wv-col"},[a("div",{class:"wv-stack",title:e.work+" dk çalışma / "+e.stop+" dk duruş"},[a("div",{class:"wv-seg work",style:v({blockSize:ee(e.work)}),title:"Çalışma"},[e.work>0?(n(),i("span",Je,r(e.work),1)):d("",!0)],4),a("div",{class:"wv-seg stop",style:v({blockSize:ee(e.stop)}),title:"Duruş"},[e.stop>0?(n(),i("span",Qe,r(e.stop),1)):d("",!0)],4)],8,Ze),a("div",ea,r(e.label),1)]))),128))])])]),a("div",aa,[s[12]||(s[12]=a("h4",null,"Haftalık Sayaç (adet)",-1)),a("div",sa,[a("div",ta,[k.value?(n(),i(y,{key:0},p(7,e=>a("div",{key:"wvc-skel-"+e,class:"wvc-col"},[a("div",la,[a("div",{class:"wvc-fill sk-fill",style:v({blockSize:20+e*4+"%"})},null,4)]),s[11]||(s[11]=a("div",{class:"wvc-day"}," ",-1))])),64)):(n(!0),i(y,{key:1},p(I.value,e=>(n(),i("div",{key:e.date,class:"wvc-col"},[a("div",{class:"wvc-stack",title:e.count+" adet"},[a("div",{class:"wvc-bar",style:v({blockSize:me(e.count)}),title:"Adet"},[e.count>0?(n(),i("span",na,r(e.count),1)):d("",!0)],4)],8,ia),a("div",oa,r(e.label),1)]))),128))])])])])]),a("section",ra,[k.value?(n(),i(y,{key:0},p(6,e=>a("article",{key:"skeleton-"+e,class:"machine-card skeleton"},s[13]||(s[13]=[Te('<div class="card-top" data-v-2b2a1aa6><div class="names" data-v-2b2a1aa6><div class="sk-line w-60" data-v-2b2a1aa6></div><div class="sk-line w-40 mt-1" data-v-2b2a1aa6></div></div><div class="status" data-v-2b2a1aa6><span class="dot" data-v-2b2a1aa6></span><span class="sk-line w-20" data-v-2b2a1aa6></span></div></div><div class="kpi-row" data-v-2b2a1aa6><div class="kpi-item" data-v-2b2a1aa6><div class="sk-line w-60" data-v-2b2a1aa6></div><div class="sk-line w-40 mt-1" data-v-2b2a1aa6></div></div><div class="kpi-item" data-v-2b2a1aa6><div class="sk-line w-60" data-v-2b2a1aa6></div><div class="sk-line w-40 mt-1" data-v-2b2a1aa6></div></div><div class="kpi-item" data-v-2b2a1aa6><div class="sk-line w-60" data-v-2b2a1aa6></div><div class="sk-line w-40 mt-1" data-v-2b2a1aa6></div></div><div class="kpi-item" data-v-2b2a1aa6><div class="sk-line w-60" data-v-2b2a1aa6></div><div class="sk-line w-40 mt-1" data-v-2b2a1aa6></div></div></div><div class="mini-bars" data-v-2b2a1aa6><div class="multi-bar" data-v-2b2a1aa6><div class="multi-seg sk-fill" style="inline-size:65%;" data-v-2b2a1aa6></div><div class="multi-seg sk-fill" style="inline-size:20%;" data-v-2b2a1aa6></div><div class="multi-seg sk-fill" style="inline-size:15%;" data-v-2b2a1aa6></div></div></div>',3)]))),64)):(n(!0),i(y,{key:1},p(E.value,e=>(n(),i("article",{key:e.id,class:"machine-card"},[a("div",ua,[a("div",da,[a("h3",ca,r(e.code)+" - "+r(e.name),1),e.operator?(n(),i("p",va,"Operatör: "+r(e.operator),1)):d("",!0)]),a("div",{class:$(["status",e.status])},[s[14]||(s[14]=a("span",{class:"dot"},null,-1)),a("span",ka,r(de(e.status)),1)],2)]),e.itemCode||e.itemName||e.counter!==void 0?(n(),i("div",ma,[a("div",ya,[e.itemCode?(n(),i("span",pa,r(e.itemCode),1)):d("",!0),e.itemName?(n(),i("span",fa,r(e.itemName),1)):d("",!0)]),e.counter!==void 0?(n(),i("div",ba,[s[15]||(s[15]=ze("Sayaç: ")),a("strong",null,r(e.counter),1)])):d("",!0)])):d("",!0),a("div",ha,[a("div",_a,[s[16]||(s[16]=a("span",null,"Uygulanabilirlik",-1)),a("strong",null,r(b(e.availability)),1)]),a("div",wa,[s[17]||(s[17]=a("span",null,"Performans",-1)),a("strong",null,r(b(e.performance)),1)]),a("div",ga,[s[18]||(s[18]=a("span",null,"Kalite",-1)),a("strong",null,r(b(e.quality)),1)]),a("div",{class:$(["kpi-item oee",Q(e.oee)])},[s[19]||(s[19]=a("span",null,"OEE",-1)),a("strong",null,r(b(e.oee)),1)],2)]),a("div",Sa,[e.segments&&e.segments.length?(n(),i("div",Ma,[(n(!0),i(y,null,p(e.segments,(l,c)=>(n(),i("div",{key:e.id+"-seg-"+c,class:"multi-seg",style:v(fe(l,e.segments)),title:be(l,e)},null,12,Ca))),128))])):(n(),i("div",Ta,[a("div",{class:"multi-seg work",style:v({inlineSize:B(e).work+"%"}),title:"Çalışma"},null,4),a("div",{class:"multi-seg stop",style:v({inlineSize:B(e).stop+"%"}),title:"Duruş"},null,4),B(e).remain>0?(n(),i("div",{key:0,class:"multi-seg remain",style:v({inlineSize:B(e).remain+"%"}),title:"Kalan"},null,4)):d("",!0)]))])]))),128))]),a("section",za,[a("div",Na,[s[24]||(s[24]=a("h4",null,"Duruş Sebepleri (Süre)",-1)),h.value?(n(),i("div",xa,[s[20]||(s[20]=a("strong",null,"Veri alınamadı:",-1)),a("span",Ea,r(h.value),1),a("button",{class:"retry-btn",onClick:U},"Tekrar Dene")])):R.value&&!k.value?(n(),i("div",Da,[s[21]||(s[21]=a("span",null,"Henüz veri yok.",-1)),a("button",{class:"retry-btn subtle",onClick:U},"Yenile")])):d("",!0),k.value?(n(),i("div",Aa,[(n(),i(y,null,p(5,e=>a("div",{key:"rs-"+e,class:"reason-row"},[s[22]||(s[22]=a("div",{class:"row-label"},[a("div",{class:"sk-line w-40"})],-1)),a("div",La,[a("div",{class:"fill sk-fill",style:v({width:100-e*12+"%"})},null,4)]),s[23]||(s[23]=a("div",{class:"value"},[a("div",{class:"sk-line w-20 ml-auto"})],-1))])),64))])):(n(),i("div",Ra,[(n(!0),i(y,null,p(V.value,e=>(n(),i("div",{key:e.name,class:"reason-row"},[a("div",Ba,r(e.name),1),a("div",Oa,[a("div",{class:"fill reason",style:v({width:ce(e.minutes)})},null,4)]),a("div",qa,r(e.minutes)+" dk",1)]))),128))]))]),a("div",$a,[s[25]||(s[25]=a("h4",null,"Canlı Akış",-1)),a("div",{class:"ticker-shell",onMouseenter:s[0]||(s[0]=e=>z.value=!0),onMouseleave:s[1]||(s[1]=e=>z.value=!1)},[a("div",{class:"ticker-track",style:v(oe.value),ref_key:"tickerTrackEl",ref:Z},[(n(!0),i(y,null,p(ie.value,(e,l)=>(n(),i("span",{key:"tk-"+l,class:"ticker-item"},r(e),1))),128))],4)],32),z.value?d("",!0):(n(),i("small",Fa,"Üzerine gelince durur")),a("div",Ka,[(n(),i(y,null,p(j,(e,l)=>a("button",{key:"sp-"+e,class:$(["speed-btn",{active:F.value===l}]),onClick:c=>F.value=l,title:e+" px/sn"},r(e),11,Pa)),64))])])])]))}}),Ha=Ne(Va,[["__scopeId","data-v-2b2a1aa6"]]);export{Ha as default};
