import{_ as $}from"./AppSelect.vue_vue_type_script_setup_true_lang-DalojY1r.js";import{_ as K}from"./AppTextField.vue_vue_type_script_setup_true_lang-DUVkacuQ.js";import{d as M,v as N,r as n,aH as z,w as T,g as k,o as S,f as t,b as s,j as P,aB as V,k as A,u as l,L as y,m as j,aJ as O,aA as q}from"./main-BOWGhs4r.js";import{r as w,e as E}from"./validators-BwBNGiur.js";import{$ as c}from"./api-BL15l4d2.js";import{V as H,a as I}from"./VToolbar-Dvz6gauk.js";import{V as J}from"./VSpacer-COCoAjEK.js";import{V as L}from"./VDivider-DfMbpFe-.js";import{V as Y}from"./VAlert-g9mwABEy.js";import{V as G}from"./VCard-ByGWLcQr.js";import{V as Q}from"./VCardText-D1nF0aQr.js";import{V as W}from"./VForm-jorAyh_O.js";import{V as X}from"./VRow-5UJ35msi.js";import{V as d}from"./VCol-W5kbTBDh.js";import{V as Z}from"./VNavigationDrawer-BFbQ-red.js";const Ve=M({__name:"UserFormDrawer",props:{modelValue:{type:Boolean},editUser:{}},emits:["update:modelValue","saved"],setup(B,{emit:D}){const _=B,b=D,u=N({get:()=>_.modelValue,set:o=>b("update:modelValue",o)}),g=n(),e=z({id:void 0,name:"",email:"",password:"",roles:[],permissions:[]}),U=n([]),x=n([]),C=n(!1),f=n(!1),p=n(null);T(()=>_.editUser,o=>{o?(e.id=o.id,e.name=o.name,e.email=o.email,e.password="",e.roles=(o.roles||[]).map(a=>a.name),e.permissions=(o.permissions||[]).map(a=>a.name)):(e.id=void 0,e.name="",e.email="",e.password="",e.roles=[],e.permissions=[])},{immediate:!0});const F=async()=>{C.value=!0;try{const[o,a]=await Promise.all([c("/roles/available"),c("/permissions")]);U.value=(o.roles||[]).map(i=>({title:i.name,value:i.name})),x.value=(a||[]).map(i=>({title:i.name,value:i.name}))}catch(o){p.value=(o==null?void 0:o.message)||"Meta veriler alınamadı."}finally{C.value=!1}};T(u,o=>{o&&F()});const v=()=>{u.value=!1},R=async()=>{var a,i;p.value=null;const o=await((a=g.value)==null?void 0:a.validate());if(o!=null&&o.valid)try{f.value=!0;const r={name:e.name,email:e.email,roles:e.roles,permissions:e.permissions};e.password&&(r.password=e.password),e.id?await c(`/users/${e.id}`,{method:"PUT",body:r}):await c("/users",{method:"POST",body:{...r,password:e.password||void 0}}),b("saved"),v()}catch(r){p.value=((i=r==null?void 0:r.data)==null?void 0:i.message)||(r==null?void 0:r.message)||"Kayıt başarısız."}finally{f.value=!1}};return(o,a)=>{const i=K,r=$;return S(),k(Z,{modelValue:l(u),"onUpdate:modelValue":a[5]||(a[5]=m=>q(u)?u.value=m:null),location:"end",temporary:"",width:"480"},{default:t(()=>[s(H,{density:"comfortable",flat:""},{default:t(()=>[s(I,null,{default:t(()=>[V(A(l(e).id?"Kullanıcıyı Düzenle":"Yeni Kullanıcı"),1)]),_:1}),s(J),s(y,{icon:"",variant:"text",onClick:v},{default:t(()=>[s(j,{icon:"tabler-x"})]),_:1})]),_:1}),s(L),l(p)?(S(),k(Y,{key:0,type:"error",variant:"tonal",class:"ma-4"},{default:t(()=>[V(A(l(p)),1)]),_:1})):P("",!0),s(G,{flat:""},{default:t(()=>[s(Q,null,{default:t(()=>[s(l(W),{ref_key:"refVForm",ref:g,onSubmit:O(R,["prevent"])},{default:t(()=>[s(X,null,{default:t(()=>[s(d,{cols:"12"},{default:t(()=>[s(i,{modelValue:l(e).name,"onUpdate:modelValue":a[0]||(a[0]=m=>l(e).name=m),label:"Ad Soyad",rules:[l(w)]},null,8,["modelValue","rules"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(i,{modelValue:l(e).email,"onUpdate:modelValue":a[1]||(a[1]=m=>l(e).email=m),label:"E-posta",rules:[l(w),l(E)]},null,8,["modelValue","rules"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(i,{modelValue:l(e).password,"onUpdate:modelValue":a[2]||(a[2]=m=>l(e).password=m),label:l(e).id?"Şifre (opsiyonel)":"Şifre",type:"password",rules:l(e).id?[]:[l(w)]},null,8,["modelValue","label","rules"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(r,{modelValue:l(e).roles,"onUpdate:modelValue":a[3]||(a[3]=m=>l(e).roles=m),items:l(U),label:"Roller",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),s(d,{cols:"12"},{default:t(()=>[s(r,{modelValue:l(e).permissions,"onUpdate:modelValue":a[4]||(a[4]=m=>l(e).permissions=m),items:l(x),label:"İzinler",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),s(d,{cols:"12",class:"d-flex justify-end gap-3"},{default:t(()=>[s(y,{variant:"tonal",color:"secondary",onClick:v},{default:t(()=>a[6]||(a[6]=[V("İptal")])),_:1,__:[6]}),s(y,{type:"submit",loading:l(f),disabled:l(f)},{default:t(()=>a[7]||(a[7]=[V("Kaydet")])),_:1,__:[7]},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}});export{Ve as _};
