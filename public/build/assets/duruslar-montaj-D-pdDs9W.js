import{u as Be}from"./pageTitle-B21vlPMS.js";import{d as Ee,r as s,D as d,aq as Oe,i as Pe,a as Fe,c as Le,o as j,b as t,l as a,f as r,e as u,g as je,aA as Ae,p as Ge,F as Ue,s as Ve}from"./main-BA6IByp5.js";import{D as _}from"./button-KLE7N1ea.js";import{D as $e,a as Ye,c as Ke,e as R,d as Qe,b as qe,j as A,g as He,f as Je,k as We,i as Xe}from"./chart-lOXFzThi.js";import{s as Ze,D as m,e as et,f as tt,g as at,h as lt,i as ot,j as nt,k as rt,d as it,l as st,m as ut,n as dt,o as mt,p as ct,b as pt,c,q as ft,r as G,t as U}from"./data-grid-C6vrNf0X.js";import{D as V}from"./date-box-BjlbzhYK.js";import{D as $}from"./load-panel-C2Bzo4IZ.js";import{D as Y}from"./number-box-DyPCcn3N.js";import{n as gt}from"./notify-D5KDjaAP.js";import"./m_base_widget-0F2NQ4j5.js";import{V as K}from"./VCardText-DJ3k762g.js";import{V as Q}from"./VCard-bvvLevnF.js";import{V as vt}from"./VCol-CpWu-1N1.js";import"./editor-BBQp0CcU.js";import"./overlay-DuLKvmQo.js";import"./m_select_box-BfgkrVhL.js";import"./themes-C2TbJqJs.js";import"./m_row_dragging-D5bGi6cA.js";import"./createSimpleFunctional-nAcGup33.js";import"./VAvatar-D2N_ZOil.js";import"./VImg-BfSY32t_.js";import"./index-C_9jYE9r.js";/* empty css              */const bt={id:"liste",style:{"margin-block-end":"-10px"}},yt={id:"durus-chart",style:{display:"grid","margin-block-end":"8px"}},xt={id:"liste",style:{"margin-block-end":"-10px"}},ht={style:{display:"flex","align-items":"center",gap:"6px","margin-inline-start":"10px"}},Dt={style:{display:"flex","align-items":"center",gap:"6px"}},wt={style:{display:"flex","align-items":"center",gap:"6px","inline-size":"140px"}},_t={class:"duration-cell"},Tt={class:"duration-cell__label"},St={style:{display:"flex","align-items":"center",gap:"6px","inline-size":"120px"}},C="Duruşlar",M="Montaj",kt="#ff9e9e",Ct="#ef5350",Mt="#b0bec5",Zt=Ee({__name:"duruslar-montaj",setup(Nt){const z=Be();z.setTitle(`${C} (${M})`),document.title=`OFT - ${C} | ${M}`;const q=s(0),f=s([]),T=s(!1),x=s(!1),I=s(""),B=s(null),H=s(null),E=s(null),J=s([]),W=s(!0),X=s(!0),Z={of:"#grid"},h=s(Number(localStorage.getItem("montaj.longDowntimeMin")||30)),S=s(Number(localStorage.getItem("montaj.minMinutes")||1)||1),g=s(null),v=s(null),ee=d(()=>{const e=new Map;for(const i of f.value){const p=i&&(i.durus_sebebi||i.durus_sebebi_kodu),k=p&&String(p).trim()||"Diğer",N=Number(i==null?void 0:i.durum_suresi)||0;e.set(k,(e.get(k)||0)+N)}const l=Array.from(e.entries()).map(([i,p])=>({arg:i,val:p})),n=l.filter(i=>i.arg!=="Diğer").sort((i,p)=>p.val-i.val),o=l.filter(i=>i.arg==="Diğer");return[...n,...o]}),O=s(Number(localStorage.getItem("montaj.chartTopN")||10)||10),P=d(()=>ee.value.slice(0,O.value)),te=d(()=>P.value.map(e=>e.arg)),ae=d(()=>`Duruş Süre Toplamları (İlk ${O.value})`),F=d({get:()=>!x.value,set:e=>{x.value=!e}}),le=Oe(),b=d(()=>{try{return!!le.global.current.value.dark}catch{return!!document.querySelector("body.v-theme--dark, .v-theme--dark")}}),D=d(()=>b.value?"#eceff1":"#263238"),oe=d(()=>b.value?"#263238":"#ffffff"),ne=d(()=>(b.value,"#90a4ae")),re=d(()=>b.value?"#eceff1":"#263238"),ie=d(()=>{const e=f.value.reduce((l,n)=>{const o=Number(n==null?void 0:n.durum_suresi)||0;return o>l?o:l},0);return e>0?e:1}),y=s(localStorage.getItem("montaj.clipQ95")==="1"),se=d(()=>f.value.map(e=>Number(e==null?void 0:e.durum_suresi)||0));function ue(e,l){if(!e||e.length===0)return 1;const n=[...e].sort((N,Ie)=>N-Ie),o=(n.length-1)*l,i=Math.floor(o),p=Math.ceil(o);if(p===i)return Math.max(1,n[i]);const k=o-i;return Math.max(1,n[i]+(n[p]-n[i])*k)}const de=d(()=>{if(y.value){const e=ue(se.value,.95);return e>0?e:1}return ie.value}),me=()=>{y.value=!y.value,localStorage.setItem("montaj.clipQ95",y.value?"1":"0")},ce=e=>{if(b.value)switch(e){case"DURUYOR":return"linear-gradient(90deg, #ff8a65, #e53935)";case"MOLA":return"linear-gradient(90deg, #ba68c8, #8e24aa)";default:return"linear-gradient(90deg, #90caf9, #42a5f5)"}else switch(e){case"DURUYOR":return"linear-gradient(90deg, #ffccbc, #ff8a65)";case"MOLA":return"linear-gradient(90deg, #e1bee7, #ce93d8)";default:return"linear-gradient(90deg, #bbdefb, #90caf9)"}};function pe(e){return(e||"").trim().toLowerCase()==="diğer"}function fe(e){const l=String((e==null?void 0:e.argument)??"");return pe(l)?{color:Mt}:{color:b.value?Ct:kt}}function ge(e){const l=String((e==null?void 0:e.argumentText)??(e==null?void 0:e.argument)??""),n=(e==null?void 0:e.valueText)??String((e==null?void 0:e.value)??"0");return{text:`${l}: ${n} dk`}}function L(e){return typeof e.value=="number"?new Intl.NumberFormat("tr-TR",{maximumFractionDigits:0}).format(e.value):e.valueText}const w=async()=>{var e,l;T.value=!0;try{const n={};g.value instanceof Date&&(n.from=g.value.toISOString().slice(0,10)),v.value instanceof Date&&(n.to=v.value.toISOString().slice(0,10)),n.min_minutes=String(S.value??1);const{data:o}=await Ve.get("/api/duruslar-montaj",{params:n});f.value=o.data||[],(l=(e=B.value)==null?void 0:e.instance)==null||l.refresh(),console.log("duruslar-montaj yüklendi, kayıt sayısı:",f.value.length)}catch(n){console.error("duruslar-montaj yüklenemedi:",n),f.value=[],gt("Veri alınamadı","error",1500)}finally{T.value=!1,x.value||(x.value=!0)}},ve=()=>{w()},be=()=>{g.value=null,v.value=null,w()},ye=e=>{g.value=e.value??null},xe=()=>{const l=new Date().toISOString().slice(0,10);g.value=new Date(l),v.value=new Date(l),w()},he=()=>{const e=new Date;e.setDate(e.getDate()-1);const l=e.toISOString().slice(0,10);g.value=new Date(l),v.value=new Date(l),w()},De=e=>{const l=Number(e.value||30);h.value=isNaN(l)?30:l,localStorage.setItem("montaj.longDowntimeMin",String(h.value))},we=e=>{v.value=e.value??null},_e=e=>{const l=Number((e==null?void 0:e.value)??1);S.value=isNaN(l)?1:Math.max(0,Math.min(1440,l)),localStorage.setItem("montaj.minMinutes",String(S.value))},Te=e=>{var n,o;if(e.rowType!=="data")return;const l=e.data;(l==null?void 0:l.durum)==="DURUYOR"&&Number(l==null?void 0:l.durum_suresi)>=h.value&&((o=(n=e.rowElement)==null?void 0:n.classList)==null||o.add("long-downtime"))},Se=e=>{var o;if(e.rowType!=="data")return;const l=e.data;(l==null?void 0:l.durum)==="DURUYOR"&&Number(l==null?void 0:l.durum_suresi)>=h.value&&((o=e.column)==null?void 0:o.dataField)==="durum_suresi"&&e.cellElement&&(e.cellElement.classList.add("duration-long"),e.cellElement.style.fontWeight="700")},ke=()=>{},Ce=()=>{},Me=()=>{},Ne=()=>{},Re=()=>{},ze=()=>{};return Pe(()=>{z.setTitle(`${C} (${M})`),document.title=`OFT - ${C} | ${M}`,w()}),(e,l)=>{const n=Fe("DxGridLoadPanel");return j(),Le(Ue,null,[t(a($),{visible:F.value,"onUpdate:visible":l[0]||(l[0]=o=>F.value=o),"show-indicator":!0,"show-pane":!0,shading:!0,message:"Montaj Duruşları Yükleniyor",position:{of:"#grid"}},null,8,["visible"]),t(Q,{class:"mt-0 pa-4 pt-2"},{default:r(()=>[t(K,{class:"mt-0 pa-4 ms-2"},{default:r(()=>[u("div",bt,[u("div",yt,[t(a($e),{ref_key:"chartRef",ref:H,"data-source":P.value,palette:"Soft",style:{"block-size":"420px","inline-size":"100%"},rotated:!0,"customize-point":fe},{default:r(()=>[t(a(Ye),{type:"bar","argument-field":"arg","value-field":"val"}),t(a(Ke),{type:"bar","argument-field":"arg","value-field":"val",name:"Süre (dk)"},{default:r(()=>[t(a(R),{visible:!0,format:{type:"fixedPoint",precision:0},font:{color:D.value}},null,8,["font"])]),_:1}),t(a(Qe),{categories:te.value},{default:r(()=>[t(a(R),{font:{color:D.value}},null,8,["font"])]),_:1},8,["categories"]),t(a(qe),null,{default:r(()=>[t(a(R),{font:{color:D.value}},null,8,["font"]),t(a(A),{text:"Süre (dk)",font:{color:D.value}},null,8,["font"])]),_:1}),t(a(He),{visible:!1}),t(a(Je),{enabled:!0,"customize-tooltip":ge,color:oe.value,border:{color:ne.value,width:1,opacity:.35},font:{color:re.value}},null,8,["color","border","font"]),t(a(A),{text:ae.value,font:{color:D.value}},null,8,["text","font"]),t(a(We),{enabled:!0,"file-name":"montaj-durus-sureleri",formats:["PNG","JPEG","PDF","SVG"],"printing-enabled":!1}),t(a(Xe),{height:420})]),_:1},8,["data-source"])])])]),_:1})]),_:1}),t(Q,{class:"mt-4 pa-0 pt-4"},{default:r(()=>[t(K,{class:"mt-0 pa-0 ms-2 me-1"},{default:r(()=>[t(vt,{cols:"12",class:"mt-0 pa-1 pe-2"},{default:r(()=>[u("div",xt,[(j(),je(a(Ze),{id:"grid",ref_key:"dataGridRef",ref:B,key:q.value,"data-source":f.value,"key-expr":"id","show-borders":!0,"focused-row-enabled":!0,"row-alternation-enabled":!0,"min-width":200,onExporting:ke,"allow-column-reordering":!0,"column-auto-width":!1,onContentReady:Ce,onFocusedRowChanged:Me,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:Se,onSelectionChanged:Ne,"auto-navigate-to-focused-row":!0,onRowPrepared:Te,"on-option-changed":Re,onContextMenuPreparing:ze,"focused-row-key":E.value,"onUpdate:focusedRowKey":l[1]||(l[1]=o=>E.value=o),"selected-rows-keys":J.value},{fromDateTemplate:r(()=>[u("div",ht,[l[3]||(l[3]=u("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Başlangıç",-1)),t(a(V),{value:g.value,type:"date","display-format":"yyyy-MM-dd","on-value-changed":ye},null,8,["value"])])]),toDateTemplate:r(()=>[u("div",Dt,[l[4]||(l[4]=u("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Bitiş",-1)),t(a(V),{value:v.value,type:"date","display-format":"yyyy-MM-dd","on-value-changed":we},null,8,["value"])])]),filtreleTemplate:r(()=>[t(a(_),{icon:"filter",text:"Listele","styling-mode":"contained",type:"default",onClick:ve})]),temizleTemplate:r(()=>[t(a(_),{icon:"close",text:"Temizle","styling-mode":"outlined",type:"normal",onClick:be})]),minSureTemplate:r(()=>[u("div",wt,[l[5]||(l[5]=u("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Min Süre (dk)",-1)),t(a(Y),{value:S.value,min:0,max:1440,"show-spin-buttons":!0,"on-value-changed":_e},null,8,["value"])])]),durationCell:r(({data:o})=>[u("div",_t,[u("div",{class:"duration-cell__bar",style:Ae({inlineSize:Math.min(100,Math.round((Number(o.value)||0)/de.value*100))+"%",background:ce(o&&o.data&&o.data.durum||null)})},null,4),u("div",Tt,Ge(new Intl.NumberFormat("tr-TR",{maximumFractionDigits:0}).format(Number(o.value)||0)),1)])]),clipTemplate:r(()=>[t(a(_),{icon:(y.value,"percent"),text:y.value?"Q95 Açık":"Q95 Kapalı","styling-mode":"outlined",type:"default",onClick:me},null,8,["icon","text"])]),bugunTemplate:r(()=>[t(a(_),{icon:"event",text:"Bugün","styling-mode":"outlined",type:"default",onClick:xe})]),dunTemplate:r(()=>[t(a(_),{icon:"event",text:"Dün","styling-mode":"outlined",type:"default",onClick:he})]),esikTemplate:r(()=>[u("div",St,[l[6]||(l[6]=u("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Eşik (dk)",-1)),t(a(Y),{value:h.value,min:1,max:1440,"show-spin-buttons":!0,"on-value-changed":De},null,8,["value"])])]),default:r(()=>[t(a(m),{"data-field":"id",caption:"ID",visible:!1,width:"90"}),t(a(m),{"data-field":"istasyon",caption:"İSTASYON",visible:!0,width:"250"}),t(a(m),{"data-field":"durum_bas_tarihi",caption:"BAŞLANGIÇ","data-type":"date",width:160,visible:!0,format:{formatter:o=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(o)).replace(/\//g,".")}},null,8,["format"]),t(a(m),{"data-field":"durum_bit_tarihi",caption:"BİTİŞ","data-type":"date",width:160,visible:!0,format:{formatter:o=>o?new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(o)).replace(/\//g,"."):"-"}},null,8,["format"]),t(a(m),{"data-field":"durum_suresi",caption:"SÜRE (dk)","data-type":"number",width:160,visible:!0,"cell-template":"durationCell"}),t(a(m),{"data-field":"durus_sebebi_kodu",caption:"SEBEP KODU",visible:!0,width:"120"}),t(a(m),{"data-field":"durus_sebebi",caption:"SEBEP",visible:!0,width:"180"}),t(a(m),{"data-field":"is_emri_no",caption:"İŞ EMRİ NO",visible:!0,width:"140"}),t(a(m),{"data-field":"urun_kodu",caption:"ÜRÜN KODU",visible:!0,width:"140"}),t(a(m),{"data-field":"urun_adi",caption:"ÜRÜN ADI",visible:!0,"min-width":"200"}),t(a(m),{"data-field":"personel_id",caption:"PERSONEL ID",visible:!0,width:"120"}),t(a(m),{"data-field":"isemri_id",caption:"İŞ EMRİ ID",visible:!1,width:"120"}),t(a(m),{"data-field":"urun_id",caption:"ÜRÜN ID",visible:!1,width:"120"}),t(n,{enabled:x.value,text:I.value||"Yükleniyor...","show-indicator":!0,"show-pane":!0,shading:!0},null,8,["enabled","text"]),t(a(et),{mode:"single"}),t(a(tt),{"auto-expand-all":W.value},null,8,["auto-expand-all"]),t(a(at),{visible:!0}),t(a(lt),{visible:!0}),t(a(ot),{visible:!0}),t(a(nt),{visible:X.value},null,8,["visible"]),t(a(rt),{visible:!0,width:240}),t(a(it),{mode:"virtual","row-rendering-mode":"virtual","show-scrollbar":"always"}),t(a(st),{mode:"multiple"}),t(a(ut),{enabled:!0,"allow-export-selected-data":!1}),t(a(dt),{height:"540px",enabled:!0,mode:"select",position:Z},{default:r(()=>[t(a(mt),{enabled:!0}),t(a(ct),{"allow-select-all":!0,"select-by-click":!0,recursive:!0})]),_:1}),t(a(pt),null,{default:r(()=>[t(a(c),{location:"before",name:"groupPanel"}),t(a(c),{location:"before",template:"fromDateTemplate"}),t(a(c),{location:"before",template:"toDateTemplate"}),t(a(c),{location:"before",template:"bugunTemplate"}),t(a(c),{location:"before",template:"dunTemplate"}),t(a(c),{location:"before",template:"minSureTemplate"}),t(a(c),{location:"before",template:"filtreleTemplate"}),t(a(c),{location:"before",template:"temizleTemplate"}),t(a(c),{location:"before",template:"esikTemplate"}),t(a(c),{location:"before",template:"clipTemplate"}),t(a(c),{name:"exportButton"}),t(a(c),{name:"columnChooserButton"}),t(a(c),{name:"searchPanel"})]),_:1}),t(a(ft),null,{default:r(()=>[t(a(G),{"align-by-column":!0,column:"durus_sebebi","summary-type":"count","display-format":"{0} duruş",alignment:"right"}),t(a(G),{"align-by-column":!0,column:"durum_suresi","summary-type":"sum",alignment:"right","customize-text":L}),t(a(U),{"align-by-column":!0,column:"durus_sebebi","summary-type":"count","display-format":"{0} duruş",alignment:"right"}),t(a(U),{"align-by-column":!0,column:"durum_suresi","summary-type":"sum",alignment:"right","customize-text":L})]),_:1})]),_:1},8,["data-source","focused-row-key","selected-rows-keys"])),t(a($),{visible:T.value,"onUpdate:visible":l[2]||(l[2]=o=>T.value=o),"show-indicator":!0,"show-pane":!0,shading:!0,message:I.value||"Yükleniyor...",position:{of:"#grid"}},null,8,["visible","message"])])]),_:1})]),_:1})]),_:1})],64)}}});export{Zt as default};
