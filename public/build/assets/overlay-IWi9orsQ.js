import{e5 as x,dC as et,d6 as g,d1 as T,ed as K,db as N,d3 as V,a$ as p,d4 as w,dx as I,eu as it,dc as nt,d9 as O,dv as st,dX as ot,df as m,da as rt}from"./main-DCUJhUhR.js";import{E as at,p as X,a3 as lt,K as E,F as ct,r as ht,J as dt,s as l,a5 as F,b5 as M,ak as k,b6 as z,a8 as H,al as _t,O as ut,as as pt,aI as L,at as gt,av as vt,N as C,aY as y,aB as ft,Q as mt,e as u,d as v,aw as A,b7 as bt,a$ as Ct,ax as U,g as S,b8 as G,ap as yt,W as j,a as St,B as $t,T as wt,a9 as Pt,P as Tt,U as Et,L as Ot,q as kt}from"./dom_component-BKjseBUi.js";const Z=(function(){let r=[];return{add:function(t){r.includes(t)||r.push(t)},remove:function(t){const e=r.indexOf(t);e!==-1&&r.splice(e,1)},fire:function(){const t=r.pop(),e=!!t;return e&&t(),e},hasCallback:function(){return r.length>0}}})(),Mt="dxactive",$=et.inherit({ctor(r,t){this._timeout=r,this._fire=t},start(){const r=this;this._schedule((()=>{r.force()}))},_schedule(r){this.stop(),this._timer=setTimeout(r,this._timeout)},stop(){clearTimeout(this._timer)},force(){this._fired||(this.stop(),this._fire(),this._fired=!0)},fired(){return this._fired}});let _;const R=at.inherit({ctor(){this.callBase.apply(this,arguments),this._active=new $(0,g),this._inactive=new $(0,g)},configure(r,t){switch(t){case"dxactive":r.activeTimeout=r.timeout;break;case"dxinactive":r.inactiveTimeout=r.timeout}this.callBase(r)},start(r){if(_){const t=ct(this.getElement().get(0),_.getElement().get(0)),e=!_._active.fired();if(t&&e){this._cancel();return}_._inactive.force()}_=this,this._initEvents(r),this._active.start()},_initEvents(r){const t=this,e=this._getEmitterTarget(r),i=lt(r),n=E.isSimulator()||!i,o=x(this.activeTimeout,30),a=x(this.inactiveTimeout,400);this._active=new $(n?o:0,(()=>{t._fireEvent("dxactive",r,{target:e})})),this._inactive=new $(n?a:0,(()=>{t._fireEvent("dxinactive",r,{target:e}),_=null}))},cancel(r){this.end(r)},end(r){const t=r.type!==X.up;t?this._active.stop():this._active.force(),this._inactive.start(),t&&this._inactive.force()},dispose(){this._active.stop(),this._inactive.stop(),_===this&&(_=null),this.callBase()},lockInactive(){return this._active.force(),this._inactive.stop(),_=null,this._cancel(),this._inactive.force.bind(this._inactive)}});R.lock=function(r){const t=_?_.lockInactive():g;r.done(t)};ht({emitter:R,events:["dxactive","dxinactive"]});const{lock:zt}=R;function Ht(r,t,e){function i(n){return typeof n=="string"?n.split("."):typeof n=="number"?[n]:n}r=i(r),t=i(t);let s=Math.max(r.length,t.length);isFinite(e)&&(s=Math.min(s,e));for(let n=0;n<s;n++){const o=parseInt(r[n]||0,10),a=parseInt(t[n]||0,10);if(o<a)return-1;if(o>a)return 1}return 0}const Lt="dx-state-focused";function q(r,t,e){const i=r==="role"||r==="id"?r:`aria-${r}`,s=w(t)?t.toString():null;e.attr(i,s)}class W extends dt{constructor(){super(...arguments),this._feedbackHideTimeout=400,this._feedbackShowTimeout=30}static getOptionsFromContainer(t){let{name:e,fullName:i,value:s}=t,n={};if(e===i)n=s;else{const o=i.split(".").pop();n[o]=s}return n}_supportedKeys(t){return{}}_getDefaultOptions(){return T(super._getDefaultOptions(),{hoveredElement:null,isActive:!1,disabled:!1,visible:!0,hint:void 0,activeStateEnabled:!1,onContentReady:null,hoverStateEnabled:!1,focusStateEnabled:!1,tabIndex:0,accessKey:void 0,onFocusIn:null,onFocusOut:null,onKeyboardHandled:null,ignoreParentReadOnly:!1,useResizeObserver:!0})}_defaultOptionsRules(){return[...super._defaultOptionsRules(),{device(){const e=E.real(),{platform:i}=e,{version:s}=e;return i==="ios"&&Ht(s,"13.3")<=0},options:{useResizeObserver:!1}}]}_init(){super._init(),this._initContentReadyAction()}_innerWidgetOptionChanged(t,e){const i=W.getOptionsFromContainer(e);t&&t.option(i),this._options.cache(e.name,i)}_bindInnerWidgetOptions(t,e){const i=()=>this._options.silent(e,T({},t.option()));i(),t.on("optionChanged",i)}_getAriaTarget(){return this._focusTarget()}_initContentReadyAction(){this._contentReadyAction=this._createActionByOption("onContentReady",{excludeValidators:["disabled","readOnly"]})}_initMarkup(){const{disabled:t,visible:e}=this.option();this.$element().addClass("dx-widget"),this._toggleDisabledState(t),this._toggleVisibility(e),this._renderHint(),this._isFocusable()&&this._renderFocusTarget(),super._initMarkup()}_render(){super._render(),this._renderContent(),this._renderFocusState(),this._attachFeedbackEvents(),this._attachHoverEvents(),this._toggleIndependentState()}_renderHint(){const{hint:t}=this.option();this.$element().attr("title",t||null)}_renderContent(){K((()=>this._disposed?void 0:this._renderContentImpl())).done((()=>this._disposed?void 0:this._fireContentReadyAction()))}_renderContentImpl(){}_fireContentReadyAction(){return K((()=>{var t;return(t=this._contentReadyAction)===null||t===void 0?void 0:t.call(this)}))}_dispose(){this._contentReadyAction=null,this._detachKeyboardEvents(),super._dispose()}_resetActiveState(){this._toggleActiveState(this._eventBindingTarget(),!1)}_clean(){this._cleanFocusState(),this._resetActiveState(),super._clean(),this.$element().empty()}_toggleVisibility(t){this.$element().toggleClass("dx-state-invisible",!t)}_renderFocusState(){this._attachKeyboardEvents(),this._isFocusable()&&(this._renderFocusTarget(),this._attachFocusEvents(),this._renderAccessKey())}_renderAccessKey(){const t=this._focusTarget(),{accessKey:e}=this.option();t.attr("accesskey",e)}_isFocusable(){const{focusStateEnabled:t,disabled:e}=this.option();return t&&!e}_eventBindingTarget(){return this.$element()}_focusTarget(){return this._getActiveElement()}_isFocusTarget(t){return l(this._focusTarget()).toArray().includes(t)}_findActiveTarget(t){return t.find(this._activeStateUnit).not(".dx-state-disabled")}_getActiveElement(){const t=this._eventBindingTarget();return this._activeStateUnit?this._findActiveTarget(t):t}_renderFocusTarget(){const{tabIndex:t}=this.option();this._focusTarget().attr("tabIndex",t)}_keyboardEventBindingTarget(){return this._eventBindingTarget()}_refreshFocusEvent(){this._detachFocusEvents(),this._attachFocusEvents()}_focusEventTarget(){return this._focusTarget()}_focusInHandler(t){t.isDefaultPrevented()||this._createActionByOption("onFocusIn",{beforeExecute:()=>this._updateFocusState(t,!0),excludeValidators:["readOnly"]})({event:t})}_focusOutHandler(t){t.isDefaultPrevented()||this._createActionByOption("onFocusOut",{beforeExecute:()=>this._updateFocusState(t,!1),excludeValidators:["readOnly","disabled"]})({event:t})}_updateFocusState(t,e){let{target:i}=t;this._isFocusTarget(i)&&this._toggleFocusClass(e,l(i))}_toggleFocusClass(t,e){(e!=null&&e.length?e:this._focusTarget()).toggleClass("dx-state-focused",t)}_hasFocusClass(t){return l(t??this._focusTarget()).hasClass("dx-state-focused")}_isFocused(){return this._hasFocusClass()}_getKeyboardListeners(){return[]}_attachKeyboardEvents(){this._detachKeyboardEvents();const{focusStateEnabled:t,onKeyboardHandled:e}=this.option(),i=this._getKeyboardListeners().length;(t||i||!!e)&&(this._keyboardListenerId=F.on(this._keyboardEventBindingTarget(),this._focusTarget(),(o=>this._keyboardHandler(o))))}_keyboardHandler(t,e){if(!e){const{originalEvent:n,keyName:o,which:a}=t,c=this._supportedKeys(n),h=c[o]||c[a];if(h!==void 0&&!h.bind(this)(n,t))return!1}const i=this._getKeyboardListeners(),{onKeyboardHandled:s}=this.option();return i.forEach((n=>n==null?void 0:n._keyboardHandler(t))),s&&s(t),!0}_refreshFocusState(){this._cleanFocusState(),this._renderFocusState()}_cleanFocusState(){this._focusTarget().removeAttr("tabIndex"),this._toggleFocusClass(!1),this._detachFocusEvents(),this._detachKeyboardEvents()}_detachKeyboardEvents(){F.off(this._keyboardListenerId),this._keyboardListenerId=null}_attachHoverEvents(){const{hoverStateEnabled:t}=this.option(),e=this._activeStateUnit,i=this._eventBindingTarget();M.off(i,{selector:e,namespace:"UIFeedback"}),t&&M.on(i,new k((s=>{let{event:n,element:o}=s;this._hoverStartHandler(n),this.option("hoveredElement",l(o))}),{excludeValidators:["readOnly"]}),(s=>{this.option("hoveredElement",null),this._hoverEndHandler(s)}),{selector:e,namespace:"UIFeedback"})}_attachFeedbackEvents(){const{activeStateEnabled:t}=this.option(),e=this._activeStateUnit,i=this._eventBindingTarget();z.off(i,{namespace:"UIFeedback",selector:e}),t&&z.on(i,new k((s=>{let{event:n,element:o}=s;return this._toggleActiveState(l(o),!0,n)})),new k((s=>{let{event:n,element:o}=s;return this._toggleActiveState(l(o),!1,n)}),{excludeValidators:["disabled","readOnly"]}),{showTimeout:this._feedbackShowTimeout,hideTimeout:this._feedbackHideTimeout,selector:e,namespace:"UIFeedback"})}_detachFocusEvents(){const t=this._focusEventTarget();H.off(t,{namespace:`${this.NAME}Focus`})}_attachFocusEvents(){const t=this._focusEventTarget();H.on(t,(e=>this._focusInHandler(e)),(e=>this._focusOutHandler(e)),{namespace:`${this.NAME}Focus`,isFocusable:(e,i)=>l(i).is(_t)})}_hoverStartHandler(t){}_hoverEndHandler(t){}_toggleActiveState(t,e,i){this.option("isActive",e),t.toggleClass("dx-state-active",e)}_updatedHover(){const t=this._options.silent("hoveredElement");this._hover(t,t)}_findHoverTarget(t){return t==null?void 0:t.closest(this._activeStateUnit||this._eventBindingTarget())}_hover(t,e){var i;const{hoverStateEnabled:s,disabled:n,isActive:o}=this.option();if(e=this._findHoverTarget(e),(i=e)===null||i===void 0||i.toggleClass("dx-state-hover",!1),t&&s&&!n&&!o){const a=this._findHoverTarget(t);a==null||a.toggleClass("dx-state-hover",!0)}}_toggleDisabledState(t){this.$element().toggleClass("dx-state-disabled",!!t),this.setAria("disabled",t||void 0)}_toggleIndependentState(){const{ignoreParentReadOnly:t}=this.option();this.$element().toggleClass("dx-state-independent",t)}_setWidgetOption(t,e){if(!this[t])return;if(N(e[0])){V(e[0],((o,a)=>this._setWidgetOption(t,[o,a])));return}const i=e[0];let s=e[1];e.length===1&&(s=this.option(i));const n=this[`${t}OptionMap`];this[t].option(n?n(i):i,s)}_optionChanged(t){const{name:e,value:i,previousValue:s}=t;switch(e){case"disabled":this._toggleDisabledState(i),this._updatedHover(),this._refreshFocusState();break;case"hint":this._renderHint();break;case"ignoreParentReadOnly":this._toggleIndependentState();break;case"activeStateEnabled":this._attachFeedbackEvents();break;case"hoverStateEnabled":this._attachHoverEvents(),this._updatedHover();break;case"tabIndex":case"focusStateEnabled":this._refreshFocusState();break;case"onFocusIn":case"onFocusOut":case"useResizeObserver":break;case"accessKey":this._renderAccessKey();break;case"hoveredElement":this._hover(i,s);break;case"isActive":this._updatedHover();break;case"visible":this._toggleVisibility(i),this._isVisibilityChangeSupported()&&this._checkVisibilityChanged(i?"shown":"hiding");break;case"onKeyboardHandled":this._attachKeyboardEvents();break;case"onContentReady":this._initContentReadyAction();break;default:super._optionChanged(t)}}_isVisible(){const{visible:t}=this.option();return super._isVisible()&&t}beginUpdate(){this._ready(!1),super.beginUpdate()}endUpdate(){super.endUpdate(),this._initialized&&this._ready(!0)}_ready(t){return arguments.length===0?!!this._isReady:(this._isReady=!!t,this._isReady)}setAria(){if(!N(arguments.length<=0?void 0:arguments[0]))q(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],(arguments.length<=2?void 0:arguments[2])||this._getAriaTarget());else{const t=(arguments.length<=1?void 0:arguments[1])||this._getAriaTarget();V(arguments.length<=0?void 0:arguments[0],((e,i)=>q(e,i,t)))}}isReady(){return this._ready()}repaint(){this._refresh()}focus(){H.trigger(this._focusTarget())}registerKeyHandler(t,e){const i=this._supportedKeys();this._supportedKeys=()=>p({},i,{[t]:e})}}const At=r=>{const e=l(r).closest('[class^="dx-swatch-"], [class*=" dx-swatch-"]'),i=ut();if(!e.length)return i;const s=new RegExp("(\\s|^)(dx-swatch-.*?)(\\s|$)"),n=e[0].className.match(s)[2];let o=i.children(`.${n}`);return o.length||(o=l("<div>").addClass(n).appendTo(i)),o},xt={getSwatchContainer:At},Vt=C.getWindow(),tt={top:{my:"top center",at:"top center"},bottom:{my:"bottom center",at:"bottom center"},right:{my:"right center",at:"right center"},left:{my:"left center",at:"left center"},center:{my:"center",at:"center"},"right bottom":{my:"right bottom",at:"right bottom"},"right top":{my:"right top",at:"right top"},"left bottom":{my:"left bottom",at:"left bottom"},"left top":{my:"left top",at:"left top"}},J={h:0,v:0},It=r=>nt(r);class Ft{constructor(t){const{properties:e,elements:i}=t,{container:s,position:n,visualContainer:o}=e,{$root:a,$content:c,$wrapper:h}=i;this._properties=e,this._$root=a,this._$content=c,this._$wrapper=h,this._$markupContainer=void 0,this._$visualContainer=void 0,this._shouldRenderContentInitialPosition=!0,this._visualPosition=void 0,this._initialPosition=void 0,this._previousVisualPosition=void 0,this.updateContainer(s),this.updatePosition(n),this.updateVisualContainer(o)}get $container(){return this.updateContainer(),this._$markupContainer}get $visualContainer(){return this._$visualContainer}get position(){return this._position}set fixWrapperPosition(t){this._properties._fixWrapperPosition=t,this.styleWrapperPosition()}set restorePosition(t){this._properties.restorePosition=t}updatePosition(t){this._properties.position=t,this._position=this._normalizePosition(t),this.updateVisualContainer()}updateContainer(t){const e=t??this._properties.container;w(t)&&(this._properties.container=e),e?this._$markupContainer=l(e):this._$root&&(this._$markupContainer=xt.getSwatchContainer(this._$root)),this.updateVisualContainer(this._properties.visualContainer)}updateVisualContainer(t){w(t)&&(this._properties.visualContainer=t),this._$visualContainer=this._getVisualContainer()}restorePositionOnNextRender(t){this._shouldRenderContentInitialPosition=t||!this._visualPosition}openingHandled(){const t=!!this._properties.restorePosition;this.restorePositionOnNextRender(t)}detectVisualPositionChange(t){this._updateVisualPositionValue(),this._raisePositionedEvents(t)}positionContent(){this._shouldRenderContentInitialPosition?this._renderContentInitialPosition():(pt(this._$content,this._visualPosition),this.detectVisualPositionChange())}positionWrapper(){this._$visualContainer&&L.setup(this._$wrapper,{my:"top left",at:"top left",of:this._$visualContainer})}styleWrapperPosition(){var t,e;const n=I((t=this.$visualContainer)===null||t===void 0?void 0:t.get(0))||this._properties._fixWrapperPosition?"fixed":"absolute";(e=this._$wrapper)===null||e===void 0||e.css("position",n)}_updateVisualPositionValue(){this._previousVisualPosition=this._visualPosition,this._visualPosition=gt(this._$content)}_renderContentInitialPosition(){var t,e,i;this._renderBoundaryOffset(),vt(this._$content);const s=((t=this._$wrapper)===null||t===void 0?void 0:t.css("overflow"))??"";if((e=this._$wrapper)===null||e===void 0||e.css("overflow","hidden"),!this._properties._skipContentPositioning){const n=L.setup(this._$content,this._position);this._initialPosition=n}(i=this._$wrapper)===null||i===void 0||i.css("overflow",s),this.detectVisualPositionChange()}_raisePositionedEvents(t){var e,i;const s=this._previousVisualPosition,n=this._visualPosition,o=(s==null?void 0:s.top)===(n==null?void 0:n.top),a=(s==null?void 0:s.left)===(n==null?void 0:n.left);if(!(o&&a)){var h,d;(h=(d=this._properties).onVisualPositionChanged)===null||h===void 0||h.call(d,{event:t,previousPosition:s,position:n})}(e=(i=this._properties).onPositioned)===null||e===void 0||e.call(i,{position:this._initialPosition})}_renderBoundaryOffset(){var t,e;const i=((t=this._position)===null||t===void 0?void 0:t.boundaryOffset)??J,{v:s,h:n}=i;s&&n&&((e=this._$content)===null||e===void 0||e.css("margin",`${i.v}px ${i.h}px`))}_getVisualContainer(){var t,e,i;const s=this._properties.container,n=this._properties.visualContainer,o=it((t=this._properties.position)===null||t===void 0?void 0:t.of)?(e=this._properties.position)===null||e===void 0||(e=e.of)===null||e===void 0?void 0:e.target:(i=this._properties.position)===null||i===void 0?void 0:i.of;return n?l(n):s?l(s):o?l(o):l(Vt)}_normalizePosition(t){const e={boundaryOffset:J};if(w(t)){const i=this._positionToObject(t);return T(!0,{},e,i)}return e}_positionToObject(t){return It(t)?p({},tt[t]):t}}let P=1500,f=[];const Dt=r=>(P=x(r,P),P),Rt=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P;const{length:t}=f,e=(t?f[t-1]:r)+1;return f.push(e),e},Y=r=>{const t=f.indexOf(r);t>=0&&f.splice(t,1)},Ut=r=>f.length?f[f.length-1]===r:!1,Wt=Ot.add,b=C.getWindow(),Q=mt,D=[];Wt((()=>{u.subscribeGlobal(v.getDocument(),X.down,(r=>{for(let i=D.length-1;i>=0;i-=1){var t,e;if(!((t=(e=D[i])._proxiedDocumentDownHandler)!==null&&t!==void 0&&t.call(e,r)))return}}))}));class B extends W{_supportedKeys(){return p({},super._supportedKeys(),{escape(){this.hide()}})}_getDefaultOptions(){return p({},super._getDefaultOptions(),{activeStateEnabled:!1,visible:!1,deferRendering:!0,shading:!0,shadingColor:"",wrapperAttr:{},position:p({},tt.center),width:"80vw",minWidth:null,maxWidth:null,height:"80vh",minHeight:null,maxHeight:null,animation:{show:{type:"pop",duration:300,from:{scale:.55}},hide:{type:"pop",duration:300,from:{opacity:1,scale:1},to:{opacity:0,scale:.55}}},hideOnOutsideClick:!1,onShowing:null,onShown:null,onHiding:null,onHidden:null,contentTemplate:"content",innerOverlay:!1,restorePosition:!0,hideOnParentScroll:!1,preventScrollEvents:!0,onPositioned:null,propagateOutsideClick:!1,ignoreChildEvents:!0,_checkParentVisibility:!0,_fixWrapperPosition:!1,_loopFocus:!1,_ignorePreventScrollEventsDeprecation:!1,hideTopOverlayHandler:()=>{this.hide()}})}_defaultOptionsRules(){return[...super._defaultOptionsRules(),{device:()=>!C.hasWindow(),options:{width:null,height:null,animation:null,_checkParentVisibility:!1}}]}_setOptionsByReference(){super._setOptionsByReference(),this._optionsByReference=p({},this._optionsByReference,{animation:!0})}$wrapper(){return this._$wrapper}_eventBindingTarget(){return this._$content}ctor(t,e){super.ctor(t,e),e&&"preventScrollEvents"in e&&!e._ignorePreventScrollEventsDeprecation&&this._logDeprecatedPreventScrollEventsInfo()}_logDeprecatedPreventScrollEventsInfo(){this._logDeprecatedOptionWarning("preventScrollEvents",{since:"23.1",message:"If you enable this option, end-users may experience scrolling issues."})}_init(){super._init(),this._initActions(),this._initHideOnOutsideClickHandler(),this._initTabTerminatorHandler(),this._customWrapperClass=null,this._$wrapper=l("<div>").addClass("dx-overlay-wrapper"),this._$content=l("<div>").addClass("dx-overlay-content"),this._initInnerOverlayClass(),this.$element().addClass("dx-overlay"),this._$wrapper.attr("data-bind","dxControlsDescendantBindings: true"),this._toggleViewPortSubscription(!0);const{hideTopOverlayHandler:e}=this.option();this._initHideTopOverlayHandler(e),this._parentsScrollSubscriptionInfo={handler:i=>{this._hideOnParentsScrollHandler(i)}},this.warnPositionAsFunction()}warnPositionAsFunction(){const{position:t}=this.option();O(t)&&st.log("W0018")}_initInnerOverlayClass(){const{innerOverlay:t}=this.option();this._$content.toggleClass("dx-inner-overlay",t)}_initHideTopOverlayHandler(t){t&&(this._hideTopOverlayHandler=t)}_getActionsList(){return["onShowing","onShown","onHiding","onHidden","onPositioned","onVisualPositionChanged"]}_initActions(){this._actions={};const t=this._getActionsList();V(t,((e,i)=>{this._actions&&(this._actions[i]=this._createActionByOption(i,{excludeValidators:["disabled","readOnly"]})||g)}))}_initHideOnOutsideClickHandler(){this._proxiedDocumentDownHandler=t=>this._documentDownHandler(t)}_initMarkup(){super._initMarkup(),this._renderWrapperAttributes(),this._initPositionController()}_documentDownHandler(t){this._showAnimationProcessing&&this._stopAnimation();const{target:e}=t,i=l(e),s=y.contains(b.document,e),n=l(b.document).is(i)||s,o=l(i).closest(".dx-inner-overlay").length,a=this._$content.is(i),c=y.contains(this._$content.get(0),e);n&&!o&&!(a||c)&&this._shouldHideOnOutsideClick(t)&&this._outsideClickHandler(t);const{propagateOutsideClick:d}=this.option();return!!d}_shouldHideOnOutsideClick(t){const{hideOnOutsideClick:e}=this.option();return O(e)?e(t):!!e}_outsideClickHandler(t){const{shading:e}=this.option();e&&t.preventDefault(),this.hide()}_getAnonymousTemplateName(){return"content"}_initTemplates(){this._templateManager.addDefaultTemplates({content:new ft}),super._initTemplates()}_isTopOverlay(){const t=this._overlayStack();for(let e=t.length-1;e>=0;e-=1){const i=t[e]._findTabbableBounds();if(i.$first||i.$last)return t[e]===this}return!1}_overlayStack(){return D}_zIndexInitValue(){return B.baseZIndex()}_toggleViewPortSubscription(t){this._viewPortChangeHandle&&Q.remove(this._viewPortChangeHandle),t&&(this._viewPortChangeHandle=()=>{this._viewPortChangeHandler()},Q.add(this._viewPortChangeHandle))}_viewPortChangeHandler(){const{container:t}=this.option();this._positionController.updateContainer(t),this._refresh()}_renderWrapperAttributes(){const{wrapperAttr:t}=this.option(),e=p({},t),i=e.class;delete e.class;const s=this.$wrapper();s.attr(e),this._customWrapperClass&&s.removeClass(this._customWrapperClass),s.addClass(i),this._customWrapperClass=i}_renderVisibilityAnimate(t){return this._stopAnimation(),t?this._show():this._hide()}_getAnimationConfig(){return this._getOptionValue("animation",this)??{}}_toggleBodyScroll(t){}_animateShowing(){const t=this._getAnimationConfig(),e=this._normalizeAnimation(t.show,"to"),i=(e==null?void 0:e.start)??g,s=(e==null?void 0:e.complete)??g;this._animate(e,((n,o)=>{var a,c;if(this._isAnimationPaused)return;const{focusStateEnabled:h}=this.option();h&&u.trigger(this._focusTarget(),"focus"),s.call(this,n,o),this._showAnimationProcessing=!1,this._isHidden=!1,(a=this._actions)===null||a===void 0||(c=a.onShown)===null||c===void 0||c.call(a),this._toggleSafariScrolling(),this._showingDeferred.resolve()}),((n,o)=>{this._isAnimationPaused||(i.call(this,n,o),this._showAnimationProcessing=!0)}))}_processShowingHidingCancel(t,e,i){ot(t)?t.then((s=>{s?i():e()})).catch((()=>e())):t?i():e()}_show(){return this._showingDeferred=m(),this._parentHidden=this._isParentHidden(),this._showingDeferred.done((()=>{delete this._parentHidden})),this._parentHidden?(this._isHidden=!0,this._showingDeferred.resolve()):this._currentVisible?m().resolve().promise():(this._currentVisible=!0,this._isHidingActionCanceled?(delete this._isHidingActionCanceled,this._showingDeferred.reject()):(()=>{var e,i;this._stopAnimation();const{enableBodyScroll:s}=this.option();this._toggleBodyScroll(s),this._toggleVisibility(!0),this._$content.css("visibility","hidden"),this._$content.toggleClass("dx-state-invisible",!1),this._updateZIndexStackPosition(!0),this._positionController.openingHandled(),this._renderContent();const n={cancel:!1};(e=this._actions)===null||e===void 0||(i=e.onShowing)===null||i===void 0||i.call(e,n),this._processShowingHidingCancel(n.cancel,(()=>{this._$content.css("visibility",""),this._renderVisibility(!0),this._animateShowing()}),(()=>{this._toggleVisibility(!1),this._$content.css("visibility",""),this._$content.toggleClass("dx-state-invisible",!0),this._isShowingActionCanceled=!0,this._moveFromContainer(),this._toggleBodyScroll(!0),this.option("visible",!1),this._showingDeferred.resolve()}))})(),this._showingDeferred.promise())}_normalizeAnimation(t,e){if(!t)return;const i=p({type:"slide",skipElementInitialStyles:!0},t);return rt(i[e])&&T(i[e],{position:this._positionController.position}),i}_animateHiding(){const t=this._getAnimationConfig(),e=this._normalizeAnimation(t.hide,"from"),i=(e==null?void 0:e.start)??g,s=(e==null?void 0:e.complete)??g;this._animate(e,((n,o)=>{var a,c;this._$content.css("pointerEvents",""),this._renderVisibility(!1),s.call(this,n,o),this._hideAnimationProcessing=!1,(a=this._actions)===null||a===void 0||(c=a.onHidden)===null||c===void 0||c.call(a),this._hidingDeferred.resolve()}),((n,o)=>{this._$content.css("pointerEvents","none"),i.call(this,n,o),this._hideAnimationProcessing=!0}))}_hide(){if(!this._currentVisible)return m().resolve().promise();this._currentVisible=!1,this._hidingDeferred=m();const t={cancel:!1};if(this._isShowingActionCanceled)delete this._isShowingActionCanceled,this._hidingDeferred.reject();else{var e,i;(e=this._actions)===null||e===void 0||(i=e.onHiding)===null||i===void 0||i.call(e,t),this._toggleSafariScrolling(),this._toggleBodyScroll(!0);const s=()=>{this._isHidingActionCanceled=!0;const{enableBodyScroll:o}=this.option();this._toggleBodyScroll(o),this.option("visible",!0),this._hidingDeferred.resolve()},n=()=>{this._forceFocusLost(),this._toggleShading(!1),this._toggleSubscriptions(!1),this._animateHiding()};this._processShowingHidingCancel(t.cancel,n,s)}return this._hidingDeferred.promise()}_forceFocusLost(){const t=v.getActiveElement();!!this._$content.find(t).length&&y.resetActiveElement()}_animate(t,e,i){if(t){const s=i??t.start??g,n=p({},t,{start:s,complete:e});A.animate(this._$content.get(0),n)}else e()}_stopAnimation(){A.stop(this._$content.get(0),!0)}_renderVisibility(t){t&&this._isParentHidden()||(this._currentVisible=t,this._stopAnimation(),t||bt(this._$content),t?(this._checkContainerExists(),this._moveToContainer(),this._renderGeometry(),Ct(this._$content),U(this._$content)):(this._toggleVisibility(t),this._$content.toggleClass("dx-state-invisible",!t),this._updateZIndexStackPosition(t),this._moveFromContainer()),this._toggleShading(t),this._toggleSubscriptions(t))}_updateZIndexStackPosition(t){const e=this._overlayStack(),i=e.indexOf(this);t?(i===-1&&(this._zIndex=Rt(this._zIndexInitValue()),e.push(this)),this._$wrapper.css("zIndex",this._zIndex),this._$content.css("zIndex",this._zIndex)):i!==-1&&(e.splice(i,1),Y(this._zIndex))}_toggleShading(t){const{shading:e,shadingColor:i}=this.option();this._$wrapper.toggleClass("dx-overlay-shader",t&&e),this._$wrapper.css("backgroundColor",e?i??"":""),this._toggleTabTerminator(!!(t&&e))}_initTabTerminatorHandler(){this._proxiedTabTerminatorHandler=t=>{this._tabKeyHandler(t)}}_toggleTabTerminator(t){const{_loopFocus:e}=this.option(),i=S("keydown",this.NAME);e||t?u.on(v.getDocument(),i,this._proxiedTabTerminatorHandler):this._destroyTabTerminator()}_destroyTabTerminator(){const t=S("keydown",this.NAME);u.off(v.getDocument(),t,this._proxiedTabTerminatorHandler)}_findTabbableBounds(){const t=this._$wrapper.find("*"),e=t.length-1;let i=null,s=null;for(let n=0;n<=e;n+=1){const o=t.eq(n),a=t.eq(e-n);if(!i&&o.is(G.tabbable)&&(i=o),!s&&a.is(G.tabbable)&&(s=a),i&&s)break}return{$first:i,$last:s}}_tabKeyHandler(t){if(yt(t)!=="tab"||!this._isTopOverlay())return;const e=this._$wrapper.get(0),i=v.getActiveElement(e),{$first:s,$last:n}=this._findTabbableBounds(),o=!t.shiftKey&&i===(n==null?void 0:n.get(0)),a=t.shiftKey&&i===(s==null?void 0:s.get(0)),c=!y.contains(e,i);if(o||a||c){t.preventDefault();const d=t.shiftKey?n:s;u.trigger(d,"focusin"),u.trigger(d,"focus")}}_toggleSubscriptions(t){C.hasWindow()&&(this._toggleHideTopOverlayCallback(t),this._toggleHideOnParentsScrollSubscription(t))}_toggleHideTopOverlayCallback(t){this._hideTopOverlayHandler&&(t?Z.add(this._hideTopOverlayHandler):Z.remove(this._hideTopOverlayHandler))}_toggleHideOnParentsScrollSubscription(t){const e=S("scroll",this.NAME),i=this._parentsScrollSubscriptionInfo??{},{prevTargets:s,handler:n}=i;u.off(s,e,n);const{hideOnParentScroll:o}=this.option();if(t&&o){let a=this._getHideOnParentScrollTarget().parents();E.real().deviceType==="desktop"&&(a=a.add(b)),u.on(a,e,n),this._parentsScrollSubscriptionInfo=p({},i,{prevTargets:a})}}_hideOnParentsScrollHandler(t){let e=!1;const{hideOnParentScroll:i}=this.option();O(i)&&(e=i(t)),!e&&!this._showAnimationProcessing&&this.hide()}_getHideOnParentScrollTarget(){const{_hideOnParentScrollTarget:t}=this.option(),e=l(t);return e.length?e:this._$wrapper}_render(){super._render(),this._appendContentToElement(),this._renderVisibilityAnimate(this._isVisible())}_appendContentToElement(){this._$content.parent().is(this.$element())||this._$content.appendTo(this.$element())}_renderContent(){const{deferRendering:t}=this.option(),e=!this._currentVisible&&t;if(this._isVisible()&&this._isParentHidden()){this._isHidden=!0;return}this._contentAlreadyRendered||e||(this._contentAlreadyRendered=!0,this._appendContentToElement(),super._renderContent())}_isParentHidden(){const{_checkParentVisibility:t}=this.option();if(!t)return!1;if(this._parentHidden!==void 0)return this._parentHidden;const e=this.$element().parent();if(e.is(":visible"))return!1;let i=!1;return e.add(e.parents()).each(((s,n)=>{if(l(n).css("display")==="none")return i=!0,!1})),i||!v.getBody().contains(e.get(0))}_renderContentImpl(){const{contentTemplate:t}=this.option(),e=m(),i=this._getTemplate(t),s=this._templateManager.anonymousTemplateName===t;i==null||i.render({container:j(this.$content()),noModel:!0,transclude:s,onRendered:()=>{e.resolve();const{templatesRenderAsynchronously:o}=this.option();o&&this._dimensionChanged()}});const{preventScrollEvents:n}=this.option();return this._toggleWrapperScrollEventsSubscription(n),e.done((()=>{this._processContentRendering()})),e.promise()}_processContentRendering(){this._isVisible()&&this._moveToContainer()}_getPositionControllerConfig(){var t,e;const{container:i,visualContainer:s,restorePosition:n,_fixWrapperPosition:o,_skipContentPositioning:a}=this.option(),c={container:i,visualContainer:s,restorePosition:n,_fixWrapperPosition:o,_skipContentPositioning:a,onPositioned:(t=this._actions)===null||t===void 0?void 0:t.onPositioned,onVisualPositionChanged:(e=this._actions)===null||e===void 0?void 0:e.onVisualPositionChanged},h={$root:this.$element(),$content:this._$content,$wrapper:this._$wrapper};return{properties:c,elements:h}}_initPositionController(){this._positionController=new Ft(this._getPositionControllerConfig())}_toggleWrapperScrollEventsSubscription(t){const e=S(St,this.NAME);if(u.off(this._$wrapper,e),t){const i=n=>{const{originalEvent:o}=n.originalEvent,{type:a}=o??{},c=a==="wheel",h=a==="mousemove",d=c&&Et(n);n._cancelPreventDefault=!0,o&&n.cancelable!==!1&&!(h||d)&&n.preventDefault()},s={validate:()=>!0,getDirection:()=>"both",_toggleGestureCover(n){n||this._toggleGestureCoverImpl(n)},_clearSelection:g,isNative:!0};u.on(this._$wrapper,e,s,i)}}_moveFromContainer(){this._$content.appendTo(this.$element()),this._$wrapper.detach()}_checkContainerExists(){const t=this._positionController.$container;if(t===void 0)return;t.length>0||$t.log("W1021",this.NAME)}_moveToContainer(){const t=this._positionController.$container;t!==void 0&&this._$wrapper.appendTo(t),this._$content.appendTo(this._$wrapper)}_renderGeometry(){this._isVisible()&&C.hasWindow()&&(this._stopAnimation(),this._renderGeometryImpl())}_renderGeometryImpl(){this._positionController.updatePosition(this._getOptionValue("position")),this._renderWrapper(),this._renderDimensions(),this._renderPosition()}_renderPosition(t){this._positionController.positionContent()}_isAllWindowCovered(){var t;const{shading:e}=this.option(),i=(t=this._positionController.$visualContainer)===null||t===void 0?void 0:t.get(0);return I(i)&&!!e}_toggleSafariScrolling(){const t=this._isVisible(),e=l(v.getBody()),i=E.real().platform==="ios"&&wt.safari,s=this._isAllWindowCovered(),n=e.hasClass("dx-prevent-safari-scrolling"),o=!n&&t&&s,a=n&&(!t||!s||this._disposed);i&&(a?(e.removeClass("dx-prevent-safari-scrolling"),b.scrollTo(0,this._cachedBodyScrollTop),this._cachedBodyScrollTop=void 0):o&&(this._cachedBodyScrollTop=b.pageYOffset,e.addClass("dx-prevent-safari-scrolling")))}_renderWrapper(){this._positionController.styleWrapperPosition(),this._renderWrapperDimensions(),this._positionController.positionWrapper()}_renderWrapperDimensions(){const{$visualContainer:t}=this._positionController,e=v.getDocumentElement(),i=I(t==null?void 0:t.get(0)),s=i?e.clientWidth:Pt(t),n=i?b.innerHeight:Tt(t);this._$wrapper.css({width:s,height:n})}_renderDimensions(){const t=this._$content.get(0);this._$content.css({minWidth:this._getOptionValue("minWidth",t),maxWidth:this._getOptionValue("maxWidth",t),minHeight:this._getOptionValue("minHeight",t),maxHeight:this._getOptionValue("maxHeight",t),width:this._getOptionValue("width",t),height:this._getOptionValue("height",t)})}_focusTarget(){return this._$content}_attachKeyboardEvents(){this._keyboardListenerId=F.on(this._$content,null,(t=>this._keyboardHandler(t)))}_keyboardHandler(t,e){const i=t.originalEvent,s=l(i.target),{ignoreChildEvents:n}=this.option();(s.is(this._$content)||!n)&&super._keyboardHandler(t,e)}_isVisible(){return!!this.option("visible")}_visibilityChanged(t){t?this._isVisible()&&this._renderVisibilityAnimate(t):this._renderVisibilityAnimate(t)}_dimensionChanged(){this._renderGeometry()}_clean(){this._contentAlreadyRendered||this.$content().empty(),this._renderVisibility(!1),this._cleanFocusState()}_dispose(){A.stop(this._$content.get(0),!1),this._toggleViewPortSubscription(!1),this._toggleSubscriptions(!1),this._updateZIndexStackPosition(!1),this._actions={},this._parentsScrollSubscriptionInfo=void 0,super._dispose(),this._toggleSafariScrolling(),this._isVisible()&&Y(this._zIndex),this._$wrapper.remove(),this._$content.remove(),this._destroyTabTerminator()}_toggleRTLDirection(t){this._$content.toggleClass("dx-rtl",t)}_optionChanged(t){const{value:e,name:i}=t;if(this._getActionsList().includes(i)){this._initActions();return}switch(i){case"animation":case"hideOnOutsideClick":case"propagateOutsideClick":break;case"_loopFocus":case"shading":this._toggleShading(this._isVisible()),this._toggleSafariScrolling();break;case"shadingColor":this._toggleShading(this._isVisible());break;case"width":case"height":case"minWidth":case"maxWidth":case"minHeight":case"maxHeight":this._renderGeometry();break;case"position":{const{position:s}=this.option();this._positionController.updatePosition(s),this._positionController.restorePositionOnNextRender(!0),this._renderGeometry(),this._toggleSafariScrolling();break}case"visible":this._renderVisibilityAnimate(!!e).done((()=>{var s;return(s=this._animateDeferred)===null||s===void 0?void 0:s.resolveWith(this)})).fail((()=>{var s;return(s=this._animateDeferred)===null||s===void 0?void 0:s.reject()}));break;case"container":this._positionController.updateContainer(e),this._invalidate(),this._toggleSafariScrolling();break;case"visualContainer":this._positionController.updateVisualContainer(e),this._renderWrapper(),this._toggleSafariScrolling();break;case"innerOverlay":this._initInnerOverlayClass();break;case"deferRendering":case"contentTemplate":this._contentAlreadyRendered=!1,this._clean(),this._invalidate();break;case"hideTopOverlayHandler":this._toggleHideTopOverlayCallback(!1),this._initHideTopOverlayHandler(e),this._toggleHideTopOverlayCallback(this._isVisible());break;case"hideOnParentScroll":case"_hideOnParentScrollTarget":this._toggleHideOnParentsScrollSubscription(this._isVisible());break;case"rtlEnabled":this._contentAlreadyRendered=!1,super._optionChanged(t);break;case"_fixWrapperPosition":this._positionController.fixWrapperPosition=e;break;case"wrapperAttr":this._renderWrapperAttributes();break;case"restorePosition":this._positionController.restorePosition=e;break;case"preventScrollEvents":this._logDeprecatedPreventScrollEventsInfo(),this._toggleWrapperScrollEventsSubscription(e);break;default:super._optionChanged(t)}}toggle(t){const e=this._isVisible(),i=t??!e,s=m();if(i===e)return s.resolveWith(this,[i]).promise();const n=m();return this._animateDeferred=n,this.option("visible",i),n.promise().done((()=>{delete this._animateDeferred,s.resolveWith(this,[this._isVisible()])})).fail((()=>{delete this._animateDeferred,s.reject()})),s.promise()}$content(){return this._$content}show(){return this.toggle(!0)}hide(){return this.toggle(!1)}content(){return j(this._$content)}repaint(){this._contentAlreadyRendered?(this._positionController.restorePositionOnNextRender(!0),this._renderGeometry({forceStopAnimation:!0}),U(this._$content)):super.repaint()}static baseZIndex(t){return Dt(t)}}kt("dxOverlay",B);export{Mt as A,Lt as F,B as O,W,Ft as a,Rt as c,Ut as i,zt as l,Y as r,xt as s};
