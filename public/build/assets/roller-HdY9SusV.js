import{v as V,a as s,e as D,l as F,m as R,D as w,u as _}from"./data-grid-DhSmMBcn.js";import{d as L,r as u,G as N,c as O,e as M,g as b,b as t,f as m,m as a,b3 as d,o as v}from"./main-B_DZspM6.js";import{u as j}from"./pageTitle-DpO4PNZl.js";import"./index-U8e-Cu3E.js";import"./ui.errors-DEShB_tY.js";import"./m_row_dragging-C-dQ4Wmf.js";import"./m_select_box-6ULzz9_z.js";import"./overlay-Aq3QWzbM.js";import"./themes-BzRKG0fA.js";import"./editor-Cje8GVmU.js";import"./m_resize_observer-BIi_P_4y.js";import"./format_helper-cn-LPU2t.js";const q={class:"grids"},ne=L({__name:"roller",setup(H){const g=j();g.setTitle("Kullanıcı Rolleri"),g.setToplam(""),document.title="OFT - Roller";const f=u([]),h=u([]),l=u([]),r=u([]),i=u([]),x=u(0),k=u(0),y=e=>e&&["ALL"].indexOf(e.trim().toUpperCase())>=0,P=e=>!y(e.row.data.name),A=e=>!y(e.row.data.name),E=e=>{$(e)},I=e=>{G(e)},S=e=>{K(e)},$=e=>{e.promise=new Promise(async(o,n)=>{try{const c={...e.oldData,...e.newData};await d.put(`/api/rolGuncelle/${e.key}`,c),await p(),e.component.cancelEditData(),o()}catch(c){console.error("Error updating data:",c),n()}})},G=e=>{e.promise=new Promise(async(o,n)=>{try{await d.post("/api/rolEkle",{name:e.data.name}),await p(),e.component.cancelEditData(),o()}catch(c){console.error("Error adding data:",c),n()}})},K=e=>{e.promise=new Promise(async(o,n)=>{try{await d.delete(`/api/rolSil/${e.key}`),await p(),e.component.cancelEditData(),o()}catch(c){console.error("Error deleting data:",c),n()}})},p=async()=>{const{data:e}=await d.get("/api/roles-count");f.value=e},z=async()=>{const e=await d.get(`/api/roles-users/${l.value.name}`);h.value=e.data},C=async()=>{if(!l.value)return;const{data:e}=await d.get(`/api/roles/${l.value.id}/permissions`);i.value=e.assigned,r.value=e.available},T=async e=>{try{const o=e.itemData;if(!l.value||!o)return;i.value.push(o),r.value=r.value.filter(n=>n.id!==o.id),i.value=[...i.value],r.value=[...r.value],await d.post(`/api/roles/${l.value.id}/permissions`,{permission_id:o.id})}catch(o){console.error("İzin atama işlemi başarısız oldu:",o)}},U=async e=>{const o=e.itemData;!l.value||!o||(r.value.push(o),i.value=i.value.filter(n=>n.id!==o.id),i.value=[...i.value],r.value=[...r.value],await d.delete(`/api/roles/${l.value.id}/permissions/${o.id}`))};N(async()=>{p()});const B=e=>{const o=e.row.data;l.value=o,C(),z()};return(e,o)=>(v(),O("div",null,[M("div",q,[(v(),b(a(w),{"data-source":f.value,key:x.value,"key-expr":"id","show-borders":!0,width:"400","columns-auto-width":!0,"row-alternation-enabled":!0,"focused-row-enabled":!0,"show-indicator":!0,onFocusedRowChanged:B,onRowUpdating:E,onRowInserting:I,onRowRemoving:S},{default:m(()=>[t(a(V),{"allow-updating":A,"allow-adding":!0,"allow-deleting":P,"use-icons":!0,mode:"row"}),t(a(s),{"data-field":"id",caption:"Rol ID",width:"60","allow-editing":!1}),t(a(s),{"data-field":"name",caption:"Rol Adı",width:"120"}),t(a(s),{"data-field":"guard_name",caption:"Guard",width:"70"}),t(a(s),{"data-field":"users_count",caption:"KllAd",width:"60"}),t(a(D),{mode:"virtual","column-rendering-mode":"virtual"}),t(a(F),{visible:!0,width:240,placeholder:"Ara..."}),t(a(R),{mode:"none"})]),_:1},8,["data-source"])),(v(),b(a(w),{"data-source":h.value,key:k.value,"key-expr":"id","show-borders":!0,width:"300",title:"Atanmış İzinler","columns-auto-width":!0,"row-alternation-enabled":!1,"focused-row-enabled":!0,"show-indicator":!0,"allow-column-reordering":!0},{default:m(()=>[t(a(s),{caption:"Atanmış Kullanıcılar",alignment:"center"},{default:m(()=>[t(a(s),{"data-field":"id",caption:"ID",width:"60","allow-editing":!1}),t(a(s),{"data-field":"name",caption:"Kullanıcı Adı",width:"200"})]),_:1}),t(a(D),{mode:"virtual","column-rendering-mode":"virtual"}),t(a(R),{mode:"none"})]),_:1},8,["data-source"])),t(a(w),{"data-source":r.value,"show-borders":!0},{default:m(()=>[t(a(_),{group:"permissionsGroup","on-add":U}),t(a(s),{"data-field":"name",caption:"Atanmamış İzinler"})]),_:1},8,["data-source"]),t(a(w),{"data-source":i.value,"show-borders":!0},{default:m(()=>[t(a(_),{group:"permissionsGroup","on-add":T}),t(a(s),{"data-field":"name",caption:"Atanmış İzinler"})]),_:1},8,["data-source"])])]))}});export{ne as default};
