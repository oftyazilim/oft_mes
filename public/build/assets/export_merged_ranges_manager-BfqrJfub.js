import{d4 as i,d_ as I,d1 as E,dc as v,da as A,e0 as S,eo as W,e1 as q,d$ as X,d2 as z,dd as G}from"./main-DCUJhUhR.js";import{s as x,o as T}from"./dom_component-BKjseBUi.js";import{d as Q}from"./m_select_box-DmabWyr0.js";import{g as V}from"./m_row_dragging-BGM0kDgc.js";import{g as U}from"./language_codes-LmU07nLw.js";class B{constructor(e,n,o,r){this._$targetElement=n,this._$container=o,this._loadPanel=e._createComponent(x("<div>").addClass("dx-export-loadpanel").appendTo(this._$container),Q,this.getOptions(r))}getDefaultOptions(){return{animation:null,shading:!1,height:90,width:200,container:this._$container}}getOptions(e){return i(e.text)?e.message=e.text:e.message=I.format("dxDataGrid-exporting"),E(this.getDefaultOptions(),e)}show(){this._loadPanel.option("position",V.calculateLoadPanelPosition(this._$targetElement)),this._loadPanel.show()}dispose(){x(this._loadPanel.element()).remove(),delete this._loadPanel}}const $={thousands:"#,##0{0},&quot;K&quot;",millions:"#,##0{0},,&quot;M&quot;",billions:"#,##0{0},,,&quot;B&quot;",trillions:"#,##0{0},,,,&quot;T&quot;",percent:"0{0}%",decimal:"#{0}",fixedpoint:"#,##0{0}",exponential:"0{0}E+00",currency:" "},Y=/a+/g,J=/E/g,K=/dE+/g,Z=/L/g,ee=/h/g,te=/./g;function ne(t,e){let n,o;if(e>0){for(n=t!=="decimal"?".":"",o=0;o<e;o+=1)n+="0";return n}return""}function oe(t){let e;for(let n=0;n<t.length;n+=1)if(e=t.charCodeAt(n),e>=1632&&e<1642)return!0;return!1}function re(t){const e=(S.format(new Date(2009,8,8,6,5,4),t)||"").toString();let n=W((o=>S.format(o,t)));return n&&(n=se(n),n=le(e)+n),n}function le(t){const e=U();let n=e?e.toString(16):"",o="";if(oe(t)){for(;n.length<3;)n=`0${n}`;o=`[$-2010${n}]`}else n&&(o=`[$-${n}]`);return o}function se(t){return t.split("/").join("\\/").split("'").map(((e,n)=>n%2===0?e.replace(Y,"AM/PM").replace(K,"d").replace(J,"d").replace(Z,"M").replace(ee,"H").split("[").join("\\[").split("]").join("\\]"):e?e.replace(te,"\\$&"):"'")).join("")}function ae(t,e,n){let o,r;return t==="currency"?r=q.getOpenXmlCurrencyFormat(n):r=$[t.toLowerCase()],r&&(o=X(r,ne(t,e))),o}function ie(t){return!t||t.length<2?!1:k(t)}function ce(t,e){return!t||t.length<4||t[0]!==e?!1:k(t.substring(1,t.length-1))}function k(t){return t?/^[@=\t\r]/.test(t)?!0:/^[+-]/.test(t)?!z(t):!1:!1}const P={formatObjectConverter(t,e){const n={format:t,precision:t==null?void 0:t.precision,dataType:e};return A(t)?E(n,t,{format:t.formatter||t.type,currency:t.currency}):n},convertFormat(t,e,n,o){if(i(t)){if(n==="date")return re(t);if(v(t)&&$[t.toLowerCase()])return ae(t,e,o)}},encode(t){let e=!1;return ie(t)?e=!0:ce(t,'"')&&(t=t.substring(1,t.length-1),e=!0),e?`"'${t.replaceAll('"','""')}"`:t}},pe={getFullOptions(t){const e=E({},t);if(!(i(e.worksheet)&&A(e.worksheet)))throw Error('The "worksheet" field must contain an object.');if(!i(e.topLeftCell))e.topLeftCell={row:1,column:1};else if(v(e.topLeftCell)){const{row:n,col:o}=e.worksheet.getCell(e.topLeftCell);e.topLeftCell={row:n,column:o}}return i(e.keepColumnWidths)||(e.keepColumnWidths=!0),i(e.loadPanel)||(e.loadPanel={}),i(e.loadPanel.enabled)||(e.loadPanel.enabled=!0),i(e.encodeExecutableContent)||(e.encodeExecutableContent=!1),e},convertDateForExcelJS:t=>new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())),setNumberFormat(t,e){t.numFmt=e},getCellStyles(t){const e=t.getStyles();return e.forEach((n=>{let o=this.tryConvertToExcelNumberFormat(n.format,n.dataType);i(o)&&(o=o.replace(/&quot;/g,'"')),n.numberFormat=o})),e},tryConvertToExcelNumberFormat(t,e){const n=P.formatObjectConverter(t,e),{currency:o}=n;return t=n.format,e=n.dataType,P.convertFormat(t,n.precision,e,o)},setAlignment(t,e,n){t.alignment=t.alignment??{},i(e)&&(t.alignment.wrapText=e),i(n)&&(t.alignment.horizontal=n),t.alignment.vertical="top"},setColumnsWidth(t,e,n){if(i(e))for(let o=0;o<e.length;o+=1){const r=e[o];typeof r=="number"&&isFinite(r)&&(t.getColumn(n+o).width=Math.min(255,Math.floor(r/7*100)/100))}},export(t,e,n,o){var r,a;const{component:l,worksheet:c,topLeftCell:f,keepColumnWidths:u,selectedRowsOnly:p,loadPanel:s,encodeExecutableContent:h}=t,d=l.getDataProvider(p),C=(a=(((r=l._getInternalInstance)===null||r===void 0?void 0:r.call(l))||l).option("loadPanel"))===null||a===void 0?void 0:a.enabled;C&&l.option("loadPanel.enabled",!1);let b;if(s.enabled&&T()){const F=n(l),w=o(l);b=new B(l,F,w,s),b.show()}const j=!!l.option("wordWrapEnabled");c.properties.outlineProperties={summaryBelow:!1,summaryRight:!1};const m={from:{row:f.row,column:f.column},to:{row:f.row,column:f.column}};return new Promise((F=>{d.ready().done((()=>{const w=d.getColumns(),N=d.getRowsCount(),g=new e(l,d,c,t);u&&this.setColumnsWidth(c,d.getColumnsWidths(),m.from.column),g._exportAllFieldHeaders(w,this.setAlignment);const O=g._getFieldHeaderRowsCount();m.to.row=m.from.row+O;const H=this.getCellStyles(d);for(let _=0;_<N;_+=1){const M=m.from.row+O+_,L=c.getRow(M);let y=0;g._isRowFieldHeadersRow(_)&&(y=d.getRowAreaColCount(),g._exportFieldHeaders("row",M,0,y,this.setAlignment)),g._trySetOutlineLevel(L,_),this.exportRow(d,g,L,_,y,w.length,j,H,h),m.to.row=M}g.mergedRangesManager.applyMergedRages(),m.to.column+=w.length>0?w.length-1:0;const R=c.views[0]||{};l.option("rtlEnabled")&&(R.rightToLeft=!0),g._isFrozenZone(d)&&(Object.keys(R).includes("state")||E(R,g._getWorksheetFrozenState(m)),g._trySetAutoFilter(m)),Object.keys(R).length>0&&(c.views=[R]),F(m)})).always((()=>{C&&l.option("loadPanel.enabled",C),s.enabled&&T()&&b.dispose()}))}))},exportRow(t,e,n,o,r,a,l,c,f){for(let u=r;u<a;u+=1){const p=t.getCellData(o,u,!0),s=n.getCell(e._getFirstColumnIndex()+u);e.mergedRangesManager.updateMergedRanges(s,o,u,e);const h=e.mergedRangesManager.findMergedCellInfo(o,u,e._isHeaderCell(o,u));if(i(h)&&s!==h.masterCell)s.style=h.masterCell.style,s.value=h.masterCell.value;else if(G(p.value)?s.value=this.convertDateForExcelJS(p.value):s.value=p.value,i(s.value)){const{bold:d,alignment:D,numberFormat:C}=c[t.getStyleId(o,u)];i(C)?this.setNumberFormat(s,C):v(s.value)&&/^[@=+-]/.test(s.value)&&this.setNumberFormat(s,"@"),e._trySetFont(s,d),this.setAlignment(s,l,D)}e._customizeCell(s,p.cellSourceData),f&&(s.value=P.encode(s.value))}}};class he{constructor(e,n){this.dataProvider=e,this.worksheet=n,this.mergedCells=[],this.mergedRanges=[]}updateMergedRanges(e,n,o,r){if(r._isHeaderCell(n,o)&&!this.isCellInMergedRanges(n,o)){const{rowspan:a,colspan:l}=this.dataProvider.getCellMerging(n,o);if(l||a){const f=r._allowToMergeRange(n,o,a,l);if(this.updateMergedCells(e,n,o,a,l),f){const u=r._isInfoCell(n,o)&&r._allowExportRowFieldHeaders();this.mergedRanges.push({masterCell:e,rowspan:a-(u&&a>0),colspan:l})}}}}isCellInMergedRanges(e,n){var o;return(o=this.mergedCells[e])===null||o===void 0?void 0:o[n]}findMergedCellInfo(e,n,o){if(o&&this.isCellInMergedRanges(e,n))return this.mergedCells[e][n]}updateMergedCells(e,n,o,r,a){for(let l=n;l<=n+r;l+=1)for(let c=o;c<=o+a;c+=1)this.mergedCells[l]||(this.mergedCells[l]=[]),this.mergedCells[l][c]={masterCell:e}}addMergedRange(e,n,o){this.mergedRanges.push({masterCell:e,rowspan:n,colspan:o})}applyMergedRages(){this.mergedRanges.forEach((e=>{const n=e.masterCell.fullAddress.row,o=e.masterCell.fullAddress.col,r=n+e.rowspan,a=o+e.colspan;this.worksheet.mergeCells(n,o,r,a)}))}}export{pe as E,he as M};
