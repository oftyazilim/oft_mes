import{d as Y,eX as I,eY as K,r as y,A as H,aI as g,w as F,g as D,f as l,b as i,c as h,j as O,e as p,aX as R,aB as f,k as C,L as b,m as X,u as k,au as $,F as G,o as V,l as U}from"./main-CqlTUwGQ.js";import{d as q}from"./dayjs.min-WZT4ZYRx.js";import{s as J,D as A,k as Q,d as W}from"./data-grid-Cmz8SCuy.js";import{V as Z}from"./VDialog-Bd7WOOiz.js";import{a as ee,b as ae,V as ie}from"./VCard-DNsCm0Sx.js";import{V as te}from"./VCardText-CFL57jaN.js";import{V as se}from"./VRow-CP2Olxkj.js";import{V as N}from"./VCol-DSRh1xkA.js";import{V as le,a as re,b as oe}from"./VList-BcSECHo5.js";import{V as ne}from"./VSpacer-DuPx_nYU.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./editor-C7QDOJBp.js";import"./overlay-BhkxhbzC.js";import"./m_row_dragging-D1DCBETe.js";import"./m_select_box-CBeGJAQ-.js";import"./themes-ZcQ-fVem.js";import"./VOverlay-DkEUCYcj.js";import"./easing-Bybner-F.js";import"./delay-BNW1iJqW.js";import"./lazy-CiIkgo25.js";import"./scopeId-Df149Z8l.js";import"./VImg-DOH9OiQI.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-RLrxPCGG.js";import"./VAvatar-BoW3ra5F.js";/* empty css              */import"./ssrBoot-CV0k3B80.js";import"./VDivider-BGmZt71V.js";const de={key:0,class:"dialog-loading-overlay d-flex flex-column align-center justify-center"},ue={class:"text-caption text-end"},me={class:"ps-6"},ce=Y({__name:"PersonelSecDialog",props:I({isemriID:{},istasyonId:{},guid:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:I(["kaydedildi","iptal"],["update:modelValue"]),setup(x,{emit:B}){const w=B,_=K(x,"modelValue"),d=x,S=y([]),n=y([]),o=y([]),u=y(!1);H(async()=>{const{data:t}=await g.get("/api/personeller");S.value=t}),F(_,async t=>{if(t){n.value=S.value.map(e=>({...e}));try{const e=await g.get("/api/aktif-ekipler",{params:{isemriID:d.isemriID,guid:d.guid}}),s=Array.isArray(e.data)?e.data:Object.values(e.data);o.value=s.map(a=>({register_id:a.register_id,ad_soyad:a.personel_full_name,kimlik_no:a.citizenship_no,istasyon_id:a.istasyon_id,sicil_no:a.sicil_no}));const m=new Set(o.value.map(a=>a.register_id));n.value=n.value.filter(a=>!m.has(a.register_id))}catch(e){console.error("Aktif ekip yüklenemedi:",e)}}});const P=t=>{const e=n.value.splice(t,1)[0];o.value.push(e)},z=t=>{const e=o.value.splice(t,1)[0];n.value.push(e)},j=t=>{const e=n.value.findIndex(s=>s.register_id===t);e!==-1&&P(e)},E=async()=>{if(u.value)return;u.value=!0;const t=q().format("YYYY-MM-DD HH:mm:ss");try{const{data:e}=await g.get("/api/aktif-ekipler",{params:{isemriID:d.isemriID,guid:d.guid}}),s=new Set((Array.isArray(e)?e:Object.values(e)).filter(r=>r.end_work_time===null).map(r=>r.register_id)),m=new Set(o.value.map(r=>r.register_id)),a=o.value.filter(r=>!s.has(r.register_id)),c=Array.from(s).filter(r=>!m.has(r));if(a.length){const r=a.map(v=>({istasyon_id:d.istasyonId,worder_m_id:d.isemriID,register_id:v.register_id,sicil_no:v.sicil_no,personel_full_name:v.ad_soyad,citizenship_no:v.kimlik_no,co_id:2517,start_work_time:t,end_work_time:null,guid:d.guid}));await g.post("/api/aktif-ekipler",r)}c.length&&await g.put("/api/aktif-ekipler/kapat",{register_ids:c,guid:d.guid,end_work_time:t}),w("kaydedildi")}catch(e){console.error("KAYIT HATASI:",e)}finally{u.value=!1,_.value=!1}},L=()=>{_.value=!1,w("iptal")},M=t=>{t||w("iptal")},T=()=>{const t=new Set(o.value.map(a=>Number(a.register_id))),e=[];for(let a=n.value.length-1;a>=0;a--){const c=n.value[a],r=Number(c.register_id);c.istasyon_id===d.istasyonId&&!t.has(r)&&(e.push(c),n.value.splice(a,1))}const s=new Set(o.value.map(a=>Number(a.register_id))),m=e.filter(a=>!s.has(Number(a.register_id)));o.value.push(...m)};return(t,e)=>(V(),D(Z,{modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>_.value=s),M],"max-width":"800"},{default:l(()=>[i(ie,{class:"personel-dialog-card"},{default:l(()=>[u.value?(V(),h("div",de,[i(R,{indeterminate:"",color:"primary",size:"48",class:"mb-3"}),e[3]||(e[3]=p("span",{style:{"font-weight":"600"}},"Kayıt yapılıyor...",-1))])):O("",!0),i(ee,{class:"text-h6 d-flex justify-space-between align-center"},{default:l(()=>[e[5]||(e[5]=f(" Personel Seçimi ")),p("div",ue,[p("div",null,[e[4]||(e[4]=p("strong",null,"Seçilen:",-1)),f(" "+C(o.value.length)+" kişi",1)])])]),_:1,__:[5]}),p("div",me,[i(b,{variant:"outlined",onClick:e[0]||(e[0]=s=>T()),disabled:u.value},{default:l(()=>[i(X,{start:"",icon:"tabler-users"}),e[6]||(e[6]=f(" Ekip Aktar "))]),_:1,__:[6]},8,["disabled"])]),i(te,null,{default:l(()=>[i(se,null,{default:l(()=>[i(N,{cols:"6"},{default:l(()=>[i(k(J),{"data-source":n.value,height:600,"key-expr":"register_id","show-borders":!0,"hover-state-enabled":!0,onRowClick:e[1]||(e[1]=s=>j(s.data.register_id))},{default:l(()=>[i(k(A),{"data-field":"ad_soyad",caption:"Ad Soyad","sort-order":"asc"}),i(k(A),{"data-field":"sicil_no",caption:"Sicil No",width:"100",visible:!1}),i(k(Q),{visible:!0,"highlight-case-sensitive":!1}),i(k(W),{mode:"virtual","row-rendering-mode":"virtual","show-scrollbar":"always"})]),_:1},8,["data-source"])]),_:1}),i(N,{cols:"6"},{default:l(()=>[e[7]||(e[7]=p("h5",{class:"text-subtitle-2 mt-9 mb-2"},"Ekip Listesi",-1)),i(le,{class:"border rounded",style:{"max-block-size":"535px","overflow-y":"auto"}},{default:l(()=>[(V(!0),h(G,null,$(o.value,(s,m)=>(V(),D(re,{key:s.sicil_no,onClick:a=>z(m),class:"cursor-pointer"},{default:l(()=>[i(oe,null,{default:l(()=>[f(C(s.ad_soyad),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1,__:[7]})]),_:1})]),_:1}),i(ae,null,{default:l(()=>[i(ne),i(b,{variant:"outlined",color:"warning",onClick:L,disabled:u.value},{default:l(()=>e[8]||(e[8]=[f("Vazgeç")])),_:1,__:[8]},8,["disabled"]),i(b,{onClick:E,variant:"outlined",color:"success",disabled:u.value},{default:l(()=>e[9]||(e[9]=[f("Kaydet")])),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),He=U(ce,[["__scopeId","data-v-0f8b1407"]]);export{He as default};
