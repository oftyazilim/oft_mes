import{_ as te}from"./AppTextarea.vue_vue_type_script_setup_true_lang-BAZZspFm.js";import{_ as le}from"./AppTextField.vue_vue_type_script_setup_true_lang-BqwuNu47.js";import{d as ie,r as n,G as oe,aZ as re,w as de,c as M,b as e,f as d,F as P,o as b,g as I,l as R,e as u,d3 as ue,ae as y,t as w,m as l,v as V,i as ne,a$ as k}from"./main-BE2yE4gm.js";import{D as Y,a as o}from"./data-grid-B9tP13U6.js";import{n as C}from"./notify-BijM3HDc.js";import{V as j}from"./VRow-Bfc-M0X1.js";import{V as se}from"./VDialog-CqKXvqKy.js";import{V as me}from"./VSnackbar-wI9FivAU.js";import{V as _}from"./VCol-DezjBiS7.js";import{V as h,b as ce}from"./VCard-DSfUpguE.js";import{V as S}from"./VCardText-puhoU74H.js";import{V as W}from"./VDivider-D-WEYZOW.js";import{V as pe}from"./VTextField-CkxgrDmY.js";import{V as fe}from"./VFileInput-DEB2cz-N.js";import{V as L}from"./VImg-CZeo29ln.js";import{V as ve}from"./VSpacer-B3Cxg1QI.js";import"./focus-DibEy3KP.js";import"./VTextarea-vgPwBDqb.js";/* empty css                   */import"./VCounter-oUx13wXh.js";import"./VField-CVaM_aIP.js";import"./easing-Bybner-F.js";import"./VInput-DoOt_E0h.js";import"./form-DcgKXSOW.js";import"./forwardRefs-C-GTDzx5.js";import"./editor-B8xPEhZB.js";import"./overlay-ZWPzpMgX.js";import"./m_row_dragging-bpJkYHDs.js";import"./m_select_box-DjwB-rEf.js";import"./themes-bLT7p8pc.js";/* empty css              */import"./VOverlay-Dl4hYfLB.js";import"./delay-C8Zbu2jH.js";import"./lazy-Bo11D-j9.js";import"./scopeId-Dp1AsKlQ.js";import"./dialog-transition-BWsTw3L2.js";import"./VAvatar-We2ZKFTV.js";import"./VChip-BDuMrzOV.js";import"./VSlideGroup-vJRK2YDZ.js";const be={class:"w-100 sticky-header overflow-hidden rounded-t"},ye={class:"d-flex align-center gap-4 flex-wrap bg-custom-background pa-6"},we={class:"d-flex align-center gap-4",style:{flex:"1"}},_e={class:"w-100 sticky-header overflow-hidden rounded-t"},he={class:"text-h5 mt-2"},ge={class:"toplam"},Ve={class:"toplam"},ke={class:"toplam"},De={class:"w-100 sticky-header overflow-hidden rounded-t"},xe={class:"text-h5 mt-2"},Ae={class:"w-100 sticky-header overflow-hidden rounded-t"},Ie={class:"d-flex align-center gap-4 flex-wrap bg-custom-background pa-6"},Ce={class:"d-flex align-center gap-4",style:{flex:"1"}},Se={class:"w-100 sticky-header overflow-hidden rounded-t"},Fe={class:"d-flex align-center gap-4 flex-wrap bg-custom-background pa-6"},Te={class:"d-flex align-center gap-4",style:{flex:"1"}},wa=ie({__name:"urun-sorgula",setup(Ue){const D=n(null);document.title="OFT - Ürün Sorgula";const i=n({barkod:"",urunID:0,urunKodu:"",urunAdi:"",urunAdi2:"",toplama:0,toplami:0,toplamSayim:0}),F=n([]),T=n([]);oe(()=>{re(()=>{var t,a;(a=(t=D.value)==null?void 0:t.focus)==null||a.call(t)})});const g=n(!1),U=n(!1),O=n(""),$=n("success"),q=async()=>{var t,a;if(i.value.barkod){g.value=!0;try{i.value.urunID=0,i.value.urunKodu="",i.value.urunAdi="",i.value.urunAdi2="",i.value.toplama=0,i.value.toplami=0,i.value.toplamSayim=0,F.value=[],T.value=[],await H(),i.value.barkod="",(a=(t=D.value)==null?void 0:t.focus)==null||a.call(t)}catch(m){console.error("Hata:",m),O.value="Bir hata oluştu!",$.value="error",U.value=!0}finally{g.value=!1}}},H=async()=>{try{const t=await k.get("/api/urunsorgula",{params:{itemID:i.value.barkod}});i.value.urunID=t.data.urun.item_id,i.value.urunKodu=t.data.urun.item_code,i.value.urunAdi=t.data.urun.item_name,i.value.urunAdi2=t.data.urun.item_name2,i.value.toplama=t.data.toplama,i.value.toplami=t.data.toplami,i.value.toplamSayim=t.data.toplamSayim,F.value=t.data.stoklar||[],T.value=t.data.detay||[],s.value="",B()}catch(t){throw console.error("Veri çekilirken hata oluştu: ",t),t}},N=t=>{t.rowType==="data"&&t.column.dataField==="qty_prm"&&t.value>0&&(t.cellElement.style.fontWeight="bold",t.cellElement.style.color="green"),t.rowType==="data"&&t.column.dataField==="qty_prm"&&t.value<0&&(t.cellElement.style.fontWeight="bold",t.cellElement.style.color="red")},c=n(null),z=n(null),s=n(""),K=n(""),E=n(),Z=()=>{var t,a,m;(m=(a=(t=E.value)==null?void 0:t.$el)==null?void 0:a.querySelector("input[type=file]"))==null||m.click()},J=async t=>{try{const a={raf:K.value,itemID:t};await k.post("/api/rafgir",a),C("Başarıyla kaydedildi.","success",2e3)}catch(a){console.error("Kayıt sırasında hata oluştu:",a)}},Q=async t=>{var r,v;if(!c.value)return alert("Lütfen fotoğraf seçin.");const a=Array.isArray(c.value)?c.value[0]??null:c.value;if(!a)return alert("Geçerli bir fotoğraf bulunamadı.");const m=50*1024*1024;if(a.size>m){C("Dosya çok büyük (50MB üstü). Lütfen daha küçük bir fotoğraf seçin.","error",2500);return}const f=new FormData;f.append("photo",a),f.append("itemID",String(t));try{await k.post("/api/photo-upload",f),C("Fotoğraf yüklendi","success",1500),B();try{s.value&&URL.revokeObjectURL(s.value)}catch{}s.value=""}catch(p){console.error("Yükleme hatası:",(p==null?void 0:p.response)??p);const ae=((v=(r=p==null?void 0:p.response)==null?void 0:r.data)==null?void 0:v.message)||"Yükleme sırasında hata oluştu.";C(ae,"error",2500)}};de(c,t=>{if(!t){s.value="";return}const a=Array.isArray(t)?t[0]??null:t;if(a){try{s.value&&URL.revokeObjectURL(s.value)}catch{}s.value=URL.createObjectURL(a)}else s.value=""});const B=async()=>{console.log(i.value.urunID);const t=await k.get("/api/photos",{params:{itemID:Number(i.value.urunID)}});z.value=t.data},X=async t=>{await k.delete(`/api/photos/${t}`),B()},x=n(!1),G=n(""),ee=t=>{G.value=t,x.value=!0},A=t=>new Intl.NumberFormat("tr-TR",{maximumFractionDigits:1}).format(t);return(t,a)=>{const m=le,f=te;return b(),M(P,null,[e(j,null,{default:d(()=>[e(_,{md:"6",cols:"12",class:"mx-auto"},{default:d(()=>[e(h,{class:"overflow-visible"},{default:d(()=>[u("div",be,[u("div",ye,[u("div",we,[e(m,{ref_key:"barkodInput",ref:D,modelValue:i.value.barkod,"onUpdate:modelValue":a[0]||(a[0]=r=>i.value.barkod=r),placeholder:"BARKOD",class:"flex-1",onKeyup:ue(q,["enter"]),disabled:g.value},null,8,["modelValue","disabled"]),e(y,{loading:g.value,disabled:g.value||!D.value,onClick:q},{default:d(()=>a[12]||(a[12]=[w(" Ara ")])),_:1,__:[12]},8,["loading","disabled"])])])]),e(l(S),null,{default:d(()=>[a[13]||(a[13]=u("h5",{class:"text-h5 mb-2"}," Ürün Bilgileri ",-1)),e(W,{class:"my-2"}),e(m,{modelValue:i.value.urunID,"onUpdate:modelValue":a[1]||(a[1]=r=>i.value.urunID=r),label:"Ürün ID",class:"mb-2",readOnly:""},null,8,["modelValue"]),e(m,{modelValue:i.value.urunKodu,"onUpdate:modelValue":a[2]||(a[2]=r=>i.value.urunKodu=r),label:"Ürün Kodu",class:"mb-2",readOnly:""},null,8,["modelValue"]),e(f,{modelValue:i.value.urunAdi,"onUpdate:modelValue":a[3]||(a[3]=r=>i.value.urunAdi=r),label:"Ürün Adı",class:"mb-2","auto-grow":"",rows:"1",readOnly:""},null,8,["modelValue"]),e(f,{modelValue:i.value.urunAdi2,"onUpdate:modelValue":a[4]||(a[4]=r=>i.value.urunAdi2=r),label:"Ürün Adı 2","auto-grow":"",rows:"1",readOnly:""},null,8,["modelValue"])]),_:1,__:[13]})]),_:1})]),_:1}),e(_,{md:"6",cols:"12",class:"mx-auto"},{default:d(()=>[e(h,{class:"overflow-visible"},{default:d(()=>[e(l(S),null,{default:d(()=>[u("div",_e,[a[17]||(a[17]=u("h5",{class:"text-h5 mb-2"}," Depo Bilgileri ",-1)),e(l(Y),{id:"gridDepo",ref:"dataGridRefD","data-source":F.value,"show-borders":!0,"column-auto-width":!0,"row-alternation-enabled":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:N,height:"332px"},{default:d(()=>[e(l(o),{"data-field":"branch_desc",caption:"Firma Adı",visible:!0,width:120}),e(l(o),{"data-field":"whouse_code",caption:"Depo Kodu",visible:!0,width:80}),e(l(o),{"data-field":"description",caption:"Depo Adı",visible:!0,"min-width":180}),e(l(o),{"data-field":"add_string01",caption:"Raf Yeri",visible:!0,width:80}),e(l(o),{"data-field":"qty_prm",caption:"Miktar","data-type":"number",visible:!0,"min-width":50,format:{type:"fixedPoint",precision:2,thousandsSeparator:","}}),e(l(o),{"data-field":"unit_code",caption:"Birim",visible:!0,"min-width":40})]),_:1},8,["data-source"]),u("h5",he,[a[14]||(a[14]=w(" Ana Depo: ")),u("span",ge,V(A(i.value.toplama,1)),1),a[15]||(a[15]=w("       İstasyon Depo: ")),u("span",Ve,V(A(i.value.toplami,1)),1),a[16]||(a[16]=w("       Genel: ")),u("span",ke,V(A(i.value.toplama+i.value.toplami,1)),1)])])]),_:1})]),_:1})]),_:1}),e(_,{cols:"12",class:"mx-auto"},{default:d(()=>[e(h,{class:"overflow-visible"},{default:d(()=>[e(l(S),null,{default:d(()=>[u("div",De,[a[18]||(a[18]=u("h5",{class:"text-h5 mb-2"}," Sayım Bilgileri ",-1)),e(l(Y),{id:"gridSayim","data-source":T.value,"show-borders":!0,"column-auto-width":!0,"row-alternation-enabled":!0,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:N},{default:d(()=>[e(l(o),{"data-field":"id",caption:"#",visible:!0,"min-width":50}),e(l(o),{"data-field":"qty_prm",caption:"Miktar","data-type":"number",visible:!0,"min-width":60,format:{type:"fixedPoint",precision:2,thousandsSeparator:","}}),e(l(o),{"data-field":"note1",caption:"Raf Yeri",visible:!0,"min-width":60}),e(l(o),{"data-field":"whouse_code",caption:"Depo",visible:!0,"min-width":40}),e(l(o),{"data-field":"sorumlu",caption:"Sorumlu",visible:!0,"min-width":80}),e(l(o),{"data-field":"create_date",caption:"Sayım Tarihi",visible:!0,"min-width":60,"data-type":"date",format:{formatter:r=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(r)).replace(/\//g,".")}},null,8,["format"]),e(l(o),{"data-field":"doc_no",caption:"Sayım No",visible:!0,"min-width":60}),e(l(o),{"data-field":"description",caption:"Depo Adı",visible:!0,"min-width":60}),e(l(o),{"data-field":"serial_m_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"barcode",visible:!0,"min-width":60}),e(l(o),{"data-field":"item_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"item_code",visible:!0,"min-width":60}),e(l(o),{"data-field":"item_name",visible:!0,"min-width":60}),e(l(o),{"data-field":"qty",visible:!0,"min-width":60}),e(l(o),{"data-field":"qty_free_prm",visible:!0,"min-width":60}),e(l(o),{"data-field":"qty_free_sec",visible:!0,"min-width":60}),e(l(o),{"data-field":"create_user_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"update_user_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"update_date",visible:!0,"min-width":60,"data-type":"date",format:{formatter:r=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(r)).replace(/\//g,".")}},null,8,["format"]),e(l(o),{"data-field":"whouse_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"location_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"us_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"unit_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"cycle_count_m_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"cycle_count_d_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"co_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"branch_id",visible:!0,"min-width":60}),e(l(o),{"data-field":"is_passive",visible:!0,"min-width":60})]),_:1},8,["data-source"]),u("h5",xe," Toplam: "+V(A(i.value.toplamSayim)),1)])]),_:1})]),_:1})]),_:1}),i.value.urunKodu?(b(),I(_,{key:0,cols:"12",class:"mx-auto"},{default:d(()=>[e(h,{class:"overflow-visible"},{default:d(()=>[u("div",Ae,[u("div",Ie,[u("div",Ce,[e(pe,{modelValue:K.value,"onUpdate:modelValue":a[5]||(a[5]=r=>K.value=r),label:"Outlined",variant:"outlined"},null,8,["modelValue"]),e(y,{icon:"tabler-device-floppy",rounded:"",onClick:a[6]||(a[6]=r=>J(i.value.urunID))})])])])]),_:1})]),_:1})):R("",!0),i.value.urunKodu?(b(),I(_,{key:1,cols:"12",class:"mx-auto"},{default:d(()=>[e(h,{class:"overflow-visible"},{default:d(()=>[u("div",Se,[u("div",Fe,[u("div",Te,[e(fe,{ref_key:"fileInput",ref:E,modelValue:c.value,"onUpdate:modelValue":a[7]||(a[7]=r=>c.value=r),accept:"image/*",capture:"environment",label:"Fotoğraf Çek veya Seç","prepend-icon":"mdi-camera"},null,8,["modelValue"]),e(y,{icon:"tabler-camera-plus",rounded:"",onClick:Z}),e(y,{icon:"tabler-upload",rounded:"",onClick:a[8]||(a[8]=r=>Q(i.value.urunID))})])]),s.value?(b(),I(L,{key:0,src:s.value,class:"ma-4"},null,8,["src"])):R("",!0)]),e(l(S),null,{default:d(()=>[a[19]||(a[19]=u("h5",{class:"text-h5 mb-2"}," Ürün Fotoğrafları ",-1)),e(W,{class:"my-2"}),e(j,null,{default:d(()=>[(b(!0),M(P,null,ne(z.value,r=>(b(),I(_,{key:r.id,cols:"12",sm:"4",md:"3"},{default:d(()=>[e(L,{src:r.url,"max-height":"200",style:{cursor:"pointer","margin-inline-start":"-18px"},class:"rounded-lg",onClick:v=>ee(r.url)},null,8,["src","onClick"]),e(y,{icon:"tabler-trash",color:"error",rounded:"",onClick:v=>X(r.id),class:"mt-1"},null,8,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1,__:[19]})]),_:1})]),_:1})):R("",!0)]),_:1}),e(se,{modelValue:x.value,"onUpdate:modelValue":a[10]||(a[10]=r=>x.value=r),"max-width":"1200"},{default:d(()=>[e(h,null,{default:d(()=>[e(L,{src:G.value,class:"ma-4","aspect-ratio":"1.5"},null,8,["src"]),e(ce,null,{default:d(()=>[e(ve),e(y,{text:"",onClick:a[9]||(a[9]=r=>x.value=!1)},{default:d(()=>a[20]||(a[20]=[w("Kapat")])),_:1,__:[20]})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(me,{modelValue:U.value,"onUpdate:modelValue":a[11]||(a[11]=r=>U.value=r),color:$.value,timeout:"3000",location:"bottom center"},{default:d(()=>[w(V(O.value),1)]),_:1},8,["modelValue","color"])],64)}}});export{wa as default};
