import{u as ke,m as we,a as Se}from"./VSelect-xBeRilCz.js";import{V as G,m as Ie}from"./VTextField-BoidSOo6.js";import{W as Fe,q as De,ba as Pe,r as M,s as I,bb as Re,ae as J,bp as Ae,v as y,bf as Ee,w as F,T as Q,aG as X,B as Te,b as v,ac as S,bj as Me,c_ as _e,cr as Y,bm as Ne,F as j,m as Z,c$ as Be,cs as Ke,ad as Le,aB as Oe}from"./main-D4XoR1ln.js";import{u as Ue,m as je,h as qe}from"./filter-IJ-arDnN.js";import{u as ze}from"./form-XgbNdgYw.js";import{f as $e}from"./forwardRefs-C-GTDzx5.js";import{u as He,t as D,V as We,a as ee}from"./VList-BBEETBcj.js";import{m as Ge}from"./index-C9aVt4os.js";import{V as Je}from"./VMenu-DmRmgkbY.js";import{V as Qe}from"./VCheckboxBtn-CA-UorFX.js";import{V as Xe}from"./VAvatar-4D3-KtPT.js";import{V as Ye}from"./VChip-CeiiWcWt.js";const Ze=De({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...je({filterKeys:["title"]}),...we({hideNoData:!0,returnObject:!0}),...Me(Ie({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ge({transition:!1})},"VCombobox"),fl=Fe()({name:"VCombobox",props:Ze(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,le){var $;let{emit:te,slots:o}=le;const{t:_}=Pe(),h=M(),V=I(!1),p=I(!0),N=I(!1),q=M(),B=M(),i=I(-1);let K=!1;const{items:ae,transformIn:ue,transformOut:ne}=He(l),{textColorClasses:oe,textColorStyles:ie}=Re(()=>{var e;return(e=h.value)==null?void 0:e.color}),u=J(l,"modelValue",[],e=>ue(Ae(e)),e=>{const t=ne(e);return l.multiple?t:t[0]??null}),P=ze(l),R=y(()=>!!(l.chips||o.chip)),x=y(()=>R.value||!!o.selection),C=I(!l.multiple&&!x.value?(($=u.value[0])==null?void 0:$.title)??"":""),f=y({get:()=>C.value,set:e=>{var t;if(C.value=e??"",!l.multiple&&!x.value&&(u.value=[D(l,e)]),e&&l.multiple&&((t=l.delimiters)!=null&&t.length)){const s=e.split(new RegExp(`(?:${l.delimiters.join("|")})+`));s.length>1&&(s.forEach(a=>{a=a.trim(),a&&b(D(l,a))}),C.value="")}e||(i.value=-1),p.value=!e}}),se=y(()=>typeof l.counterValue=="function"?l.counterValue(u.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?u.value.length:f.value.length),{filteredItems:A,getMatches:re}=Ue(l,ae,()=>p.value?"":f.value),k=y(()=>l.hideSelected?A.value.filter(e=>!u.value.some(t=>t.value===e.value)):A.value),E=y(()=>l.hideNoData&&!k.value.length||P.isReadonly.value||P.isDisabled.value),L=J(l,"menu"),r=y({get:()=>L.value,set:e=>{var t;L.value&&!e&&((t=q.value)!=null&&t.Î¨openChildren.size)||e&&E.value||(L.value=e)}}),z=Ee(()=>r.value?l.closeText:l.openText);F(C,e=>{K?X(()=>K=!1):V.value&&!r.value&&(r.value=!0),te("update:search",e)}),F(u,e=>{var t;!l.multiple&&!x.value&&(C.value=((t=e[0])==null?void 0:t.title)??"")});const ce=y(()=>u.value.map(e=>e.value)),O=y(()=>{var t;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&f.value===((t=k.value[0])==null?void 0:t.title))&&k.value.length>0&&!p.value&&!N.value}),U=M(),ve=ke(U,h);function fe(e){K=!0,l.openOnClear&&(r.value=!0)}function de(){E.value||(r.value=!0)}function me(e){E.value||(V.value&&(e.preventDefault(),e.stopPropagation()),r.value=!r.value)}function he(e){var t;e.key!==" "&&Y(e)&&((t=h.value)==null||t.focus())}function be(e){var a,c,d,g;if(_e(e)||P.isReadonly.value)return;const t=(a=h.value)==null?void 0:a.selectionStart,s=u.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(r.value=!0),["Escape"].includes(e.key)&&(r.value=!1),["Enter","Escape","Tab"].includes(e.key)&&(O.value&&["Enter","Tab"].includes(e.key)&&!u.value.some(n=>{let{value:w}=n;return w===k.value[0].value})&&b(A.value[0]),p.value=!0),e.key==="ArrowDown"&&O.value&&((c=U.value)==null||c.focus("next")),e.key==="Enter"&&f.value&&(b(D(l,f.value)),x.value&&(C.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&x.value&&u.value.length>0&&!f.value)return b(u.value[0],!1);if(~i.value){e.preventDefault();const n=i.value;b(u.value[i.value],!1),i.value=n>=s-1?s-2:n}else e.key==="Backspace"&&!f.value&&(i.value=s-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(i.value<0&&t&&t>0)return;const n=i.value>-1?i.value-1:s-1;u.value[n]?i.value=n:(i.value=-1,(d=h.value)==null||d.setSelectionRange(f.value.length,f.value.length))}else if(e.key==="ArrowRight"){if(i.value<0)return;const n=i.value+1;u.value[n]?i.value=n:(i.value=-1,(g=h.value)==null||g.setSelectionRange(0,0))}else~i.value&&Y(e)&&(i.value=-1)}function ge(){var e;l.eager&&((e=B.value)==null||e.calculateVisibleItems())}function Ve(){var e;V.value&&(p.value=!0,(e=h.value)==null||e.focus())}function b(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!e||e.props.disabled))if(l.multiple){const s=u.value.findIndex(c=>(l.valueComparator||Q)(c.value,e.value)),a=t??!~s;if(~s){const c=a?[...u.value,e]:[...u.value];c.splice(s,1),u.value=c}else a&&(u.value=[...u.value,e]);l.clearOnSelect&&(f.value="")}else{const s=t!==!1;u.value=s?[e]:[],C.value=s&&!x.value?e.title:"",X(()=>{r.value=!1,p.value=!0})}}function xe(e){V.value=!0,setTimeout(()=>{N.value=!0})}function ye(e){N.value=!1}function pe(e){(e==null||e===""&&!l.multiple&&!x.value)&&(u.value=[])}return F(V,(e,t)=>{if(!(e||e===t)&&(i.value=-1,r.value=!1,f.value)){if(l.multiple){b(D(l,f.value));return}if(!x.value)return;u.value.some(s=>{let{title:a}=s;return a===f.value})?C.value="":b(D(l,f.value))}}),F(r,()=>{if(!l.hideSelected&&r.value&&u.value.length){const e=k.value.findIndex(t=>u.value.some(s=>(l.valueComparator||Q)(s.value,t.value)));Ne&&window.requestAnimationFrame(()=>{var t;e>=0&&((t=B.value)==null||t.scrollToIndex(e))})}}),F(()=>l.items,(e,t)=>{r.value||V.value&&!t.length&&e.length&&(r.value=!0)}),Te(()=>{const e=!!(!l.hideNoData||k.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),t=u.value.length>0,s=G.filterProps(l);return v(G,S({ref:h},s,{modelValue:f.value,"onUpdate:modelValue":[a=>f.value=a,pe],focused:V.value,"onUpdate:focused":a=>V.value=a,validationValue:u.externalValue,counterValue:se.value,dirty:t,class:["v-combobox",{"v-combobox--active-menu":r.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!x.value,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:P.isReadonly.value,placeholder:t?void 0:l.placeholder,"onClick:clear":fe,"onMousedown:control":de,onKeydown:be}),{...o,default:()=>v(j,null,[v(Je,S({ref:q,modelValue:r.value,"onUpdate:modelValue":a=>r.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:E.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:l.transition,onAfterEnter:ge,onAfterLeave:Ve},l.menuProps),{default:()=>[e&&v(We,S({ref:U,selected:ce.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),onKeydown:he,onFocusin:xe,onFocusout:ye,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},ve,l.listProps),{default:()=>{var a,c,d;return[(a=o["prepend-item"])==null?void 0:a.call(o),!k.value.length&&!l.hideNoData&&(((c=o["no-data"])==null?void 0:c.call(o))??v(ee,{key:"no-data",title:_(l.noDataText)},null)),v(Se,{ref:B,renderless:!0,items:k.value,itemKey:"value"},{default:g=>{var W;let{item:n,index:w,itemRef:m}=g;const H=S(n.props,{ref:m,key:n.value,active:O.value&&w===0?!0:void 0,onClick:()=>b(n,null)});return((W=o.item)==null?void 0:W.call(o,{item:n,index:w,props:H}))??v(ee,S(H,{role:"option"}),{prepend:T=>{let{isSelected:Ce}=T;return v(j,null,[l.multiple&&!l.hideSelected?v(Qe,{key:n.value,modelValue:Ce,ripple:!1,tabindex:"-1"},null):void 0,n.props.prependAvatar&&v(Xe,{image:n.props.prependAvatar},null),n.props.prependIcon&&v(Z,{icon:n.props.prependIcon},null)])},title:()=>{var T;return p.value?n.title:qe("v-combobox",n.title,(T=re(n))==null?void 0:T.title)}})}}),(d=o["append-item"])==null?void 0:d.call(o)]}})]}),u.value.map((a,c)=>{function d(m){m.stopPropagation(),m.preventDefault(),b(a,!1)}const g={"onClick:close":d,onKeydown(m){m.key!=="Enter"&&m.key!==" "||(m.preventDefault(),m.stopPropagation(),d(m))},onMousedown(m){m.preventDefault(),m.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},n=R.value?!!o.chip:!!o.selection,w=n?Ke(R.value?o.chip({item:a,index:c,props:g}):o.selection({item:a,index:c})):void 0;if(!(n&&!w))return v("div",{key:a.value,class:["v-combobox__selection",c===i.value&&["v-combobox__selection--selected",oe.value]],style:c===i.value?ie.value:{}},[R.value?o.chip?v(Le,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:a.title}}},{default:()=>[w]}):v(Ye,S({key:"chip",closable:l.closableChips,size:"small",text:a.title,disabled:a.props.disabled},g),null):w??v("span",{class:"v-combobox__selection-text"},[a.title,l.multiple&&c<u.value.length-1&&v("span",{class:"v-combobox__selection-comma"},[Oe(",")])])])})]),"append-inner":function(){var g,n;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];return v(j,null,[(g=o["append-inner"])==null?void 0:g.call(o,...c),(!l.hideNoData||l.items.length)&&l.menuIcon?v(Z,{class:"v-combobox__menu-icon",color:(n=h.value)==null?void 0:n.fieldIconColor,icon:l.menuIcon,onMousedown:me,onClick:Be,"aria-label":_(z.value),title:_(z.value),tabindex:"-1"},null):void 0])}})}),$e({isFocused:V,isPristine:p,menu:r,search:f,selectionIndex:i,filteredItems:A,select:b},h)}});export{fl as V};
