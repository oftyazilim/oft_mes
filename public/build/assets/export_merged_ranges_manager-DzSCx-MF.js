import{d8 as i,d7 as x,d0 as b,er as B,d1 as _,dg as v,e2 as k,eb as U,e3 as Z,di as j,dp as q,dv as $}from"./main-EJ7VQ3bl.js";import{r as I,P as O}from"./overlay-Dk_QSQzc.js";import{h as W}from"./m_select_box-BlzH2xgD.js";import{g as K}from"./m_row_dragging-DyxDnO00.js";class Y{constructor(e,n,s,r){this._$targetElement=n,this._$container=s,this._loadPanel=e._createComponent(I("<div>").addClass("dx-export-loadpanel").appendTo(this._$container),W,this.getOptions(r))}getDefaultOptions(){return{animation:null,shading:!1,height:90,width:200,container:this._$container}}getOptions(e){return i(e.text)?e.message=e.text:e.message=x.format("dxDataGrid-exporting"),b(this.getDefaultOptions(),e)}show(){this._loadPanel.option("position",K.calculateLoadPanelPosition(this._$targetElement)),this._loadPanel.show()}dispose(){I(this._loadPanel.element()).remove(),delete this._loadPanel}}const V={ar:1,bg:2,ca:3,"zh-Hans":4,cs:5,da:6,de:7,el:8,en:9,es:10,fi:11,fr:12,he:13,hu:14,is:15,it:16,ja:17,ko:18,nl:19,no:20,pl:21,pt:22,rm:23,ro:24,ru:25,hr:26,sk:27,sq:28,sv:29,th:30,tr:31,ur:32,id:33,uk:34,be:35,sl:36,et:37,lv:38,lt:39,tg:40,fa:41,vi:42,hy:43,az:44,eu:45,hsb:46,mk:47,tn:50,xh:52,zu:53,af:54,ka:55,fo:56,hi:57,mt:58,se:59,ga:60,ms:62,kk:63,ky:64,sw:65,tk:66,uz:67,tt:68,bn:69,pa:70,gu:71,or:72,ta:73,te:74,kn:75,ml:76,as:77,mr:78,sa:79,mn:80,bo:81,cy:82,km:83,lo:84,gl:86,kok:87,syr:90,si:91,iu:93,am:94,tzm:95,ne:97,fy:98,ps:99,fil:100,dv:101,ha:104,yo:106,quz:107,nso:108,ba:109,lb:110,kl:111,ig:112,ii:120,arn:122,moh:124,br:126,ug:128,mi:129,oc:130,co:131,gsw:132,sah:133,qut:134,rw:135,wo:136,prs:140,gd:145,"ar-SA":1025,"bg-BG":1026,"ca-ES":1027,"zh-TW":1028,"cs-CZ":1029,"da-DK":1030,"de-DE":1031,"el-GR":1032,"en-US":1033,"fi-FI":1035,"fr-FR":1036,"he-IL":1037,"hu-HU":1038,"is-IS":1039,"it-IT":1040,"ja-JP":1041,"ko-KR":1042,"nl-NL":1043,"nb-NO":1044,"pl-PL":1045,"pt-BR":1046,"rm-CH":1047,"ro-RO":1048,"ru-RU":1049,"hr-HR":1050,"sk-SK":1051,"sq-AL":1052,"sv-SE":1053,"th-TH":1054,"tr-TR":1055,"ur-PK":1056,"id-ID":1057,"uk-UA":1058,"be-BY":1059,"sl-SI":1060,"et-EE":1061,"lv-LV":1062,"lt-LT":1063,"tg-Cyrl-TJ":1064,"fa-IR":1065,"vi-VN":1066,"hy-AM":1067,"az-Latn-AZ":1068,"eu-ES":1069,"hsb-DE":1070,"mk-MK":1071,"tn-ZA":1074,"xh-ZA":1076,"zu-ZA":1077,"af-ZA":1078,"ka-GE":1079,"fo-FO":1080,"hi-IN":1081,"mt-MT":1082,"se-NO":1083,"ms-MY":1086,"kk-KZ":1087,"ky-KG":1088,"sw-KE":1089,"tk-TM":1090,"uz-Latn-UZ":1091,"tt-RU":1092,"bn-IN":1093,"pa-IN":1094,"gu-IN":1095,"or-IN":1096,"ta-IN":1097,"te-IN":1098,"kn-IN":1099,"ml-IN":1100,"as-IN":1101,"mr-IN":1102,"sa-IN":1103,"mn-MN":1104,"bo-CN":1105,"cy-GB":1106,"km-KH":1107,"lo-LA":1108,"gl-ES":1110,"kok-IN":1111,"syr-SY":1114,"si-LK":1115,"iu-Cans-CA":1117,"am-ET":1118,"ne-NP":1121,"fy-NL":1122,"ps-AF":1123,"fil-PH":1124,"dv-MV":1125,"ha-Latn-NG":1128,"yo-NG":1130,"quz-BO":1131,"nso-ZA":1132,"ba-RU":1133,"lb-LU":1134,"kl-GL":1135,"ig-NG":1136,"ii-CN":1144,"arn-CL":1146,"moh-CA":1148,"br-FR":1150,"ug-CN":1152,"mi-NZ":1153,"oc-FR":1154,"co-FR":1155,"gsw-FR":1156,"sah-RU":1157,"qut-GT":1158,"rw-RW":1159,"wo-SN":1160,"prs-AF":1164,"gd-GB":1169,"ar-IQ":2049,"zh-CN":2052,"de-CH":2055,"en-GB":2057,"es-MX":2058,"fr-BE":2060,"it-CH":2064,"nl-BE":2067,"nn-NO":2068,"pt-PT":2070,"sr-Latn-CS":2074,"sv-FI":2077,"az-Cyrl-AZ":2092,"dsb-DE":2094,"se-SE":2107,"ga-IE":2108,"ms-BN":2110,"uz-Cyrl-UZ":2115,"bn-BD":2117,"mn-Mong-CN":2128,"iu-Latn-CA":2141,"tzm-Latn-DZ":2143,"quz-EC":2155,"ar-EG":3073,"zh-HK":3076,"de-AT":3079,"en-AU":3081,"es-ES":3082,"fr-CA":3084,"sr-Cyrl-CS":3098,"se-FI":3131,"quz-PE":3179,"ar-LY":4097,"zh-SG":4100,"de-LU":4103,"en-CA":4105,"es-GT":4106,"fr-CH":4108,"hr-BA":4122,"smj-NO":4155,"ar-DZ":5121,"zh-MO":5124,"de-LI":5127,"en-NZ":5129,"es-CR":5130,"fr-LU":5132,"bs-Latn-BA":5146,"smj-SE":5179,"ar-MA":6145,"en-IE":6153,"es-PA":6154,"fr-MC":6156,"sr-Latn-BA":6170,"sma-NO":6203,"ar-TN":7169,"en-ZA":7177,"es-DO":7178,"sr-Cyrl-BA":7194,"sma-SE":7227,"ar-OM":8193,"en-JM":8201,"es-VE":8202,"bs-Cyrl-BA":8218,"sms-FI":8251,"ar-YE":9217,"en-029":9225,"es-CO":9226,"sr-Latn-RS":9242,"smn-FI":9275,"ar-SY":10241,"en-BZ":10249,"es-PE":10250,"sr-Cyrl-RS":10266,"ar-JO":11265,"en-TT":11273,"es-AR":11274,"sr-Latn-ME":11290,"ar-LB":12289,"en-ZW":12297,"es-EC":12298,"sr-Cyrl-ME":12314,"ar-KW":13313,"en-PH":13321,"es-CL":13322,"ar-AE":14337,"es-UY":14346,"ar-BH":15361,"es-PY":15370,"ar-QA":16385,"en-IN":16393,"es-BO":16394,"en-MY":17417,"es-SV":17418,"en-SG":18441,"es-HN":18442,"es-NI":19466,"es-PR":20490,"es-US":21514,"bs-Cyrl":25626,"bs-Latn":26650,"sr-Cyrl":27674,"sr-Latn":28698,smn:28731,"az-Cyrl":29740,sms:29755,zh:30724,nn:30740,bs:30746,"az-Latn":30764,sma:30779,"uz-Cyrl":30787,"mn-Cyrl":30800,"iu-Cans":30813,"zh-Hant":31748,nb:31764,sr:31770,"tg-Cyrl":31784,dsb:31790,smj:31803,"uz-Latn":31811,"mn-Mong":31824,"iu-Latn":31837,"tzm-Latn":31839,"ha-Latn":31848};function X(){return V[B.locale()]}const D={thousands:"#,##0{0},&quot;K&quot;",millions:"#,##0{0},,&quot;M&quot;",billions:"#,##0{0},,,&quot;B&quot;",trillions:"#,##0{0},,,,&quot;T&quot;",percent:"0{0}%",decimal:"#{0}",fixedpoint:"#,##0{0}",exponential:"0{0}E+00",currency:" "},Q=/a+/g,J=/E/g,ee=/dE+/g,te=/L/g,ne=/h/g,se=/./g;function re(t,e){let n,s;if(e>0){for(n=t!=="decimal"?".":"",s=0;s<e;s+=1)n+="0";return n}return""}function oe(t){let e;for(let n=0;n<t.length;n+=1)if(e=t.charCodeAt(n),e>=1632&&e<1642)return!0;return!1}function le(t){const e=(k.format(new Date(2009,8,8,6,5,4),t)||"").toString();let n=U((s=>k.format(s,t)));return n&&(n=ie(n),n=ae(e)+n),n}function ae(t){const e=X();let n=e?e.toString(16):"",s="";if(oe(t)){for(;n.length<3;)n=`0${n}`;s=`[$-2010${n}]`}else n&&(s=`[$-${n}]`);return s}function ie(t){return t.split("/").join("\\/").split("'").map(((e,n)=>n%2===0?e.replace(Q,"AM/PM").replace(ee,"d").replace(J,"d").replace(te,"M").replace(ne,"H").split("[").join("\\[").split("]").join("\\]"):e?e.replace(se,"\\$&"):"'")).join("")}function ue(t,e,n){let s,r;return t==="currency"?r=Z.getOpenXmlCurrencyFormat(n):r=D[t.toLowerCase()],r&&(s=j(r,re(t,e))),s}function ce(t){return!t||t.length<2?!1:T(t)}function ge(t,e){return!t||t.length<4||t[0]!==e?!1:T(t.substring(1,t.length-1))}function T(t){return t?/^[@=\t\r]/.test(t)?!0:/^[+-]/.test(t)?!q(t):!1:!1}const A={formatObjectConverter(t,e){const n={format:t,precision:t==null?void 0:t.precision,dataType:e};return v(t)?b(n,t,{format:t.formatter||t.type,currency:t.currency}):n},convertFormat(t,e,n,s){if(i(t)){if(n==="date")return le(t);if(_(t)&&D[t.toLowerCase()])return ue(t,e,s)}},encode(t){let e=!1;return ce(t)?e=!0:ge(t,'"')&&(t=t.substring(1,t.length-1),e=!0),e?`"'${t.replaceAll('"','""')}"`:t}},Ce={getFullOptions(t){const e=b({},t);if(!(i(e.worksheet)&&v(e.worksheet)))throw Error('The "worksheet" field must contain an object.');if(!i(e.topLeftCell))e.topLeftCell={row:1,column:1};else if(_(e.topLeftCell)){const{row:n,col:s}=e.worksheet.getCell(e.topLeftCell);e.topLeftCell={row:n,column:s}}return i(e.keepColumnWidths)||(e.keepColumnWidths=!0),i(e.loadPanel)||(e.loadPanel={}),i(e.loadPanel.enabled)||(e.loadPanel.enabled=!0),i(e.encodeExecutableContent)||(e.encodeExecutableContent=!1),e},convertDateForExcelJS:t=>new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())),setNumberFormat(t,e){t.numFmt=e},getCellStyles(t){const e=t.getStyles();return e.forEach((n=>{let s=this.tryConvertToExcelNumberFormat(n.format,n.dataType);i(s)&&(s=s.replace(/&quot;/g,'"')),n.numberFormat=s})),e},tryConvertToExcelNumberFormat(t,e){const n=A.formatObjectConverter(t,e),{currency:s}=n;return t=n.format,e=n.dataType,A.convertFormat(t,n.precision,e,s)},setAlignment(t,e,n){t.alignment=t.alignment??{},i(e)&&(t.alignment.wrapText=e),i(n)&&(t.alignment.horizontal=n),t.alignment.vertical="top"},setColumnsWidth(t,e,n){if(i(e))for(let s=0;s<e.length;s+=1){const r=e[s];typeof r=="number"&&isFinite(r)&&(t.getColumn(n+s).width=Math.min(255,Math.floor(r/7*100)/100))}},export(t,e,n,s){var r,a;const{component:o,worksheet:u,topLeftCell:f,keepColumnWidths:c,selectedRowsOnly:h,loadPanel:l,encodeExecutableContent:C}=t,g=o.getDataProvider(h),p=(a=(((r=o._getInternalInstance)===null||r===void 0?void 0:r.call(o))||o).option("loadPanel"))===null||a===void 0?void 0:a.enabled;p&&o.option("loadPanel.enabled",!1);let L;if(l.enabled&&O()){const y=n(o),E=s(o);L=new Y(o,y,E,l),L.show()}const z=!!o.option("wordWrapEnabled");u.properties.outlineProperties={summaryBelow:!1,summaryRight:!1};const m={from:{row:f.row,column:f.column},to:{row:f.row,column:f.column}};return new Promise((y=>{g.ready().done((()=>{const E=g.getColumns(),H=g.getRowsCount(),d=new e(o,g,u,t);c&&this.setColumnsWidth(u,g.getColumnsWidths(),m.from.column),d._exportAllFieldHeaders(E,this.setAlignment);const S=d._getFieldHeaderRowsCount();m.to.row=m.from.row+S;const G=this.getCellStyles(g);for(let R=0;R<H;R+=1){const M=m.from.row+S+R,P=u.getRow(M);let N=0;d._isRowFieldHeadersRow(R)&&(N=g.getRowAreaColCount(),d._exportFieldHeaders("row",M,0,N,this.setAlignment)),d._trySetOutlineLevel(P,R),this.exportRow(g,d,P,R,N,E.length,z,G,C),m.to.row=M}d.mergedRangesManager.applyMergedRages(),m.to.column+=E.length>0?E.length-1:0;const w=u.views[0]||{};o.option("rtlEnabled")&&(w.rightToLeft=!0),d._isFrozenZone(g)&&(Object.keys(w).includes("state")||b(w,d._getWorksheetFrozenState(m)),d._trySetAutoFilter(m)),Object.keys(w).length>0&&(u.views=[w]),y(m)})).always((()=>{p&&o.option("loadPanel.enabled",p),l.enabled&&O()&&L.dispose()}))}))},exportRow(t,e,n,s,r,a,o,u,f){for(let c=r;c<a;c+=1){const h=t.getCellData(s,c,!0),l=n.getCell(e._getFirstColumnIndex()+c);e.mergedRangesManager.updateMergedRanges(l,s,c,e);const C=e.mergedRangesManager.findMergedCellInfo(s,c,e._isHeaderCell(s,c));if(i(C)&&l!==C.masterCell)l.style=C.masterCell.style,l.value=C.masterCell.value;else if($(h.value)?l.value=this.convertDateForExcelJS(h.value):l.value=h.value,i(l.value)){const{bold:g,alignment:F,numberFormat:p}=u[t.getStyleId(s,c)];i(p)?this.setNumberFormat(l,p):_(l.value)&&/^[@=+-]/.test(l.value)&&this.setNumberFormat(l,"@"),e._trySetFont(l,g),this.setAlignment(l,o,F)}e._customizeCell(l,h.cellSourceData),f&&(l.value=A.encode(l.value))}}};class pe{constructor(e,n){this.dataProvider=e,this.worksheet=n,this.mergedCells=[],this.mergedRanges=[]}updateMergedRanges(e,n,s,r){if(r._isHeaderCell(n,s)&&!this.isCellInMergedRanges(n,s)){const{rowspan:a,colspan:o}=this.dataProvider.getCellMerging(n,s);if(o||a){const f=r._allowToMergeRange(n,s,a,o);if(this.updateMergedCells(e,n,s,a,o),f){const c=r._isInfoCell(n,s)&&r._allowExportRowFieldHeaders();this.mergedRanges.push({masterCell:e,rowspan:a-(c&&a>0),colspan:o})}}}}isCellInMergedRanges(e,n){var s;return(s=this.mergedCells[e])===null||s===void 0?void 0:s[n]}findMergedCellInfo(e,n,s){if(s&&this.isCellInMergedRanges(e,n))return this.mergedCells[e][n]}updateMergedCells(e,n,s,r,a){for(let o=n;o<=n+r;o+=1)for(let u=s;u<=s+a;u+=1)this.mergedCells[o]||(this.mergedCells[o]=[]),this.mergedCells[o][u]={masterCell:e}}addMergedRange(e,n,s){this.mergedRanges.push({masterCell:e,rowspan:n,colspan:s})}applyMergedRages(){this.mergedRanges.forEach((e=>{const n=e.masterCell.fullAddress.row,s=e.masterCell.fullAddress.col,r=n+e.rowspan,a=s+e.colspan;this.worksheet.mergeCells(n,s,r,a)}))}}export{Ce as E,pe as M,X as g};
