import{d as F,e_ as h,e$ as H,r as V,i as $,s as k,w as O,g as C,f as o,b as t,c as A,m as R,e as p,aY as G,aF as f,p as N,T as x,y as U,l as g,ay as q,F as J,o as w,x as Q}from"./main-Bci61fJ-.js";import{d as W}from"./dayjs.min-WZT4ZYRx.js";import{s as X,D as P,k as Z,d as ee}from"./data-grid-Ba5VG15X.js";import{V as ae}from"./VDialog-DIpLIGqa.js";import{a as te,b as ie,V as se}from"./VCard-DQQZhClb.js";import{V as le}from"./VCardText-0M6eGHjW.js";import{V as oe}from"./VRow-BvKpZ9wV.js";import{V as z}from"./VCol-BEDQ_1zk.js";import{V as re,a as ne,b as de}from"./VList-BJnvkTv3.js";import{V as ue}from"./VSpacer-ds0__od5.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./index-BhwJuAw7.js";import"./dom_component-CFxGGT7a.js";import"./m_row_dragging-5DAy3AAN.js";import"./m_resize_observer-BpDlBMfk.js";import"./m_select_box-DyZ6-Naj.js";import"./themes-skhwAFDA.js";import"./editor-BxQEF_dH.js";import"./overlay-4BK_jUr6.js";import"./format_helper-DkqiVhdE.js";import"./VOverlay-DGzWsA0z.js";import"./easing-Bybner-F.js";import"./delay-BqL7ME4G.js";import"./lazy-CPQDz-0i.js";import"./scopeId-vsXGXJqt.js";import"./index-DU9wqqct.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-Dk1stlfO.js";import"./createSimpleFunctional-DfuAzFL8.js";import"./VAvatar-DkAFqoU2.js";import"./VImg-B8Lz61Aj.js";/* empty css              */import"./ssrBoot-DhpILRlj.js";import"./VDivider-CnalsRSc.js";const me={key:0,class:"dialog-loading-overlay d-flex flex-column align-center justify-center"},ce={class:"text-caption text-end"},pe={class:"ps-6"},fe=F({__name:"PersonelSecDialog",props:h({isemriID:{},istasyonId:{},guid:{}},{modelValue:{type:Boolean},modelModifiers:{}}),emits:h(["kaydedildi","iptal"],["update:modelValue"]),setup(S,{emit:B}){const b=B,_=H(S,"modelValue"),u=S,D=V([]),d=V([]),n=V([]),m=V(!1);$(async()=>{const{data:i}=await k.get("/api/personeller");D.value=i}),O(_,async i=>{if(i){d.value=D.value.map(e=>({...e}));try{const e=await k.get("/api/aktif-ekipler",{params:{isemriID:u.isemriID,guid:u.guid}}),l=Array.isArray(e.data)?e.data:Object.values(e.data);n.value=l.map(a=>({register_id:a.register_id,ad_soyad:a.personel_full_name,kimlik_no:a.citizenship_no,istasyon_id:a.istasyon_id,sicil_no:a.sicil_no}));const s=new Set(n.value.map(a=>a.register_id));d.value=d.value.filter(a=>!s.has(a.register_id))}catch(e){console.error("Aktif ekip yüklenemedi:",e)}}});const E=i=>{const e=d.value.splice(i,1)[0];n.value.push(e)},T=i=>{const e=n.value.splice(i,1)[0];d.value.push(e)},M=i=>{const e=d.value.findIndex(l=>l.register_id===i);e!==-1&&E(e)},Y=async()=>{var e,l;if(m.value)return;m.value=!0;const i=W().format("YYYY-MM-DD HH:mm:ss");try{const{data:s}=await k.get("/api/aktif-ekipler",{params:{isemriID:u.isemriID,guid:u.guid}}),a=new Set((Array.isArray(s)?s:Object.values(s)).filter(r=>r.end_work_time===null).map(r=>r.register_id)),c=new Set(n.value.map(r=>r.register_id)),v=n.value.filter(r=>!a.has(r.register_id)),I=Array.from(a).filter(r=>!c.has(r));if(v.length){const r=v.map(y=>({istasyon_id:u.istasyonId,worder_m_id:u.isemriID,register_id:y.register_id,sicil_no:y.sicil_no,personel_full_name:y.ad_soyad,citizenship_no:y.kimlik_no,co_id:2517,start_work_time:i,end_work_time:null,guid:u.guid}));console.log("Eklenecekler:",r),await k.post("/api/aktif-ekipler",r)}I.length&&await k.put("/api/aktif-ekipler/kapat",{register_ids:I,guid:u.guid,end_work_time:i}),b("kaydedildi")}catch(s){const a=(e=s==null?void 0:s.response)==null?void 0:e.status,c=(l=s==null?void 0:s.response)==null?void 0:l.data;console.error("KAYIT HATASI:",a,c||s)}finally{m.value=!1,_.value=!1}},j=()=>{_.value=!1,b("iptal")},L=i=>{i||b("iptal")},K=()=>{const i=new Set(n.value.map(a=>Number(a.register_id))),e=[];for(let a=d.value.length-1;a>=0;a--){const c=d.value[a],v=Number(c.register_id);c.istasyon_id===u.istasyonId&&!i.has(v)&&(e.push(c),d.value.splice(a,1))}const l=new Set(n.value.map(a=>Number(a.register_id))),s=e.filter(a=>!l.has(Number(a.register_id)));n.value.push(...s)};return(i,e)=>(w(),C(ae,{modelValue:_.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>_.value=l),L],"max-width":"800"},{default:o(()=>[t(se,{class:"personel-dialog-card"},{default:o(()=>[m.value?(w(),A("div",me,[t(G,{indeterminate:"",color:"primary",size:"48",class:"mb-3"}),e[3]||(e[3]=p("span",{style:{"font-weight":"600"}},"Kayıt yapılıyor...",-1))])):R("",!0),t(te,{class:"text-h6 d-flex justify-space-between align-center"},{default:o(()=>[e[5]||(e[5]=f(" Personel Seçimi ")),p("div",ce,[p("div",null,[e[4]||(e[4]=p("strong",null,"Seçilen:",-1)),f(" "+N(n.value.length)+" kişi",1)])])]),_:1,__:[5]}),p("div",pe,[t(x,{variant:"outlined",onClick:e[0]||(e[0]=l=>K()),disabled:m.value},{default:o(()=>[t(U,{start:"",icon:"tabler-users"}),e[6]||(e[6]=f(" Ekip Aktar "))]),_:1,__:[6]},8,["disabled"])]),t(le,null,{default:o(()=>[t(oe,null,{default:o(()=>[t(z,{cols:"6"},{default:o(()=>[t(g(X),{"data-source":d.value,height:600,"key-expr":"kimlik_no","show-borders":!0,"hover-state-enabled":!0,onRowClick:e[1]||(e[1]=l=>M(l.data.kimlik_no))},{default:o(()=>[t(g(P),{"data-field":"ad_soyad",caption:"Ad Soyad","sort-order":"asc"}),t(g(P),{"data-field":"sicil_no",caption:"Sicil No",width:"100",visible:!1}),t(g(Z),{visible:!0,"highlight-case-sensitive":!1}),t(g(ee),{mode:"virtual","row-rendering-mode":"virtual","show-scrollbar":"always"})]),_:1},8,["data-source"])]),_:1}),t(z,{cols:"6"},{default:o(()=>[e[7]||(e[7]=p("h5",{class:"text-subtitle-2 mt-9 mb-2"},"Ekip Listesi",-1)),t(re,{class:"border rounded",style:{"max-block-size":"535px","overflow-y":"auto"}},{default:o(()=>[(w(!0),A(J,null,q(n.value,(l,s)=>(w(),C(ne,{key:l.kimlik_no,onClick:a=>T(s),class:"cursor-pointer"},{default:o(()=>[t(de,null,{default:o(()=>[f(N(l.ad_soyad),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1,__:[7]})]),_:1})]),_:1}),t(ie,null,{default:o(()=>[t(ue),t(x,{variant:"outlined",color:"warning",onClick:j,disabled:m.value},{default:o(()=>e[8]||(e[8]=[f("Vazgeç")])),_:1,__:[8]},8,["disabled"]),t(x,{onClick:Y,variant:"outlined",color:"success",disabled:m.value},{default:o(()=>e[9]||(e[9]=[f("Kaydet")])),_:1,__:[9]},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Je=Q(fe,[["__scopeId","data-v-f5625b13"]]);export{Je as default};
