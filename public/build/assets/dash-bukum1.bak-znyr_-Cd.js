import{d as Ae,r as n,D as y,i as se,b2 as R,c as m,m as O,b as o,e as s,f as r,F as oe,s as Ee,p as S,V as W,az as Me,ay as ze,aA as Ne,l as f,o as v,x as Ve}from"./main-BsBPzaN6.js";import{D as Le,a as Re,b as Oe,c as ie,d as We,e as qe,f as Be,g as Fe,h as Pe}from"./chart-CsQMbVMi.js";import{V as $e}from"./VRow-CwsVaWJo.js";import{V as p}from"./VCol-nFHEoKtU.js";import{V as ne}from"./VCard-Bn92qnwe.js";import{V as re}from"./VCardText-E037F6rH.js";import"./index-DCLb7BvJ.js";import"./dom_component-BOMsNA7g.js";import"./m_base_widget-CzY0bw-m.js";import"./format_helper-BxObqpko.js";import"./file_saver-D4H08IA6.js";import"./m_resize_observer-D2tcFhH5.js";import"./themes-s_hOyPlB.js";/* empty css              */import"./createSimpleFunctional-DkyDAl5o.js";import"./VAvatar-DlizocLV.js";import"./VImg-DiUUq3m5.js";import"./index-Cxa9DyQz.js";const je={key:0,class:"loading-overlay"},Ie={class:"summary-kpis px-4"},Ye={class:"kpi"},Ge={class:"kpi"},Ke={class:"kpi border-e pe-2"},He={class:"dash-actions mt-3"},Ue=["disabled"],Xe={key:0},Ze={key:1},Je={key:0,class:"last-updated"},Qe={key:1,class:"warn",title:"API geçici boş yanıt verdi; önceki veriler gösteriliyor"},et={key:2,class:"warn"},tt={key:3,class:"hint"},lt={class:"weekly-vertical ma-0 ms-2"},at={key:0,class:"wv-bars"},st={class:"wv-stack"},A=1e4,ot=Ae({__name:"dash-bukum1.bak",setup(it){const Z=n(["Üretimde süreklilik için proaktif bakım planı devrede","Operatör güvenliği: Koruyucu ekipman kontrolü yapılmalı","Enerji verimliliği izleniyor – gereksiz duruşları azaltın","Kalite ilk seferde doğru üretimle başlar","Anlık OEE analizi ile darboğazları tespit edin"]);y(()=>[...Z.value,...Z.value]);const h=n(0),ue=n(!1);let E=null;const de=[60,100,140,200],ce=n(2),me=y(()=>de[ce.value]||140),ve=n(null),q=n(0),k=n(0);let M=0;y(()=>({transform:`translateX(${h.value}px)`,inlineSize:q.value+"px"}));function B(){const t=ve.value;if(!t)return;const e=t.querySelectorAll(".ticker-item");if(!e.length)return;const i=Math.floor(e.length/2);let l=0;for(let u=0;u<i;u++){const a=e[u];l+=a.offsetWidth,u<i-1&&(l+=42)}k.value=l,q.value=l*2,h.value<-k.value&&(h.value=(h.value%k.value+k.value)%k.value*-1)}function J(t){M||(M=t);const e=(t-M)/1e3;M=t,!ue.value&&q.value&&(h.value-=me.value*e,k.value&&h.value<=-k.value&&(h.value+=k.value)),E=requestAnimationFrame(J)}se(()=>{requestAnimationFrame(()=>{B(),E=requestAnimationFrame(J)}),window.addEventListener("resize",B),D=new ResizeObserver(()=>te()),x.value&&D.observe(x.value),requestAnimationFrame(()=>te())}),R(()=>{E&&cancelAnimationFrame(E)}),R(()=>{window.removeEventListener("resize",B)}),R(()=>{if(D){try{x.value&&D.unobserve(x.value)}catch{}D.disconnect(),D=null}});const F=n([]),d=n({availability:0,performance:0,quality:1,oee:0}),Q=n([]),P=n([]),fe=n([]),g=n(!0),$=n(!1),z=n(!1),N=n(null),j=n(!1),I=n(!1),Y=n(0),_=n(A),pe=n(null),ye=y(()=>g.value&&!N.value),V=t=>isFinite(t)?`${Math.round(t*100)}%`:"-",ke=t=>{const e=t*100;return e<50?"oee-red":e<70?"oee-yellow":e<85?"oee-orange":"oee-green"};function be(t){const e=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${e}-${i}-${l}`}const G=y(()=>{const t=[],e=new Date,l=(e.getDay()+6)%7,u=new Date(e);u.setHours(0,0,0,0),u.setDate(e.getDate()-l);const a=["Paz","Pzt","Sal","Çar","Per","Cum","Cmt"];for(let U=0;U<7;U++){const X=new Date(u);X.setDate(u.getDate()+U);const Se=be(X),Ce=a[X.getDay()]||"";t.push({date:Se,label:Ce,work:0,stop:0})}return t}),K=y(()=>{const t=new Map;for(const e of G.value)t.set(e.date,{...e});for(const e of P.value){const i=String(e.date);if(!t.has(i))continue;const l=t.get(i);t.set(i,{date:i,label:l.label,work:Number(e.work||0),stop:Number(e.stop||0)})}return G.value.map(e=>t.get(e.date)||e)});y(()=>[{name:"Çalışma",data:K.value.map(t=>t.work)},{name:"Duruş",data:K.value.map(t=>t.stop)}]),y(()=>({chart:{stacked:!0,toolbar:{show:!1},width:"100%"},plotOptions:{bar:{horizontal:!1,columnWidth:"70%",borderRadius:4}},dataLabels:{enabled:!1},grid:{strokeDashArray:3,borderColor:"rgba(255,255,255,0.08)"},xaxis:{categories:G.value.map(t=>t.label)},yaxis:{labels:{formatter:t=>`${Math.round(t)}`},title:{text:"dk"}},tooltip:{shared:!0,intersect:!1},colors:["#189c49","#efb803"]}));const he=y(()=>K.value.map(t=>({label:t.label,work:t.work,stop:t.stop})));function ge(t){return{text:(Array.isArray(t.points)?t.points:[t]).map(l=>`${l.seriesName}: ${Math.round(l.value)}`).join(`
`)}}const x=n(null),ee=n(void 0);let D=null;function te(){const t=x.value;if(!t)return;const e=Math.max(0,Math.floor(t.clientWidth));ee.value=e||void 0}let w=null;const T=n(null);async function we(t){var e;try{F.value.length===0?g.value=!0:z.value=!0,w&&(clearTimeout(w),w=null),w=window.setTimeout(()=>{$.value=!0},2500),T.value=null;const{data:l}=await Ee.get("/api/dash-bukum/overview",{signal:t,timeout:1e4}),u=((l==null?void 0:l.machines)||[]).map(a=>({id:Number(a.id),name:String(a.name??""),operator:a.operator||void 0,breakDescription:a.break_description??a.breakDescription??a.break_desc??void 0,statuTime:a.statu_time??a.statuTime??void 0,itemCode:a.itemCode??a.item_code??void 0,itemName:a.itemName??a.item_name??void 0,counter:a.counter!==void 0&&a.counter!==null?Number(a.counter):void 0,status:a.status??"stopped",availability:Number(a.availability)||0,performance:Number(a.performance)||0,quality:Number(a.quality)||1,oee:Number(a.oee)||0,workRatio:Number(a.workRatio)||0,stopRatio:Number(a.stopRatio)||0,code:a.code||"",segments:Array.isArray(a.segments)?a.segments:Array.isArray(a.barData)?a.barData:Array.isArray(a.timeline)?a.timeline:void 0}));pe.value=(l==null?void 0:l.meta)||null,u.length===0?F.value.length===0?j.value=!0:I.value=!0:(F.value=u,j.value=!1,I.value=!1),d.value=(l==null?void 0:l.daySummary)||d.value,Q.value=(l==null?void 0:l.reasons)||Q.value,P.value=(l==null?void 0:l.weekly)||P.value,fe.value=((l==null?void 0:l.weeklyCounts)||(l==null?void 0:l.weekly_counts)||[]).map(a=>({date:String(a.date),label:String(a.label??""),count:Number(a.count??0)})),N.value=new Date,Y.value=0,_.value=A}catch(i){Y.value+=1,_.value=Math.min(A*Math.pow(2,Y.value),6e4);const l=(e=i==null?void 0:i.response)==null?void 0:e.status;l===401?T.value="Yetki hatası (401).":l===404?T.value="Endpoint bulunamadı (404).":l===500?T.value="Sunucu hatası (500).":(i==null?void 0:i.code)==="ECONNABORTED"?T.value="Zaman aşımı.":(i==null?void 0:i.name)==="CanceledError"||(i==null?void 0:i.message)==="canceled"||(T.value="Beklenmeyen hata.")}finally{g.value=!1,z.value=!1,w&&(clearTimeout(w),w=null),$.value&&setTimeout(()=>{$.value=!1},400)}}const _e=A;let c=null,L=!1,b=null;function C(t=_.value){c&&clearTimeout(c),c=window.setTimeout(le,t)}async function le(){if(document.hidden){C(Math.max(3e4,_.value));return}if(L){C(500);return}L=!0,b&&b.abort(),b=new AbortController;try{await we(b.signal)}finally{L=!1,C(_e)}}function ae(){document.hidden?(b&&b.abort(),c&&(clearTimeout(c),c=null)):C(0)}function xe(){L||(c&&(clearTimeout(c),c=null),C(0))}function De(t){return t?t.toLocaleTimeString("tr-TR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}const Te=n(Date.now());let H=null;return se(async()=>{document.addEventListener("visibilitychange",ae),await le(),H=window.setInterval(()=>{Te.value=Date.now()},1e3)}),R(()=>{document.removeEventListener("visibilitychange",ae),b&&b.abort(),c&&clearTimeout(c),H&&clearInterval(H)}),(t,e)=>(v(),m(oe,null,[ye.value?(v(),m("div",je,e[0]||(e[0]=[s("div",{class:"loader-box"},[s("div",{class:"spinner","aria-hidden":"true"}),s("h2",null,"Veriler yükleniyor"),s("p",null,"Makine durumları, OEE ve haftalık istatistikler getiriliyor. Lütfen bekleyin…")],-1)]))):O("",!0),o($e,{class:"match-height"},{default:r(()=>[o(p,{cols:"12",md:"4"},{default:r(()=>[o(ne,{height:"260"},{default:r(()=>[o(re,null,{default:r(()=>e[1]||(e[1]=[s("h5",{class:"text-h5"},"Günlük Genel Değerlendirme",-1)])),_:1,__:[1]}),s("div",Ie,[s("div",Ye,[e[2]||(e[2]=s("span",null,"Çlş.",-1)),s("strong",null,S(V(d.value.availability)),1),o(W,{"model-value":d.value.availability*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",Ge,[e[3]||(e[3]=s("span",null,"Perf.",-1)),s("strong",null,S(V(d.value.performance)),1),o(W,{"model-value":d.value.performance*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",Ke,[e[4]||(e[4]=s("span",null,"Kalite",-1)),s("strong",null,S(V(d.value.quality)),1),o(W,{"model-value":d.value.quality*100,color:"primary",height:"10"},null,8,["model-value"])]),s("div",{class:Me(["kpi oee",ke(d.value.oee)])},[e[5]||(e[5]=s("span",null,"OEE",-1)),s("strong",null,S(V(d.value.oee)),1),o(W,{"model-value":d.value.oee*100,color:"success",height:"10"},null,8,["model-value"])],2)]),s("div",He,[s("button",{class:"refresh-btn",onClick:xe,disabled:z.value||g.value},[z.value?(v(),m("span",Xe,"⟳ Yenileniyor...")):(v(),m("span",Ze,"⟳ Yenile"))],8,Ue),N.value?(v(),m("small",Je,"Güncellendi: "+S(De(N.value)),1)):O("",!0),I.value?(v(),m("small",Qe,"Geçici boş yanıt")):j.value&&!g.value?(v(),m("small",et,"Veri yok")):O("",!0),_.value>A&&!g.value?(v(),m("small",tt,"Bekleme: "+S(Math.round(_.value/1e3))+"sn",1)):O("",!0)])]),_:1})]),_:1}),o(p,{cols:"12",md:"4",sm:"6"},{default:r(()=>[o(ne,{height:"260"},{default:r(()=>[o(re,{class:"pa-5"},{default:r(()=>e[6]||(e[6]=[s("h5",{class:"text-h5"},"Haftalık Çalışma / Duruş (dk)",-1)])),_:1,__:[6]}),s("div",lt,[g.value?(v(),m("div",at,[(v(),m(oe,null,ze(7,i=>s("div",{key:"wv-dx-skel-"+i,class:"wv-col"},[s("div",st,[s("div",{class:"wv-fill sk-fill",style:Ne({blockSize:20+i*6+"%"})},null,4)]),e[7]||(e[7]=s("div",{class:"wv-day"}," ",-1))])),64))])):(v(),m("div",{key:1,class:"dx-weekly-wrap",ref_key:"dxWrapEl",ref:x},[o(f(Le),{"data-source":he.value,size:{height:180,width:ee.value||void 0}},{default:r(()=>[o(f(Re),{right:16,left:8,top:8,bottom:0}),o(f(Oe),{"argument-field":"label",type:"stackedBar"}),o(f(ie),{"value-field":"work",name:"Çalışma",color:"#189c49"}),o(f(ie),{"value-field":"stop",name:"Duruş",color:"#efb803"}),o(f(We),{"discrete-axis-division-mode":"betweenLabels"}),o(f(qe),null,{default:r(()=>[o(f(Be),{visible:!0})]),_:1}),o(f(Fe),{enabled:!0,shared:!0,"customize-tooltip":ge}),o(f(Pe),{position:"bottom","horizontal-alignment":"center",visible:!1})]),_:1},8,["data-source","size"])],512))])]),_:1})]),_:1}),o(p,{cols:"12",md:"3",sm:"6"},{default:r(()=>e[8]||(e[8]=[s("h1",null,"Sales Overview",-1)])),_:1,__:[8]}),o(p,{cols:"12",md:"6"},{default:r(()=>e[9]||(e[9]=[s("h1",null,"Earning Reports Weekly Overview",-1)])),_:1,__:[9]}),o(p,{cols:"12",md:"6"},{default:r(()=>e[10]||(e[10]=[s("h1",null,"Support Tracker",-1)])),_:1,__:[10]}),o(p,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[11]||(e[11]=[s("h1",null,"Sales by Countries",-1)])),_:1,__:[11]}),o(p,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[12]||(e[12]=[s("h1",null,"Total Earning",-1)])),_:1,__:[12]}),o(p,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[13]||(e[13]=[s("h1",null,"Monthly Campaign State",-1)])),_:1,__:[13]}),o(p,{cols:"12",sm:"6",lg:"4"},{default:r(()=>e[14]||(e[14]=[s("h1",null,"Source Visits",-1)])),_:1,__:[14]}),o(p,{cols:"12",lg:"8"},{default:r(()=>e[15]||(e[15]=[s("h1",null,"pjjjpjpjpo",-1)])),_:1,__:[15]})]),_:1})],64))}}),Tt=Ve(ot,[["__scopeId","data-v-08b3c0b4"]]);export{Tt as default};
