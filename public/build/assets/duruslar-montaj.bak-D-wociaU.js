import{u as De}from"./pageTitle-BhmaQy6J.js";import{d as xe,r,D as h,aq as we,i as _e,w as ke,a as Te,c as Se,o as E,b as e,l as t,f as n,e as d,g as Ce,aA as Re,p as Fe,F as Me,s as Pe,aK as z}from"./main-DCUJhUhR.js";import{D}from"./button-Cz7jt4pB.js";import{D as Ne,b as Ie,h as Oe,g as Be,k as Ee}from"./chart-MnmZUgUX.js";import{s as ze,D as s,e as Le,f as Ge,g as Ue,h as Ae,i as je,j as Ve,k as Ye,d as $e,l as Ke,m as Qe,n as qe,o as He,p as We,b as Je,c as u,q as Xe,r as L,t as G}from"./data-grid-CYOqx4Ho.js";import{D as U}from"./date-box-DEMo8c7t.js";import{D as A}from"./load-panel-XfMp5Qo7.js";import{D as Ze}from"./number-box-BY49HI5G.js";import{D as et,c as tt,d as at,f as ot,P as lt}from"./pivot-grid-Bh5_4Jmx.js";import{n as it}from"./notify-pNJuSwh0.js";import{V as nt}from"./VCardText-Bn02KgKk.js";import{V as rt}from"./VCol-BGlht0eS.js";import{V as st}from"./VCard-D_YdKlWr.js";import"./index-BQIgBoUx.js";import"./dom_component-BKjseBUi.js";import"./m_select_box-DmabWyr0.js";import"./themes-DUCqBcv-.js";import"./editor-Cq2gaKZh.js";import"./overlay-IWi9orsQ.js";import"./m_resize_observer-D-ZSYfzD.js";import"./m_base_widget-DTt7T0bR.js";import"./format_helper-XMU9hzjj.js";import"./m_row_dragging-BGM0kDgc.js";import"./language_codes-LmU07nLw.js";/* empty css              */import"./createSimpleFunctional-B93PKyQs.js";import"./VAvatar-BaooApo5.js";import"./VImg-nR9t6jrR.js";import"./index-B_QQFSN0.js";const ut={id:"liste",style:{"margin-block-end":"-10px"}},dt={style:{display:"flex","align-items":"center",gap:"6px","margin-inline-start":"10px"}},mt={style:{display:"flex","align-items":"center",gap:"6px"}},ct={class:"duration-cell"},pt={class:"duration-cell__label"},ft={style:{display:"flex","align-items":"center",gap:"6px","inline-size":"120px"}},gt={id:"pivot-chart",style:{display:"grid",gap:"12px","grid-template-columns":"1fr","margin-block-start":"8px"}},w="Duruşlar",_="Montaj",Kt=xe({__name:"duruslar-montaj.bak",setup(vt){const k=De();k.setTitle(`${w} (${_})`),document.title=`OFT - ${w} | ${_}`;const j=r(0),m=r([]),x=r(!1),v=r(!1),T=r(""),S=r(null),C=r(null),R=r(null),F=r(null),V=r([]),Y=r(!0),$=r(!0),K={of:"#grid"},y=r(Number(localStorage.getItem("montaj.longDowntimeMin")||30)),c=r(null),p=r(null),M=r(null),Q=[{dataField:"durus_sebebi",caption:"Sebep",area:"row",width:300,expanded:!1,sortBySummaryField:"durum_bas_tarihi",sortOrder:"desc"},{dataField:"istasyon",caption:"İstasyon",area:"row",width:300,expanded:!1},{dataField:"durum_bas_tarihi",caption:"Yıl",dataType:"date",groupInterval:"year",area:"column",expanded:!0},{dataField:"durum_bas_tarihi",caption:"Ay",dataType:"date",groupInterval:"month",area:"column",expanded:!1},{dataField:"durum_bas_tarihi",caption:"Gün",dataType:"date",groupInterval:"day",area:"column",expanded:!1},{dataField:"durum_suresi",caption:"Süre (dk)",dataType:"number",summaryType:"sum",area:"data",format:{type:"fixedPoint",precision:0}}],P=h({get:()=>!v.value,set:a=>{v.value=!a}}),q=we(),H=h(()=>{try{return!!q.global.current.value.dark}catch{return!!document.querySelector("body.v-theme--dark, .v-theme--dark")}}),W=h(()=>{const a=m.value.reduce((o,i)=>{const l=Number(i==null?void 0:i.durum_suresi)||0;return l>o?l:o},0);return a>0?a:1}),g=r(localStorage.getItem("montaj.clipQ95")==="1"),J=h(()=>m.value.map(a=>Number(a==null?void 0:a.durum_suresi)||0));function X(a,o){if(!a||a.length===0)return 1;const i=[...a].sort((be,he)=>be-he),l=(i.length-1)*o,f=Math.floor(l),B=Math.ceil(l);if(B===f)return Math.max(1,i[f]);const ye=l-f;return Math.max(1,i[f]+(i[B]-i[f])*ye)}const Z=h(()=>{if(g.value){const a=X(J.value,.95);return a>0?a:1}return W.value}),ee=()=>{g.value=!g.value,localStorage.setItem("montaj.clipQ95",g.value?"1":"0")},te=a=>{if(H.value)switch(a){case"DURUYOR":return"linear-gradient(90deg, #ff8a65, #e53935)";case"MOLA":return"linear-gradient(90deg, #ba68c8, #8e24aa)";default:return"linear-gradient(90deg, #90caf9, #42a5f5)"}else switch(a){case"DURUYOR":return"linear-gradient(90deg, #ffccbc, #ff8a65)";case"MOLA":return"linear-gradient(90deg, #e1bee7, #ce93d8)";default:return"linear-gradient(90deg, #bbdefb, #90caf9)"}};function N(a){return typeof a.value=="number"?new Intl.NumberFormat("tr-TR",{maximumFractionDigits:0}).format(a.value):a.valueText}const b=async()=>{var a,o;x.value=!0;try{const i={};c.value instanceof Date&&(i.from=c.value.toISOString().slice(0,10)),p.value instanceof Date&&(i.to=p.value.toISOString().slice(0,10));const{data:l}=await Pe.get("/api/duruslar-montaj",{params:i});m.value=l.data||[],(o=(a=S.value)==null?void 0:a.instance)==null||o.refresh(),I(),await z(),O(),console.log("duruslar-montaj yüklendi, kayıt sayısı:",m.value.length)}catch(i){console.error("duruslar-montaj yüklenemedi:",i),m.value=[],it("Veri alınamadı","error",1500)}finally{x.value=!1,v.value||(v.value=!0)}},ae=()=>{b()},oe=()=>{c.value=null,p.value=null,b()},le=a=>{c.value=a.value??null},ie=()=>{const o=new Date().toISOString().slice(0,10);c.value=new Date(o),p.value=new Date(o),b()},ne=()=>{const a=new Date;a.setDate(a.getDate()-1);const o=a.toISOString().slice(0,10);c.value=new Date(o),p.value=new Date(o),b()},re=a=>{const o=Number(a.value||30);y.value=isNaN(o)?30:o,localStorage.setItem("montaj.longDowntimeMin",String(y.value))},se=a=>{p.value=a.value??null},ue=a=>{var i,l;if(a.rowType!=="data")return;const o=a.data;(o==null?void 0:o.durum)==="DURUYOR"&&Number(o==null?void 0:o.durum_suresi)>=y.value&&((l=(i=a.rowElement)==null?void 0:i.classList)==null||l.add("long-downtime"))},de=a=>{var l;if(a.rowType!=="data")return;const o=a.data;(o==null?void 0:o.durum)==="DURUYOR"&&Number(o==null?void 0:o.durum_suresi)>=y.value&&((l=a.column)==null?void 0:l.dataField)==="durum_suresi"&&a.cellElement&&(a.cellElement.classList.add("duration-long"),a.cellElement.style.fontWeight="700")},me=()=>{},ce=()=>{},pe=()=>{},fe=()=>{},ge=()=>{},ve=()=>{};_e(()=>{k.setTitle(`${w} (${_})`),document.title=`OFT - ${w} | ${_}`,b()});function I(){try{M.value=new lt({fields:Q,store:m.value||[]})}catch(a){console.error("PivotDataSource oluşturulamadı:",a)}}function O(){var i,l;const a=(i=C.value)==null?void 0:i.instance,o=(l=R.value)==null?void 0:l.instance;if(a&&o)try{a.bindChart(o,{dataFieldsDisplayMode:"splitPanes",alternateDataFields:!1})}catch(f){console.warn("Pivot-Chart bağlama hatası:",f)}}return ke(m,async()=>{I(),await z(),O()}),(a,o)=>{const i=Te("DxGridLoadPanel");return E(),Se(Me,null,[e(t(A),{visible:P.value,"onUpdate:visible":o[0]||(o[0]=l=>P.value=l),"show-indicator":!0,"show-pane":!0,shading:!0,message:"Montaj Duruşları Yükleniyor",position:{of:"#grid"}},null,8,["visible"]),e(st,{class:"mt-0 pa-0 pt-2"},{default:n(()=>[e(nt,{class:"mt-0 pa-0 ms-2 me-1"},{default:n(()=>[e(rt,{cols:"12",class:"mt-0 pa-1 pe-2"},{default:n(()=>[d("div",ut,[(E(),Ce(t(ze),{id:"grid",ref_key:"dataGridRef",ref:S,key:j.value,"data-source":m.value,"key-expr":"id","show-borders":!0,"focused-row-enabled":!0,"row-alternation-enabled":!0,"min-width":200,onExporting:me,"allow-column-reordering":!0,"column-auto-width":!1,onContentReady:ce,onFocusedRowChanged:pe,"allow-column-resizing":!0,"column-resizing-mode":"widget",onCellPrepared:de,onSelectionChanged:fe,"auto-navigate-to-focused-row":!0,onRowPrepared:ue,"on-option-changed":ge,onContextMenuPreparing:ve,"focused-row-key":F.value,"onUpdate:focusedRowKey":o[1]||(o[1]=l=>F.value=l),"selected-rows-keys":V.value},{fromDateTemplate:n(()=>[d("div",dt,[o[3]||(o[3]=d("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Başlangıç",-1)),e(t(U),{value:c.value,type:"date","display-format":"yyyy-MM-dd","on-value-changed":le},null,8,["value"])])]),toDateTemplate:n(()=>[d("div",mt,[o[4]||(o[4]=d("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Bitiş",-1)),e(t(U),{value:p.value,type:"date","display-format":"yyyy-MM-dd","on-value-changed":se},null,8,["value"])])]),filtreleTemplate:n(()=>[e(t(D),{icon:"filter",text:"Listele","styling-mode":"contained",type:"default",onClick:ae})]),temizleTemplate:n(()=>[e(t(D),{icon:"close",text:"Temizle","styling-mode":"outlined",type:"normal",onClick:oe})]),durationCell:n(({data:l})=>[d("div",ct,[d("div",{class:"duration-cell__bar",style:Re({inlineSize:Math.min(100,Math.round((Number(l.value)||0)/Z.value*100))+"%",background:te(l&&l.data&&l.data.durum||null)})},null,4),d("div",pt,Fe(new Intl.NumberFormat("tr-TR",{maximumFractionDigits:0}).format(Number(l.value)||0)),1)])]),clipTemplate:n(()=>[e(t(D),{icon:(g.value,"percent"),text:g.value?"Q95 Açık":"Q95 Kapalı","styling-mode":"outlined",type:"default",onClick:ee},null,8,["icon","text"])]),bugunTemplate:n(()=>[e(t(D),{icon:"event",text:"Bugün","styling-mode":"outlined",type:"default",onClick:ie})]),dunTemplate:n(()=>[e(t(D),{icon:"event",text:"Dün","styling-mode":"outlined",type:"default",onClick:ne})]),esikTemplate:n(()=>[d("div",ft,[o[5]||(o[5]=d("span",{style:{color:"var(--v-theme-on-surface)","font-size":"12px"}},"Eşik (dk)",-1)),e(t(Ze),{value:y.value,min:1,max:1440,"show-spin-buttons":!0,"on-value-changed":re},null,8,["value"])])]),default:n(()=>[e(t(s),{"data-field":"id",caption:"ID",visible:!1,width:"90"}),e(t(s),{"data-field":"istasyon",caption:"İSTASYON",visible:!0,width:"250"}),e(t(s),{"data-field":"durum_bas_tarihi",caption:"BAŞLANGIÇ","data-type":"date",width:160,visible:!0,format:{formatter:l=>new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(l)).replace(/\//g,".")}},null,8,["format"]),e(t(s),{"data-field":"durum_bit_tarihi",caption:"BİTİŞ","data-type":"date",width:160,visible:!0,format:{formatter:l=>l?new Intl.DateTimeFormat("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(new Date(l)).replace(/\//g,"."):"-"}},null,8,["format"]),e(t(s),{"data-field":"durum_suresi",caption:"SÜRE (dk)","data-type":"number",width:160,visible:!0,"cell-template":"durationCell"}),e(t(s),{"data-field":"durus_sebebi_kodu",caption:"SEBEP KODU",visible:!0,width:"120"}),e(t(s),{"data-field":"durus_sebebi",caption:"SEBEP",visible:!0,width:"180"}),e(t(s),{"data-field":"is_emri_no",caption:"İŞ EMRİ NO",visible:!0,width:"140"}),e(t(s),{"data-field":"urun_kodu",caption:"ÜRÜN KODU",visible:!0,width:"140"}),e(t(s),{"data-field":"urun_adi",caption:"ÜRÜN ADI",visible:!0,"min-width":"200"}),e(t(s),{"data-field":"personel_id",caption:"PERSONEL ID",visible:!0,width:"120"}),e(t(s),{"data-field":"isemri_id",caption:"İŞ EMRİ ID",visible:!1,width:"120"}),e(t(s),{"data-field":"urun_id",caption:"ÜRÜN ID",visible:!1,width:"120"}),e(i,{enabled:v.value,text:T.value||"Yükleniyor...","show-indicator":!0,"show-pane":!0,shading:!0},null,8,["enabled","text"]),e(t(Le),{mode:"single"}),e(t(Ge),{"auto-expand-all":Y.value},null,8,["auto-expand-all"]),e(t(Ue),{visible:!0}),e(t(Ae),{visible:!0}),e(t(je),{visible:!0}),e(t(Ve),{visible:$.value},null,8,["visible"]),e(t(Ye),{visible:!0,width:240}),e(t($e),{mode:"virtual","row-rendering-mode":"virtual","show-scrollbar":"always"}),e(t(Ke),{mode:"multiple"}),e(t(Qe),{enabled:!0,"allow-export-selected-data":!1}),e(t(qe),{height:"540px",enabled:!0,mode:"select",position:K},{default:n(()=>[e(t(He),{enabled:!0}),e(t(We),{"allow-select-all":!0,"select-by-click":!0,recursive:!0})]),_:1}),e(t(Je),null,{default:n(()=>[e(t(u),{location:"before",name:"groupPanel"}),e(t(u),{location:"before",template:"fromDateTemplate"}),e(t(u),{location:"before",template:"toDateTemplate"}),e(t(u),{location:"before",template:"bugunTemplate"}),e(t(u),{location:"before",template:"dunTemplate"}),e(t(u),{location:"before",template:"filtreleTemplate"}),e(t(u),{location:"before",template:"temizleTemplate"}),e(t(u),{location:"before",template:"esikTemplate"}),e(t(u),{location:"before",template:"clipTemplate"}),e(t(u),{name:"exportButton"}),e(t(u),{name:"columnChooserButton"}),e(t(u),{name:"searchPanel"})]),_:1}),e(t(Xe),null,{default:n(()=>[e(t(L),{"align-by-column":!0,column:"durus_sebebi","summary-type":"count","display-format":"{0} duruş",alignment:"right"}),e(t(L),{"align-by-column":!0,column:"durum_suresi","summary-type":"sum",alignment:"right","customize-text":N}),e(t(G),{"align-by-column":!0,column:"durus_sebebi","summary-type":"count","display-format":"{0} duruş",alignment:"right"}),e(t(G),{"align-by-column":!0,column:"durum_suresi","summary-type":"sum",alignment:"right","customize-text":N})]),_:1})]),_:1},8,["data-source","focused-row-key","selected-rows-keys"])),e(t(A),{visible:x.value,"onUpdate:visible":o[2]||(o[2]=l=>x.value=l),"show-indicator":!0,"show-pane":!0,shading:!0,message:T.value||"Yükleniyor...",position:{of:"#grid"}},null,8,["visible","message"])]),d("div",gt,[e(t(et),{id:"pivotgrid",ref_key:"pivotRef",ref:C,"data-source":M.value,"allow-sorting-by-summary":!0,"allow-filtering":!0,"show-borders":!0,"show-column-grand-totals":!0,"show-row-grand-totals":!0,"show-row-totals":!1,"show-column-totals":!1,height:570},{default:n(()=>[e(t(tt),{enabled:!0,height:400}),e(t(at),{visible:!0}),e(t(ot),{enabled:!0,type:"localStorage","storage-key":"dx-widget-gallery-pivotgrid-storing"})]),_:1},8,["data-source"]),e(t(Ne),{ref_key:"chartRef",ref:R,"data-source":[],palette:"Soft",style:{"block-size":"360px","inline-size":"100%"}},{default:n(()=>[e(t(Ie),{type:"bar","argument-field":"arg","value-field":"val"}),e(t(Oe),{visible:!0,position:"outside"}),e(t(Be),{enabled:!0,format:"fixedPoint",precision:0}),e(t(Ee),{height:360})]),_:1},512)])]),_:1})]),_:1})]),_:1})],64)}}});export{Kt as default};
